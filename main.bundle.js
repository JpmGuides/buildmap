webpackJsonp([1],{0:function(e,n,t){e.exports=t("rl7j")},rl7j:function(e,n,t){"use strict";function l(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","fa fa-recycle pull-right"],["style","font-size: 14pt"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.resetToDefault()&&l}return l},null,null))],null,null)}function i(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,3,"option",[],null,null,null,null,null)),ie["\u0275did"](147456,null,0,pe.i,[ie.ElementRef,ie.Renderer2,[2,pe.j]],{value:[0,"value"]},null),ie["\u0275did"](147456,null,0,pe.o,[ie.ElementRef,ie.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),ie["\u0275ted"](null,["",""]))],function(e,n){e(n,1,0,n.context.$implicit),e(n,2,0,n.context.$implicit)},function(e,n){e(n,3,0,n.context.$implicit)})}function o(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,3,"option",[],null,null,null,null,null)),ie["\u0275did"](147456,null,0,pe.i,[ie.ElementRef,ie.Renderer2,[2,pe.j]],{value:[0,"value"]},null),ie["\u0275did"](147456,null,0,pe.o,[ie.ElementRef,ie.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),ie["\u0275ted"](null,["",""]))],function(e,n){e(n,1,0,n.context.$implicit.name),e(n,2,0,n.context.$implicit.name)},function(e,n){e(n,3,0,n.context.$implicit.name)})}function r(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),ie["\u0275did"](147456,null,0,pe.i,[ie.ElementRef,ie.Renderer2,[2,pe.j]],{value:[0,"value"]},null),ie["\u0275did"](147456,null,0,pe.o,[ie.ElementRef,ie.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),ie["\u0275ted"](null,["Route"]))],function(e,n){e(n,1,0,"route");e(n,2,0,"route")},null)}function a(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,103,"div",[["class","form-horizontal"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,l)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,null,18,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Transport:"])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,12,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,9,"select",[["class","form-control input-sm"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,t){var l=!0,i=e.component;if("change"===n){l=!1!==ie["\u0275nov"](e,13).onChange(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,13).onTouched()&&l}if("change"===n){l=!1!==i.setTravelMean(t.target.value)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.j,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[pe.j]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,i)),ie["\u0275did"](802816,null,0,he.NgForOf,[ie.ViewContainerRef,ie.TemplateRef,ie.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,null,18,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Line style:"])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,12,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,9,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,t){var l=!0,i=e.component;if("change"===n){l=!1!==ie["\u0275nov"](e,33).onChange(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,33).onTouched()&&l}if("change"===n){l=!1!==i.setLineStyle(t.target.value)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.j,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[pe.j]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,o)),ie["\u0275did"](802816,null,0,he.NgForOf,[ie.ViewContainerRef,ie.TemplateRef,ie.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,null,28,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Line shape:"])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,22,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,19,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,t){var l=!0,i=e.component;if("change"===n){l=!1!==ie["\u0275nov"](e,53).onChange(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,53).onTouched()&&l}if("change"===n){l=!1!==i.setGeom(t.target.value)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.j,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[pe.j]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),ie["\u0275did"](147456,null,0,pe.i,[ie.ElementRef,ie.Renderer2,[2,pe.j]],{value:[0,"value"]},null),ie["\u0275did"](147456,null,0,pe.o,[ie.ElementRef,ie.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),ie["\u0275ted"](null,["Straight"])),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),ie["\u0275did"](147456,null,0,pe.i,[ie.ElementRef,ie.Renderer2,[2,pe.j]],{value:[0,"value"]},null),ie["\u0275did"](147456,null,0,pe.o,[ie.ElementRef,ie.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),ie["\u0275ted"](null,["Curved"])),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,r)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,null,15,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Line width:"])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,9,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,6,"input",[["class","form-control input-sm"],["id","lineWidth"],["max","10"],["min","0"],["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,t){var l=!0,i=e.component;if("input"===n){l=!1!==ie["\u0275nov"](e,83)._handleInput(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,83).onTouched()&&l}if("compositionstart"===n){l=!1!==ie["\u0275nov"](e,83)._compositionStart()&&l}if("compositionend"===n){l=!1!==ie["\u0275nov"](e,83)._compositionEnd(t.target.value)&&l}if("change"===n){l=!1!==ie["\u0275nov"](e,84).onChange(t.target.value)&&l}if("input"===n){l=!1!==ie["\u0275nov"](e,84).onChange(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,84).onTouched()&&l}if("change"===n){l=!1!==i.changeEvent()&&l}if("ngModelChange"===n){l=!1!==(i.lineWidth=t)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.c,[ie.Renderer2,ie.ElementRef,[2,pe.a]],null,null),ie["\u0275did"](16384,null,0,pe.l,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e,n){return[e,n]},[pe.c,pe.l]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},{update:"ngModelChange"}),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,null,10,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Line color:"])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,4,"div",[["class","col-md-8 edge-prop-colors"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control "]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"input"],[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("input"===n){l=!1!==ie["\u0275nov"](e,100).inputChange(t.target.value)&&l}if("click"===n){l=!1!==ie["\u0275nov"](e,100).onClick()&&l}if("colorPickerChange"===n){l=!1!==(i.lineColor=t)&&l}if("colorPickerChange"===n){l=!1!==i.colorChanged()&&l}return l},null,null)),ie["\u0275did"](606208,null,0,fe.ColorPickerDirective,[ie.Injector,ie.ComponentFactoryResolver,ie.ApplicationRef,ie.ViewContainerRef,ie.ElementRef,ge.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){var t=n.component;e(n,3,0,!t.hasDefault()&&!t.noReset),e(n,15,0,t.travelMean),e(n,20,0,t.allTravelMeans),e(n,35,0,t.lineStyle),e(n,40,0,t.allLineStyles),e(n,55,0,t.geom);e(n,60,0,"straight");e(n,61,0,"straight");e(n,65,0,"spline");e(n,66,0,"spline"),e(n,70,0,t.canDrive()),e(n,86,0,t.lineWidth),e(n,100,0,t.lineColor)},function(e,n){var t=n.component;e(n,12,0,ie["\u0275nov"](n,17).ngClassUntouched,ie["\u0275nov"](n,17).ngClassTouched,ie["\u0275nov"](n,17).ngClassPristine,ie["\u0275nov"](n,17).ngClassDirty,ie["\u0275nov"](n,17).ngClassValid,ie["\u0275nov"](n,17).ngClassInvalid,ie["\u0275nov"](n,17).ngClassPending),e(n,32,0,ie["\u0275nov"](n,37).ngClassUntouched,ie["\u0275nov"](n,37).ngClassTouched,ie["\u0275nov"](n,37).ngClassPristine,ie["\u0275nov"](n,37).ngClassDirty,ie["\u0275nov"](n,37).ngClassValid,ie["\u0275nov"](n,37).ngClassInvalid,ie["\u0275nov"](n,37).ngClassPending),e(n,52,0,ie["\u0275nov"](n,57).ngClassUntouched,ie["\u0275nov"](n,57).ngClassTouched,ie["\u0275nov"](n,57).ngClassPristine,ie["\u0275nov"](n,57).ngClassDirty,ie["\u0275nov"](n,57).ngClassValid,ie["\u0275nov"](n,57).ngClassInvalid,ie["\u0275nov"](n,57).ngClassPending),e(n,82,0,ie["\u0275nov"](n,88).ngClassUntouched,ie["\u0275nov"](n,88).ngClassTouched,ie["\u0275nov"](n,88).ngClassPristine,ie["\u0275nov"](n,88).ngClassDirty,ie["\u0275nov"](n,88).ngClassValid,ie["\u0275nov"](n,88).ngClassInvalid,ie["\u0275nov"](n,88).ngClassPending),e(n,99,0,t.lineColor)})}function s(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,a)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){e(n,2,0,n.component.properties)},null)}function u(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"edge-prop",[],null,null,null,s,be)),ie["\u0275did"](376832,null,0,ve,[ie.KeyValueDiffers],null,null)],function(e,n){e(n,1,0)},null)}function d(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","fa fa-recycle"],["style","font-size: 14pt"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.resetToDefault()&&l}return l},null,null))],null,null)}function p(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,36,"span",[["class","root"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275eld"](0,null,null,7,"span",[["class","text-prop-colors block"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control"]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"input"],[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("input"===n){l=!1!==ie["\u0275nov"](e,5).inputChange(t.target.value)&&l}if("click"===n){l=!1!==ie["\u0275nov"](e,5).onClick()&&l}if("colorPickerChange"===n){l=!1!==(i.fill=t)&&l}if("colorPickerChange"===n){l=!1!==i.setProperty("fill")&&l}return l},null,null)),ie["\u0275did"](606208,null,0,fe.ColorPickerDirective,[ie.Injector,ie.ComponentFactoryResolver,ie.ApplicationRef,ie.ViewContainerRef,ie.ElementRef,ge.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Text"])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,null,7,"span",[["class","text-prop-colors leftpadding block"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control"]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"input"],[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("input"===n){l=!1!==ie["\u0275nov"](e,14).inputChange(t.target.value)&&l}if("click"===n){l=!1!==ie["\u0275nov"](e,14).onClick()&&l}if("colorPickerChange"===n){l=!1!==(i.stroke=t)&&l}if("colorPickerChange"===n){l=!1!==i.setProperty("stroke")&&l}return l},null,null)),ie["\u0275did"](606208,null,0,fe.ColorPickerDirective,[ie.Injector,ie.ComponentFactoryResolver,ie.ApplicationRef,ie.ViewContainerRef,ie.ElementRef,ge.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Shadow"])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,null,15,"span",[["class","font-size-margin block"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,1,"span",[["for","fontSize"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Font size:"])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,6,"input",[["class","form-control"],["id","fontSize"],["max","64"],["min","5"],["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,t){var l=!0,i=e.component;if("input"===n){l=!1!==ie["\u0275nov"](e,26)._handleInput(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,26).onTouched()&&l}if("compositionstart"===n){l=!1!==ie["\u0275nov"](e,26)._compositionStart()&&l}if("compositionend"===n){l=!1!==ie["\u0275nov"](e,26)._compositionEnd(t.target.value)&&l}if("change"===n){l=!1!==ie["\u0275nov"](e,27).onChange(t.target.value)&&l}if("input"===n){l=!1!==ie["\u0275nov"](e,27).onChange(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,27).onTouched()&&l}if("change"===n){l=!1!==i.setProperty("fontSize")&&l}if("ngModelChange"===n){l=!1!==(i.fontSize=t)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.c,[ie.Renderer2,ie.ElementRef,[2,pe.a]],null,null),ie["\u0275did"](16384,null,0,pe.l,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e,n){return[e,n]},[pe.c,pe.l]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},{update:"ngModelChange"}),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n\n    "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,d)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){var t=n.component;e(n,5,0,t.fill),e(n,14,0,t.stroke),e(n,29,0,t.fontSize),e(n,34,0,!t.hasDefault()&&!t.noReset)},function(e,n){var t=n.component;e(n,4,0,t.fill),e(n,13,0,t.stroke),e(n,25,0,ie["\u0275nov"](n,31).ngClassUntouched,ie["\u0275nov"](n,31).ngClassTouched,ie["\u0275nov"](n,31).ngClassPristine,ie["\u0275nov"](n,31).ngClassDirty,ie["\u0275nov"](n,31).ngClassValid,ie["\u0275nov"](n,31).ngClassInvalid,ie["\u0275nov"](n,31).ngClassPending)})}function c(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275and"](16777216,null,null,1,null,p)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){e(n,1,0,n.component.properties)},null)}function h(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"text-prop",[],null,null,null,c,ke)),ie["\u0275did"](376832,null,0,we,[ge.ColorPickerService,ie.KeyValueDiffers],null,null)],function(e,n){e(n,1,0)},null)}function f(e){switch(e){case"Car":return"driving-car";case"Bus":return"driving-hgv";case"Bike":return"cycling-regular";case"Walk":return"foot-walking";default:return}}function g(e){var n=["https://api.openrouteservice.org/geocode/reverse?api_key=5b3ce3597851110001cf6248e0fee72951d5494c8b4cf5d8b4ff2b76","point.lat="+e.lat,"point.lon="+e.lon,"sources=oa"].join("&");return new Promise(function(e,t){$.getJSON(n).done(function(n){n&&n.features&&n.features[0]&&n.features[0].geometry&&n.features[0].geometry.coordinates?e({lon:n.features[0].geometry.coordinates[0],lat:n.features[0].geometry.coordinates[1]}):t(new Error("Empty or bad data from openrouteservice"))}).fail(function(e){"object"==typeof e&&"number"==typeof e.status&&e.status>=400&&e.status<500&&t(e),t(e)})})}function m(e,n){var t=e.lat-n.lat,l=e.lon-n.lon;return Math.sqrt(t*t+l*l)}function v(e,n){for(var t,l,i=0,o=n;i<o.length;i++){var r=o[i],a=m(e,r);(void 0==t||a<t)&&(t=a,l=r)}return l}function y(e){return Ae(this,void 0,void 0,function(){return qe(this,function(n){return[2,new Promise(function(n,t){$.getJSON("http://overpass-api.de/api/interpreter?data="+encodeURIComponent('[out:json];(way["highway"~"^(road|motorway|trunk|primary|secondary|tertiary|residential)$"]["access:conditional"!~"no"]["access"!~"no"]["name"](around:15000,'+e.lat+","+e.lon+");>;);out 32;\n")).done(function(l){if(l&&Array.isArray(l.elements)&&l.elements.length>=1&&l.elements[0].lat&&l.elements[0].lon){var i=v(e,l.elements);n(i)}else t("Bad or empty reply from overpass")}).fail(t)})]})})}function b(e){var n=this,t=JSON.stringify(e);return je[t]?je[t]:je[t]=function(){return Ae(n,void 0,void 0,function(){var n,t;return qe(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,y(e)];case 1:return[2,l.sent()];case 2:return n=l.sent(),[3,3];case 3:return l.trys.push([3,5,,6]),[4,g(e)];case 4:return[2,l.sent()];case 5:return t=l.sent(),[3,6];case 6:return[2,e]}})})}()}function _(e,n,t){var l=["https://api.openrouteservice.org/directions?api_key=5b3ce3597851110001cf6248e0fee72951d5494c8b4cf5d8b4ff2b76","coordinates="+e.lon+"%2C"+e.lat+"|"+n.lon+"%2C"+n.lat,"profile="+t,"geometry_format=geojson","geometry_simplify=true","radiuses=-1|-1"].join("&");return new Promise(function(e,n){$.getJSON(l).done(function(t){t&&t.routes&&t.routes[0]&&t.routes[0].geometry&&t.routes[0].geometry.coordinates?e(t.routes[0].geometry.coordinates):n(new Error("Empty or bad data from openrouteservice"))}).fail(n)})}function P(e,n,t,l){var i=this;void 0===l&&(l=!1);var o=f(t);if(!o)throw new Error("Transportation mean unsupported: "+t);var r=JSON.stringify({from:e,to:n,mean:t});return r in Be?Be[r]:(Be[r]=function(){return Ae(i,void 0,void 0,function(){var t,l,i,r,a,s,u,d,p,c;return qe(this,function(h){switch(h.label){case 0:t=!1,l=!1,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,_(e,n,o)];case 2:return[2,h.sent()];case 3:if("object"!=typeof(i=h.sent())||!i.responseJSON||2010!=i.responseJSON.error.code)throw i;for(r=/Cannot find point ([0-9]+)/g,a=void 0;a=r.exec(i.responseJSON.error.message);)switch(a[1]){case"0":t=!0;break;case"1":l=!0}if(!t&&!l)throw i;return[3,4];case 4:return t?[4,b(e)]:[3,6];case 5:return u=h.sent(),[3,7];case 6:u=e,h.label=7;case 7:return s=u,l?[4,b(n)]:[3,9];case 8:return p=h.sent(),[3,10];case 9:p=n,h.label=10;case 10:return d=p,[4,_(s,d,o)];case 11:return c=h.sent(),c.unshift([e.lon,e.lat]),c.push([n.lon,n.lat]),[2,c]}})})}(),Be[r])}function x(e){for(var n=0,t=[0],l=1;l<e.length;++l){n+=Fe.dist(e[l],e[l-1]),t.push(n)}for(var i=n/2,l=0;l<t.length;++l)if(t[l]>i)return l-1;return 0}function w(){var e=window,n=e.global_map_params;if(!n&&thisTripApi){var t=window.cssserviceUrl||"https://destinationbook-cssservice.herokuapp.com/";e.global_map_params={locations_url:thisTripApi.locationsUrl,map_settings_url:thisTripApi.mapUrl,preferences:{line_shape:thisTripApi.lineShape},language:thisTripApi.tripLanguage,geoname_service_url:t,map_print_service_url:t},n=e.global_map_params}if(n||"undefined"==typeof mapJson||("object"==typeof mapJson&&mapJson.global_map_params?e.global_map_params=mapJson.global_map_params:e.global_map_params={map_settings:mapJson,language:mapJson.tripLanguage,geoname_service_url:"",map_print_service_url:"",hide_ui:!0},n=e.global_map_params),!n)throw new Error("Can't find map parameters");return n.preferences||(n.preferences={}),n}function C(e){if(!e)return[];var n=Utils.worldToLatLon(e);return[n.lon,n.lat]}function k(e,n,t){var l=t.nodes,i=n.edgeProperty(e,"geom");if(e.properties&&e.properties.hidden||l[e.from].properties.skip||l[e.to].properties.skip)return[];if("route"==i){if(e.properties&&e.properties.route&&e.properties.route.geom)return e.properties.route.geom.map(C);i="straight"}if("straight"==i)return[l[e.from].coord,l[e.to].coord].map(C);if(2==e.controlPoints.length){for(var o=[l[e.from].coord,e.controlPoints[0],e.controlPoints[1],l[e.to].coord],r=[],a=0,s=o;a<s.length;a++){var u=s[a];r.push(u.x),r.push(u.y)}return new Bezier(r).getLUT(128).map(C)}return console.log("Unexpected edge structure, not drawing"),[]}function L(e){return e.match(/^http/)?e:"https://maps.tilehosting.com/styles/"+e+"/style.json?key="+en}function M(e){return ie["\u0275vid"](0,[ie["\u0275qud"](402653184,1,{mapDiv:0}),(e()(),ie["\u0275eld"](0,[[1,0],["mapDiv",1]],null,0,"div",[["style","position: absolute;"]],[[4,"width","px"],[4,"height","px"]],null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n"]))],null,function(e,n){var t=n.component;e(n,1,0,t.canvasWidth,t.canvasHeight)})}function T(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"mapview2",[],null,null,null,M,rn)),ie["\u0275did"](49152,null,0,ln,[],null,null)],null,null)}function S(e,n){var t=e.x-n.x,l=e.y-n.y,i=e.scale-n.scale;return Math.abs(t)<1e-7&&Math.abs(l)<1e-7&&Math.abs(i)<1e-7}function R(e){return ie["\u0275vid"](0,[ie["\u0275qud"](402653184,1,{renderCanvas:0}),ie["\u0275qud"](402653184,2,{canvas:0}),ie["\u0275qud"](402653184,3,{mapview:0}),(e()(),ie["\u0275eld"](0,[[1,0],["renderCanvas",1]],null,0,"canvas",[["style","position: absolute;"]],[[4,"width","px"],[4,"height","px"],[1,"width",0],[1,"height",0]],null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"mapview2",[["style","display:block; position:absolute;"]],[[4,"width","px"],[4,"height","px"]],null,null,M,rn)),ie["\u0275did"](49152,[[3,4],["mapview",4]],0,ln,[],{canvasWidth:[0,"canvasWidth"],canvasHeight:[1,"canvasHeight"],compactAttribution:[2,"compactAttribution"],lang:[3,"lang"]},null),(e()(),ie["\u0275eld"](0,[[2,0],["eventCanvas",1]],null,0,"canvas",[["style","position: absolute;"]],[[4,"width","px"],[4,"height","px"],[1,"width",0],[1,"height",0]],null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){var t=n.component;e(n,5,0,t.getCanvasWidth(),t.getCanvasHeight(),!0,t.lang)},function(e,n){var t=n.component;e(n,3,0,t.getCanvasWidth(),t.getCanvasHeight(),t.getCanvasWidth()*t.pixelRatio(),t.getCanvasHeight()*t.pixelRatio()),e(n,4,0,t.getCanvasWidth(),t.getCanvasHeight()),e(n,6,0,t.getCanvasWidth(),t.getCanvasHeight(),t.getCanvasWidth()*t.pixelRatio(),t.getCanvasHeight()*t.pixelRatio())})}function O(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"mapview",[],null,null,null,R,pn)),ie["\u0275did"](49152,null,0,un,[ie.ElementRef],null,null)],null,null)}function E(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,4,"div",[["class","alert fade in alert-danger"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275eld"](0,null,null,1,"button",[["class","close"],["data-dismiss","alert"],["type","button"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==(i._errorMessage=null)&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["\xd7"])),(e()(),ie["\u0275ted"](null,["\n  ","\n"]))],null,function(e,n){e(n,4,0,n.component._errorMessage)})}function D(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,4,"div",[["class","alert fade in alert-success"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275eld"](0,null,null,1,"button",[["class","close"],["data-dismiss","alert"],["type","button"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==(i._infoMessage=null)&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["\xd7"])),(e()(),ie["\u0275ted"](null,["\n  ","\n"]))],null,function(e,n){e(n,4,0,n.component._infoMessage)})}function I(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Please add at least one location in a day or event settings"]))],null,null)}function z(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Loading..."]))],null,null)}function N(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,7,"div",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["No map created yet."])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275eld"](0,null,null,1,"button",[["class","btn btn-primary"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.fetchLocationsAndGenerateMap()&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Create map"])),(e()(),ie["\u0275ted"](null,["\n"]))],null,null)}function F(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","glyphicon glyphicon-map-marker"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "]))],null,null)}function W(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,3,"option",[["class","form-control"],["required",""]],null,null,null,null,null)),ie["\u0275did"](147456,null,0,pe.i,[ie.ElementRef,ie.Renderer2,[2,pe.j]],{value:[0,"value"]},null),ie["\u0275did"](147456,null,0,pe.o,[ie.ElementRef,ie.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),ie["\u0275ted"](null,["",""]))],function(e,n){e(n,1,0,n.context.$implicit.key()),e(n,2,0,n.context.$implicit.key())},function(e,n){e(n,3,0,n.context.$implicit.name)})}function A(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,0,"input",[["type","checkbox"]],[[8,"checked",0],[8,"disabled",0]],[[null,"change"],[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("change"===n){l=!1!==i.toggleHideEdge(i.edgeFrom(e.parent.parent.context.$implicit.node))&&l}if("click"===n){l=!1!==t.stopPropagation()&&l}return l},null,null))],null,function(e,n){var t=n.component;e(n,0,0,!t.edgeFrom(n.parent.parent.context.$implicit.node).properties.hidden&&!t.isSkipped(n.parent.parent.context.$implicit.node),t.isSkipped(n.parent.parent.context.$implicit.node))})}function q(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","fa fa-road"]],null,null,null,null,null))],null,null)}function B(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"edge-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,t){var l=!0,i=e.component;if("propertiesChange"===n){l=!1!==(i.edgeFrom(e.parent.parent.parent.context.$implicit.node).properties=t)&&l}if("onChange"===n){l=!1!==i.edgePropertiesChanged(i.edgeFrom(e.parent.parent.parent.context.$implicit.node))&&l}return l},s,be)),ie["\u0275did"](376832,null,0,ve,[ie.KeyValueDiffers],{properties:[0,"properties"],defaults:[1,"defaults"]},{onChange:"onChange"})],function(e,n){var t=n.component;e(n,1,0,t.edgeFrom(n.parent.parent.parent.context.$implicit.node).properties,t._seqTrip._tripData.defaultEdgeProp)},null)}function j(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,50,"div",[["class","btn-group properties"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,34,"div",[["style","margin-bottom: 10px;"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,31,"span",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n              "])),(e()(),ie["\u0275eld"](0,null,null,8,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==ie["\u0275nov"](e,7).onClick()&&l}if("click"===n){l=!1!==i.toggleProperty(e.parent.parent.context.$implicit.node,"landing")&&l}return l},null,null)),ie["\u0275did"](81920,null,0,_e.a,[],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[_e.a]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n                "])),(e()(),ie["\u0275eld"](0,null,null,0,"img",[["alt","Landing"],["height","16px"],["src","/ng-map/assets/landing.svg"],["width","16px"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n              "])),(e()(),ie["\u0275ted"](null,["\n              "])),(e()(),ie["\u0275eld"](0,null,null,8,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==ie["\u0275nov"](e,17).onClick()&&l}if("click"===n){l=!1!==i.toggleProperty(e.parent.parent.context.$implicit.node,"takeoff")&&l}return l},null,null)),ie["\u0275did"](81920,null,0,_e.a,[],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[_e.a]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n                "])),(e()(),ie["\u0275eld"](0,null,null,0,"img",[["alt","Take-off"],["height","16px"],["src","/ng-map/assets/takeoff.svg"],["width","16px"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n              "])),(e()(),ie["\u0275ted"](null,["\n              "])),(e()(),ie["\u0275eld"](0,null,null,8,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==ie["\u0275nov"](e,27).onClick()&&l}if("click"===n){l=!1!==i.setProperty(e.parent.parent.context.$implicit.node,"markStyle",i.hasMark(e.parent.parent.context.$implicit.node)?"normal":"first")&&l}return l},null,null)),ie["\u0275did"](81920,null,0,_e.a,[],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[_e.a]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n                "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-circle"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n              "])),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,0,"hr",[["class","smallspacing"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,1,"text-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,t){var l=!0,i=e.component;if("propertiesChange"===n){l=!1!==(e.parent.parent.context.$implicit.node.properties=t)&&l}if("onChange"===n){l=!1!==i.nodePropertiesChanged()&&l}return l},c,ke)),ie["\u0275did"](376832,null,0,we,[ge.ColorPickerService,ie.KeyValueDiffers],{properties:[0,"properties"],defaults:[1,"defaults"]},{onChange:"onChange"}),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275ted"](null,["\n\n          "])),(e()(),ie["\u0275eld"](0,null,null,0,"hr",[["class","smallspacing"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n\n          "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,B)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n        "]))],function(e,n){var t=n.component;e(n,7,0),e(n,9,0,n.parent.parent.context.$implicit.node.properties.landing),e(n,17,0),e(n,19,0,n.parent.parent.context.$implicit.node.properties.takeoff),e(n,27,0),e(n,29,0,t.hasMark(n.parent.parent.context.$implicit.node)),e(n,43,0,n.parent.parent.context.$implicit.node.properties,t._seqTrip._tripData.defaultTextProp),e(n,49,0,t.edgeFrom(n.parent.parent.context.$implicit.node)&&!t.edgeFrom(n.parent.parent.context.$implicit.node).properties.hidden)},function(e,n){e(n,6,0,ie["\u0275nov"](n,7).state,ie["\u0275nov"](n,11).ngClassUntouched,ie["\u0275nov"](n,11).ngClassTouched,ie["\u0275nov"](n,11).ngClassPristine,ie["\u0275nov"](n,11).ngClassDirty,ie["\u0275nov"](n,11).ngClassValid,ie["\u0275nov"](n,11).ngClassInvalid,ie["\u0275nov"](n,11).ngClassPending),e(n,16,0,ie["\u0275nov"](n,17).state,ie["\u0275nov"](n,21).ngClassUntouched,ie["\u0275nov"](n,21).ngClassTouched,ie["\u0275nov"](n,21).ngClassPristine,ie["\u0275nov"](n,21).ngClassDirty,ie["\u0275nov"](n,21).ngClassValid,ie["\u0275nov"](n,21).ngClassInvalid,ie["\u0275nov"](n,21).ngClassPending),e(n,26,0,ie["\u0275nov"](n,27).state,ie["\u0275nov"](n,31).ngClassUntouched,ie["\u0275nov"](n,31).ngClassTouched,ie["\u0275nov"](n,31).ngClassPristine,ie["\u0275nov"](n,31).ngClassDirty,ie["\u0275nov"](n,31).ngClassValid,ie["\u0275nov"](n,31).ngClassInvalid,ie["\u0275nov"](n,31).ngClassPending)})}function V(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,39,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"nodeSkipped",null],[2,"panel-open",null]],null,null,Le.b,Le.a)),ie["\u0275did"](245760,[["group",4]],0,Me.a,[Te.a],{isOpen:[0,"isOpen"]},null),(e()(),ie["\u0275ted"](1,["\n        "])),(e()(),ie["\u0275eld"](0,null,0,32,"div",[["accordion-heading",""],["class","hflex-container"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,2,"i",[["class","fa fa-right-margin flex-item-narrow in-margin-top"],["style","font-size: 14pt"]],null,null,null,null,null)),ie["\u0275did"](278528,null,0,he.NgClass,[ie.IterableDiffers,ie.KeyValueDiffers,ie.ElementRef,ie.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),ie["\u0275pod"]({"fa-caret-down":0,"fa-caret-right":1}),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,5,"input",[["class","form-control-input flex-item-wide"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"],[null,"change"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,t){var l=!0,i=e.component;if("input"===n){l=!1!==ie["\u0275nov"](e,10)._handleInput(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,10).onTouched()&&l}if("compositionstart"===n){l=!1!==ie["\u0275nov"](e,10)._compositionStart()&&l}if("compositionend"===n){l=!1!==ie["\u0275nov"](e,10)._compositionEnd(t.target.value)&&l}if("click"===n){l=!1!==t.stopPropagation()&&l}if("change"===n){l=!1!==i.setNodeLabel(e.parent.context.$implicit.node,t.target.value)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.c,[ie.Renderer2,ie.ElementRef,[2,pe.a]],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[pe.c]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,18,"div",[["class","route-action"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,5,"input",[["type","checkbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"],[null,"change"],[null,"blur"]],function(e,n,t){var l=!0,i=e.component;if("change"===n){l=!1!==ie["\u0275nov"](e,19).onChange(t.target.checked)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,19).onTouched()&&l}if("click"===n){i.toggleSkipNode(e.parent.context.$implicit.node);l=!1!==t.stopPropagation()&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.b,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[pe.b]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","glyphicon glyphicon-map-marker"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,A)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,q)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275ted"](1,["\n        "])),(e()(),ie["\u0275and"](16777216,null,1,1,null,j)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](1,["\n      "]))],function(e,n){var t=n.component;e(n,1,0,t.isNodeSelected(n.parent.context.$implicit.node));e(n,6,0,"fa fa-right-margin flex-item-narrow in-margin-top",e(n,7,0,null==ie["\u0275nov"](n,1)?null:ie["\u0275nov"](n,1).isOpen,!(null==ie["\u0275nov"](n,1)?null:ie["\u0275nov"](n,1).isOpen))),e(n,12,0,t.isSkipped(n.parent.context.$implicit.node),n.parent.context.$implicit.node.label),e(n,21,0,!t.isSkipped(n.parent.context.$implicit.node)),e(n,30,0,t.edgeFrom(n.parent.context.$implicit.node)),e(n,33,0,t.edgeFrom(n.parent.context.$implicit.node)),e(n,38,0,!t.isSkipped(n.parent.context.$implicit.node))},function(e,n){var t=n.component;e(n,0,0,n.parent.context.$implicit.node&&t.isSkipped(n.parent.context.$implicit.node),ie["\u0275nov"](n,1).isOpen),e(n,9,0,ie["\u0275nov"](n,14).ngClassUntouched,ie["\u0275nov"](n,14).ngClassTouched,ie["\u0275nov"](n,14).ngClassPristine,ie["\u0275nov"](n,14).ngClassDirty,ie["\u0275nov"](n,14).ngClassValid,ie["\u0275nov"](n,14).ngClassInvalid,ie["\u0275nov"](n,14).ngClassPending),e(n,18,0,ie["\u0275nov"](n,23).ngClassUntouched,ie["\u0275nov"](n,23).ngClassTouched,ie["\u0275nov"](n,23).ngClassPristine,ie["\u0275nov"](n,23).ngClassDirty,ie["\u0275nov"](n,23).ngClassValid,ie["\u0275nov"](n,23).ngClassInvalid,ie["\u0275nov"](n,23).ngClassPending)})}function U(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,4,null,null,null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,V)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n      "]))],function(e,n){e(n,3,0,n.context.$implicit.node)},null)}function H(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","fa fa-file"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "]))],null,null)}function Z(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,136,"div",[["class","maptabset"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275eld"](0,null,null,133,"tabset",[["type","pills"]],[[2,"tab-container",null]],null,null,Se.b,Se.a)),ie["\u0275did"](180224,null,0,Re.a,[Oe.a],{vertical:[0,"vertical"],type:[1,"type"]},null),(e()(),ie["\u0275ted"](0,["\n  "])),(e()(),ie["\u0275eld"](0,null,0,57,"tab",[],[[2,"active",null],[2,"tab-pane",null]],[[null,"select"]],function(e,n,t){var l=!0,i=e.component;if("select"===n){l=!1!==i.lockMap(!0)&&l}return l},null,null)),ie["\u0275did"](212992,null,0,Ee.a,[Re.a,ie.ElementRef,ie.Renderer],null,{select:"select"}),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275and"](0,null,null,1,null,F)),ie["\u0275did"](16384,null,0,De.a,[ie.TemplateRef,Ee.a],null,null),(e()(),ie["\u0275ted"](null,["\n\n    "])),(e()(),ie["\u0275eld"](0,null,null,23,"div",[["class","row heading"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,12,"div",[["class","col-md-5"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275eld"](0,null,null,9,"select",[["class","form-control btn-xs"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,t){var l=!0,i=e.component;if("change"===n){l=!1!==ie["\u0275nov"](e,16).onChange(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,16).onTouched()&&l}if("change"===n){l=!1!==i.uiSetPageSize(t.target.value)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.j,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e){return[e]},[pe.j]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,W)),ie["\u0275did"](802816,null,0,he.NgForOf,[ie.ViewContainerRef,ie.TemplateRef,ie.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,6,"div",[["class","col-md-7 legend"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275eld"](0,null,null,3,"p",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n          Display location "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","glyphicon glyphicon-map-marker"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,15,"div",[["class","row heading"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,4,"div",[["class","col-md-5"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275eld"](0,null,null,1,"button",[["class","btn btn-default btn-xs map-btn"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.uiSetFrame()&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Auto scroll/zoom"])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n\n      "])),(e()(),ie["\u0275eld"](0,null,null,6,"div",[["class","col-md-7 legend"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275eld"](0,null,null,3,"p",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n          Line to next active location "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["class","fa fa-road"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,0,"hr",[["class","button-separtor"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,6,"accordion",[["class","panel-group"],["id","long-accord"],["role","tablist"],["style","display: block"]],[[1,"aria-multiselectable",0]],null,null,Ie.b,Ie.a)),ie["\u0275did"](49152,null,0,Te.a,[ze.a],{closeOthers:[0,"closeOthers"]},null),(e()(),ie["\u0275ted"](0,["\n      "])),(e()(),ie["\u0275and"](16777216,null,0,1,null,U)),ie["\u0275did"](802816,null,0,he.NgForOf,[ie.ViewContainerRef,ie.TemplateRef,ie.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),ie["\u0275ted"](0,["  "])),(e()(),ie["\u0275ted"](0,["\n    "])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](0,["\n\n  "])),(e()(),ie["\u0275eld"](0,null,0,70,"tab",[],[[2,"active",null],[2,"tab-pane",null]],[[null,"select"]],function(e,n,t){var l=!0,i=e.component;if("select"===n){l=!1!==i.lockMap(!1)&&l}return l},null,null)),ie["\u0275did"](212992,null,0,Ee.a,[Re.a,ie.ElementRef,ie.Renderer],null,{select:"select"}),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275and"](0,null,null,1,null,H)),ie["\u0275did"](16384,null,0,De.a,[ie.TemplateRef,Ee.a],null,null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,29,"div",[["class","panel panel-default"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275eld"](0,null,null,26,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,1,"label",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Zoom / center"])),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,9,"div",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,6,"input",[["id","scaleSlider"],["max","18"],["min","0"],["step","0.000001"],["type","range"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,t){var l=!0,i=e.component;if("input"===n){l=!1!==ie["\u0275nov"](e,83)._handleInput(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,83).onTouched()&&l}if("compositionstart"===n){l=!1!==ie["\u0275nov"](e,83)._compositionStart()&&l}if("compositionend"===n){l=!1!==ie["\u0275nov"](e,83)._compositionEnd(t.target.value)&&l}if("change"===n){l=!1!==ie["\u0275nov"](e,84).onChange(t.target.value)&&l}if("input"===n){l=!1!==ie["\u0275nov"](e,84).onChange(t.target.value)&&l}if("blur"===n){l=!1!==ie["\u0275nov"](e,84).onTouched()&&l}if("change"===n){l=!1!==i.setScale(t.target.value)&&l}if("input"===n){l=!1!==i.setScale(t.target.value)&&l}return l},null,null)),ie["\u0275did"](16384,null,0,pe.c,[ie.Renderer2,ie.ElementRef,[2,pe.a]],null,null),ie["\u0275did"](16384,null,0,pe.m,[ie.Renderer2,ie.ElementRef],null,null),ie["\u0275prd"](1024,null,pe.e,function(e,n){return[e,n]},[pe.c,pe.m]),ie["\u0275did"](671744,null,0,pe.h,[[8,null],[8,null],[8,null],[2,pe.e]],{model:[0,"model"]},null),ie["\u0275prd"](2048,null,pe.f,null,[pe.h]),ie["\u0275did"](16384,null,0,pe.g,[pe.f],null,null),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275eld"](0,null,null,6,"div",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,0,"input",[["type","checkbox"]],[[8,"checked",0]],[[null,"change"]],function(e,n,t){var l=!0,i=e.component;if("change"===n){l=!1!=(i._autoLockMap=!i._autoLockMap)&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Auto lock map"])),(e()(),ie["\u0275ted"](null,["\n          "])),(e()(),ie["\u0275ted"](null,["\n        "])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,32,"accordion",[["class","panel-group"],["role","tablist"],["style","display: block"]],[[1,"aria-multiselectable",0]],null,null,Ie.b,Ie.a)),ie["\u0275did"](49152,null,0,Te.a,[ze.a],{closeOthers:[0,"closeOthers"]},null),(e()(),ie["\u0275ted"](0,["\n        "])),(e()(),ie["\u0275eld"](0,null,0,13,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"panel-open",null]],null,null,Le.b,Le.a)),ie["\u0275did"](245760,null,0,Me.a,[Te.a],null,null),(e()(),ie["\u0275ted"](1,["\n          "])),(e()(),ie["\u0275eld"](0,null,0,3,"p",[["accordion-heading",""]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-font"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Default text properties\n          "])),(e()(),ie["\u0275ted"](1,["\n          "])),(e()(),ie["\u0275eld"](0,null,1,4,"div",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,1,"text-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,t){var l=!0,i=e.component;if("propertiesChange"===n){l=!1!==(i._seqTrip._tripData.defaultTextProp=t)&&l}if("onChange"===n){l=!1!==i.nodePropertiesChanged()&&l}return l},c,ke)),ie["\u0275did"](376832,null,0,we,[ge.ColorPickerService,ie.KeyValueDiffers],{properties:[0,"properties"],noReset:[1,"noReset"]},{onChange:"onChange"}),(e()(),ie["\u0275ted"](null,["\n\n          "])),(e()(),ie["\u0275ted"](1,["\n        "])),(e()(),ie["\u0275ted"](0,["\n\n        "])),(e()(),ie["\u0275eld"](0,null,0,13,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"panel-open",null]],null,null,Le.b,Le.a)),ie["\u0275did"](245760,null,0,Me.a,[Te.a],null,null),(e()(),ie["\u0275ted"](1,["\n          "])),(e()(),ie["\u0275eld"](0,null,0,3,"p",[["accordion-heading",""]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-arrows-h"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["Default line properties\n          "])),(e()(),ie["\u0275ted"](1,["\n          "])),(e()(),ie["\u0275eld"](0,null,1,4,"div",[],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n            "])),(e()(),ie["\u0275eld"](0,null,null,1,"edge-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,t){var l=!0,i=e.component;if("propertiesChange"===n){l=!1!==(i._seqTrip._tripData.defaultEdgeProp=t)&&l}if("onChange"===n){l=!1!==i.edgePropertiesChanged()&&l}return l},s,be)),ie["\u0275did"](376832,null,0,ve,[ie.KeyValueDiffers],{properties:[0,"properties"],noReset:[1,"noReset"]},{onChange:"onChange"}),(e()(),ie["\u0275ted"](null,["\n\n          "])),(e()(),ie["\u0275ted"](1,["\n        "])),(e()(),ie["\u0275ted"](0,["\n      "])),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](0,["\n"])),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){var t=n.component;e(n,3,0,!0,"pills"),e(n,6,0),e(n,18,0,t._pageSizeName),e(n,23,0,t._pageSizes);e(n,56,0,!0),e(n,59,0,t._interleaved),e(n,65,0),e(n,86,0,t.scale());e(n,102,0,!0),e(n,105,0);e(n,115,0,t._seqTrip._tripData.defaultTextProp,!0),e(n,120,0);e(n,130,0,t._seqTrip._tripData.defaultEdgeProp,!0)},function(e,n){var t=n.component;e(n,2,0,ie["\u0275nov"](n,3).clazz),e(n,5,0,ie["\u0275nov"](n,6).active,ie["\u0275nov"](n,6).addClass),e(n,15,0,ie["\u0275nov"](n,20).ngClassUntouched,ie["\u0275nov"](n,20).ngClassTouched,ie["\u0275nov"](n,20).ngClassPristine,ie["\u0275nov"](n,20).ngClassDirty,ie["\u0275nov"](n,20).ngClassValid,ie["\u0275nov"](n,20).ngClassInvalid,ie["\u0275nov"](n,20).ngClassPending),e(n,55,0,ie["\u0275nov"](n,56).closeOthers),e(n,64,0,ie["\u0275nov"](n,65).active,ie["\u0275nov"](n,65).addClass),e(n,82,0,ie["\u0275nov"](n,88).ngClassUntouched,ie["\u0275nov"](n,88).ngClassTouched,ie["\u0275nov"](n,88).ngClassPristine,ie["\u0275nov"](n,88).ngClassDirty,ie["\u0275nov"](n,88).ngClassValid,ie["\u0275nov"](n,88).ngClassInvalid,ie["\u0275nov"](n,88).ngClassPending),e(n,93,0,t._autoLockMap),e(n,101,0,ie["\u0275nov"](n,102).closeOthers),e(n,104,0,ie["\u0275nov"](n,105).isOpen),e(n,119,0,ie["\u0275nov"](n,120).isOpen)})}function G(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.download("mbtiles")&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Export MBTiles"]))],null,null)}function J(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.download("mbtiles",{maxzoom:14})&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Export MBTiles (max details)"]))],null,null)}function K(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.download("mbtiles",{hillshading:1})&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Export hillshading MBTiles"]))],null,null)}function X(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.download("mbtiles",{hillshading:1,maxzoom:14})&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Export hillshading MBTiles (max details)"]))],null,null)}function Y(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,35,"ul",[["class","dropdown-menu dropdown-menu-right"],["role","menu"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.autoPlaceLabels()&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Auto place labels"])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.resetCurves()&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Reset curves"])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.resetLabels()&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Reset labels"])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,0,"li",[["class","divider dropdown-divider"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.download("jpg")&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Export JPG"])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,t){var l=!0,i=e.component;if("click"===n){l=!1!==i.download("png")&&l}return l},null,null)),(e()(),ie["\u0275ted"](null,["Export PNG"])),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,G)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,J)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,K)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,X)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n    "]))],function(e,n){var t=n.component;e(n,25,0,t.superadmin),e(n,28,0,t.superadmin),e(n,31,0,t.superadmin),e(n,34,0,t.superadmin)},null)}function Q(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,0,"div",[["class","spin-loader"]],null,null,null,null,null))],null,null)}function ee(e){return ie["\u0275vid"](0,[ie["\u0275qud"](402653184,1,{mapview:0}),(e()(),ie["\u0275eld"](0,null,null,0,"link",[["href","https://fonts.googleapis.com/css?family=PT+Sans"],["rel","stylesheet"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,E)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,D)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,I)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,z)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,N)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275eld"](0,null,null,28,"div",[],[[2,"hidden",null]],null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,Z)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n\n"])),(e()(),ie["\u0275eld"](0,null,null,6,"div",[["class","floatleft"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275eld"](0,null,null,1,"mapview",[["style","display:block;"]],[[4,"width","px"],[4,"height","px"]],[[null,"drop"],[null,"dragover"]],function(e,n,t){var l=!0,i=e.component;if("drop"===n){l=!1!==i.drop(t)&&l}if("dragover"===n){l=!1!==i.allowDrop(t)&&l}return l},R,pn)),ie["\u0275did"](49152,[[1,4],["mapview",4]],0,un,[ie.ElementRef],{canvasWidth:[0,"canvasWidth"],canvasHeight:[1,"canvasHeight"],compactAttribution:[2,"compactAttribution"],lang:[3,"lang"]},null),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275eld"](0,null,null,0,"div",[["id","map_attribution"],["style","font-size: 8pt;"]],[[8,"innerHTML",1]],null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n"])),(e()(),ie["\u0275ted"](null,["\n\n  "])),(e()(),ie["\u0275eld"](16777216,null,null,14,"span",[["class","floatright btn-group"],["dropdown",""],["style","width:auto;"]],[[2,"dropup",null],[2,"open",null],[2,"show",null]],null,null,null,null)),ie["\u0275prd"](512,null,cn.a,cn.a,[]),ie["\u0275did"](212992,null,0,hn.a,[ie.ElementRef,ie.Renderer,ie.ViewContainerRef,fn.a,gn.a,cn.a],null,null),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275eld"](0,null,null,6,"button",[["class","btn btn-default dropdown-toggle thinbutton"],["dropdownToggle",""],["type","button"]],[[1,"aria-haspopup",0],[1,"disabled",0],[1,"aria-expanded",0]],[[null,"click"],["document","click"],[null,"keyup.esc"]],function(e,n,t){var l=!0;if("click"===n){l=!1!==ie["\u0275nov"](e,36).onClick()&&l}if("document:click"===n){l=!1!==ie["\u0275nov"](e,36).onDocumentClick(t)&&l}if("keyup.esc"===n){l=!1!==ie["\u0275nov"](e,36).onEsc()&&l}return l},null,null)),ie["\u0275did"](147456,null,0,mn.a,[cn.a,ie.ElementRef],null,null),(e()(),ie["\u0275ted"](null,["\n      "])),(e()(),ie["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-cogs"]],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,0,"br",[],null,null,null,null,null)),(e()(),ie["\u0275eld"](0,null,null,0,"span",[["class","caret"]],null,null,null,null,null)),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275ted"](null,["\n    "])),(e()(),ie["\u0275and"](16777216,null,null,1,null,Y)),ie["\u0275did"](16384,null,0,vn.a,[cn.a,ie.ViewContainerRef,ie.TemplateRef],null,null),(e()(),ie["\u0275ted"](null,["\n  "])),(e()(),ie["\u0275ted"](null,["\n\n\n"])),(e()(),ie["\u0275ted"](null,["\n\n"])),(e()(),ie["\u0275and"](16777216,null,null,1,null,Q)),ie["\u0275did"](16384,null,0,he.NgIf,[ie.ViewContainerRef,ie.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){var t=n.component;e(n,4,0,t._errorMessage),e(n,7,0,t._infoMessage),e(n,10,0,!t._loadingMap&&0==t._numLocations),e(n,13,0,t._loadingMap),e(n,16,0,t._numLocations>0&&!t._visitedPlaceList.length),e(n,21,0,!t.hideUi());e(n,26,0,t._canvasWidth,t._canvasHeight,!0,t.language),e(n,33,0),e(n,49,0,t._showSpinner)},function(e,n){var t=n.component;e(n,18,0,!t._visitedPlaceList.length),e(n,25,0,t._canvasWidth,t._canvasHeight),e(n,28,0,t.attribution()),e(n,31,0,ie["\u0275nov"](n,33).dropup,ie["\u0275nov"](n,33).isOpen,ie["\u0275nov"](n,33).isOpen&&ie["\u0275nov"](n,33).isBs4);e(n,35,0,!0,ie["\u0275nov"](n,36).isDisabled,ie["\u0275nov"](n,36).isOpen)})}function ne(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"trip-map",[],null,[["window","beforeunload"]],function(e,n,t){var l=!0;if("window:beforeunload"===n){l=!1!==ie["\u0275nov"](e,1).doSomething(t)&&l}return l},ee,bn)),ie["\u0275did"](4440064,null,0,Qe,[Ne.c],null,null)],function(e,n){e(n,1,0)},null)}function te(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"trip-map",[],null,[["window","beforeunload"]],function(e,n,t){var l=!0;if("window:beforeunload"===n){l=!1!==ie["\u0275nov"](e,1).doSomething(t)&&l}return l},ee,bn)),ie["\u0275did"](4440064,null,0,Qe,[Ne.c],null,null),(e()(),ie["\u0275ted"](null,["\n"]))],function(e,n){e(n,1,0)},null)}function le(e){return ie["\u0275vid"](0,[(e()(),ie["\u0275eld"](0,null,null,1,"app-root",[],null,null,null,te,Pn)),ie["\u0275did"](49152,null,0,re,[],null,null)],null,null)}Object.defineProperty(n,"__esModule",{value:!0});var ie=t("/oeL"),oe=function(){function e(){}return e}(),re=function(){function e(){}return e.ctorParameters=function(){return[]},e}(),ae=t("A6LD"),se=t("DdBX"),ue=[""],de=[".properties[_ngcontent-%COMP%]{font-size:12px}.maptabset[_ngcontent-%COMP%]    .panel-heading{padding:10px 15px}.maptabset[_ngcontent-%COMP%]    .panel{margin-bottom:1px}tabset[_ngcontent-%COMP%]    .nav-stacked{float:left}tabset[_ngcontent-%COMP%]    .tab-content{float:left;width:305px;margin-right:6px}.inline[_ngcontent-%COMP%]{display:inline-block}.floatleft[_ngcontent-%COMP%]{float:left}.floatright[_ngcontent-%COMP%]{float:right}.nodeSelected[_ngcontent-%COMP%]{font-weight:700}.nodeSkipped[_ngcontent-%COMP%]{color:gray}.small[_ngcontent-%COMP%]{width:25px;height:25px}button.delete[_ngcontent-%COMP%]{margin-top:2px;margin-right:.8em;background-color:#d3d3d3;color:red}div.maptabset[_ngcontent-%COMP%]{float:left}tab[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{width:100%} .square{width:10px;height:10px;display:inline-block;margin:3px}.hidden[_ngcontent-%COMP%]{display:none}.global-buttons[_ngcontent-%COMP%]{margin-bottom:20px}.maptabset[_ngcontent-%COMP%]    .nav-pills{margin-right:6px}.maptabset[_ngcontent-%COMP%]    .nav-item{border-right:1px solid #ddd;margin:0}.maptabset[_ngcontent-%COMP%]    .nav-item.active{border-top:1px solid #ddd;border-bottom:1px solid #ddd;border-left:1px solid #ddd;border-right:0}.maptabset[_ngcontent-%COMP%]    .nav-item.active  a{color:#428bca;background-color:#fff}.maptabset[_ngcontent-%COMP%]    .tab-content  button{width:100%}.spin-loader[_ngcontent-%COMP%]{position:absolute;bottom:-20px;left:0;right:0;top:-20px;z-index:10000;background:url(/ng-map/assets/loader.gif) 50% no-repeat;background-size:80px 80px;background-color:rgba(0,0,0,.6);display:block}.maptabset[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{height:2em}.maptabset[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]{font-size:12px;text-align:right;margin-top:5px;display:table}.maptabset[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:table-cell;vertical-align:middle;height:25px}.maptabset[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#428bca}.maptabset[_ngcontent-%COMP%]   .panel-default[_ngcontent-%COMP%]{margin-bottom:7px}.maptabset[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{box-shadow:none}.route-action[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{float:right;margin:0;height:12px}.route-action[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{float:right;font-size:10px;margin-right:4px;color:#428bca}.button-separtor[_ngcontent-%COMP%]{margin:10px 0}.map-colors[_ngcontent-%COMP%]{position:relative;padding:5px 0}.map-colors[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:40px;top:11px}.heading[_ngcontent-%COMP%]   .map-btn[_ngcontent-%COMP%]{margin-top:10px}.in-margin-top[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.fa-right-margin[_ngcontent-%COMP%]{margin-right:7px}.form-control-input[_ngcontent-%COMP%]{display:inline-block;margin-right:10px;height:34px;padding:6px 12px;font-size:12px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.italic[_ngcontent-%COMP%]{font-style:italic;padding-left:12px;font-size:12px}.btn-group[_ngcontent-%COMP%]{width:100%}.form-control[_ngcontent-%COMP%]{margin-top:5px}accordion-group[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding-top:5px}accordion-group[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{margin-right:10px;color:#428bca}#accordion-menu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#333;background-color:#f5f5f5;cursor:pointer;padding:10px 20px;margin:0;border-top-left-radius:4px;border-top-right-radius:4px;border:1px solid #ddd;box-shadow:0 1px 1px rgba(0,0,0,.05)}#accordion-menu[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{border:1px solid #ddd;padding:20px 15px 10px;color:#333;background-color:#fff;border-color:#ddd;display:none;margin:0}#accordion-menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style-type:none}#accordion-menu[_ngcontent-%COMP%]   .collapsable-menu[_ngcontent-%COMP%]{display:none}#accordion-menu[_ngcontent-%COMP%]   .uncollapsable-menu[_ngcontent-%COMP%]{display:block}#long-accord[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto;padding-right:5px}#long-accord[_ngcontent-%COMP%]::-webkit-scrollbar{background-color:#eee;width:6px}#long-accord[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#999;border-radius:6px}.thinbutton[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}#scaleSlider[_ngcontent-%COMP%]{padding:15px}.hflex-container[_ngcontent-%COMP%]{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-ms-flex-pack:start;-webkit-box-pack:start;justify-content:flex-start;-ms-flex-line-pack:stretch;align-content:stretch;-ms-flex-align:start;-webkit-box-align:start;align-items:flex-start}.flex-item-narrow[_ngcontent-%COMP%], .flex-item-wide[_ngcontent-%COMP%]{-ms-flex-order:0;-webkit-box-ordinal-group:1;order:0;-webkit-align-self:auto;-ms-flex-item-align:auto;-ms-grid-row-align:auto;align-self:auto}.flex-item-narrow[_ngcontent-%COMP%]{-ms-flex:0 1 auto;-webkit-box-flex:0;flex:0 1 auto}.flex-item-wide[_ngcontent-%COMP%]{-ms-flex:1 1 auto;-webkit-box-flex:1;flex:1 1 auto}.smallspacing[_ngcontent-%COMP%]{margin-top:5px;margin-bottom:5px}"],pe=t("bm2B"),ce=[".form-control[_ngcontent-%COMP%]{display:inline-block;font-size:12px;padding:2px}.form-group[_ngcontent-%COMP%]{margin-bottom:2px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:400;text-align:left}.small[_ngcontent-%COMP%]{width:25px;height:25px}.edge-prop-colors[_ngcontent-%COMP%]{text-align:right}.input-form-control-margin[_ngcontent-%COMP%]{margin:10px 0}"],he=t("qbdv"),fe=t("ZHSE"),ge=t("QMm5"),me=function(){function e(e,n){this.name=e.replace(/-/g,"\u2501").replace(/ /g," \xa0"),this.style=n}return e.prototype.key=function(){return name},e}(),ve=function(){function e(e){this.differs=e,this.onChange=new ie.EventEmitter,this.defaultsDiffer=e.find({}).create(null),this.propertiesDiffer=e.find({}).create(null),this.allLineStyles=[new me("------",[]),new me("- - - ",[4,4]),new me("--  --",[8,8])],this.allTravelMeans=["Unspecified","Bike","Boat","Bus","Car","Helicopter","Plane","Train","Walk"]}return e.prototype.changeEvent=function(){this.setProp("lineWidth"),this.onChange.emit(this.properties)},e.prototype.ngOnInit=function(){this.readProperties()},e.prototype.ngDoCheck=function(){var e=this.defaultsDiffer.diff(this.defaults)||this.propertiesDiffer.diff(this.properties);return e&&this.readProperties(),e},e.prototype.readProperties=function(){for(var e={lineColor:"#000000",lineWidth:2,travelMean:"Unspecified",geom:"straight"},n=0,t=Object.keys(e);n<t.length;n++){var l=t[n];this.properties&&l in this.properties?this[l]=this.properties[l]:this.defaults&&l in this.defaults?this[l]=this.defaults[l]:this[l]=e[l]}var i;if(this.properties&&this.properties.dashed?i=this.properties.dashed:this.defaults&&this.defaults.dashed&&(i=this.defaults.dashed),i)for(var o=0,r=this.allLineStyles;o<r.length;o++){var a=r[o];this.sameStyles(a.style,i)&&(this.lineStyle=a.name)}else this.lineStyle=this.allLineStyles[0].name},e.prototype.sameStyles=function(e,n){if(!e||!n)return!1;if(e===n)return!0;if(e.length!=n.length)return!1;for(var t=0;t<e.length;++t)if(e[t]!=n[t])return!1;return!0},e.prototype.setProp=function(e){this.properties&&(this.defaults&&this[e]===this.defaults[e]?this.properties[e]&&delete this.properties[e]:this.properties[e]=this[e])},e.prototype.colorChanged=function(){this.setProp("lineColor"),this.changeEvent()},e.prototype.resetToDefault=function(){for(var e=0,n=Object.keys(this.properties);e<n.length;e++){var t=n[e];delete this.properties[t]}this.readProperties(),this.changeEvent()},e.prototype.hasDefault=function(){for(var e=["lineColor","lineWidth","travelMean","dashed"],n=0,t=e;n<t.length;n++){if(t[n]in this.properties)return!1}return!0},e.prototype.setLineStyle=function(e){for(var n=0,t=this.allLineStyles;n<t.length;n++){var l=t[n];l.name===e&&(this.properties.dashed=l.style)}this.changeEvent()},e.prototype.canDrive=function(){return-1!=["Car","Bus","Bike","Walk"].indexOf(this.travelMean)},e.prototype.setTravelMean=function(e){this.travelMean=e,this.setProp("travelMean"),this.canDrive()?"route"!=this.geom&&(this.geom="route",this.setProp("geom")):"route"==this.geom&&(this.geom=this.defaults?this.defaults.geom:"straight",this.setProp("geom")),this.changeEvent()},e.prototype.setGeom=function(e){this.geom=e,this.setProp("geom"),this.changeEvent()},e.ctorParameters=function(){return[{type:ie.KeyValueDiffers}]},e}(),ye=[ce],be=ie["\u0275crt"]({encapsulation:0,styles:ye,data:{}}),_e=(ie["\u0275ccf"]("edge-prop",ve,u,{properties:"properties",defaults:"defaults",noReset:"noReset"},{properties:"properties",onChange:"onChange"},[]),t("QO87")),Pe=[".block[_ngcontent-%COMP%]{display:inline-block;margin-right:15px}.form-control[_ngcontent-%COMP%]{width:8em;height:2em;display:inline-block;font-size:12px}.leftpadding[_ngcontent-%COMP%]{padding-left:15px}.small[_ngcontent-%COMP%]{width:25px;height:25px}.root[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%]{display:inline-block}input[type=number][_ngcontent-%COMP%]{width:4em;padding-left:3px;padding-right:3px}i.fa-recycle[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.text-prop-colors[_ngcontent-%COMP%]{position:relative;padding:5px 0}span[_ngcontent-%COMP%]{font-size:12px}.font-size-margin[_ngcontent-%COMP%]{margin:5px 0 8px}"],xe=t("XB9w"),we=function(){function e(e,n){this.cpService=e,this.differs=n,this.onChange=new ie.EventEmitter,this.defaultsDiffer=n.find({}).create(null),this.propertiesDiffer=n.find({}).create(null)}return e.prototype.ngOnInit=function(){},e.prototype.changeEvent=function(){this.onChange.emit(this.properties)},e.prototype.ngDoCheck=function(){var e=this.defaultsDiffer.diff(this.defaults)||this.propertiesDiffer.diff(this.properties);return e&&this.readProperties(),e},e.prototype.readProperties=function(){for(var e=0,n=["fill","stroke","fontSize"];e<n.length;e++){var t=n[e];this.properties&&t in this.properties?this[t]=this.properties[t]:this.defaults&&t in this.defaults?this[t]=this.defaults[t]:this[t]="stroke"==t||"fill"==t?"#000000":void 0}},e.prototype.hasDefault=function(){for(var e=0,n=["fill","stroke","fontSize"];e<n.length;e++){if(n[e]in this.properties)return!1}return!0},e.prototype.setProperty=function(e){this.properties[e]=this[e],this.changeEvent()},e.prototype.resetToDefault=function(){for(var e=0,n=["fill","stroke","fontSize"];e<n.length;e++){var t=n[e];delete this.properties[t]}this.readProperties(),this.changeEvent()},e.ctorParameters=function(){return[{type:xe.ColorPickerService},{type:ie.KeyValueDiffers}]},e}(),Ce=[Pe],ke=ie["\u0275crt"]({encapsulation:0,styles:Ce,data:{}}),Le=(ie["\u0275ccf"]("text-prop",we,h,{properties:"properties",defaults:"defaults",noReset:"noReset"},{properties:"properties",onChange:"onChange"},[]),t("uDoG")),Me=t("2dRj"),Te=t("m6EG"),Se=t("UbUN"),Re=t("1sP3"),Oe=t("5bcs"),Ee=t("Fw80"),De=t("Djd0"),Ie=t("pYHX"),ze=t("DmCJ"),Ne=t("XKz0"),Fe=function(){function e(e,n){if("number"==typeof e&&"number"==typeof n?(this.x=e,this.y=n):Array.isArray(e)?(this.x=e[0],this.y=e[1]):"object"==typeof e&&(this.x=e.x,this.y=e.y),void 0===this.x||void 0===this.y)throw new Error("invalid point")}return e.minus=function(n,t){return new e(n.x-t.x,n.y-t.y)},e.plus=function(n,t){return new e(n.x+t.x,n.y+t.y)},e.times=function(n,t){return new e(n*t.x,n*t.y)},e.min=function(n,t){return new e(Math.min(n.x,t.x),Math.min(n.y,t.y))},e.max=function(n,t){return new e(Math.max(n.x,t.x),Math.max(n.y,t.y))},e.dist=function(e,n){var t=e.x-n.x,l=e.y-n.y;return Math.sqrt(t*t+l*l)},e.norm=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.nearest=function(n,t){for(var l,i,o=0,r=t;o<r.length;o++){var a=r[o],s=e.dist(a,n);(void 0===l||s<i)&&(i=s,l=a)}return l},e.rotate=function(n,t){var l=Math.cos(t),i=Math.sin(t);return new e(n.x*l-n.y*i,n.x*i+n.y*l)},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.mul=function(e){return this.x*=e,this.y*=e,this},e.prototype.norm=function(){return e.norm(this)},e}(),We=function(){function e(e){e&&(e.min&&(this.min=new Fe(e.min)),e.max&&(this.max=new Fe(e.max)))}return e.closestPoint=function(e,n){var t=new Fe(0,0);for(var l in t)e[l]<n.min[l]?t[l]=n.min[l]:e[l]>n.max[l]?t[l]=n.max[l]:t[l]=e[l];return t},e.overlaps=function(e,n){return!(e.max.x<n.min.x||e.min.x>n.max.x||e.max.y<n.min.y||e.min.y>n.max.y)},e.contains=function(e,n){return n.x>=e.min.x&&n.x<=e.max.x&&n.y>=e.min.y&&n.y<=e.max.y},e.prototype.addPoint=function(e){this.min=void 0===this.min?new Fe(e):Fe.min(this.min,e),this.max=void 0===this.max?new Fe(e):Fe.max(this.max,e)},e.prototype.addArray=function(e){for(var n=0,t=e;n<t.length;n++){var l=t[n];this.addPoint(l)}},e.prototype.overlaps=function(n){return e.overlaps(this,n)},e.prototype.contains=function(n){return e.contains(this,n)},e}(),Ae=this&&this.__awaiter||function(e,n,t,l){return new(t||(t=Promise))(function(i,o){function r(e){try{s(l.next(e))}catch(e){o(e)}}function a(e){try{s(l.throw(e))}catch(e){o(e)}}function s(e){e.done?i(e.value):new t(function(n){n(e.value)}).then(r,a)}s((l=l.apply(e,n||[])).next())})},qe=this&&this.__generator||function(e,n){function t(e){return function(n){return l([e,n])}}function l(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(r=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(r=r.call(o,t[1])).done)return r;switch(o=0,r&&(t=[0,r.value]),t[0]){case 0:case 1:r=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){s.label=t[1];break}if(6===t[0]&&s.label<r[1]){s.label=r[1],r=t;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(t);break}r[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(e,s)}catch(e){t=[6,e],o=0}finally{i=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var i,o,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Be={},je={},Ve=function(){function e(e,n){var t=e||{};this.nodes=t.node||{},this.edges=t.edges||[],this.defaultEdgeProp=n}return e.generateControlPoints=function(e,n,t,l){var i=Fe.minus(t,n).mul(1/3),o=new Fe(-i.y,i.x);return[Fe.plus(Fe.plus(n,i),o),Fe.plus(Fe.minus(t,i),o)]},e.bezierFromPoints=function(e){for(var n=[],t=0;t<4;++t)n.push(e[t].x),n.push(e[t].y);return new Bezier(n)},e.bezierThroughPoints=function(n){for(var t=[],l=1;l<n.length;++l){var i=1===l?n[l-1]:n[l-2],o=n[l-1],r=n[l],a=l===n.length-1?n[l]:n[l+1];t.push(e.bezierFromPoints([o,Fe.plus(o,Fe.times(.2,Fe.minus(r,i))),Fe.plus(r,Fe.times(.2,Fe.minus(o,a))),r]))}return t},e.placeLeaderLine=function(e,n,t){e.properties||(e.properties={});var l,i=e.properties.leaderLine||"bestAnchor",o=e.properties.labelBbox;if("center"===i){var r=(o.max.x,o.min.x,new Fe((o.min.x+o.max.x)/2,(o.min.y+o.max.y)/2)),a=Fe.minus(e.coord,r);a.mul(.02),l=Fe.plus(r,a)}else l="closestOnBbox"===i?We.closestPoint(e.coord,o):d3.labeler.closestLineAnchorPoint(e.coord,{left:o.min.x,right:o.max.x,top:o.min.y,bottom:o.max.y,cx:(o.min.x+o.max.x)/2,cy:(o.min.y+o.max.y)/2});e.properties.leaderLineAnchorPixelOffset=void 0,e.properties.leaderLineAnchor=l,e.convertToPixelOffset(n,t)},e.prototype.createDefaultBezier=function(){for(var n in this.edges)for(var t=this.edges[n],l=this.nodes[t.from],i=this.nodes[t.to],o=e.generateControlPoints(void 0,l.coord,i.coord,void 0),r=0;r<o.length;++r)t.controlPoints[r]=o[r]},e.prototype.edgeProperty=function(e,n){return e.properties[n]||this.defaultEdgeProp[n]},e.prototype.getEdgeRoute=function(e){if("route"==this.edgeProperty(e,"geom")&&e.properties&&e.properties.route&&e.properties.route.geom&&this.edgeProperty(e,"travelMean")==e.properties.route.mean)return e.properties.route},e.prototype.bezier=function(n){if(!n.controlPoints||n.properties.hidden)return[];if("straight"==this.edgeProperty(n,"geom"))return e.bezierThroughPoints([this.nodes[n.from].coord,this.nodes[n.to].coord]);if(2===n.controlPoints.length){var t=[this.nodes[n.from].coord,n.controlPoints[0],n.controlPoints[1],this.nodes[n.to].coord];return[e.bezierFromPoints(t)]}if(5===n.controlPoints.length){var l=[this.nodes[n.from].coord,n.controlPoints[0],n.controlPoints[1],n.controlPoints[2]],i=[n.controlPoints[2],n.controlPoints[3],n.controlPoints[4],this.nodes[n.to].coord];return[e.bezierFromPoints(l),e.bezierFromPoints(i)]}var o=[this.nodes[n.from].coord].concat(n.controlPoints,[this.nodes[n.to].coord]);return e.bezierThroughPoints(o)},e.prototype.bounds=function(){var e=new We;for(var n in this.nodes)this.nodes[n].properties.skip||e.addPoint(this.nodes[n].coord);for(var n in this.edges){var t=this.edges[n],l=this.getEdgeRoute(t);if(l)for(var i=0,o=l.geom;i<o.length;i++){var r=o[i];e.addPoint(r)}else for(var a=this.bezier(t),s=0,u=a;s<u.length;s++)for(var d=u[s],p=d.getLUT(8),c=0,h=p;c<h.length;c++){var r=h[c];e.addPoint(r)}}return e},e.prototype.frame=function(e,n){var t=this.bounds();if(n=n||1.1,t.max&&t.min){if(t.min.x===t.max.x){var l=new Fe(1/32,1/32);t.addPoint(Fe.plus(t.min,l)),t.addPoint(Fe.minus(t.min,l))}}else t.min=new Fe(0,0),t.max=new Fe(1,1),n=1;e=e||(t.max.x-t.min.x)/(t.max.y-t.min.y);var i="number"==typeof n?new Fe(n,n):n,o=Fe.minus(t.max,t.min);o.x*=i.x,o.y*=i.y;var r,a=o.y*e;r=o.x>a?new Fe(o.x,o.x/e):new Fe(o.y*e,o.y),r.mul(.5);var s=Fe.times(.5,Fe.plus(t.max,t.min)),u=new We;return u.addPoint(Fe.minus(s,r)),u.addPoint(Fe.plus(s,r)),u},e.prototype.location=function(e,n){var t=this.frame(e,n);t.max.x,t.min.x;return{x:(t.max.x+t.min.x)/2,y:(t.max.y+t.min.y)/2,scale:Math.max(1/32768,t.max.x-t.min.x)}},e.prototype.compareNodes=function(e){var n=function(e,n){for(var t in e)if(!(t in n))return!1;return!0};return n(this.nodes,e.nodes)&&n(e.nodes,this.nodes)},e.prototype.getEdgeDirections=function(e,n){return P(Utils.worldToLatLon(this.nodes[e.from].coord),Utils.worldToLatLon(this.nodes[e.to].coord),n).then(function(t){var l=t.map(function(e){return new Fe(Utils.latLonToWorld(e))});return{mean:n,geom:l,from:e.from,to:e.to,midpoint:x(l)}})},e}(),Ue=function(){function e(e,n,t){this.graph=n,this.renderer=e,this.tripLayer=t}return e.prototype.acceptTouchEvent=function(e,n,t){if("wheel"===t)return!1;this.startWorldPos=new Fe(n),this.startViewerPos=new Fe(e);var l=this.tripLayer.findLabelAtWorldPos(this.startWorldPos);if(l){this.selectLabel(l);var i=l.properties;return this.applyDelta=function(e,n){i.labelCoord&&(i.labelCoord.x+=e.x,i.labelCoord.y+=e.y,i.userPlacement=new Fe(i.labelCoord)),i.labelPixelOffset&&(i.labelPixelOffset.add(Fe.times(1/this.renderer.pixelRatio,n)),i.userPlacementPixelOffset=new Fe(i.labelPixelOffset)),i.labelBbox.min.x+=e.x,i.labelBbox.min.y+=e.y,i.labelBbox.max.x+=e.x,i.labelBbox.max.y+=e.y,Ve.placeLeaderLine(l,this.renderer.pinchZoom,this.renderer.pixelRatio),this.onLabelMoved&&this.onLabelMoved(l)},!0}this.deselectLabel();var o=this.closestBezier(n),r=this.renderer.pinchZoom.worldDistanceFromViewerDistance(10*this.renderer.pixelRatio);if(o&&o.d<r){if(this.selectBezier(o),!o.bezier)return!0;var a=this,s=function(e){a.applyDelta=function(n,t){if(e){for(var l=Array.isArray(e)?e:[e],i=0,r=l;i<r.length;i++){var a=r[i];a.x+=n.x,a.y+=n.y}this.onBezierMoved&&this.onBezierMoved(o)}}},u=function(e,n,t){a.applyDelta=function(t,l){e.x+=t.x,e.y+=t.y,n.x+=t.x/2,n.y+=t.y/2}};return 2===o.edge.controlPoints.length?s(o.edge.controlPoints[o.t<.5?0:1]):5===o.edge.controlPoints.length?o.bezier.points[1].x===o.edge.controlPoints[0].x&&o.bezier.points[1].y===o.edge.controlPoints[0].y?o.t<.5?s(o.edge.controlPoints[0]):o.t<.9?u(o.edge.controlPoints[1],o.edge.controlPoints[2],o.edge.controlPoints[3]):s([o.edge.controlPoints[1],o.edge.controlPoints[2],o.edge.controlPoints[3]]):o.t<.1?s([o.edge.controlPoints[1],o.edge.controlPoints[2],o.edge.controlPoints[3]]):o.t<.5?u(o.edge.controlPoints[3],o.edge.controlPoints[2],o.edge.controlPoints[1]):s(o.edge.controlPoints[4]):s(Fe.nearest(n,o.edge.controlPoints)),!0}return this.selectBezier(),this.applyDelta=void 0,!1},e.prototype.selectLabel=function(e){this.selectedLabel&&delete this.selectedLabel.properties.frame,this.selectedLabel=void 0,this.selectBezier(),this.selectedLabel=e,this.onLabelSelect&&this.onLabelSelect(e),e&&(e.properties=e.properties||{},e.properties.frame="#000000"),this.renderer.refreshIfNotMoving()},e.prototype.deselectLabel=function(){return this.selectLabel()},e.prototype.handleMouseDown=function(e){e.preventDefault()},e.prototype.handleMouseMove=function(e){e.preventDefault();var n=Utils.eventPosInElementCoordinates(e,e.target||e.srcElement);this.handleMotion(n)},e.prototype.handleMotion=function(e){if(this.applyDelta){var n=this.renderer.pinchZoom.worldPosFromViewerPos(e.x,e.y),t=Fe.minus(n,this.startWorldPos);this.startWorldPos=n;var l=Fe.minus(e,this.startViewerPos);this.startViewerPos=new Fe(e),this.applyDelta(t,l),this.renderer.refreshIfNotMoving()}},e.prototype.handleMouseUp=function(e){e.preventDefault(),this.applyDelta=void 0},e.prototype.handleMouseWheel=function(e){e.preventDefault()},e.prototype.handleStart=function(e){e.preventDefault()},e.prototype.handleEnd=function(e){e.preventDefault(),this.applyDelta=void 0},e.prototype.handleMove=function(e){if(e.preventDefault(),1!==e.touches.length)return void(this.applyDelta=void 0);var n=Utils.eventPosInElementCoordinates(e.touches[0],e.target||e.srcElement);this.handleMotion(n)},e.prototype.edgeProperty=function(e,n){return this.graph.edgeProperty(e,n)},e.prototype.closestBezier=function(e){for(var n,t=0,l=this.graph.edges;t<l.length;t++){var i=l[t],o=this.graph.getEdgeRoute(i);if(o)for(var r=0,a=o.geom;r<a.length;r++){var s=a[r],u=Fe.dist(e,s);(!n||u<n.d)&&(n={d:u,edge:i,bezier:void 0})}else for(var d=this.graph.bezier(i),p=0,c=d;p<c.length;p++){var h=c[p],f=h.project(e);(!n||f.d<n.d)&&(n=f,n.edge=i,n.bezier=h)}}return n},e.prototype.selectBezier=function(e){if(this.selectedBezier){var n=this.selectedBezier.edge;delete n.drawMiddlePoint,void 0!==n.properties._lineWidth?(n.properties.lineWidth=n.properties._lineWidth,delete n.properties._lineWidth):delete n.properties.lineWidth}if(this.selectedBezier=e,e){var n=e.edge;n.drawMiddlePoint=!0,void 0!==n.properties.lineWidth&&(n.properties._lineWidth=n.properties.lineWidth),n.properties.lineWidth=5}this.selectedLabel&&this.deselectLabel(),this.onBezierSelect&&this.onBezierSelect(this.selectedBezier),this.renderer.refreshIfNotMoving()},e}(),$e=function(){function e(){this.allPlaces=[]}return e.parse=function(n){var t=new e;t.coord=new Fe(n.coord),n.place&&(n.place=e.parse(n.place)),n.viewerPos&&(t.viewerPos=new Fe(n.viewerPos));for(var l=0,i=["dbid","name","label","labelIcon","properties"];l<i.length;l++){var o=i[l];n[o]&&(t[o]=n[o])}return t.name||(void 0!==t.dbid?t.name=""+t.dbid:t.label&&(t.name=t.label)),t.properties=n.properties||{},t.properties.labelBbox&&(t.properties.labelBbox=new We(t.properties.labelBbox)),t.properties.leaderLineAnchor&&(t.properties.leaderLineAnchor=new Fe(t.properties.leaderLineAnchor)),t.properties.labelCoord&&(t.properties.labelCoord=new Fe(t.properties.labelCoord)),t.properties.labelPixelOffset&&(t.properties.labelPixelOffset=new Fe(t.properties.labelPixelOffset)),t},e.prototype.isSkipped=function(){return!(this.label&&(!this.properties||void 0===this.properties.skip))&&this.properties.skip},e.prototype.labelPixelPos=function(e,n){return this.properties&&this.properties.labelPixelOffset?Fe.plus(e.viewerPosFromWorldPos(this.coord),Fe.times(n,this.properties.labelPixelOffset)):e.viewerPosFromWorldPos(this.properties&&this.properties.labelCoord?this.properties.labelCoord:this.coord)},e.prototype.leaderLineAnchorPos=function(e,n){if(this.properties&&(this.properties.leaderLineAnchor||this.properties.leaderLineAnchorPixelOffset))return this.properties.leaderLineAnchorPixelOffset?Fe.plus(e.viewerPosFromWorldPos(this.coord),Fe.times(n,this.properties.leaderLineAnchorPixelOffset)):e.viewerPosFromWorldPos(this.properties.leaderLineAnchor)},e.prototype.convertToPixelOffset=function(e,n){this.properties.labelCoord&&(this.properties.labelPixelOffset||(this.properties.labelPixelOffset=Fe.minus(e.viewerPosFromWorldPos(this.properties.labelCoord),e.viewerPosFromWorldPos(this.coord)).mul(1/n)),delete this.properties.labelCoord),this.properties.leaderLineAnchor&&(this.properties.leaderLineAnchorPixelOffset||(this.properties.leaderLineAnchorPixelOffset=Fe.minus(e.viewerPosFromWorldPos(this.properties.leaderLineAnchor),e.viewerPosFromWorldPos(this.coord)).mul(1/n)),delete this.properties.leaderLineAnchor)},e}(),He=function(){function e(n){if(this.properties={},n){if(n.controlPoints){this.controlPoints=[];for(var t=0;t<n.controlPoints.length;++t)this.controlPoints[t]=new Fe(n.controlPoints[t])}n.originalEdge&&(this.originalEdge=new e(n.originalEdge));for(var l=0,i=["from","to","drawMiddlePoint","properties","fromDbId"];l<i.length;l++){var o=i[l];o in n&&(this[o]=n[o])}if(n.properties&&(this.properties=n.properties,n.properties.lineWidth&&(this.properties.lineWidth=parseFloat(n.properties.lineWidth)),n.properties.dashed))for(var t=0;t<n.properties.dashed.length;++t)this.properties.dashed[t]=parseInt(n.properties.dashed[t])}}return e.prototype.propagateToOriginal=function(){if(this.originalEdge)for(var e=0,n=["controlPoints","drawMiddlePoint"];e<n.length;e++){var t=n[e];t in this&&(this.originalEdge[t]=this[t])}},e}(),Ze=function(){function e(e){if(this.params=e,this.markedPlaces=[],this.renderer=e.renderer,this.defaultRadius=e.defaultRadius||6,this.icons={},this.defaultTextProp={fontSize:e.defaultFontSize||20,stroke:"rgba(255,255,255,.8)",fill:"#000000"},this.defaultEdgeProp=e.defaultEdgeProp||{lineWidth:1,lineColor:"#000000"},this.hideLabels=!!e.hideLabels,this.hideNodePoints=!!e.hideNodePoints,!this.renderer)throw new Error("TripGraphLayer: no renderer !");this.graph=e.graph||new Ve(void 0,this.defaultEdgeProp),this.missingData=1}return e.prototype.isReady=function(){return 0==this.missingData},e.prototype.draw=function(e,n,t,l){var i=this.graph,o=e.getContext("2d"),r=this.renderer.pixelRatio;this.markedPlaces=[],this.missingData=0;for(var a=0,s=i.edges;a<s.length;a++){var u=s[a];this.drawEdge(o,n,u,r,"curve")}for(var d=0,p=i.edges;d<p.length;d++){var u=p[d];this.drawEdge(o,n,u,r,"mark")}o.setLineDash([]);for(var c in i.nodes){var h=i.nodes[c];h.convertToPixelOffset(n,r),h.viewerPos=n.viewerPosFromWorldPos(h.coord)}if(!this.hideNodePoints)for(var c in i.nodes){var h=i.nodes[c];this.drawNodePoint(o,n,h)}for(var c in i.nodes)if(this.forceLeaderLines||!this.hideLabels||c.match(/-(takeoff)|(landing)$/)){var h=i.nodes[c];this.drawLeaderLine(o,n,h)}for(var c in i.nodes)if(!this.hideLabels||c.match(/-(takeoff)|(landing)$/)){var h=i.nodes[c];this.drawNodeLabel(o,n,h)}this.markedPlaces=this.markedPlaces.map(function(e){return n.worldPosFromViewerPos(e)}),this.fillClicMap(e,n)},e.prototype.drawEdge=function(e,n,t,l,i){this.setEdgeStrokeStyle(e,t),"route"==this.edgeProperty(t,"geom")?this.drawRoad(e,n,t,l,i):this.drawEdgeBezier(e,n,t,l,i)},e.prototype.drawRoad=function(e,n,t,l,i){var o=this,r=(this.edgeProperty(t,"travelMean"),this.graph.getEdgeRoute(t));if("curve"==i)if(r){var a=t.properties.route.geom;e.beginPath();var s=n.viewerPosFromWorldPos(a[0]);e.moveTo(s.x,s.y);for(var u=1;u<a.length;++u){var d=n.viewerPosFromWorldPos(a[u]);e.lineTo(d.x,d.y)}e.stroke()}else this.missingData+=1,t.properties||(t.properties={}),this.graph.getEdgeDirections(t,this.edgeProperty(t,"travelMean")).then(function(e){t.properties.route=e,o.renderer.refresh()}).catch(function(e){console.log(e),t.properties.geom="straight",o.renderer.refresh()});else if("mark"==i&&r&&r.midpoint){var s=new Fe(n.viewerPosFromWorldPos(r.geom[0])),p=new Fe(n.viewerPosFromWorldPos(r.geom[r.geom.length-1]));if(Fe.dist(p,s)>80*l){for(var c=r.midpoint,h=16*l,f=new Fe(n.viewerPosFromWorldPos(r.geom[c])),g=void 0,u=c;u<r.geom.length;++u){var m=new Fe(n.viewerPosFromWorldPos(r.geom[u])),v=Fe.dist(f,m);if(v>h){g=Fe.minus(m,f);break}}if(!g)return;var y=new Fe(g.y,-g.x);this.drawEdgeMark(Fe.plus(f,Fe.times(8*l/g.norm(),g)),y,g,e,l,t,i)}}},e.prototype.drawEdgeBezier=function(e,n,t,l,i){for(var o=this.graph.bezier(t),r=0,a=o;r<a.length;r++){var s=a[r];this.drawBezier(e,n,s,l,t,i)}if("mark"!=i&&o.length>1&&t.drawMiddlePoint)for(var u in o){var d=n.viewerPosFromWorldPos(o[u].points[3]),p=5*l;e.beginPath(),e.arc(d.x,d.y,p,0,2*Math.PI,!1),e.fillStyle="#000000",e.fill()}},e.prototype.drawBezier=function(e,n,t,l,i,o){e.save();for(var r=new Array(8),a=t.points,s=0;s<4;++s){var u=n.viewerPosFromWorldPos(a[s]);r[2*s]=u.x,r[2*s+1]=u.y}var d=new Bezier(r),p=d.length(),c=Math.min(2,Math.floor(p/(40*l))),h=d.points;"mark"!=o&&(e.beginPath(),e.moveTo(h[0].x,h[0].y),e.bezierCurveTo(h[1].x,h[1].y,h[2].x,h[2].y,h[3].x,h[3].y),e.stroke());for(var f=1;f<c;++f){var g=f/c,u=new Fe(d.get(g)),m=new Fe(d.normal(g)),v=new Fe(d.derivative(g));this.drawEdgeMark(u,m,v,e,l,i,o)}e.restore()},e.prototype.drawEdgeMark=function(n,t,l,i,o,r,a){switch(this.edgeProperty(r,"travelMean")){case"Bike":case"Boat":case"Bus":case"Car":case"Helicopter":case"Plane":case"Train":case"Walk":"curve"!=a&&this.drawEdgeMarkIcon(n,t,l,i,o,r);break;case"Unspecified":default:"mark"!=a&&e.drawEdgeMarkTriangle(n,t,l,i,o)}},e.drawEdgeMarkTriangle=function(e,n,t,l,i){var o=10*i;t.mul(o/t.norm()),e=Fe.plus(e,Fe.times(.5,t));var r=Fe.minus(e,t);l.beginPath(),l.moveTo(r.x+o/2*n.x,r.y+o/2*n.y),l.lineTo(e.x,e.y),l.lineTo(r.x-o/2*n.x,r.y-o/2*n.y),l.closePath(),l.fill()},e.prototype.drawEdgeMarkIcon=function(e,n,t,l,i,o){l.fillStyle="#fff",l.setLineDash([]),l.lineWidth=1*i;var r=10*i,a=6*i;t=t.mul(1/t.norm());var s=Fe.plus(e,Fe.times((r+a)/2,t)),u=Fe.minus(e,Fe.times((r+a)/2,t)),d=Fe.plus(u,Fe.times(r,t)),p=new Fe(-t.y,t.x).mul(4*i),c=Fe.plus(d,p),h=Fe.minus(d,p),f=Fe.minus(c,u),g=Math.atan2(f.y,f.x),m=Fe.minus(h,u),v=Math.atan2(m.y,m.x);l.beginPath(),l.arc(u.x,u.y,r,g,v),l.lineTo(s.x,s.y),l.closePath(),l.fill(),l.stroke(),l.fillStyle="#000",l.textAlign="center",l.textBaseline="middle",l.font=Math.round(10*i)+"px FontAwesome";var y={Bike:"\uf206",Boat:"\uf21a",Bus:"\uf207",Car:"\uf1b9",Helicopter:"H",Plane:"\uf072",Train:"\uf238",Walk:"\uf183"},b=this.edgeProperty(o,"travelMean");"Plane"==b&&(l.save(),l.translate(u.x,u.y),l.rotate(Math.PI/4+Math.atan2(t.y,t.x)),l.translate(-u.x,-u.y)),l.fillText(y[b],u.x,u.y),this.markedPlaces.push(u),"Plane"==b&&l.restore()},e.prototype.edgeProperty=function(e,n){return e.properties[n]||this.defaultEdgeProp[n]},e.prototype.setEdgeStrokeStyle=function(e,n){var t=this.edgeProperty(n,"lineColor");e.strokeStyle=t,e.fillStyle=t,e.lineWidth=this.renderer.pixelRatio*this.edgeProperty(n,"lineWidth"),this.setDashStyle(e,this.edgeProperty(n,"dashed"))},e.prototype.nodeRadius=function(e){var n=this.defaultRadius;return e.properties&&e.properties.radius&&(n=e.properties.radius),n*this.renderer.pixelRatio},e.prototype.drawNodePoint=function(e,n,t){if(!t.properties||0!=t.properties.point){var l=t.viewerPos;this.drawPoint(e,l,this.renderer.pixelRatio,t.properties||{})}},e.prototype.drawNodeLabel=function(n,t,l){var i=this;if(l.label||l.labelIcon){var o=l.labelPixelPos(t,this.renderer.pixelRatio);if(l.label&&e.drawText(n,l.label,o,this.renderer.pixelRatio,l.properties||{},this.defaultTextProp),l.labelIcon){var r=this.getIcon(l.labelIcon.url);if(r){if(void 0!=l.labelIcon.autorotate){var a=t.viewerPosFromWorldPos(l.coord);l.labelIcon.angle=l.labelIcon.autorotate+Math.atan2(a.y-o.y,a.x-o.x)}this.drawIcon(n,r,l.labelIcon,o,this.renderer.pixelRatio)}else this.missingData++,this.loadIcons(function(){return i.renderer.refresh()})}if(l.properties&&l.properties.frame&&l.label){var s=e.measureText(n,l.label,this.renderer.pixelRatio,l.properties||{},this.defaultTextProp);n.strokeStyle=l.properties.frame,s.width+=3*this.renderer.pixelRatio,s.height+=3*this.renderer.pixelRatio,n.rect(o.x-s.width/2,o.y-s.height/2,s.width,s.height),n.stroke()}}},e.prototype.setDashStyle=function(e,n){var t=[];if(n)for(var l=0,i=n;l<i.length;l++){var o=i[l];t.push(this.renderer.pixelRatio*o)}e.setLineDash(t)},e.prototype.drawLeaderLine=function(e,n,t){if(t.properties){var l=t.properties;if(l.leaderLineAnchor||l.leaderLineAnchorPixelOffset){var i=this.renderer.pixelRatio,o=t.leaderLineAnchorPos(n,i);e.lineWidth=(t.properties.leaderLineWidth||1)*i,e.beginPath();var r=n.viewerPosFromWorldPos(t.coord),a=this.nodeRadius(t),s=t.properties&&void 0!==t.properties.maxLeaderLineLength?t.properties.maxLeaderLineLength*i:3*a;Fe.dist(o,r)>s&&(t.properties.dashed&&this.setDashStyle(e,t.properties.dashed),e.moveTo(o.x,o.y),e.lineTo(r.x,r.y),e.strokeStyle=t.properties.leaderLineColor||"#000000",e.stroke(),t.properties.dashed&&e.setLineDash([]))}}},e.prototype.drawPoint=function(e,n,t,l){e.strokeStyle="rgba(0,0,0,1)",e.fillStyle="rgba(255,255,255,1)",e.lineWidth=2*t,e.beginPath();var i=(l.radius||this.defaultRadius)*t;e.arc(n.x,n.y,i,0,2*Math.PI,!1),e.stroke(),e.fill();var o=l.markStyle;!o&&l.firstVisited&&(o="first"),"first"===o&&(e.fillStyle="rgba(0, 0, 0, 1)",e.beginPath(),e.arc(n.x,n.y,.6*i,0,2*Math.PI,!1),e.fill())},e.measureText=function(n,t,l,i,o){var r=t.split("\n"),a=e.setTextStyle(n,l,i,o),s={width:0,height:a*r.length*1.1};for(var u in r)s.width=Math.max(s.width,1.1*n.measureText(r[u]).width);return s},e.setTextStyle=function(e,n,t,l){t=t||{};var i=t.fontSize||l.fontSize;return i*=n,e.font=i+"px "+(t.font||"'PT Sans', sans-serif"),e.strokeStyle=t.stroke||l.stroke,e.lineWidth=(t.haloWidth||4)*n,e.fillStyle=t.fill||l.fill,parseInt(""+i)},e.drawText=function(n,t,l,i,o,r){var a,s,u=(void 0!=o.textOffset?o.textOffset:20)*i,d=((o.textPlacement||"S")+"").toUpperCase();switch(d){default:case"C":case"N":case"S":n.textAlign="center",a=0;break;case"E":case"NE":n.textAlign="start",a=u;break;case"O":case"W":n.textAlign="end",a=-u}switch(d){case"C":case"E":case"W":case"O":n.textBaseline="middle",s=0;break;case"N":case"NE":n.textBaseline="bottom",s=-u;break;default:case"S":n.textBaseline="top",s=u}var p=l.x+a,c=l.y+s,h=e.setTextStyle(n,i,o,r),f=t.split("\n");n.shadowBlur=3*i,n.shadowColor="#ffffff",n.lineWidth=2*i;for(var g=(f.length-1)/2,m=0;m<f.length;++m){var v=c+(m-g)*h;n.strokeText(f[m],p,v),n.fillText(f[m],p,v)}n.shadowColor="transparent"},e.prototype.drawIcon=function(e,n,t,l,i){if(n){var o=t.width?t.width*i:16*i,r=t.height?t.height*i:o,a="ratioX"in t?t.ratioX:.5,s="ratioY"in t?t.ratioY:.5,u=o*a,d=r*s;t.angle?(e.save(),e.translate(l.x,l.y),e.rotate(t.angle),e.drawImage(n,-u,-d,o,r),e.restore(),this.markedPlaces.push(Fe.plus(l,Fe.rotate(new Fe(o/2-u,r/2-d),t.angle)))):(e.drawImage(n,l.x-u,l.y-d,o,r),this.markedPlaces.push({x:l.x-u+o/2,y:l.y-d+r/2}))}},e.prototype.getLabelIconSize=function(e,n){var t=this.renderer.pixelRatio,l=n.labelIcon;return{width:(l.width||16)*t,height:(l.height||l.width||16)*t}},e.prototype.computeNodeSizeWithMargin=function(n,t){var l;if(t.label){var i=this.renderer.pixelRatio;l=e.measureText(n,t.label,i,t.properties,this.defaultTextProp)}else t.labelIcon&&(l=this.getLabelIconSize(n,t),l.width*=1.4,l.height*=1.4);if(!l)throw"no label and no labIcon for node";var o=2*this.renderer.pixelRatio;return l.width+=2*o,l.height+=2*o,l},e.prototype.setLabelBbox=function(e,n,t){if(e&&(e.label||e.labelIcon)&&e.properties&&(e.properties.labelCoord||e.properties.labelPixelOffset)){n||(n=this.renderer.canvas.getContext("2d"));var l=this.renderer.pinchZoom;if(!t){var i=this.computeNodeSizeWithMargin(n,e),o=e.labelPixelPos(l,this.renderer.pixelRatio);t={x:o.x,y:o.y,width:i.width,height:i.height}}var r=e.properties,a=Fe.times(.5,new Fe(t.width,t.height));r.labelBbox=new We({min:l.worldPosFromViewerPos(Fe.minus(t,a)),max:l.worldPosFromViewerPos(Fe.plus(t,a))})}},e.prototype.nodeName=function(e){if(e.label)return e.label;if(e.labelIcon)return"icon:"+e.labelIcon.url;throw"no label and no labIcon for node"},e.prototype.placeLabels=function(e,n){var t=this.renderer.pinchZoom,l=this.renderer.pixelRatio,i=[],o=[];for(var r in this.graph.nodes){var a=this.graph.nodes[r];if(a.label||a.labelIcon){var s=t.viewerPosFromWorldPos(a.coord),u=this.defaultRadius;a.properties&&a.properties.radius&&(u=a.properties.radius),o.push({x:s.x,y:s.y,r:!1!==a.properties.point?u*l:-1});var d=this.computeNodeSizeWithMargin(e,a),p=this.nodeName(a),c=s;!1===a.properties.point&&(c.x-=d.width/2,c.y-=d.height/2);var h=void 0;n&&(h=c),a.properties&&a.properties.userPlacement&&(h=c=t.viewerPosFromWorldPos(a.properties.userPlacement)),a.properties&&a.properties.userPlacementPixelOffset&&(h=c=Fe.plus(s,Fe.times(l,a.properties.userPlacementPixelOffset)));var f={x:c.x,y:c.y,name:p,width:d.width,height:d.height,node:a,userPlacement:h};i.push(f)}}var g=d3.labeler().label(i).anchor(o).width(this.renderer.canvas.width).height(this.renderer.canvas.height),m=g.alt_energy(),v=[],y=[];for(var b in this.graph.edges){var _=this.graph.getEdgeRoute(this.graph.edges[b]);if(_){for(var P=[],x=0,w=_.geom;x<w.length;x++){var C=w[x],k=t.viewerPosFromWorldPos(C);(0==P.length||Fe.dist(P[P.length-1],k)>4*l)&&P.push(k)}var L=new We;L.addArray(P),v.push(L),y.push(P)}else{var M=this.graph.bezier(this.graph.edges[b]);for(var r in M){var T=M[r],L=T.bbox();v.push({min:t.viewerPosFromWorldPos(L.x.min,L.y.min),max:t.viewerPosFromWorldPos(L.x.max,L.y.max)});var S=T.getLUT(30),R=[];for(var O in S)R.push(t.viewerPosFromWorldPos(S[O]));y.push(R)}}}g.alt_energy(function(e,n,t){var l=0,o=g.boxOfLabel(e),r=new We;r.addPoint(new Fe(o.left,o.top)),r.addPoint(new Fe(o.right,o.bottom));for(var a in v)if(We.overlaps(v[a],r)){var s=y[a];for(var u in s)r.contains(s[u])&&l++}var d=10*l+m(e),p=i[e].userPlacement;if(p){d+=Fe.dist(p,i[e])}return d});g.start(5e3,1);for(var r in i){var E=i[r];E.node.properties||(E.node.properties={});var D=E.node.properties,I=t.viewerPosFromWorldPos(E.node.coord);D.labelPixelOffset=Fe.minus(E,I).mul(1/l),"labelCoord"in D&&delete D.labelCoord,this.setLabelBbox(E.node,e,E),Ve.placeLeaderLine(E.node,t,l),D.textPlacement="C",D.textOffset=0}},e.shallowCopy=function(e){var n,t=Object.create(Object.getPrototypeOf(e)),l=Object.getOwnPropertyNames(e);for(n=0;n<l.length;n++)Object.defineProperty(t,l[n],Object.getOwnPropertyDescriptor(e,l[n]));return t},e.prototype.forEachNode=function(e){for(var n in this.graph.nodes)e(this.graph.nodes[n])},e.prototype.getIcon=function(e){if(this.icons[e]&&!this.icons[e].loading)return this.icons[e]},e.prototype.loadIcons=function(e){if(!(this.iconsToLoad>0)){var n=this;this.iconsToLoad=1,this.failedIcons=0;var t=function(){n.iconsToLoad--,e&&0===n.iconsToLoad&&(n.failedIcons>0?e(new Error(n.failedIcons+" icons failed to load.")):e())};this.forEachNode(function(e){if(e.labelIcon){var l=e.labelIcon.url;if(n.icons[l])return;n.icons[l]={loading:!0},n.iconsToLoad++;var i=window.imageUrlPrefix||"";n.renderer.loadImage(i+e.labelIcon.url,function(e){n.icons[l]=e,t()},function(e){console.log("Failed to load: "+l+" (prefix: "+i+")"),n.failedIcons++,t()})}}),t()}},e.prototype.findLabelAtWorldPos=function(e){var n=this.graph.nodes;for(var t in n)if(n.hasOwnProperty(t)){var l=this.graph.nodes[t];if(l.properties&&(l.properties.labelCoord||l.properties.labelPixelOffset)&&this.setLabelBbox(l),l.properties&&l.properties.labelBbox&&We.contains(l.properties.labelBbox,e))return l}},e.prototype.findNodePointAtViewerPos=function(e){var n=this.graph;for(var t in n.nodes){var l=n.nodes[t];if(!l.properties||0!=l.properties.point){var i=l.properties,o=(i.radius||this.defaultRadius)*this.renderer.pixelRatio;if(Fe.dist(l.viewerPos,e)<o)return l}}},e.prototype.fillClicMap=function(e,n){var t=document.getElementById("image-clic-map"),l=this.graph;if(t){var i="";for(var o in l.nodes){var r=l.nodes[o];if(r.label){var a=this.computeNodeSizeWithMargin(e.getContext("2d"),r),s=r.labelPixelPos(n,this.renderer.pixelRatio),u=[s.x-a.width/2,s.y-a.height/2,s.x+a.width/2,s.y+a.height/2].map(function(e){return Math.round(e)});u[0]>=e.width||u[1]>=e.height||u[2]<0||u[3]<0||(i+='<area href="'+(r.dbid||r.name)+'" shape="rect" alt="'+r.label+'" coords="'+u.join(",")+'">\n')}}t.innerHTML=i}},e}(),Ge=function(){function e(e,n,t){this.name=e,this.width_mm=n,this.height_mm=t}return e.fromPt=function(n,t,l){return new e(n,t/e.mmToPoint,l/e.mmToPoint)},e.fromIPageSize=function(n){return new e(n.name,n.width_mm,n.height_mm)},e.prototype.widthPt=function(){return Math.round(this.width_mm*e.mmToPoint)},e.prototype.heightPt=function(){return Math.round(this.height_mm*e.mmToPoint)},e.prototype.key=function(){return Math.round(this.width_mm)+"x"+Math.round(this.height_mm)},e}();Ge.mmToPoint=2.83465;var Je,Ke=function(){function e(){this.reset()}return e.makePlaneIcon=function(e,n){var t=new $e;return t.name=n.dbid+"-"+e,t.labelIcon={url:"/ng-map/assets/plane.png",width:20,autorotate:Math.PI/2*("landing"===e?1:-1),ratioX:.5,ratioY:"landing"===e?0:1},t.coord=n.coord,t.properties={point:!1,leaderLine:"center",dashed:[5,3],leaderLineWidth:2,maxLeaderLineLength:2},t},e.prototype.places=function(){return this._tripData.places},e.prototype.stages=function(){return this._tripData.stages},e.prototype.setLocation=function(e){this._tripData.location=e},e.prototype.location=function(){return this._tripData.location},e.prototype.width_mm=function(){return this._tripData.width},e.prototype.height_mm=function(){return this._tripData.height},e.prototype.pageSizeName=function(){return this._tripData.pageSizeName},e.prototype.world=function(){return this._tripData.world||(this._tripData.world={}),this._tripData.world},e.prototype.setSize=function(e,n,t){this._tripData.width=n,this._tripData.height=t,this._tripData.pageSizeName=e},e.prototype.defaultRadius=function(){return this._tripData.defaultRadius},e.prototype.defaultTextProp=function(){return this._tripData.defaultTextProp||(this._tripData.defaultTextProp={}),this._tripData.defaultTextProp},e.prototype.defaultEdgeProp=function(){return this._tripData.defaultEdgeProp||(this._tripData.defaultEdgeProp=e.defaultTrip().defaultEdgeProp),this._tripData.defaultEdgeProp},e.prototype.edgeProperty=function(e,n){return e.properties[n]||this._tripData.defaultEdgeProp[n]},e.prototype.nodeProperty=function(e,n){return e.properties[n]||this._tripData.defaultTextProp[n]},e.prototype.reset=function(){this._tripData=e.defaultTrip()},e.defaultTrip=function(){var e=(window,w().preferences||{}),n=new Ge("Full page",128,190);if(e.default_page_size&&e.page_sizes)for(var t=0,l=e.page_sizes;t<l.length;t++){var i=l[t];if(i.name==e.default_page_size){n=i;break}}return{places:[],stages:[],additionalPlaces:[],location:{x:.5,y:.5,scale:1/8},defaultRadius:8,width:n.width_mm,height:n.height_mm,pageSizeName:n.name,borderColor:"#fefefe",landColor:"#cecece",seaColor:"#c4e3ff",showRivers:!1,world:{},defaultTextProp:Object.assign({fontSize:12,font:"'PT Sans', sans-serif",stroke:"rgba(255,255,255,.8)",fill:"#000000"},e.default_node_prop),defaultEdgeProp:Object.assign({lineWidth:2,lineColor:"#000000",geom:e.line_shape||"straight"},e.default_edge_prop)}},e.prototype.setPlaces=function(e){this._tripData.places.splice.apply(this._tripData.places,[0,this._tripData.places.length].concat(e)),this.updateStages(),this.updateLandingsAndTakeoff()},e.prototype.stagesAsDict=function(){for(var e={},n=0,t=this._tripData.stages;n<t.length;n++){var l=t[n];l.from in e||(e[l.from]={}),e[l.from][l.to]=l}return e},e.prototype.edgeFrom=function(e){for(var n=0,t=this._tripData.stages;n<t.length;n++){var l=t[n];if(l.from==e)return l}},e.prototype.updateStages=function(){for(var e=this._tripData.places,n=e.length-1,t=(this._tripData.stages,[]),l=this.stagesAsDict(),i=1;i<=n;++i){var o=e[i-1].dbid,r=e[i].dbid;if(l[o]&&l[o][r]){var a=l[o][r];a.to=e[i].name,t.push(a)}else t.push(new He({from:e[i-1].name,to:e[i].name,fromDbId:o,controlPoints:Ve.generateControlPoints(i>=2?e[i-2].coord:void 0,e[i-1].coord,e[i].coord,i+1<e.length?e[i+1].coord:void 0),properties:e[i-1].followingEdgeProp||{}}))}this._tripData.stages.splice.apply(this._tripData.stages,[0,this._tripData.stages.length].concat(t))},e.prototype.updateLandingsAndTakeoff=function(){for(var n={},t=this._tripData.additionalPlaces,l=0;l<t.length;++l)n[t[l].name]=l;for(var i=[],o={},r={},a=["landing","takeoff"],s=0,u=this._tripData.places;s<u.length;s++)for(var d=u[s],p=0,c=a;p<c.length;p++){var h=c[p],f=d.dbid+"-"+h;r[f]=!0,!d.properties.skip&&d.properties[h]?f in n||i.push(e.makePlaneIcon(h,d)):f in n&&(o[f]=!0)}var g=/-(landing|takeoff)$/,m=t.filter(function(e){return!(e.name in o)&&(e.name in r||null==e.name.match(g))}).concat(i);this._tripData.additionalPlaces.splice.apply(this._tripData.additionalPlaces,[0,this._tripData.additionalPlaces.length].concat(m))},e.prototype.nodeRadius=function(e,n){var t=this._tripData.defaultRadius;return e.properties&&e.properties.radius&&(t=e.properties.radius),t*n},e.prototype.makeGraph=function(e){for(var n={},t=(function(e){for(var t=e;t in n;)t=n[t];return t}),l=0,i=this._tripData.places;l<i.length;l++){var o=i[l];if(!o.name)throw new Error("nodes should have names and labels")}var r=[];if(e){for(var a=e.renderer.pinchZoom,s=e.renderer.pixelRatio,u=0,d=this._tripData.places;u<d.length;u++){var p=d[u];p.viewerPos=a.viewerPosFromWorldPos(p.coord)}for(var c=0,h=this._tripData.places;c<h.length;c++){var p=h[c];if(!(!p.label||p.properties&&p.properties.skip)){for(var f=this.nodeRadius(p,s),g=!0,m=0;m<r.length;++m){var o=r[m];if(Fe.dist(o.viewerPos,p.viewerPos)<this.nodeRadius(o,s)+f){r[m]=function(e,t){var l=$e.parse(e);l.name=e.name+","+t.name,l.allPlaces=e.allPlaces.concat([t]);var i=e.label.split("\n");return i.indexOf(t.label)<0&&i.push(t.label),l.label=i.join("\n"),n[e.name]=n[t.name]=l.name,l}(o,p),g=!1;break}}if(g){p.properties||(p.properties={});var v=$e.parse(p);v.place=p,v.allPlaces=[p],r.push(v)}}}}else for(var y=0,b=this._tripData.places;y<b.length;y++){var p=b[y],v=$e.parse(p);v.place=p,v.allPlaces=[p],r.push(v)}for(var _=this._tripData.places,P={},m=0;m<_.length;++m){var o=_[m];P[o.name]=m}for(var x=new Ve(void 0,this._tripData.defaultEdgeProp),w=0,C=r;w<C.length;w++){var o=C[w];x.nodes[o.name]=o}this.updateLandingsAndTakeoff();for(var k=0,L=this._tripData.additionalPlaces;k<L.length;k++){var o=L[k];x.nodes[o.name]=o}for(var M=0,T=this._tripData.stages;M<T.length;M++){var S=T[M];if(!S.properties.hidden&&!_[P[S.from]].isSkipped()){for(var R=t(S.from),O=P[S.to];O<_.length&&_[O].isSkipped();)++O;if(!(O>=_.length||_[O].isSkipped())){var E=t(_[O].name);if(R!==E){var D=Ze.shallowCopy(S);D.from=R,D.to=E,D.originalEdge=S;var I=D.properties.route;!I||I.from==R&&I.to==E||delete D.properties.route,x.edges.push(D)}}}}return x},e.prototype.save=function(){return this._tripData},e.prototype.load=function(e){if("string"==typeof e&&(e=JSON.parse(e)),!e||!e.places||!e.stages)throw new Error("no data");var n=e,t=function(e){for(var n=0;n<e.length;++n)e[n]=$e.parse(e[n])};t(n.places);for(var l=n.stages,i=0;i<l.length;++i)l[i]=new He(l[i]);t(n.additionalPlaces),this._tripData=n,this.defaultEdgeProp(),this.setSize(e.pageSizeName,e.width,e.height)},e.prototype.seaColor=function(){return this._tripData.seaColor},e.prototype.setSeaColor=function(e){this._tripData.seaColor=e},e.prototype.landColor=function(){return this._tripData.landColor},e.prototype.setLandColor=function(e){this._tripData.landColor=e},e.prototype.borderColor=function(){return this._tripData.borderColor},e.prototype.setBorderColor=function(e){this._tripData.borderColor=e},e.prototype.showRivers=function(){return this._tripData.showRivers},e.prototype.toggleShowRiver=function(){this._tripData.showRivers=!this._tripData.showRivers},e.prototype.language=function(){return this._tripData.language||"en"},e.prototype.setLanguage=function(e){this._tripData.language=e},e.prototype.placeByName=function(e){for(var n=0,t=this._tripData.places;n<t.length;n++){var l=t[n];if(e===l.name)return l}},e.prototype.markFirstLocation=function(){for(var e=0,n=this._tripData.places;e<n.length;e++){var t=n[e];"firstVisited"in t.properties&&delete t.properties.firstVisited}for(var l=0,i=this._tripData.places;l<i.length;l++){var t=i[l];if(!(!t.label||t.properties&&t.properties.skip))return void(t.properties.firstVisited=!0)}},e.prototype.clearUserPlacements=function(){for(var e=0,n=this._tripData.additionalPlaces.concat(this._tripData.places);e<n.length;e++){var t=n[e];t.properties&&(t.properties.userPlacement&&delete t.properties.userPlacement,t.properties.userPlacementPixelOffset&&delete t.properties.userPlacementPixelOffset)}},e.prototype.getMapStyle=function(){return w().preferences.map_style||"streets"},e.prototype.filterAdditionalPlace=function(e){var n=this._tripData.additionalPlaces.filter(e);this._tripData.additionalPlaces.splice.apply(this._tripData.additionalPlaces,[0,this._tripData.additionalPlaces.length].concat(n))},e.prototype.setAdditionalPlace=function(e){var n=this._tripData.additionalPlaces,t=n.find(function(n){return n.name==e.name});t?n[n.indexOf(t)]=e:n.push(e)},e.prototype.renameNodes=function(e,n,t){for(var l=0,i=this._tripData.places;l<i.length;l++){var o=i[l];-1!=o.name.search(e)&&(o.label=o.label.replace(n,t))}},e}(),Xe=this&&this.__awaiter||function(e,n,t,l){return new(t||(t=Promise))(function(i,o){function r(e){try{s(l.next(e))}catch(e){o(e)}}function a(e){try{s(l.throw(e))}catch(e){o(e)}}function s(e){e.done?i(e.value):new t(function(n){n(e.value)}).then(r,a)}s((l=l.apply(e,n||[])).next())})},Ye=this&&this.__generator||function(e,n){function t(e){return function(n){return l([e,n])}}function l(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(r=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(r=r.call(o,t[1])).done)return r;switch(o=0,r&&(t=[0,r.value]),t[0]){case 0:case 1:r=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){s.label=t[1];break}if(6===t[0]&&s.label<r[1]){s.label=r[1],r=t;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(t);break}r[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(e,s)}catch(e){t=[6,e],o=0}finally{i=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var i,o,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};!function(e){e[e.Location=1]="Location",e[e.Node=2]="Node",e[e.NodeStyle=3]="NodeStyle",e[e.Edge=4]="Edge",e[e.PageSize=5]="PageSize",e[e.MapColor=6]="MapColor",e[e.Frame=7]="Frame",e[e.LabelMoved=8]="LabelMoved",e[e.CurveMoved=9]="CurveMoved",e[e.Label=10]="Label",e[e.LabelProperties=11]="LabelProperties",e[e.EdgeProperties=12]="EdgeProperties",e[e.UpdatedLocations=13]="UpdatedLocations"}(Je||(Je={}));var Qe=function(){function e(e){this.http=e;var n=document.querySelectorAll("meta[name^=role]")[0];this.role=n?n.getAttribute("content"):"unknown",this.superadmin="super-admin"==this.role,this._canvasWidth=512,this._canvasHeight=512,this._selectedCountry="",this._loadingMap=!1,this._autoLockMap=!0;w().preferences.page_sizes?this._pageSizes=w().preferences.page_sizes.map(Ge.fromIPageSize):this._pageSizes=[new Ge("Full page",128,190),new Ge("Full page rotated",190,128),new Ge("Square",128,128),new Ge("Landscape",128,95)],this._pageSizeMap={};for(var t=0,l=this._pageSizes;t<l.length;t++){var i=l[t];this._pageSizeMap[i.key()]=i}this._numLocations=0,this._showSpinner=!1,this._seqTrip=new Ke,this._graph=new Ve(void 0,this._seqTrip.defaultEdgeProp()),this._tripLayer&&(this._tripLayer.defaultTextProp=this._seqTrip.defaultTextProp(),this._tripLayer.defaultEdgeProp=this._seqTrip.defaultEdgeProp()),this._visitedPlaceList=this._seqTrip.places(),this._stages=this._seqTrip.stages(),this._interleaved=this.interleavedPlacesAndEvents(),this.setPageSize(this._pageSizes[0].key()),this.language=w().language,this._seqTrip.setLanguage(w().language)}return e.prototype.fetchRawLocations=function(){var e=this;this._numLocations=0;var n,t=w();return n=t.locations?Promise.resolve(t.locations.map(function(e){return Object.assign({},e)})):t.locations_url?new Promise(function(n,l){e.http.get(t.locations_url,{responseType:"json"}).subscribe(function(e){Array.isArray(e)?n(e):l("bad map data")},function(e){l(e)})}):Promise.resolve(void 0),n.then(function(n){return n&&(e._numLocations=n.length),n})},e.prototype.translateLocations=function(e){var n=this;return new Promise(function(t,l){for(var i in e)e[i].translations&&e[i].translations[w().language]?e[i].label=e[i].translations[w().language]:e[i].translations&&e[i].translations.en&&(e[i].label=e[i].translations.en);var o=e.filter(function(e){return e.geoname_id&&!e.translations}).map(function(e){return e.geoname_id});if(0==o.length)return void t(e);var r=w().geoname_service_url+"location?q="+o.join(",")+"&l="+w().language;n.http.get(r,{responseType:"json"}).subscribe(function(n){if(!n||!Array.isArray(n))return void t(e);for(var l={},i=0,o=n;i<o.length;i++){var r=o[i];l[r.id]=r}for(var a=0,s=e;a<s.length;a++){var u=s[a];u.geoname_id&&u.geoname_id in l&&l[u.geoname_id].name&&(u.label=l[u.geoname_id].name)}return t(e)},function(e){l(e)})})},e.prototype.fetchLocations=function(){var e=this;return this.fetchRawLocations().then(function(n){return n?e.translateLocations(n):void 0})},e.prototype.generateFromLocations=function(e){this._seqTrip.reset(),this.updateWithLocations(e,{resetLocation:!0}),this._tripLayer&&(this._tripLayer.defaultTextProp=this._seqTrip.defaultTextProp(),this._tripLayer.defaultEdgeProp=this._seqTrip.defaultEdgeProp()),this.saveMap()},e.prototype.updateWithLocations=function(e,n){return Xe(this,void 0,void 0,function(){var t,l,i,o,r,a,s,u,d,p,c,h,f,g,m,v,r,y=this;return Ye(this,function(b){switch(b.label){case 0:for(n=n||{},t=function(e,n){var t=Utils.latLonToWorld([n,e]);return new Fe(t)},l={},i=0,o=this._seqTrip.places();i<o.length;i++)"dbid"in(r=o[i])&&(l[r.dbid]=r);for(a=[],s=0,u=0,d=e;u<d.length;u++)if(p=d[u],c=t(p.latitude,p.longitude),(h=""+p.id)in l)f=l[h],f.coord=c,f.label&&!n.resetLabels||(f.label=p.label),a.push(f);else{for(g=$e.parse({dbid:h,name:h,label:p.label,coord:c,properties:p.node_prop}),p.following_edge_prop&&(g.followingEdgeProp=p.following_edge_prop),m=0,v=a;m<v.length;m++)if(r=v[m],r.dbid==g.dbid){g.properties=r.properties;break}a.push(g),++s}return this._seqTrip.setPlaces(a),this._seqTrip.markFirstLocation(),n.resetLocation&&this._seqTrip.setLocation(this._seqTrip.makeGraph().location(this._seqTrip.width_mm()/this._seqTrip.height_mm(),1.2)),this._visitedPlaceList=this._seqTrip.places(),this._stages=this._seqTrip.stages(),this._interleaved=this.interleavedPlacesAndEvents(),[4,this.pushSeqTripToCanvas(n.resetLocation)];case 1:return b.sent(),s>0?(this.placeLabels(!0),this._runAfterInit=function(){y.placeLabels(!0)}):this._runAfterInit=function(){y.makeGraph()},[2]}})})},e.prototype.destination=function(e){return this._tripLayer&&e.to in this._tripLayer.graph.nodes?this._tripLayer.graph.nodes[e.to]:this._seqTrip.placeByName(e.to)},e.prototype.origin=function(e){return this._tripLayer&&e.from in this._tripLayer.graph.nodes?this._tripLayer.graph.nodes[e.from]:this._seqTrip.placeByName(e.from)},e.prototype.ngOnInit=function(){var e=this;this.mapview.onMapReady=function(){e.isReady()&&console.log("Map is ready.")},this.loadMap()},e.prototype.pushSeqTripToCanvas=function(e){for(var n=this,t=0,l=["seaColor","borderColor","landColor","showRivers"];t<l.length;t++);var i=new Ge(this._seqTrip.pageSizeName(),this._seqTrip.width_mm(),this._seqTrip.height_mm());return this._pageSizeMap[i.key()]||(this._pageSizeMap[i.key()]=i,this._pageSizes.push(i)),this.setPageSize(i.key(),!1),new Promise(function(e,n){return setTimeout(e,20)}).then(function(){n._renderer&&(n._renderer.setLocation(n._seqTrip.location()),n._graph=n.mapview.setSeqTrip(n._seqTrip)),!0===e?n.reset():n._renderer&&n.makeGraph()})},e.prototype.ngAfterViewInit=function(){},e.prototype.scale=function(){var e=this._seqTrip.location();return Math.log2(1/e.scale)},e.prototype.setScale=function(e){var n=this,t=this._renderer;if(t){var l=t.getLocation();l.scale=1/Math.pow(2,e),t.setLocation(l),this._seqTrip.setLocation(this._renderer.getLocation()),this.modified(Je.Location),this._scaleChangeTimeout&&clearTimeout(this._scaleChangeTimeout),this._scaleChangeTimeout=setTimeout(function(){n.placeLabels(!0)},800)}},e.prototype.prepareCanvas=function(e){var n=this;this._seqTrip&&this.mapview.prepareCanvas({disableMouseWheel:!this.hideUi(),trip:this._seqTrip,graph:this._graph,onLocationChange:function(e){if(!n._loadingMap&&n._seqTrip&&n._tripLayer&&n._editor){var t=e.getLocation(),l=!1;if(n._needLabelPlacement)clearTimeout(n._needLabelPlacement),n._needLabelPlacement=void 0,l=!0;else{l=!n._seqTrip.makeGraph(n._tripLayer).compareNodes(n._tripLayer.graph)}l?n._needLabelPlacement=setTimeout(function(){console.log("Placing labels after motion."),n._seqTrip.setLocation(e.getLocation());var t=n._seqTrip.makeGraph(n._tripLayer);n._graph=t,n._tripLayer.graph=t,n._editor.graph=t,n.placeLabels(!0),n._needLabelPlacement=void 0},500):n._seqTrip.setLocation(t),n.modified(Je.Location)}},alreadyCreated:function(n){e&&e()},created:function(t,l){n._renderer=t,n._tripLayer=l,setTimeout(function(){return Xe(n,void 0,void 0,function(){var n=this;return Ye(this,function(t){switch(t.label){case 0:return this.clearSelection(),this._editor=new Ue(this._renderer,this._graph,l),this._renderer.pinchZoom.touchEventHandlers.push(this._editor),this._editor.onLabelMoved=function(e){n.modified(Je.LabelMoved)},this._editor.onBezierMoved=function(e){n.modified(Je.CurveMoved)},this._editor.onLabelSelect=function(e){n.selectNode(e)},this._editor.onBezierSelect=function(e){e?n.selectEdge(e.edge):n.clearSelection()},[4,this.pushSeqTripToCanvas()];case 1:return t.sent(),this.mapview.resize(),e&&e(),[2]}})})},10)}})},e.prototype.mapIsLocked=function(){return this._renderer&&this._renderer.pinchZoom&&this._renderer.pinchZoom.locked},e.prototype.lockMap=function(e){this._renderer&&this._renderer.pinchZoom&&(this._renderer.pinchZoom.locked=e&&this._autoLockMap)},e.prototype.ngOnDestroy=function(){this._autoRefresh&&clearInterval(this._autoRefresh)},e.prototype.clearSelection=function(){this._selectedCountry=void 0,this._selectedNode=void 0,this._selectedEdge=void 0},e.prototype.clearAndSaveSelection=function(){var e={_selectedCountry:this._selectedCountry,_selectedNode:this._selectedNode,_selectedEdge:this._selectedEdge};return this.clearSelection(),e},e.prototype.restoreSelection=function(e){this._selectedCountry=e._selectedCountry,this._selectedNode=e._selectedNode,this._selectedEdge=e._selectedEdge},e.prototype.selectCountry=function(e){this.clearSelection(),this._selectedCountry=e,this.setCountryColor(e,this.countryColor(e))},e.prototype.setCountryColor=function(e,n){if(e){var t,l="default"==n,i=!1;t?l?(i=!!t.color,delete t.color,0==Object.keys(t).length&&delete this._worldLayer.params.countryStyle[e]):(i=t.color!==n,t.color=n):l||(i=!0,t=this._worldLayer.params.countryStyle[e]={color:n}),i&&this.modified(Je.MapColor)}},e.prototype.countryColor=function(e){return this._worldLayer&&this._worldLayer.params.countryStyle[e]&&this._worldLayer.params.countryStyle[e].color?this._worldLayer.params.countryStyle[e].color:this._seqTrip.landColor()},e.prototype.tunedCountries=function(){return this._worldLayer?Object.keys(this._worldLayer.params.countryStyle):[]},e.prototype.selectNode=function(e){if(this.clearSelection(),e&&(e.properties||(e.properties={}),e.name in this._graph.nodes&&(this._selectedNode=this._graph.nodes[e.name]),e!==this._editor.selectedLabel)){var n=this._editor.onLabelSelect,t=this._editor.onBezierSelect;this._editor.onLabelSelect=function(){},this._editor.onBezierSelect=function(){},e.name in this._editor.graph.nodes?this._editor.selectLabel(e):this._editor.deselectLabel(),this._editor.onLabelSelect=n,this._editor.onBezierSelect=t}},e.prototype.isNodeSelected=function(e){return this._selectedNode&&e&&this._selectedNode.properties===e.properties||this._selectedEdge&&this._selectedEdge.from.match(e.name)},e.prototype.selectEdge=function(e){this.clearSelection(),this._selectedEdge=e},e.prototype.isEdgeSelected=function(e){return this._selectedEdge&&this._selectedEdge.properties===e.properties},e.prototype.nodeNames=function(){return Object.keys(this._graph.nodes)},e.prototype.nodeArray=function(){for(var e=[],n=0,t=Object.keys(this._graph.nodes);n<t.length;n++){var l=t[n];e.push(this._graph.nodes[l])}return e},e.prototype.isSkipped=function(e){return!(!e.properties||void 0===e.properties.skip)&&e.properties.skip},e.prototype.toggleHideEdge=function(e){if(e.properties.hidden){delete e.properties.hidden;for(var n=0,t=this._visitedPlaceList;n<t.length;n++){var l=t[n];l.name!=e.from&&l.name!=e.to||!this.isSkipped(l)||this.toggleSkipNode(l)}}else e.properties.hidden=!0;this.modified(Je.Edge)},e.prototype.toggleSkipNode=function(e){this.isSkipped(e)?delete e.properties.skip:e.properties?e.properties.skip=!0:e.properties={skip:!0},this.modified(Je.Node)},e.prototype.toggleProperty=function(e,n){e.properties[n]=!e.properties[n],this.modified(Je.Node)},e.prototype.setProperty=function(e,n,t,l){void 0!==t?e.properties[n]=t:n in e.properties&&delete e.properties[n],this.modified(Je.NodeStyle)},e.prototype.setNodeLabel=function(e,n){var t=e.label;if(t!==n){this._seqTrip.renameNodes(e.name,t,n),console.log('Renaming: "'+t+'" into "'+n+'"');var l=this._graph;for(var i in l.nodes){var o=l.nodes[i];(o.place===e||o.allPlaces.indexOf(e)>=0)&&(o.label=o.label.replace(t,n))}e.label=n,this.modified(Je.Label)}},e.prototype.removeEdge=function(e){var n=function(n){return n.from!==e.from||n.to!==e.to};this._graph.edges=this._graph.edges.filter(n),this._editor.graph.edges=this._editor.graph.edges.filter(n)},e.prototype.uiSetFrame=function(e,n){this.setFrame(e,n),this.modified(Je.Frame),this.autoPlaceLabels()},e.prototype.setFrame=function(e,n){if(this._renderer){var t=this._canvasWidth,l=this._canvasHeight,i=this._seqTrip.makeGraph().location(t/l,1.2);this._seqTrip.setLocation(i),this._renderer.setLocation(i)}},e.prototype.setMapboxLocation=function(e){this.mapview.setMapboxLocation(e)},e.prototype.getLocation=function(){return this._renderer.getLocation()},e.prototype.autoPlaceLabels=function(){this._seqTrip.clearUserPlacements(),this.placeLabels(!1)},e.prototype.placeLabels=function(e){var n=this;this._tripLayer&&this._renderer&&this._seqTrip&&this.runBlockingTask(function(t){n._tripLayer.placeLabels(n._renderer.canvas.getContext("2d"),e),n.modified(Je.LabelMoved),n.mapview.refresh(),t()})},e.prototype.runBlockingTask=function(e){var n=this;this._showSpinner=!0,setTimeout(function(){try{e(function(){n._showSpinner=!1})}catch(e){n._showSpinner=!1,console.log(e)}},30)},e.prototype.update=function(){this.placeLabels(!0)},e.prototype.resetCurves=function(){this._graph.createDefaultBezier();var e=this._seqTrip.makeGraph(this._tripLayer);this._graph=e,this._tripLayer.graph=e,this._editor.graph=e,this._tripLayer.placeLabels(this._renderer.canvas.getContext("2d"),!0),this.mapview.refresh(),this.modified(Je.CurveMoved)},e.prototype.makeGraph=function(){this._graph=this._seqTrip.makeGraph(this._tripLayer),this._tripLayer?this._tripLayer.graph=this._graph:console.log("Warning: makeGraph called before this._tripLayer is ready."),this._editor&&(this._editor.graph=this._graph)},e.prototype.recreate=function(){this._visitedPlaceList.length&&(this.makeGraph(),this._seqTrip.markFirstLocation(),this.placeLabels(!0))},e.prototype.reset=function(){this._visitedPlaceList.length&&(this.makeGraph(),this.setFrame(),this.placeLabels(!1))},e.prototype.uiSetPageSize=function(e,n){this.setPageSize(e,n),this.modified(Je.PageSize)},e.prototype.setPageSize=function(e,n){var t=this,l=this._pageSizeMap[e];if(l){this._pageSizeName=e;var i=l.widthPt(),o=l.heightPt();this._canvasWidth=1.1*i,this._canvasHeight=1.1*o,this._seqTrip.setSize(l.name,l.width_mm,l.height_mm),!1!==n&&(this.setFrame(this._canvasWidth,this._canvasHeight),setTimeout(function(){t.placeLabels(!0)},20))}this.mapview&&setTimeout(function(){t.mapview.resize()},0)},e.prototype.setLayerColors=function(){this.mapview.setLayerColors(this._seqTrip)},e.prototype.setSeaColor=function(e){e!=this._seqTrip.seaColor()&&(this._seqTrip.setSeaColor(e),this.setLayerColors(),this.modified(Je.MapColor))},e.prototype.setBorderColor=function(e){e!=this._seqTrip.borderColor()&&(this._seqTrip.setBorderColor(e),this.setLayerColors(),this.modified(Je.MapColor))},e.prototype.setLandColor=function(e){e!=this._seqTrip.landColor()&&(this._seqTrip.setLandColor(e),this.setLayerColors(),this.modified(Je.MapColor))},e.prototype.toggleShowRiver=function(){this._seqTrip.toggleShowRiver(),this._worldLayer.params.showRivers=this._seqTrip.showRivers(),this.modified(Je.MapColor)},e.prototype.fetchMap=function(){var e=this,n=w();return n.map_settings?Promise.resolve(n.map_settings):new Promise(function(t,l){e.http.get(n.map_settings_url,{responseType:"json"}).subscribe(function(e){t(e)},function(e){l(e)})})},e.prototype.loadMap=function(){var e=this;this._loadingMap=!0,this.fetchMap().then(function(n){try{return e._seqTrip.load(n),e._seqTrip.setLanguage(w().language),e._saved=!0,e._visitedPlaceList=e._seqTrip.places(),e._stages=e._seqTrip.stages(),e._interleaved=e.interleavedPlacesAndEvents(),e.fetchLocations().then(function(n){n&&e.updateWithLocations(n)}).catch(function(n){e.handleError(n)})}catch(n){return e.fetchLocationsAndGenerateMap()}}).then(function(){return e.pushSeqTripToCanvas(!1)}).then(function(){e.prepareCanvas(function(){e._runAfterInit&&e._runAfterInit(),e._loadingMap=!1})}).catch(function(n){e.pushSeqTripToCanvas(!1),e.prepareCanvas(function(){e._loadingMap=!1}),e.handleError(n)})},e.prototype.isReady=function(){return!this._loadingMap&&this.mapview.isReady()},e.prototype.fetchLocationsAndGenerateMap=function(){var e=this;return this.fetchLocations().then(function(n){n.length>0&&e.generateFromLocations(n)})},e.prototype.saveMap=function(){var e=this,n=this.clearAndSaveSelection();if(this._editor&&this._editor.deselectLabel(),this._graph)for(var t=0,l=this._graph.edges;t<l.length;t++){var i=l[t];i.propagateToOriginal()}var o=w().map_settings_url;o?$.ajax({type:"PUT",url:o,dataType:"text",contentType:"application/json",data:JSON.stringify({_method:"PUT",map_data:JSON.stringify(this._seqTrip.save())}),success:function(){e._saved=!0,e._errorMessage=void 0},error:function(n,t,l){e.handleError("Error: Can't save map. Please check your internet connection.")}}):this._saved=!0,this.restoreSelection(n)},e.prototype.handleError=function(e){var n;n="object"==typeof e?""+("message"in e?e.message:e):"string"==typeof e?e:"Undefined error",console.log(e),this._infoMessage=void 0,this._errorMessage=n},e.prototype.nodePropertiesChanged=function(){this.modified(Je.LabelProperties),this.modified(Je.NodeStyle)},e.prototype.edgePropertiesChanged=function(e){this.modified(Je.EdgeProperties)},e.prototype.modified=function(e){var n=this;if(!this._loadingMap){switch(this._saved=!1,e==Je.Location?this.mapview.updateCanvas():this.mapview.refresh(),e){case Je.UpdatedLocations:case Je.LabelMoved:case Je.CurveMoved:case Je.Location:break;case Je.NodeStyle:case Je.LabelProperties:case Je.EdgeProperties:case Je.MapColor:this._seqTrip.markFirstLocation(),this.mapview.refresh();break;case Je.Label:this.placeLabels(!0);break;case Je.Node:case Je.Edge:case Je.Frame:this.recreate();break;case Je.PageSize:}this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(function(){n._loadingMap||n.saveMap()},500)}},e.prototype.attribution=function(){return this.mapview?this.mapview.attribution().join("|"):""},e.prototype.interleavedPlacesAndEvents=function(){for(var e=[],n=(this._seqTrip.stagesAsDict(),{}),t=this._visitedPlaceList,l=t.length-1,i=0;i<t.length;++i){var o=t[i],r=void 0;i<l&&(r=t[i+1].dbid,o.dbid===r)||function(t){t.dbid in n?e.push({node:n[t.dbid]}):(n[t.dbid]=t,e.push({node:t}))}(o)}return e},e.prototype.edgeFrom=function(e){return this._seqTrip.edgeFrom(e.name)},e.prototype.download=function(e,n){var t=this,l=function(e){return Math.round(Math.pow(36,e+1)-Math.random()*Math.pow(36,e)).toString(36).slice(1)}(16),i=w().map_print_service_url+"mapgen/"+l,o=i+"/"+e;n&&(o+="?"+Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&"));var r=Object.assign({},w());r.map_settings=this._seqTrip.save(),r.map_settings_url&&delete r.map_settings_url,r.locations_url&&delete r.locations_url,r.hide_ui=!0,this.http.post(i,JSON.stringify({global_map_params:r}),{headers:new Ne.g({"content-type":"application/json"})}).subscribe(function(e){window.open(o)},function(e){console.log(e),t.handleError(e.message)})},e.prototype.resetNodeToDefault=function(e){for(var n=0,t=Object.keys(e.properties);n<t.length;n++){var l=t[n];"firstVisited"!=l&&delete e.properties[l]}this.modified(Je.Node)},e.prototype.resetLabels=function(){var e=this;this.fetchLocations().then(function(n){e.updateWithLocations(n,{resetLabels:!0}),e.modified(Je.Label)})},e.prototype.doSomething=function(e){!this._loadingMap&&this._numLocations>0&&!this._saved&&(e.returnValue="Your data will be lost!")},e.prototype.hideUi=function(){return w().hide_ui||!1},e.prototype.allowDrop=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},e.prototype.drag=function(e){e.preventDefault()},e.prototype.readKmlFile=function(e){for(var n=new DOMParser,t=n.parseFromString(e,"text/xml"),l=t.getElementsByTagName("Placemark"),i=0;i<l.length;++i){var o=l[i],r=o.getElementsByTagName("name")[0].textContent,a=o.getElementsByTagName("coordinates")[0].textContent.split(",").map(parseFloat),s=parseInt(r);isNaN(s)&&(s=i+1),this._seqTrip.setAdditionalPlace($e.parse({coord:new Fe(Utils.latLonToWorld(a)),name:"kml-"+s,label:""+s,properties:{point:!1,blackdot:!0,numberedName:r.replace(/^[0-9]*\. */,"")}}))}},e.prototype.readJsonFile=function(e){try{for(var n=JSON.parse(e),t=0,l=n;t<l.length;t++){var i=l[t];if("Feature"==i.type&&"Point"==i.geometry.type&&i.properties){var o=i.properties.index;this._seqTrip.setAdditionalPlace($e.parse({coord:new Fe(Utils.latLonToWorld(i.geometry.coordinates)),name:"kml-"+o,label:""+o,properties:{point:!1,blackdot:!0,numberedName:i.properties.name,articleId:i.properties.articleID}}))}}}catch(e){console.log(e)}},e.prototype.drop=function(e){var n=this;e.stopPropagation(),e.preventDefault(),this._kmlReader||(this._kmlReader=new FileReader,this._kmlReader.onload=function(e){n._seqTrip.filterAdditionalPlace(function(e){return!e.name.match(/^kml-/)});var t=n._kmlReader.result;"["==t[0]?n.readJsonFile(t):n.readKmlFile(t),n.makeGraph(),n.placeLabels(!1),n.modified(Je.Label)}),e.dataTransfer&&e.dataTransfer.files.length>0&&this._kmlReader.readAsText(e.dataTransfer.files[0])},e.prototype.hasMark=function(e){return!!e.properties&&(e.properties.markStyle?"first"==e.properties.markStyle:!!e.properties.firstVisited)},e.ctorParameters=function(){return[{type:Ne.c}]},e}(),en="e7trAnc5053j8mX60MlQ",nn=(mapboxgl.AttributionControl,mapboxgl.Map),tn=mapboxgl.ScaleControl,ln=function(){function e(){this.waitingList=[]}return e.prototype.pixelRatio=function(){return window.devicePixelRatio||1},e.prototype.createMap=function(e){var n=this;if(!this._map){var t={container:this.mapDiv.nativeElement,style:L(e.getMapStyle()),center:C(e.location()),zoom:this.getZoomFromLocation(e.location()),attributionControl:!1,minZoom:0,renderWorldCopies:!0};this._map=new nn(t),this._map.on("error",function(e){console.log("Map error:",e)}),this._map.on("load",function(){var e=Object.keys(n._map.getStyle().sources);n.lang&&n._map.setLanguage(n.lang);for(var t=0,l=e;t<l.length;t++){var i=l[t],o=n._map.getSource(i);o&&(o.tileSize=400,o.roundZoom=!0)}});var l=new tn;return this._map.addControl(l),this._map}},e.prototype.addTripLayers=function(e,n,t,l,i){var o=this._map;this._graph=n;var r=this.buildPathGeoJson(e,n),a=o.getSource("dayEdges"),s=this.firstLayerOfType("symbol").id;if(t)this.updateCanvasLayer(t,l,i);else if(a?a.setData(r):o.addSource("dayEdges",{type:"geojson",data:r}),void 0==o.getLayer("dayEdgesLayer")){o.addLayer({id:"dayEdgesLayer",type:"line",source:"dayEdges",minZoom:0,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["get","width"]}},s)}var u=this.buildPlacesGeoJson(e,n),d=o.getSource("dayPlaces");if(d)d.setData(u),o.setLayoutProperty("dayLabels","icon-size",this._iconFactor);else{o.addSource("dayPlaces",{type:"geojson",data:u}),this.genBlackDot(),o.addLayer({id:"dayLabels",type:"symbol",source:"dayPlaces",minZoom:0,layout:{"text-field":"{label}","text-font":["match",["get","fontName"],"noto",["literal",["Noto Sans Bold"]],["literal",["Open Sans Semibold"]]],"text-anchor":"center","text-offset":{type:"identity",property:"labelOffset"},"text-size":{property:"fontSize",type:"identity"},"text-allow-overlap":!0,"text-max-width":100,visibility:this._disabledLayers?"none":"visible","icon-image":["get","icon"],"icon-anchor":"center","icon-allow-overlap":!0,"icon-size":this._iconFactor,"icon-offset":{type:"identity",property:"iconOffset"}},paint:{"text-color":{property:"fill",type:"identity"},"text-halo-color":{property:"stroke",type:"identity"},"text-halo-width":1.2}});var p=e.places().filter(function(e){return!e.properties.skip}).map(function(e){return e.label+""});this.hidePlaces(p)}},e.prototype.updateCanvasLayer=function(e,n,t){var l=this;if(e&&n){var i=this._map,o=i.getSource("canvasSource");if(o){var r=o.coordinates,a=n.map(C);JSON.stringify(r)!=JSON.stringify(a)&&o.setCoordinates(a),o.play()}else{var s=this.firstLayerOfType("symbol").id;i.addSource("canvasSource",{type:"canvas",canvas:e,animate:!0,coordinates:n.map(C)}),i.addLayer({id:"canvasLayer",type:"raster",source:"canvasSource",paint:{"raster-fade-duration":0},layout:{visibility:this._disabledLayers?"none":"visible"},minZoom:0},s)}this.pauseCanvasSourceTimeout&&clearTimeout(this.pauseCanvasSourceTimeout),this.pauseCanvasSourceTimeout=setTimeout(function(){l.pauseCanvasSourceTimeout=void 0,i.getSource("canvasSource").pause()},200),this.killMapLabels(t)}},e.prototype.firstLayerOfType=function(e){for(var n=this._map.getStyle().layers,t=0;t<n.length;t++)if(n[t].type===e&&"contour_label"!=n[t].id&&!n[t].id.match(/^(water_name)|(highway)/))return n[t]},e.prototype.resize=function(){this._map&&(this._map.resize(),this._trip&&this.setMapboxLocation(this._trip.location()))},e.prototype.setMapboxLocation=function(e){if(!isFinite(e.x)||!isFinite(e.y))throw new Error("Invalid coordinates: "+e.x+", "+e.y);this._map&&(this._map.setCenter(C(e)),isFinite(e.scale)&&this._map.setZoom(this.getZoomFromLocation(e)))},e.prototype.getZoomFromLocation=function(e){if(e){var n=this.canvasWidth;return Math.log2(1/(e.scale*(512/n)))}return 8},e.prototype.buildPathGeoJson=function(e,n){return{type:"FeatureCollection",features:n.edges.map(function(t){return{type:"Feature",geometry:{type:"LineString",coordinates:k(t,e,n)},properties:{mean:t.properties.travelMean,color:e.edgeProperty(t,"lineColor"),width:parseFloat(e.edgeProperty(t,"lineWidth")),dashed:(e.edgeProperty(t,"dashed")||[]).concat([1])[0]}}})}},e.prototype.buildPlacesGeoJson=function(e,n){var t=[];this._iconFactor=(e.defaultTextProp().fontSize/12*16+4)/64;for(var l in n.nodes){var i=n.nodes[l];if(!i.properties.skip){var o=e.nodeProperty(i,"fontSize")||12,r=[0,0],a=[0,0];if(i.properties.labelPixelOffset){var s=1/o;r=[i.properties.labelPixelOffset.x*s,i.properties.labelPixelOffset.y*s],a=[i.properties.labelPixelOffset.x/this._iconFactor,i.properties.labelPixelOffset.y/this._iconFactor]}t.push({type:"Feature",geometry:{type:"Point",coordinates:C(i.coord)},properties:{label:i.label,labelOffset:r,iconOffset:a,fontSize:o,fontName:e.nodeProperty(i,"blackdot")?"noto":"default",icon:e.nodeProperty(i,"blackdot")?"blackdot":"",fill:e.nodeProperty(i,"fill"),stroke:e.nodeProperty(i,"stroke")}})}}return{type:"FeatureCollection",features:t}},e.prototype.hidePlaces=function(e){var n=[["!in","name:"+this.lang].concat(e),["!in","name"].concat(e)],t=["","-"+this.lang],l=this._map;["place_city_capital","place_city","place_town","place_village","place_other"].forEach(function(e){t.forEach(function(t){var i=e+t;if(l.getLayer(i)){var o=l.getFilter(i);o=o.concat(n),l.setFilter(i,o)}})})},e.prototype.killMapLabels=function(e){var n=this,t=this._map;if(!t.hasImage("blank4")){for(var l=new Uint8Array(64),i=0;i<4;i++)for(var o=0;o<4;o++){var r=4*(4*o+i);l[r+0]=255,l[r+1]=0,l[r+2]=0,l[r+3]=0}t.addImage("blank4",{width:4,height:4,data:l})}e||console.log("No marked places!");var a=e.map(C);this._graph&&(a=a.concat(Object.keys(this._graph.nodes).map(function(e){return C(n._graph.nodes[e].coord)})));for(var s=t.getCanvas(),u=s.clientWidth,d=s.clientHeight,p=[],c=18;c<u;c+=18)p.push(t.unproject([c,0])),p.push(t.unproject([c,d]));for(var h=18;h<d;h+=18)p.push(t.unproject([0,h])),p.push(t.unproject([u,h]));a=a.concat(p.map(function(e){return[e.lng,e.lat]}));var f={type:"FeatureCollection",features:a.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e}}})},g=t.getSource("blankSource");g?g.setData(f):(t.addSource("blankSource",{type:"geojson",data:f}),t.addLayer({id:"blank",type:"symbol",source:"blankSource",minZoom:0,layout:{"icon-image":"blank4","icon-anchor":"center","icon-size":4,"icon-allow-overlap":!0,visibility:this._disabledLayers?"none":"visible"}}))},e.prototype.switchCustomLayers=function(e){if(this._map){var n=this._map;if(!e||this._disabledLayers){if(!e){if(this._disabledLayers)return;this._disabledLayers=["blank","dayLabels","canvasLayer"];for(var t=this._map.getStyle().layers,l=0;l<t.length;l++){var i=t[l];"symbol"==i.type&&"visible"==n.getLayoutProperty(i.id,"visibility")&&this._disabledLayers.push(i.id)}}var o=e?"visible":"none";this._disabledLayers.forEach(function(e){n.setLayoutProperty(e,"visibility",o)}),e&&(this._disabledLayers=void 0)}}},e.prototype.genBlackDot=function(){var e=this._map;if(!e.hasImage("blackdot")){for(var n=new Uint8Array(16384),t=new Fe(31.5,31.5),l=0;l<64;l++)for(var i=0;i<64;i++){var o=new Fe(l,i),r=Fe.dist(o,t),a=Math.min(1,Math.max(0,31.5-r)),s=4*(64*i+l);n[s+0]=0,n[s+1]=0,n[s+2]=0,n[s+3]=255*a}e.addImage("blackdot",{width:64,height:64,data:n})}},e}(),on=[],rn=ie["\u0275crt"]({encapsulation:2,styles:on,data:{}}),an=(ie["\u0275ccf"]("mapview2",ln,T,{canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",compactAttribution:"compactAttribution",lang:"lang"},{},[]),{CanvasTilesRenderer:CanvasTilesRenderer,PinchZoom:PinchZoom,Utils:Utils}),sn=mapboxgl.AttributionControl,un=(mapboxgl.Map,function(){function e(e){this.el=e,this.waitingList=[],this._showOld=!0,this._removeMapLabels=!1}return e.prototype.pixelRatio=function(){return this._renderer&&this._renderer.pixelRatio?this._renderer.pixelRatio:1},e.prototype.getCanvasWidth=function(){return this.canvasWidth?this.canvasWidth:this.el&&this.el.nativeElement?this.el.nativeElement.offsetWidth:0},e.prototype.getCanvasHeight=function(){return this.canvasHeight?this.canvasHeight:this.el&&this.el.nativeElement?this.el.nativeElement.offsetHeight:0},e.prototype.isReady=function(){var e=this._map;return e&&this._renderer&&this._tripLayer&&this._tripLayer.isReady()&&e.loaded()&&!(e._sourcesDirty||e._repaint||e._styleDirty||e._placementDirty)},e.prototype.prepareCanvas=function(e){var n=this;if(this._options=e,!this.canvas||!this.canvas.nativeElement||this._renderer||this._map)return void(e.alreadyCreated&&(this._map.loaded()?e.alreadyCreated(this._renderer,this._tripLayer):this.waitingList.push(e)));this._map=this.mapview.createMap(e.trip),this._map.on("load",function(){var t=n.canvas.nativeElement,l=e.trip.location();n._renderer=new an.CanvasTilesRenderer({canvas:t,width:1,clearBorder:!1,downsampleDuringMotion:!1,fillScreen:!1,downgradeIfSlowerFPS:1e-8,url:"https://tiles.wmflabs.org/bw-mapnik/$scale/$x/$y.png",initialLocation:l,onLocationChange:function(t){var l=t.getLocation();n.setMapboxLocation(l),e.onLocationChange&&e.onLocationChange(t)}}),n._renderer.pinchZoom.maxScale=n.getScaleFromZoom(0),e.disableMouseWheel&&(n._renderer.pinchZoom.handleMouseWheel=function(e){}),n._renderer.layers=[{draw:function(){var e=n.renderCanvas.nativeElement,t=n.canvas.nativeElement;e.width=t.width,e.height=t.height,e.getContext("2d").clearRect(0,0,e.width,e.height)}}],n._tripLayer=new Ze({renderer:n._renderer,graph:e.graph}),n._renderer.addLayer(n._tripLayer);var i=n._tripLayer.draw,o=n;n._tripLayer.draw=function(){if(this.hideLabels=!o._removeMapLabels,this.forceLeaderLines=!0,o._showOld){var e=o.renderCanvas.nativeElement;arguments[0]=e,i.apply(this,arguments);var n=e.width,t=e.height;o._canvasWorldCoord=[[0,0],[n,0],[n,t],[0,t]].map(function(e){return o._renderer.pinchZoom.worldPosFromViewerPos({x:e[0],y:e[1]})}),o.updateCanvas()}},e.created&&e.created(n._renderer,n._tripLayer);for(var r=0,a=n.waitingList;r<a.length;r++){var s=a[r];s.alreadyCreated&&s.alreadyCreated(n._renderer,n._tripLayer)}setTimeout(function(){n.setSeqTrip(e.trip),l&&(n._removeMapLabels=l.scale>1,n.switchCanvasVisibility(n._removeMapLabels),n.mapview.switchCustomLayers(!n._removeMapLabels))},10),n.resize()}),this._map.on("idle",function(){n._map;n.isReady()?n.onMapReady&&n.onMapReady():console.log("mapbox map is ready, but not mapview!!")})},e.prototype.getLayer=function(e){},e.prototype.setLayerColors=function(e){},e.prototype.resize=function(){this.mapview.resize(),this._renderer&&(this._renderer.pinchZoom.maxScale=this.getScaleFromZoom(0),this.setMapboxLocation(this._renderer.getLocation()))},e.prototype.setMapboxLocation=function(e){this.mapview.setMapboxLocation(e),this._removeMapLabels=e.scale>1,this.switchCanvasVisibility(this._removeMapLabels),this.mapview.switchCustomLayers(!this._removeMapLabels)},e.prototype.getZoomFromLocation=function(e){if(e){var n=this.getCanvasWidth();return Math.log2(1/(e.scale*(512/n)))}return 8},e.prototype.getScaleFromZoom=function(e){return this.getCanvasWidth()/512*1/Math.pow(2,e)},e.prototype.setSeqTrip=function(e){var n=this;this._seqTrip=e;var t;this._tripLayer.graph&&Object.keys(this._tripLayer.graph.nodes).length>0?t=this._tripLayer.graph:(t=e.makeGraph(this._tripLayer),this._tripLayer.graph=t),this._tripLayer.defaultRadius=e.defaultRadius(),this._tripLayer.defaultTextProp=e.defaultTextProp(),this._tripLayer.defaultEdgeProp=e.defaultEdgeProp();var l=e.location();S(l,this._renderer.location)||this._renderer.setLocation(l),this.setMapboxLocation(l),this.setLayerColors(e),this._renderer.refresh(),this.resize(),this._tripLayer.loadIcons(function(e){e&&console.log(e),n._renderer.refresh()});var i=this.renderCanvas.nativeElement,o=i.width,r=i.height;return this.mapview.addTripLayers(e,t,i,[[0,0],[o,0],[o,r],[0,r]].map(function(e){return n._renderer.pinchZoom.worldPosFromViewerPos({x:e[0],y:e[1]})}),this._tripLayer.markedPlaces),t},e.prototype.updateCanvas=function(){if(this._canvasWorldCoord){var e=this.renderCanvas.nativeElement;e.width,e.height;this.mapview.updateCanvasLayer(e,this._canvasWorldCoord,this._tripLayer.markedPlaces)}},e.prototype.refresh=function(){this._renderer&&this._renderer.refresh(),this._seqTrip&&this.setSeqTrip(this._seqTrip)},e.prototype.attribution=function(){var e=this._map;if(!e||!e.style)return[];var n=[],t=e.style.sourceCaches;for(var l in t){var i=t[l];if(i.used){var o=i.getSource();o.attribution&&n.indexOf(o.attribution)<0&&n.push(o.attribution)}}return n.sort(function(e,n){return e.length-n.length}),n=n.filter(function(e,t){for(var l=t+1;l<n.length;l++)if(n[l].indexOf(e)>=0)return!1;return!0})},e.prototype.switchCanvasVisibility=function(e){var n=this.renderCanvas.nativeElement,t=n.parentElement;e?t.insertBefore(n,this.canvas.nativeElement):t.insertBefore(n,t.firstChild)},e.prototype.addMarker=function(e,n){if(this._map){return new mapboxgl.Marker(n).setLngLat([e.longitude,e.latitude]).addTo(this._map)}},e.prototype.addAttributionControl=function(e){this._map&&this._map.addControl(new sn({compact:e}))},e.ctorParameters=function(){return[{type:ie.ElementRef}]},e}()),dn=[],pn=ie["\u0275crt"]({encapsulation:2,styles:dn,data:{}}),cn=(ie["\u0275ccf"]("mapview",un,O,{canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",compactAttribution:"compactAttribution",lang:"lang"},{},[]),t("4zAq")),hn=t("rxZd"),fn=t("poDJ"),gn=t("pBJ6"),mn=t("2VFp"),vn=t("iDwB"),yn=[de],bn=ie["\u0275crt"]({encapsulation:0,styles:yn,data:{}}),_n=(ie["\u0275ccf"]("trip-map",Qe,ne,{},{},[]),[ue]),Pn=ie["\u0275crt"]({encapsulation:0,styles:_n,data:{}}),xn=ie["\u0275ccf"]("app-root",re,le,{},{},[]),wn=t("fc+i"),Cn=t("BhHz"),kn=t("4Vp2"),Ln=t("x/Up"),Mn=t("G8gw"),Tn=t("xHno"),Sn=t("yroR"),Rn=t("bIam"),On=ie["\u0275cmf"](oe,[re],function(e){return ie["\u0275mod"]([ie["\u0275mpd"](512,ie.ComponentFactoryResolver,ie["\u0275CodegenComponentFactoryResolver"],[[8,[ae.a,se.a,xn]],[3,ie.ComponentFactoryResolver],ie.NgModuleRef]),ie["\u0275mpd"](5120,ie.LOCALE_ID,ie["\u0275m"],[[3,ie.LOCALE_ID]]),ie["\u0275mpd"](4608,he.NgLocalization,he.NgLocaleLocalization,[ie.LOCALE_ID]),ie["\u0275mpd"](4608,ie.Compiler,ie.Compiler,[]),ie["\u0275mpd"](5120,ie.APP_ID,ie["\u0275f"],[]),ie["\u0275mpd"](5120,ie.IterableDiffers,ie["\u0275k"],[]),ie["\u0275mpd"](5120,ie.KeyValueDiffers,ie["\u0275l"],[]),ie["\u0275mpd"](4608,wn.b,wn.s,[he.DOCUMENT]),ie["\u0275mpd"](6144,ie.Sanitizer,null,[wn.b]),ie["\u0275mpd"](4608,wn.e,wn.f,[]),ie["\u0275mpd"](5120,wn.c,function(e,n,t,l){return[new wn.k(e),new wn.o(n),new wn.n(t,l)]},[he.DOCUMENT,he.DOCUMENT,he.DOCUMENT,wn.e]),ie["\u0275mpd"](4608,wn.d,wn.d,[wn.c,ie.NgZone]),ie["\u0275mpd"](135680,wn.m,wn.m,[he.DOCUMENT]),ie["\u0275mpd"](4608,wn.l,wn.l,[wn.d,wn.m]),ie["\u0275mpd"](6144,ie.RendererFactory2,null,[wn.l]),ie["\u0275mpd"](6144,wn.p,null,[wn.m]),ie["\u0275mpd"](4608,ie.Testability,ie.Testability,[ie.NgZone]),ie["\u0275mpd"](4608,wn.g,wn.g,[he.DOCUMENT]),ie["\u0275mpd"](4608,wn.i,wn.i,[he.DOCUMENT]),ie["\u0275mpd"](4608,pe.n,pe.n,[]),ie["\u0275mpd"](4608,Ne.i,Ne.n,[he.DOCUMENT,ie.PLATFORM_ID,Ne.l]),ie["\u0275mpd"](4608,Ne.o,Ne.o,[Ne.i,Ne.m]),ie["\u0275mpd"](5120,Ne.a,function(e){return[e]},[Ne.o]),ie["\u0275mpd"](4608,Ne.k,Ne.k,[]),ie["\u0275mpd"](6144,Ne.j,null,[Ne.k]),ie["\u0275mpd"](4608,Ne.h,Ne.h,[Ne.j]),ie["\u0275mpd"](6144,Ne.b,null,[Ne.h]),ie["\u0275mpd"](5120,Ne.f,Ne.p,[Ne.b,[2,Ne.a]]),ie["\u0275mpd"](4608,Ne.c,Ne.c,[Ne.f]),ie["\u0275mpd"](4608,ge.ColorPickerService,ge.ColorPickerService,[]),ie["\u0275mpd"](4608,ze.a,ze.a,[]),ie["\u0275mpd"](4608,Oe.a,Oe.a,[]),ie["\u0275mpd"](4608,Cn.a,Cn.a,[]),ie["\u0275mpd"](4608,fn.a,fn.a,[ie.ComponentFactoryResolver,ie.NgZone,ie.Injector,Cn.a,ie.ApplicationRef]),ie["\u0275mpd"](4608,cn.a,cn.a,[]),ie["\u0275mpd"](512,he.CommonModule,he.CommonModule,[]),ie["\u0275mpd"](1024,ie.ErrorHandler,wn.q,[]),ie["\u0275mpd"](1024,ie.APP_INITIALIZER,function(e,n){return[wn.r(e,n)]},[[2,wn.h],[2,ie.NgProbeToken]]),ie["\u0275mpd"](512,ie.ApplicationInitStatus,ie.ApplicationInitStatus,[[2,ie.APP_INITIALIZER]]),ie["\u0275mpd"](131584,ie["\u0275e"],ie["\u0275e"],[ie.NgZone,ie["\u0275Console"],ie.Injector,ie.ErrorHandler,ie.ComponentFactoryResolver,ie.ApplicationInitStatus]),ie["\u0275mpd"](2048,ie.ApplicationRef,null,[ie["\u0275e"]]),ie["\u0275mpd"](512,ie.ApplicationModule,ie.ApplicationModule,[ie.ApplicationRef]),ie["\u0275mpd"](512,wn.a,wn.a,[[3,wn.a]]),ie["\u0275mpd"](512,pe.k,pe.k,[]),ie["\u0275mpd"](512,pe.d,pe.d,[]),ie["\u0275mpd"](512,Ne.e,Ne.e,[]),ie["\u0275mpd"](512,Ne.d,Ne.d,[]),ie["\u0275mpd"](512,kn.ColorPickerModule,kn.ColorPickerModule,[]),ie["\u0275mpd"](512,Ln.a,Ln.a,[]),ie["\u0275mpd"](512,Mn.a,Mn.a,[]),ie["\u0275mpd"](512,Tn.a,Tn.a,[]),ie["\u0275mpd"](512,Sn.a,Sn.a,[]),ie["\u0275mpd"](512,Rn.a,Rn.a,[]),ie["\u0275mpd"](512,oe,oe,[]),ie["\u0275mpd"](256,Ne.l,"XSRF-TOKEN",[]),ie["\u0275mpd"](256,Ne.m,"X-XSRF-TOKEN",[]),ie["\u0275mpd"](256,gn.a,{autoClose:!0},[])])});Object(ie.enableProdMode)(),Object(wn.j)().bootstrapModuleFactory(On)},z1vh:function(e,n){function t(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id="z1vh"}},[0]);