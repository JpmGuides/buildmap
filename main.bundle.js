webpackJsonp([1],{0:function(e,n,l){e.exports=l("rl7j")},rl7j:function(e,n,l){"use strict";function t(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,0,"i",[["class","fa fa-recycle"],["style","font-size: 14pt"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.resetToDefault()&&t}return t},null,null))],null,null)}function i(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,36,"div",[["class","root"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275eld"](0,null,null,15,"div",[["class","font-size-margin"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"span",[["for","fontSize"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Font size:"])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,6,"input",[["class","form-control"],["id","fontSize"],["max","64"],["min","5"],["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,l){var t=!0,i=e.component;if("input"===n){t=!1!==B["\u0275nov"](e,8)._handleInput(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,8).onTouched()&&t}if("compositionstart"===n){t=!1!==B["\u0275nov"](e,8)._compositionStart()&&t}if("compositionend"===n){t=!1!==B["\u0275nov"](e,8)._compositionEnd(l.target.value)&&t}if("change"===n){t=!1!==B["\u0275nov"](e,9).onChange(l.target.value)&&t}if("input"===n){t=!1!==B["\u0275nov"](e,9).onChange(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,9).onTouched()&&t}if("change"===n){t=!1!==i.setProperty("fontSize")&&t}if("ngModelChange"===n){t=!1!==(i.fontSize=l)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.c,[B.Renderer2,B.ElementRef,[2,X.a]],null,null),B["\u0275did"](16384,null,0,X.l,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e,n){return[e,n]},[X.c,X.l]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},{update:"ngModelChange"}),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n\n    "])),(e()(),B["\u0275and"](16777216,null,null,1,null,t)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n  "])),(e()(),B["\u0275eld"](0,null,null,7,"div",[["class","text-prop-colors"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control"]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"input"],[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("input"===n){t=!1!==B["\u0275nov"](e,22).inputChange(l.target.value)&&t}if("click"===n){t=!1!==B["\u0275nov"](e,22).onClick()&&t}if("colorPickerChange"===n){t=!1!==(i.fill=l)&&t}if("colorPickerChange"===n){t=!1!==i.setProperty("fill")&&t}return t},null,null)),B["\u0275did"](606208,null,0,Q.ColorPickerDirective,[B.Injector,B.ComponentFactoryResolver,B.ApplicationRef,B.ViewContainerRef,B.ElementRef,ee.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Text color"])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n  "])),(e()(),B["\u0275eld"](0,null,null,7,"div",[["class","text-prop-colors"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control"]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"input"],[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("input"===n){t=!1!==B["\u0275nov"](e,31).inputChange(l.target.value)&&t}if("click"===n){t=!1!==B["\u0275nov"](e,31).onClick()&&t}if("colorPickerChange"===n){t=!1!==(i.stroke=l)&&t}if("colorPickerChange"===n){t=!1!==i.setProperty("stroke")&&t}return t},null,null)),B["\u0275did"](606208,null,0,Q.ColorPickerDirective,[B.Injector,B.ComponentFactoryResolver,B.ApplicationRef,B.ViewContainerRef,B.ElementRef,ee.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Shadow color"])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n"]))],function(e,n){var l=n.component;e(n,11,0,l.fontSize),e(n,16,0,!l.hasDefault()&&!l.noReset),e(n,22,0,l.fill),e(n,31,0,l.stroke)},function(e,n){var l=n.component;e(n,7,0,B["\u0275nov"](n,13).ngClassUntouched,B["\u0275nov"](n,13).ngClassTouched,B["\u0275nov"](n,13).ngClassPristine,B["\u0275nov"](n,13).ngClassDirty,B["\u0275nov"](n,13).ngClassValid,B["\u0275nov"](n,13).ngClassInvalid,B["\u0275nov"](n,13).ngClassPending),e(n,21,0,l.fill),e(n,30,0,l.stroke)})}function o(e){return B["\u0275vid"](0,[(e()(),B["\u0275and"](16777216,null,null,1,null,i)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"]))],function(e,n){e(n,1,0,n.component.properties)},null)}function r(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"text-prop",[],null,null,null,o,ie)),B["\u0275did"](376832,null,0,le,[ee.ColorPickerService,B.KeyValueDiffers],null,null)],function(e,n){e(n,1,0)},null)}function a(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,0,"i",[["class","fa fa-recycle pull-right"],["style","font-size: 14pt"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.resetToDefault()&&t}return t},null,null))],null,null)}function s(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),B["\u0275did"](147456,null,0,X.i,[B.ElementRef,B.Renderer2,[2,X.j]],{value:[0,"value"]},null),B["\u0275did"](147456,null,0,X.o,[B.ElementRef,B.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),B["\u0275ted"](null,["",""]))],function(e,n){e(n,1,0,n.context.$implicit),e(n,2,0,n.context.$implicit)},function(e,n){e(n,3,0,n.context.$implicit)})}function u(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,3,"option",[["class","form-control"],["required",""]],null,null,null,null,null)),B["\u0275did"](147456,null,0,X.i,[B.ElementRef,B.Renderer2,[2,X.j]],{value:[0,"value"]},null),B["\u0275did"](147456,null,0,X.o,[B.ElementRef,B.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),B["\u0275ted"](null,["",""]))],function(e,n){e(n,1,0,n.context.$implicit.name),e(n,2,0,n.context.$implicit.name)},function(e,n){e(n,3,0,n.context.$implicit.name)})}function d(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),B["\u0275did"](147456,null,0,X.i,[B.ElementRef,B.Renderer2,[2,X.j]],{value:[0,"value"]},null),B["\u0275did"](147456,null,0,X.o,[B.ElementRef,B.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),B["\u0275ted"](null,["Route"]))],function(e,n){e(n,1,0,"route");e(n,2,0,"route")},null)}function p(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,100,"div",[["class","form-horizontal"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275and"](16777216,null,null,1,null,a)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n   "])),(e()(),B["\u0275eld"](0,null,null,18,"div",[["class","form-group"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"div",[["class","col-md-4"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Transport:"])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,12,"div",[["class","col-md-4"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,9,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,l){var t=!0,i=e.component;if("change"===n){t=!1!==B["\u0275nov"](e,13).onChange(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,13).onTouched()&&t}if("change"===n){t=!1!==i.setTravelMean(l.target.value)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.j,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[X.j]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275and"](16777216,null,null,1,null,s)),B["\u0275did"](802816,null,0,Y.NgForOf,[B.ViewContainerRef,B.TemplateRef,B.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n  "])),(e()(),B["\u0275eld"](0,null,null,15,"div",[["class","form-group"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"div",[["class","col-md-4"],["for","lineWidth"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Line width:"])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,9,"div",[["class","col-md-4"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,6,"input",[["class","form-control"],["id","lineWidth"],["max","10"],["min","0"],["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,l){var t=!0,i=e.component;if("input"===n){t=!1!==B["\u0275nov"](e,33)._handleInput(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,33).onTouched()&&t}if("compositionstart"===n){t=!1!==B["\u0275nov"](e,33)._compositionStart()&&t}if("compositionend"===n){t=!1!==B["\u0275nov"](e,33)._compositionEnd(l.target.value)&&t}if("change"===n){t=!1!==B["\u0275nov"](e,34).onChange(l.target.value)&&t}if("input"===n){t=!1!==B["\u0275nov"](e,34).onChange(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,34).onTouched()&&t}if("change"===n){t=!1!==i.changeEvent()&&t}if("ngModelChange"===n){t=!1!==(i.lineWidth=l)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.c,[B.Renderer2,B.ElementRef,[2,X.a]],null,null),B["\u0275did"](16384,null,0,X.l,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e,n){return[e,n]},[X.c,X.l]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},{update:"ngModelChange"}),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n  "])),(e()(),B["\u0275eld"](0,null,null,18,"div",[["class","form-group"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"div",[["class","col-md-4"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Line style:"])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,12,"div",[["class","col-md-4"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,9,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,l){var t=!0,i=e.component;if("change"===n){t=!1!==B["\u0275nov"](e,50).onChange(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,50).onTouched()&&t}if("change"===n){t=!1!==i.setLineStyle(l.target.value)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.j,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[X.j]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275and"](16777216,null,null,1,null,u)),B["\u0275did"](802816,null,0,Y.NgForOf,[B.ViewContainerRef,B.TemplateRef,B.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n  "])),(e()(),B["\u0275eld"](0,null,null,28,"div",[["class","form-group"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"div",[["class","col-md-4"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Line shape:"])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,22,"div",[["class","col-md-4"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,19,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,l){var t=!0,i=e.component;if("change"===n){t=!1!==B["\u0275nov"](e,70).onChange(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,70).onTouched()&&t}if("change"===n){t=!1!==i.setGeom(l.target.value)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.j,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[X.j]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),B["\u0275did"](147456,null,0,X.i,[B.ElementRef,B.Renderer2,[2,X.j]],{value:[0,"value"]},null),B["\u0275did"](147456,null,0,X.o,[B.ElementRef,B.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),B["\u0275ted"](null,["Straight"])),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),B["\u0275did"](147456,null,0,X.i,[B.ElementRef,B.Renderer2,[2,X.j]],{value:[0,"value"]},null),B["\u0275did"](147456,null,0,X.o,[B.ElementRef,B.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),B["\u0275ted"](null,["Curved"])),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275and"](16777216,null,null,1,null,d)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n  "])),(e()(),B["\u0275eld"](0,null,null,7,"div",[["class","edge-prop-colors"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control"]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"input"],[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("input"===n){t=!1!==B["\u0275nov"](e,95).inputChange(l.target.value)&&t}if("click"===n){t=!1!==B["\u0275nov"](e,95).onClick()&&t}if("colorPickerChange"===n){t=!1!==(i.lineColor=l)&&t}if("colorPickerChange"===n){t=!1!==i.colorChanged()&&t}return t},null,null)),B["\u0275did"](606208,null,0,Q.ColorPickerDirective,[B.Injector,B.ComponentFactoryResolver,B.ApplicationRef,B.ViewContainerRef,B.ElementRef,ee.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Line color"])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n"]))],function(e,n){var l=n.component;e(n,3,0,!l.hasDefault()&&!l.noReset),e(n,15,0,l.travelMean),e(n,20,0,l.allTravelMeans),e(n,36,0,l.lineWidth),e(n,52,0,l.lineStyle),e(n,57,0,l.allLineStyles),e(n,72,0,l.geom);e(n,77,0,"straight");e(n,78,0,"straight");e(n,82,0,"spline");e(n,83,0,"spline"),e(n,87,0,l.canDrive()),e(n,95,0,l.lineColor)},function(e,n){var l=n.component;e(n,12,0,B["\u0275nov"](n,17).ngClassUntouched,B["\u0275nov"](n,17).ngClassTouched,B["\u0275nov"](n,17).ngClassPristine,B["\u0275nov"](n,17).ngClassDirty,B["\u0275nov"](n,17).ngClassValid,B["\u0275nov"](n,17).ngClassInvalid,B["\u0275nov"](n,17).ngClassPending),e(n,32,0,B["\u0275nov"](n,38).ngClassUntouched,B["\u0275nov"](n,38).ngClassTouched,B["\u0275nov"](n,38).ngClassPristine,B["\u0275nov"](n,38).ngClassDirty,B["\u0275nov"](n,38).ngClassValid,B["\u0275nov"](n,38).ngClassInvalid,B["\u0275nov"](n,38).ngClassPending),e(n,49,0,B["\u0275nov"](n,54).ngClassUntouched,B["\u0275nov"](n,54).ngClassTouched,B["\u0275nov"](n,54).ngClassPristine,B["\u0275nov"](n,54).ngClassDirty,B["\u0275nov"](n,54).ngClassValid,B["\u0275nov"](n,54).ngClassInvalid,B["\u0275nov"](n,54).ngClassPending),e(n,69,0,B["\u0275nov"](n,74).ngClassUntouched,B["\u0275nov"](n,74).ngClassTouched,B["\u0275nov"](n,74).ngClassPristine,B["\u0275nov"](n,74).ngClassDirty,B["\u0275nov"](n,74).ngClassValid,B["\u0275nov"](n,74).ngClassInvalid,B["\u0275nov"](n,74).ngClassPending),e(n,94,0,l.lineColor)})}function c(e){return B["\u0275vid"](0,[(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,p)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"]))],function(e,n){e(n,2,0,n.component.properties)},null)}function h(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"edge-prop",[],null,null,null,c,he)),B["\u0275did"](376832,null,0,pe,[B.KeyValueDiffers],null,null)],function(e,n){e(n,1,0)},null)}function f(e){switch(e){default:case"Car":return"driving-car";case"Bus":return"driving-hgv";case"Bike":return"cycling-regular";case"Walk":return"foot-walking"}}function g(e,n,l){var t=["https://api.openrouteservice.org/directions?api_key=5b3ce3597851110001cf6248e0fee72951d5494c8b4cf5d8b4ff2b76","coordinates="+e.lon+"%2C"+e.lat+"|"+n.lon+"%2C"+n.lat,"profile="+f(l),"geometry_format=geojson","geometry_simplify=true"].join("&");return t in _e?_e[t]:(_e[t]=new Promise(function(e,n){$.getJSON(t).done(function(l){l&&l.routes&&l.routes[0]&&l.routes[0].geometry&&l.routes[0].geometry.coordinates?e(l.routes[0].geometry.coordinates):n(new Error("Empty or bad data from openrouteservice"))}).fail(function(e){n(e)})}),_e[t])}function m(e){for(var n=0,l=[0],t=1;t<e.length;++t){n+=ye.dist(e[t],e[t-1]),l.push(n)}for(var i=n/2,t=0;t<l.length;++t)if(l[t]>i)return t-1;return 0}function v(e){return B["\u0275vid"](0,[B["\u0275qud"](402653184,1,{canvas:0}),B["\u0275qud"](402653184,2,{mapDiv:0}),(e()(),B["\u0275eld"](0,[[2,0],["mapDiv",1]],null,0,"div",[["style","position: absolute;"]],[[4,"width","px"],[4,"height","px"]],null,null,null,null)),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275eld"](0,[[1,0],["mapCanvas",1]],null,0,"canvas",[["style","position: absolute;"]],[[4,"width","px"],[4,"height","px"],[1,"width",0],[1,"height",0]],null,null,null,null)),(e()(),B["\u0275ted"](null,["\n"]))],null,function(e,n){var l=n.component;e(n,2,0,l.canvasWidth,l.canvasHeight),e(n,4,0,l.canvasWidth,l.canvasHeight,l.canvasWidth*l.pixelRatio(),l.canvasHeight*l.pixelRatio())})}function y(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"mapview",[],null,null,null,v,Ae)),B["\u0275did"](49152,null,0,Fe,[],null,null)],null,null)}function b(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,4,"div",[["class","alert fade in alert-danger"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275eld"](0,null,null,1,"button",[["class","close"],["data-dismiss","alert"],["type","button"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==(i._errorMessage=null)&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["\xd7"])),(e()(),B["\u0275ted"](null,["\n  ","\n"]))],null,function(e,n){e(n,4,0,n.component._errorMessage)})}function _(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,4,"div",[["class","alert fade in alert-success"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275eld"](0,null,null,1,"button",[["class","close"],["data-dismiss","alert"],["type","button"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==(i._infoMessage=null)&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["\xd7"])),(e()(),B["\u0275ted"](null,["\n  ","\n"]))],null,function(e,n){e(n,4,0,n.component._infoMessage)})}function w(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Please add at least one location in a day or event settings"]))],null,null)}function P(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Loading..."]))],null,null)}function x(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,7,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["No map created yet."])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275eld"](0,null,null,1,"button",[["class","btn btn-primary"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.fetchLocationsAndGenerateMap()&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["Create map"])),(e()(),B["\u0275ted"](null,["\n"]))],null,null)}function C(e){return B["\u0275vid"](0,[(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,0,"i",[["class","fa fa-file"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "]))],null,null)}function k(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,3,"option",[["class","form-control"],["required",""]],null,null,null,null,null)),B["\u0275did"](147456,null,0,X.i,[B.ElementRef,B.Renderer2,[2,X.j]],{value:[0,"value"]},null),B["\u0275did"](147456,null,0,X.o,[B.ElementRef,B.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),B["\u0275ted"](null,["",""]))],function(e,n){e(n,1,0,n.context.$implicit.key()),e(n,2,0,n.context.$implicit.key())},function(e,n){e(n,3,0,n.context.$implicit.name)})}function L(e){return B["\u0275vid"](0,[(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,0,"i",[["class","glyphicon glyphicon-map-marker"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "]))],null,null)}function T(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,37,"div",[["class","btn-group"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,1,"text-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,l){var t=!0,i=e.component;if("propertiesChange"===n){t=!1!==(e.parent.parent.context.$implicit.node.properties=l)&&t}if("onChange"===n){t=!1!==i.nodePropertiesChanged()&&t}return t},o,ie)),B["\u0275did"](376832,null,0,le,[ee.ColorPickerService,B.KeyValueDiffers],{properties:[0,"properties"],defaults:[1,"defaults"]},{onChange:"onChange"}),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,17,"span",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,6,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==B["\u0275nov"](e,11).onClick()&&t}if("click"===n){t=!1!==i.toggleProperty(e.parent.parent.context.$implicit.node,"landing")&&t}return t},null,null)),B["\u0275did"](81920,null,0,oe.a,[],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[oe.a]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275eld"](0,null,null,0,"img",[["alt","Landing"],["height","16px"],["src","/ng-map/assets/landing.svg"],["width","16px"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n\n           "])),(e()(),B["\u0275eld"](0,null,null,6,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==B["\u0275nov"](e,19).onClick()&&t}if("click"===n){t=!1!==i.toggleProperty(e.parent.parent.context.$implicit.node,"takeoff")&&t}return t},null,null)),B["\u0275did"](81920,null,0,oe.a,[],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[oe.a]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275eld"](0,null,null,0,"img",[["alt","Take-off"],["height","16px"],["src","/ng-map/assets/takeoff.svg"],["width","16px"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275ted"](null,["\n\n          "])),(e()(),B["\u0275eld"](0,null,null,9,"span",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,6,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==B["\u0275nov"](e,30).onClick()&&t}if("click"===n){t=!1!==i.setProperty(e.parent.parent.context.$implicit.node,"markStyle","first"===e.parent.parent.context.$implicit.node.properties.markStyle?"normal":"first")&&t}return t},null,null)),B["\u0275did"](81920,null,0,oe.a,[],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[oe.a]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-circle"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275ted"](null,["\n        "]))],function(e,n){var l=n.component;e(n,5,0,n.parent.parent.context.$implicit.node.properties,l._seqTrip._tripData.defaultTextProp),e(n,11,0),e(n,13,0,n.parent.parent.context.$implicit.node.properties.landing),e(n,19,0),e(n,21,0,n.parent.parent.context.$implicit.node.properties.takeoff),e(n,30,0),e(n,32,0,"first"===n.parent.parent.context.$implicit.node.properties.markStyle)},function(e,n){e(n,10,0,B["\u0275nov"](n,11).state,B["\u0275nov"](n,15).ngClassUntouched,B["\u0275nov"](n,15).ngClassTouched,B["\u0275nov"](n,15).ngClassPristine,B["\u0275nov"](n,15).ngClassDirty,B["\u0275nov"](n,15).ngClassValid,B["\u0275nov"](n,15).ngClassInvalid,B["\u0275nov"](n,15).ngClassPending),e(n,18,0,B["\u0275nov"](n,19).state,B["\u0275nov"](n,23).ngClassUntouched,B["\u0275nov"](n,23).ngClassTouched,B["\u0275nov"](n,23).ngClassPristine,B["\u0275nov"](n,23).ngClassDirty,B["\u0275nov"](n,23).ngClassValid,B["\u0275nov"](n,23).ngClassInvalid,B["\u0275nov"](n,23).ngClassPending),e(n,29,0,B["\u0275nov"](n,30).state,B["\u0275nov"](n,34).ngClassUntouched,B["\u0275nov"](n,34).ngClassTouched,B["\u0275nov"](n,34).ngClassPristine,B["\u0275nov"](n,34).ngClassDirty,B["\u0275nov"](n,34).ngClassValid,B["\u0275nov"](n,34).ngClassInvalid,B["\u0275nov"](n,34).ngClassPending)})}function M(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,26,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"nodeSkipped",null],[2,"panel-open",null]],null,null,re.b,re.a)),B["\u0275did"](245760,[["group",4]],0,ae.a,[se.a],null,null),(e()(),B["\u0275ted"](1,["\n        "])),(e()(),B["\u0275eld"](0,null,0,19,"div",[["accordion-heading",""],["class","hflex-container"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,2,"i",[["class","fa fa-right-margin flex-item-narrow in-margin-top"],["style","font-size: 14pt"]],null,null,null,null,null)),B["\u0275did"](278528,null,0,Y.NgClass,[B.IterableDiffers,B.KeyValueDiffers,B.ElementRef,B.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),B["\u0275pod"]({"fa-caret-down":0,"fa-caret-right":1}),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,5,"input",[["class","form-control-input flex-item-wide"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"],[null,"change"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,l){var t=!0,i=e.component;if("input"===n){t=!1!==B["\u0275nov"](e,10)._handleInput(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,10).onTouched()&&t}if("compositionstart"===n){t=!1!==B["\u0275nov"](e,10)._compositionStart()&&t}if("compositionend"===n){t=!1!==B["\u0275nov"](e,10)._compositionEnd(l.target.value)&&t}if("click"===n){t=!1!==l.stopPropagation()&&t}if("change"===n){t=!1!==i.setNodeLabel(e.parent.context.$implicit.node,l.target.value)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.c,[B.Renderer2,B.ElementRef,[2,X.a]],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[X.c]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n\n          "])),(e()(),B["\u0275eld"](0,null,null,5,"input",[["class","flex-item-narrow in-margin-top"],["type","checkbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"],[null,"change"],[null,"blur"]],function(e,n,l){var t=!0,i=e.component;if("change"===n){t=!1!==B["\u0275nov"](e,17).onChange(l.target.checked)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,17).onTouched()&&t}if("click"===n){i.toggleSkipNode(e.parent.context.$implicit.node);t=!1!==l.stopPropagation()&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.b,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[X.b]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n\n        "])),(e()(),B["\u0275ted"](1,["\n        "])),(e()(),B["\u0275and"](16777216,null,1,1,null,T)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](1,["\n      "]))],function(e,n){var l=n.component;e(n,1,0);e(n,6,0,"fa fa-right-margin flex-item-narrow in-margin-top",e(n,7,0,null==B["\u0275nov"](n,1)?null:B["\u0275nov"](n,1).isOpen,!(null==B["\u0275nov"](n,1)?null:B["\u0275nov"](n,1).isOpen))),e(n,12,0,l.isSkipped(n.parent.context.$implicit.node),n.parent.context.$implicit.node.label),e(n,19,0,!l.isSkipped(n.parent.context.$implicit.node)),e(n,25,0,!l.isSkipped(n.parent.context.$implicit.node))},function(e,n){var l=n.component;e(n,0,0,n.parent.context.$implicit.node&&l.isSkipped(n.parent.context.$implicit.node),B["\u0275nov"](n,1).isOpen),e(n,9,0,B["\u0275nov"](n,14).ngClassUntouched,B["\u0275nov"](n,14).ngClassTouched,B["\u0275nov"](n,14).ngClassPristine,B["\u0275nov"](n,14).ngClassDirty,B["\u0275nov"](n,14).ngClassValid,B["\u0275nov"](n,14).ngClassInvalid,B["\u0275nov"](n,14).ngClassPending),e(n,16,0,B["\u0275nov"](n,21).ngClassUntouched,B["\u0275nov"](n,21).ngClassTouched,B["\u0275nov"](n,21).ngClassPristine,B["\u0275nov"](n,21).ngClassDirty,B["\u0275nov"](n,21).ngClassValid,B["\u0275nov"](n,21).ngClassInvalid,B["\u0275nov"](n,21).ngClassPending)})}function S(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,22,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"nodeSkipped",null],[2,"panel-open",null]],null,null,re.b,re.a)),B["\u0275did"](245760,[["group2",4]],0,ae.a,[se.a],null,null),(e()(),B["\u0275ted"](1,["\n        "])),(e()(),B["\u0275eld"](0,null,0,15,"div",[["accordion-heading",""]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,2,"i",[["class","fa"],["style","font-size: 14pt"]],null,null,null,null,null)),B["\u0275did"](278528,null,0,Y.NgClass,[B.IterableDiffers,B.KeyValueDiffers,B.ElementRef,B.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),B["\u0275pod"]({"fa-caret-down":0,"fa-caret-right":1}),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,1,"span",[["class","italic"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,[""," - ",""])),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,5,"input",[["class","pull-right"],["type","checkbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"],[null,"change"],[null,"blur"]],function(e,n,l){var t=!0,i=e.component;if("change"===n){t=!1!==B["\u0275nov"](e,13).onChange(l.target.checked)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,13).onTouched()&&t}if("click"===n){i.toggleHideEdge(e.parent.context.$implicit.edge);t=!1!==l.stopPropagation()&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.b,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[X.b]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n        "])),(e()(),B["\u0275ted"](1,["\n        "])),(e()(),B["\u0275eld"](0,null,1,1,"edge-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,l){var t=!0,i=e.component;if("propertiesChange"===n){t=!1!==(e.parent.context.$implicit.edge.properties=l)&&t}if("onChange"===n){t=!1!==i.edgePropertiesChanged(e.parent.context.$implicit.edge)&&t}return t},c,he)),B["\u0275did"](376832,null,0,pe,[B.KeyValueDiffers],{properties:[0,"properties"],defaults:[1,"defaults"]},{onChange:"onChange"}),(e()(),B["\u0275ted"](1,["\n      "]))],function(e,n){var l=n.component;e(n,1,0);e(n,6,0,"fa",e(n,7,0,null==B["\u0275nov"](n,1)?null:B["\u0275nov"](n,1).isOpen,!(null==B["\u0275nov"](n,1)?null:B["\u0275nov"](n,1).isOpen))),e(n,15,0,!n.parent.context.$implicit.edge.properties.hidden),e(n,21,0,n.parent.context.$implicit.edge.properties,l._seqTrip._tripData.defaultEdgeProp)},function(e,n){var l=n.component;e(n,0,0,n.parent.context.$implicit.edge.properties.hidden,B["\u0275nov"](n,1).isOpen),e(n,10,0,l.origin(n.parent.context.$implicit.edge).label,l.destination(n.parent.context.$implicit.edge).label),e(n,12,0,B["\u0275nov"](n,17).ngClassUntouched,B["\u0275nov"](n,17).ngClassTouched,B["\u0275nov"](n,17).ngClassPristine,B["\u0275nov"](n,17).ngClassDirty,B["\u0275nov"](n,17).ngClassValid,B["\u0275nov"](n,17).ngClassInvalid,B["\u0275nov"](n,17).ngClassPending)})}function R(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,7,null,null,null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275and"](16777216,null,null,1,null,M)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275and"](16777216,null,null,1,null,S)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n      "]))],function(e,n){e(n,3,0,n.context.$implicit.node),e(n,6,0,n.context.$implicit.edge)},null)}function D(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,23,"ul",[["class","dropdown-menu dropdown-menu-right"],["role","menu"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),B["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.autoPlaceLabels()&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["Auto place labels"])),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),B["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.resetCurves()&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["Reset curves"])),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),B["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.resetLabels()&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["Reset labels"])),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,0,"li",[["class","divider dropdown-divider"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),B["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.download("jpg")&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["Export JPG"])),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),B["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.download("png")&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["Export PNG"])),(e()(),B["\u0275ted"](null,["\n    "]))],null,null)}function E(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,0,"div",[["class","spin-loader"]],null,null,null,null,null))],null,null)}function z(e){return B["\u0275vid"](0,[B["\u0275qud"](402653184,1,{mapview:0}),(e()(),B["\u0275eld"](0,null,null,0,"link",[["href","https://fonts.googleapis.com/css?family=PT+Sans"],["rel","stylesheet"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,b)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,_)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,w)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,P)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,x)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275eld"](0,null,null,144,"div",[],[[2,"hidden",null]],null,null,null,null)),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275eld"](0,null,null,122,"div",[["class","maptabset"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275eld"](0,null,null,119,"tabset",[["type","pills"]],[[2,"tab-container",null]],null,null,fe.b,fe.a)),B["\u0275did"](180224,null,0,ge.a,[me.a],{vertical:[0,"vertical"],type:[1,"type"]},null),(e()(),B["\u0275ted"](0,["\n  "])),(e()(),B["\u0275eld"](0,null,0,100,"tab",[],[[2,"active",null],[2,"tab-pane",null]],[[null,"select"]],function(e,n,l){var t=!0,i=e.component;if("select"===n){t=!1!==i.lockMap(!1)&&t}return t},null,null)),B["\u0275did"](212992,null,0,Re.a,[ge.a,B.ElementRef,B.Renderer],null,{select:"select"}),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275and"](0,null,null,1,null,C)),B["\u0275did"](16384,null,0,De.a,[B.TemplateRef,Re.a],null,null),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,93,"div",[["class","panel panel-default"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,90,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n\n        "])),(e()(),B["\u0275eld"](0,null,null,52,"div",[["class","panel panel-default"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275eld"](0,null,null,18,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,1,"label",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Format/orientation"])),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,9,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,n,l){var t=!0,i=e.component;if("change"===n){t=!1!==B["\u0275nov"](e,46).onChange(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,46).onTouched()&&t}if("change"===n){t=!1!==i.uiSetPageSize(l.target.value)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.j,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e){return[e]},[X.j]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n               "])),(e()(),B["\u0275and"](16777216,null,null,1,null,k)),B["\u0275did"](802816,null,0,Y.NgForOf,[B.ViewContainerRef,B.TemplateRef,B.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275ted"](null,["\n\n          "])),(e()(),B["\u0275eld"](0,null,null,29,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,1,"label",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Zoom / center"])),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275ted"](null,["\n\n            "])),(e()(),B["\u0275eld"](0,null,null,1,"label",[["class","btn btn-default map-btn"]],null,[[null,"click"]],function(e,n,l){var t=!0,i=e.component;if("click"===n){t=!1!==i.uiSetFrame()&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["Auto scroll/zoom"])),(e()(),B["\u0275ted"](null,["\n\n            "])),(e()(),B["\u0275eld"](0,null,null,9,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,6,"input",[["id","scaleSlider"],["max","8"],["min","0"],["step","0.000001"],["type","range"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,n,l){var t=!0,i=e.component;if("input"===n){t=!1!==B["\u0275nov"](e,71)._handleInput(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,71).onTouched()&&t}if("compositionstart"===n){t=!1!==B["\u0275nov"](e,71)._compositionStart()&&t}if("compositionend"===n){t=!1!==B["\u0275nov"](e,71)._compositionEnd(l.target.value)&&t}if("change"===n){t=!1!==B["\u0275nov"](e,72).onChange(l.target.value)&&t}if("input"===n){t=!1!==B["\u0275nov"](e,72).onChange(l.target.value)&&t}if("blur"===n){t=!1!==B["\u0275nov"](e,72).onTouched()&&t}if("change"===n){t=!1!==i.setScale(l.target.value)&&t}if("input"===n){t=!1!==i.setScale(l.target.value)&&t}return t},null,null)),B["\u0275did"](16384,null,0,X.c,[B.Renderer2,B.ElementRef,[2,X.a]],null,null),B["\u0275did"](16384,null,0,X.m,[B.Renderer2,B.ElementRef],null,null),B["\u0275prd"](1024,null,X.e,function(e,n){return[e,n]},[X.c,X.m]),B["\u0275did"](671744,null,0,X.h,[[8,null],[8,null],[8,null],[2,X.e]],{model:[0,"model"]},null),B["\u0275prd"](2048,null,X.f,null,[X.h]),B["\u0275did"](16384,null,0,X.g,[X.f],null,null),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,6,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n              "])),(e()(),B["\u0275eld"](0,null,null,0,"input",[["type","checkbox"]],[[8,"checked",0]],[[null,"change"]],function(e,n,l){var t=!0,i=e.component;if("change"===n){t=!1!=(i._autoLockMap=!i._autoLockMap)&&t}return t},null,null)),(e()(),B["\u0275ted"](null,["\n              "])),(e()(),B["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Auto lock map"])),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275ted"](null,["\n          "])),(e()(),B["\u0275ted"](null,["\n        "])),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,33,"accordion",[["class","panel-group"],["role","tablist"],["style","display: block"]],[[1,"aria-multiselectable",0]],null,null,Ee.b,Ee.a)),B["\u0275did"](49152,null,0,se.a,[ze.a],{closeOthers:[0,"closeOthers"]},null),(e()(),B["\u0275ted"](0,["\n      "])),(e()(),B["\u0275ted"](0,["\n\n        "])),(e()(),B["\u0275eld"](0,null,0,13,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"panel-open",null]],null,null,re.b,re.a)),B["\u0275did"](245760,null,0,ae.a,[se.a],null,null),(e()(),B["\u0275ted"](1,["\n          "])),(e()(),B["\u0275eld"](0,null,0,3,"p",[["accordion-heading",""]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-font"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Default text properties\n          "])),(e()(),B["\u0275ted"](1,["\n          "])),(e()(),B["\u0275eld"](0,null,1,4,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,1,"text-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,l){var t=!0,i=e.component;if("propertiesChange"===n){t=!1!==(i._seqTrip._tripData.defaultTextProp=l)&&t}if("onChange"===n){t=!1!==i.nodePropertiesChanged()&&t}return t},o,ie)),B["\u0275did"](376832,null,0,le,[ee.ColorPickerService,B.KeyValueDiffers],{properties:[0,"properties"],noReset:[1,"noReset"]},{onChange:"onChange"}),(e()(),B["\u0275ted"](null,["\n\n          "])),(e()(),B["\u0275ted"](1,["\n        "])),(e()(),B["\u0275ted"](0,["\n\n        "])),(e()(),B["\u0275eld"](0,null,0,13,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"panel-open",null]],null,null,re.b,re.a)),B["\u0275did"](245760,null,0,ae.a,[se.a],null,null),(e()(),B["\u0275ted"](1,["\n          "])),(e()(),B["\u0275eld"](0,null,0,3,"p",[["accordion-heading",""]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-arrows-h"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["Default line properties\n          "])),(e()(),B["\u0275ted"](1,["\n          "])),(e()(),B["\u0275eld"](0,null,1,4,"div",[],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n            "])),(e()(),B["\u0275eld"](0,null,null,1,"edge-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,n,l){var t=!0,i=e.component;if("propertiesChange"===n){t=!1!==(i._seqTrip._tripData.defaultEdgeProp=l)&&t}if("onChange"===n){t=!1!==i.edgePropertiesChanged()&&t}return t},c,he)),B["\u0275did"](376832,null,0,pe,[B.KeyValueDiffers],{properties:[0,"properties"],noReset:[1,"noReset"]},{onChange:"onChange"}),(e()(),B["\u0275ted"](null,["\n\n          "])),(e()(),B["\u0275ted"](1,["\n        "])),(e()(),B["\u0275ted"](0,["\n      "])),(e()(),B["\u0275ted"](null,["\n\n      "])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](0,["\n\n  "])),(e()(),B["\u0275eld"](0,null,0,13,"tab",[],[[2,"active",null],[2,"tab-pane",null]],[[null,"select"]],function(e,n,l){var t=!0,i=e.component;if("select"===n){t=!1!==i.lockMap(!0)&&t}return t},null,null)),B["\u0275did"](212992,null,0,Re.a,[ge.a,B.ElementRef,B.Renderer],null,{select:"select"}),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275and"](0,null,null,1,null,L)),B["\u0275did"](16384,null,0,De.a,[B.TemplateRef,Re.a],null,null),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,6,"accordion",[["class","panel-group"],["id","long-accord"],["role","tablist"],["style","display: block"]],[[1,"aria-multiselectable",0]],null,null,Ee.b,Ee.a)),B["\u0275did"](49152,null,0,se.a,[ze.a],null,null),(e()(),B["\u0275ted"](0,["\n      "])),(e()(),B["\u0275and"](16777216,null,0,1,null,R)),B["\u0275did"](802816,null,0,Y.NgForOf,[B.ViewContainerRef,B.TemplateRef,B.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),B["\u0275ted"](0,["  "])),(e()(),B["\u0275ted"](0,["\n    "])),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](0,["\n\n"])),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275ted"](null,["\n\n"])),(e()(),B["\u0275eld"](0,null,null,1,"mapview",[["class","floatleft"],["style","display:block;"]],[[4,"width","px"],[4,"height","px"]],null,null,v,Ae)),B["\u0275did"](49152,[[1,4],["mapview",4]],0,Fe,[],{canvasWidth:[0,"canvasWidth"],canvasHeight:[1,"canvasHeight"],compactAttribution:[2,"compactAttribution"]},null),(e()(),B["\u0275ted"](null,["\n\n  "])),(e()(),B["\u0275eld"](16777216,null,null,14,"span",[["class","floatright btn-group"],["dropdown",""],["style","width:auto;"]],[[2,"dropup",null],[2,"open",null],[2,"show",null]],null,null,null,null)),B["\u0275prd"](512,null,Be.a,Be.a,[]),B["\u0275did"](212992,null,0,Ve.a,[B.ElementRef,B.Renderer,B.ViewContainerRef,Ue.a,$e.a,Be.a],null,null),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275eld"](0,null,null,6,"button",[["class","btn btn-default dropdown-toggle thinbutton"],["dropdownToggle",""],["type","button"]],[[1,"aria-haspopup",0],[1,"disabled",0],[1,"aria-expanded",0]],[[null,"click"],["document","click"],[null,"keyup.esc"]],function(e,n,l){var t=!0;if("click"===n){t=!1!==B["\u0275nov"](e,152).onClick()&&t}if("document:click"===n){t=!1!==B["\u0275nov"](e,152).onDocumentClick(l)&&t}if("keyup.esc"===n){t=!1!==B["\u0275nov"](e,152).onEsc()&&t}return t},null,null)),B["\u0275did"](147456,null,0,He.a,[Be.a,B.ElementRef],null,null),(e()(),B["\u0275ted"](null,["\n      "])),(e()(),B["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-cogs"]],null,null,null,null,null)),(e()(),B["\u0275eld"](0,null,null,0,"br",[],null,null,null,null,null)),(e()(),B["\u0275eld"](0,null,null,0,"span",[["class","caret"]],null,null,null,null,null)),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275ted"](null,["\n    "])),(e()(),B["\u0275and"](16777216,null,null,1,null,D)),B["\u0275did"](16384,null,0,Ze.a,[Be.a,B.ViewContainerRef,B.TemplateRef],null,null),(e()(),B["\u0275ted"](null,["\n  "])),(e()(),B["\u0275ted"](null,["\n\n\n"])),(e()(),B["\u0275ted"](null,["\n\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,E)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"]))],function(e,n){var l=n.component;e(n,4,0,l._errorMessage),e(n,7,0,l._infoMessage),e(n,10,0,!l._loadingMap&&0==l._numLocations),e(n,13,0,l._loadingMap),e(n,16,0,l._numLocations>0&&!l._visitedPlaceList.length);e(n,23,0,!0,"pills"),e(n,26,0),e(n,48,0,l._pageSizeName),e(n,53,0,l._pageSizes),e(n,74,0,l.scale());e(n,90,0,!0),e(n,94,0);e(n,104,0,l._seqTrip._tripData.defaultTextProp,!0),e(n,109,0);e(n,119,0,l._seqTrip._tripData.defaultEdgeProp,!0),e(n,128,0),e(n,137,0,l._interleaved);e(n,145,0,l._canvasWidth,l._canvasHeight,!0),e(n,149,0),e(n,165,0,l._showSpinner)},function(e,n){var l=n.component;e(n,18,0,!l._visitedPlaceList.length),e(n,22,0,B["\u0275nov"](n,23).clazz),e(n,25,0,B["\u0275nov"](n,26).active,B["\u0275nov"](n,26).addClass),e(n,45,0,B["\u0275nov"](n,50).ngClassUntouched,B["\u0275nov"](n,50).ngClassTouched,B["\u0275nov"](n,50).ngClassPristine,B["\u0275nov"](n,50).ngClassDirty,B["\u0275nov"](n,50).ngClassValid,B["\u0275nov"](n,50).ngClassInvalid,B["\u0275nov"](n,50).ngClassPending),e(n,70,0,B["\u0275nov"](n,76).ngClassUntouched,B["\u0275nov"](n,76).ngClassTouched,B["\u0275nov"](n,76).ngClassPristine,B["\u0275nov"](n,76).ngClassDirty,B["\u0275nov"](n,76).ngClassValid,B["\u0275nov"](n,76).ngClassInvalid,B["\u0275nov"](n,76).ngClassPending),e(n,81,0,l._autoLockMap),e(n,89,0,B["\u0275nov"](n,90).closeOthers),e(n,93,0,B["\u0275nov"](n,94).isOpen),e(n,108,0,B["\u0275nov"](n,109).isOpen),e(n,127,0,B["\u0275nov"](n,128).active,B["\u0275nov"](n,128).addClass),e(n,133,0,B["\u0275nov"](n,134).closeOthers),e(n,144,0,l._canvasWidth,l._canvasHeight),e(n,147,0,B["\u0275nov"](n,149).dropup,B["\u0275nov"](n,149).isOpen,B["\u0275nov"](n,149).isOpen&&B["\u0275nov"](n,149).isBs4);e(n,151,0,!0,B["\u0275nov"](n,152).isDisabled,B["\u0275nov"](n,152).isOpen)})}function O(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"trip-map",[],null,[["window","beforeunload"]],function(e,n,l){var t=!0;if("window:beforeunload"===n){t=!1!==B["\u0275nov"](e,1).doSomething(l)&&t}return t},z,Ke)),B["\u0275did"](4440064,null,0,Se,[ve.c],null,null)],function(e,n){e(n,1,0)},null)}function I(){var e=new Le;return e.load(mapJson),e}function j(e){return B["\u0275vid"](0,[B["\u0275qud"](402653184,1,{mapview:0}),(e()(),B["\u0275eld"](0,null,null,1,"mapview",[["style","display:block;"]],[[4,"width","px"],[4,"height","px"]],null,null,v,Ae)),B["\u0275did"](49152,[[1,4],["mapview",4]],0,Fe,[],{canvasWidth:[0,"canvasWidth"],canvasHeight:[1,"canvasHeight"],compactAttribution:[2,"compactAttribution"]},null),(e()(),B["\u0275ted"](null,["\n"]))],function(e,n){var l=n.component;e(n,2,0,l.width,l.height,!1)},function(e,n){var l=n.component;e(n,1,0,l.width,l.height)})}function N(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"view-seq",[],null,null,null,j,Ye)),B["\u0275did"](4243456,null,0,Xe,[],null,null)],null,null)}function W(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"trip-map",[],null,[["window","beforeunload"]],function(e,n,l){var t=!0;if("window:beforeunload"===n){t=!1!==B["\u0275nov"](e,1).doSomething(l)&&t}return t},z,Ke)),B["\u0275did"](4440064,null,0,Se,[ve.c],null,null)],function(e,n){e(n,1,0)},null)}function F(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"view-seq",[],null,null,null,j,Ye)),B["\u0275did"](4243456,null,0,Xe,[],null,null)],null,null)}function q(e){return B["\u0275vid"](0,[(e()(),B["\u0275and"](16777216,null,null,1,null,W)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"])),(e()(),B["\u0275and"](16777216,null,null,1,null,F)),B["\u0275did"](16384,null,0,Y.NgIf,[B.ViewContainerRef,B.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),B["\u0275ted"](null,["\n"]))],function(e,n){var l=n.component;e(n,1,0,l.editor),e(n,4,0,!l.editor)},null)}function A(e){return B["\u0275vid"](0,[(e()(),B["\u0275eld"](0,null,null,1,"app-root",[],null,null,null,q,en)),B["\u0275did"](49152,null,0,U,[],null,null)],null,null)}Object.defineProperty(n,"__esModule",{value:!0});var B=l("/oeL"),V=function(){function e(){}return e}(),U=function(){function e(){this.editor=!!thisTripApi}return e.ctorParameters=function(){return[]},e}(),H=l("A6LD"),Z=l("DdBX"),G=[""],K=[".maptabset[_ngcontent-%COMP%]    .panel-heading{padding:10px 15px}.maptabset[_ngcontent-%COMP%]    .panel{margin-bottom:1px}tabset[_ngcontent-%COMP%]    .nav-stacked{float:left}tabset[_ngcontent-%COMP%]    .tab-content{float:left;width:305px;margin-right:6px}.inline[_ngcontent-%COMP%]{display:inline-block}.floatleft[_ngcontent-%COMP%]{float:left}.floatright[_ngcontent-%COMP%]{float:right}.nodeSelected[_ngcontent-%COMP%]{font-weight:700}.nodeSkipped[_ngcontent-%COMP%]{color:gray}.small[_ngcontent-%COMP%]{width:25px;height:25px}button.delete[_ngcontent-%COMP%]{margin-top:2px;margin-right:.8em;background-color:#d3d3d3;color:red}div.maptabset[_ngcontent-%COMP%]{float:left}tab[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{width:100%} .square{width:10px;height:10px;display:inline-block;margin:3px}.hidden[_ngcontent-%COMP%]{display:none}.global-buttons[_ngcontent-%COMP%]{margin-bottom:20px}.maptabset[_ngcontent-%COMP%]    .nav-pills{margin-right:6px}.maptabset[_ngcontent-%COMP%]    .nav-item{border-right:1px solid #ddd;margin:0}.maptabset[_ngcontent-%COMP%]    .nav-item.active{border-top:1px solid #ddd;border-bottom:1px solid #ddd;border-left:1px solid #ddd;border-right:0}.maptabset[_ngcontent-%COMP%]    .nav-item.active  a{color:#428bca;background-color:#fff}.maptabset[_ngcontent-%COMP%]    .tab-content  button{width:100%}.spin-loader[_ngcontent-%COMP%]{position:absolute;bottom:-20px;left:0;right:0;top:-20px;z-index:10000;background:url(/ng-map/assets/loader.gif) 50% no-repeat;background-size:80px 80px;background-color:rgba(0,0,0,.6);display:block}.map-colors[_ngcontent-%COMP%]{position:relative;padding:5px 0}.map-colors[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:40px;top:11px}.map-btn[_ngcontent-%COMP%]{margin-top:10px}.in-margin-top[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.fa-right-margin[_ngcontent-%COMP%]{margin-right:7px}.form-control-input[_ngcontent-%COMP%]{display:inline-block;margin-right:10px;height:34px;padding:6px 12px;font-size:12px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.italic[_ngcontent-%COMP%]{font-style:italic;padding-left:12px;font-size:12px}.btn-group[_ngcontent-%COMP%]{width:100%}.form-control[_ngcontent-%COMP%]{margin-top:5px}accordion-group[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}accordion-group[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{margin-right:10px;color:#428bca}#accordion-menu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#333;background-color:#f5f5f5;cursor:pointer;padding:10px 20px;margin:0;border-top-left-radius:4px;border-top-right-radius:4px;border:1px solid #ddd;box-shadow:0 1px 1px rgba(0,0,0,.05)}#accordion-menu[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{border:1px solid #ddd;padding:20px 15px 10px;color:#333;background-color:#fff;border-color:#ddd;display:none;margin:0}#accordion-menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style-type:none}#accordion-menu[_ngcontent-%COMP%]   .collapsable-menu[_ngcontent-%COMP%]{display:none}#accordion-menu[_ngcontent-%COMP%]   .uncollapsable-menu[_ngcontent-%COMP%]{display:block}#long-accord[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto;padding-right:5px}#long-accord[_ngcontent-%COMP%]::-webkit-scrollbar{background-color:#eee;width:6px}#long-accord[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#999;border-radius:6px}.thinbutton[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}#scaleSlider[_ngcontent-%COMP%]{padding:15px}.hflex-container[_ngcontent-%COMP%]{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-ms-flex-pack:start;-webkit-box-pack:start;justify-content:flex-start;-ms-flex-line-pack:stretch;align-content:stretch;-ms-flex-align:start;-webkit-box-align:start;align-items:flex-start}.flex-item-narrow[_ngcontent-%COMP%], .flex-item-wide[_ngcontent-%COMP%]{-ms-flex-order:0;-webkit-box-ordinal-group:1;order:0;-webkit-align-self:auto;-ms-flex-item-align:auto;-ms-grid-row-align:auto;align-self:auto}.flex-item-narrow[_ngcontent-%COMP%]{-ms-flex:0 1 auto;-webkit-box-flex:0;flex:0 1 auto}.flex-item-wide[_ngcontent-%COMP%]{-ms-flex:1 1 auto;-webkit-box-flex:1;flex:1 1 auto}"],X=l("bm2B"),J=[".small[_ngcontent-%COMP%]{width:25px;height:25px}.root[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%]{display:inline-block}input[type=number][_ngcontent-%COMP%]{width:5em}i.fa-recycle[_ngcontent-%COMP%]{float:right}.text-prop-colors[_ngcontent-%COMP%]{position:relative;padding:5px 0}.text-prop-colors[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:40px;top:7px}.font-size-margin[_ngcontent-%COMP%]{margin:5px 0 8px}"],Y=l("qbdv"),Q=l("ZHSE"),ee=l("QMm5"),ne=l("XB9w"),le=function(){function e(e,n){this.cpService=e,this.differs=n,this.onChange=new B.EventEmitter,this.defaultsDiffer=n.find({}).create(null),this.propertiesDiffer=n.find({}).create(null)}return e.prototype.ngOnInit=function(){},e.prototype.changeEvent=function(){this.onChange.emit(this.properties)},e.prototype.ngDoCheck=function(){var e=this.defaultsDiffer.diff(this.defaults)||this.propertiesDiffer.diff(this.properties);return e&&this.readProperties(),e},e.prototype.readProperties=function(){for(var e=0,n=["fill","stroke","fontSize"];e<n.length;e++){var l=n[e];this.properties&&l in this.properties?this[l]=this.properties[l]:this.defaults&&l in this.defaults?this[l]=this.defaults[l]:this[l]="stroke"==l||"fill"==l?"#000000":void 0}},e.prototype.hasDefault=function(){for(var e=0,n=["fill","stroke","fontSize"];e<n.length;e++){if(n[e]in this.properties)return!1}return!0},e.prototype.setProperty=function(e){this.properties[e]=this[e],this.changeEvent()},e.prototype.resetToDefault=function(){for(var e=0,n=["fill","stroke","fontSize"];e<n.length;e++){var l=n[e];delete this.properties[l]}this.readProperties(),this.changeEvent()},e.ctorParameters=function(){return[{type:ne.ColorPickerService},{type:B.KeyValueDiffers}]},e}(),te=[J],ie=B["\u0275crt"]({encapsulation:0,styles:te,data:{}}),oe=(B["\u0275ccf"]("text-prop",le,r,{properties:"properties",defaults:"defaults",noReset:"noReset"},{properties:"properties",onChange:"onChange"},[]),l("QO87")),re=l("uDoG"),ae=l("2dRj"),se=l("m6EG"),ue=[".form-control[_ngcontent-%COMP%]{width:10em;display:inline-block}.small[_ngcontent-%COMP%]{width:25px;height:25px}.edge-prop-colors[_ngcontent-%COMP%]{position:relative;padding:5px 0}.edge-prop-colors[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:40px;top:7px}.input-form-control-margin[_ngcontent-%COMP%]{margin:10px 0}"],de=function(){function e(e,n){this.name=e.replace(/-/g,"\u2501").replace(/ /g," \xa0"),this.style=n}return e.prototype.key=function(){return name},e}(),pe=function(){function e(e){this.differs=e,this.onChange=new B.EventEmitter,this.defaultsDiffer=e.find({}).create(null),this.propertiesDiffer=e.find({}).create(null),this.allLineStyles=[new de("------",[]),new de("- - - ",[4,4]),new de("--  --",[8,8])],this.allTravelMeans=["Unspecified","Bike","Boat","Bus","Car","Helicopter","Plane","Train","Walk"]}return e.prototype.changeEvent=function(){this.setProp("lineWidth"),this.onChange.emit(this.properties)},e.prototype.ngOnInit=function(){this.readProperties()},e.prototype.ngDoCheck=function(){var e=this.defaultsDiffer.diff(this.defaults)||this.propertiesDiffer.diff(this.properties);return e&&this.readProperties(),e},e.prototype.readProperties=function(){for(var e={lineColor:"#000000",lineWidth:2,travelMean:"Unspecified",geom:"straight"},n=0,l=Object.keys(e);n<l.length;n++){var t=l[n];this.properties&&t in this.properties?this[t]=this.properties[t]:this.defaults&&t in this.defaults?this[t]=this.defaults[t]:this[t]=e[t]}var i;if(this.properties&&this.properties.dashed?i=this.properties.dashed:this.defaults&&this.defaults.dashed&&(i=this.defaults.dashed),i)for(var o=0,r=this.allLineStyles;o<r.length;o++){var a=r[o];this.sameStyles(a.style,i)&&(this.lineStyle=a.name)}else this.lineStyle=this.allLineStyles[0].name},e.prototype.sameStyles=function(e,n){if(!e||!n)return!1;if(e===n)return!0;if(e.length!=n.length)return!1;for(var l=0;l<e.length;++l)if(e[l]!=n[l])return!1;return!0},e.prototype.setProp=function(e){this.properties&&(this.defaults&&this[e]===this.defaults[e]?this.properties[e]&&delete this.properties[e]:this.properties[e]=this[e])},e.prototype.colorChanged=function(){this.setProp("lineColor"),this.changeEvent()},e.prototype.resetToDefault=function(){for(var e=0,n=Object.keys(this.properties);e<n.length;e++){var l=n[e];delete this.properties[l]}this.readProperties(),this.changeEvent()},e.prototype.hasDefault=function(){for(var e=["lineColor","lineWidth","travelMean","dashed"],n=0,l=e;n<l.length;n++){if(l[n]in this.properties)return!1}return!0},e.prototype.setLineStyle=function(e){for(var n=0,l=this.allLineStyles;n<l.length;n++){var t=l[n];t.name===e&&(this.properties.dashed=t.style)}this.changeEvent()},e.prototype.canDrive=function(){return-1!=["Car","Bus","Bike","Walk"].indexOf(this.travelMean)},e.prototype.setTravelMean=function(e){this.travelMean=e,this.setProp("travelMean"),this.canDrive()?"route"!=this.geom&&(this.geom="route",this.setProp("geom")):"route"==this.geom&&(this.geom=this.defaults?this.defaults.geom:"straight",this.setProp("geom")),this.changeEvent()},e.prototype.setGeom=function(e){this.geom=e,this.setProp("geom"),this.changeEvent()},e.ctorParameters=function(){return[{type:B.KeyValueDiffers}]},e}(),ce=[ue],he=B["\u0275crt"]({encapsulation:0,styles:ce,data:{}}),fe=(B["\u0275ccf"]("edge-prop",pe,h,{properties:"properties",defaults:"defaults",noReset:"noReset"},{properties:"properties",onChange:"onChange"},[]),l("UbUN")),ge=l("1sP3"),me=l("5bcs"),ve=l("XKz0"),ye=function(){function e(e,n){if("number"==typeof e&&"number"==typeof n?(this.x=e,this.y=n):Array.isArray(e)?(this.x=e[0],this.y=e[1]):"object"==typeof e&&(this.x=e.x,this.y=e.y),void 0===this.x||void 0===this.y)throw new Error("invalid point")}return e.minus=function(n,l){return new e(n.x-l.x,n.y-l.y)},e.plus=function(n,l){return new e(n.x+l.x,n.y+l.y)},e.times=function(n,l){return new e(n*l.x,n*l.y)},e.min=function(n,l){return new e(Math.min(n.x,l.x),Math.min(n.y,l.y))},e.max=function(n,l){return new e(Math.max(n.x,l.x),Math.max(n.y,l.y))},e.dist=function(e,n){var l=e.x-n.x,t=e.y-n.y;return Math.sqrt(l*l+t*t)},e.norm=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.nearest=function(n,l){for(var t,i,o=0,r=l;o<r.length;o++){var a=r[o],s=e.dist(a,n);(void 0===t||s<i)&&(i=s,t=a)}return t},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.mul=function(e){return this.x*=e,this.y*=e,this},e.prototype.norm=function(){return e.norm(this)},e}(),be=function(){function e(e){e&&(e.min&&(this.min=new ye(e.min)),e.max&&(this.max=new ye(e.max)))}return e.closestPoint=function(e,n){var l=new ye(0,0);for(var t in l)e[t]<n.min[t]?l[t]=n.min[t]:e[t]>n.max[t]?l[t]=n.max[t]:l[t]=e[t];return l},e.overlaps=function(e,n){return!(e.max.x<n.min.x||e.min.x>n.max.x||e.max.y<n.min.y||e.min.y>n.max.y)},e.contains=function(e,n){return n.x>=e.min.x&&n.x<=e.max.x&&n.y>=e.min.y&&n.y<=e.max.y},e.prototype.addPoint=function(e){this.min=void 0===this.min?e:ye.min(this.min,e),this.max=void 0===this.max?e:ye.max(this.max,e)},e.prototype.addArray=function(e){for(var n=0,l=e;n<l.length;n++){var t=l[n];this.addPoint(t)}},e.prototype.overlaps=function(n){return e.overlaps(this,n)},e.prototype.contains=function(n){return e.contains(this,n)},e}(),_e={},we=function(){function e(e,n){var l=e||{};this.nodes=l.node||{},this.edges=l.edges||[],this.defaultEdgeProp=n}return e.generateControlPoints=function(e,n,l,t){var i=ye.minus(l,n).mul(1/3),o=new ye(-i.y,i.x);return[ye.plus(ye.plus(n,i),o),ye.plus(ye.minus(l,i),o)]},e.bezierFromPoints=function(e){for(var n=[],l=0;l<4;++l)n.push(e[l].x),n.push(e[l].y);return new Bezier(n)},e.bezierThroughPoints=function(n){for(var l=[],t=1;t<n.length;++t){var i=1===t?n[t-1]:n[t-2],o=n[t-1],r=n[t],a=t===n.length-1?n[t]:n[t+1];l.push(e.bezierFromPoints([o,ye.plus(o,ye.times(.2,ye.minus(r,i))),ye.plus(r,ye.times(.2,ye.minus(o,a))),r]))}return l},e.placeLeaderLine=function(e){e.properties||(e.properties={});var n,l=e.properties.leaderLine||"bestAnchor",t=e.properties.labelBbox;if("center"===l){var i=(t.max.x,t.min.x,new ye((t.min.x+t.max.x)/2,(t.min.y+t.max.y)/2)),o=ye.minus(e.coord,i);o.mul(.02),n=ye.plus(i,o)}else n="closestOnBbox"===l?be.closestPoint(e.coord,t):d3.labeler.closestLineAnchorPoint(e.coord,{left:t.min.x,right:t.max.x,top:t.min.y,bottom:t.max.y,cx:(t.min.x+t.max.x)/2,cy:(t.min.y+t.max.y)/2});e.properties.leaderLineAnchor=n},e.prototype.createDefaultBezier=function(){for(var n in this.edges){var l=this.edges[n],t=this.nodes[l.from],i=this.nodes[l.to];l.controlPoints=e.generateControlPoints(void 0,t.coord,i.coord,void 0)}},e.prototype.bezier=function(n){if(!n.controlPoints||n.properties.hidden)return[];if("straight"==n.properties.geom||!n.properties.geom&&"straight"==this.defaultEdgeProp.geom)return e.bezierThroughPoints([this.nodes[n.from].coord,this.nodes[n.to].coord]);if(2===n.controlPoints.length){var l=[this.nodes[n.from].coord,n.controlPoints[0],n.controlPoints[1],this.nodes[n.to].coord];return[e.bezierFromPoints(l)]}if(5===n.controlPoints.length){var t=[this.nodes[n.from].coord,n.controlPoints[0],n.controlPoints[1],n.controlPoints[2]],i=[n.controlPoints[2],n.controlPoints[3],n.controlPoints[4],this.nodes[n.to].coord];return[e.bezierFromPoints(t),e.bezierFromPoints(i)]}var o=[this.nodes[n.from].coord].concat(n.controlPoints,[this.nodes[n.to].coord]);return e.bezierThroughPoints(o)},e.prototype.bounds=function(){var e=new be;for(var n in this.nodes)this.nodes[n].properties.skip||e.addPoint(this.nodes[n].coord);return e},e.prototype.frame=function(e,n){var l=this.bounds();if(n=n||1.1,l.max&&l.min){if(l.min.x===l.max.x){var t=new ye(1/32,1/32);l.addPoint(ye.plus(l.min,t)),l.addPoint(ye.minus(l.min,t))}}else l.min=new ye(0,0),l.max=new ye(1,1),n=1;e=e||(l.max.x-l.min.x)/(l.max.y-l.min.y);var i="number"==typeof n?new ye(n,n):n,o=ye.minus(l.max,l.min);o.x*=i.x,o.y*=i.y;var r,a=o.y*e;r=o.x>a?new ye(o.x,o.x/e):new ye(o.y*e,o.y),r.mul(.5);var s=ye.times(.5,ye.plus(l.max,l.min)),u=new be;return u.addPoint(ye.minus(s,r)),u.addPoint(ye.plus(s,r)),u},e.prototype.location=function(e,n){var l=this.frame(e,n);l.max.x,l.min.x;return{x:(l.max.x+l.min.x)/2,y:(l.max.y+l.min.y)/2,scale:Math.max(1/32768,l.max.x-l.min.x)}},e.prototype.compareNodes=function(e){var n=function(e,n){for(var l in e)if(!(l in n))return!1;return!0};return n(this.nodes,e.nodes)&&n(e.nodes,this.nodes)},e.prototype.getEdgeDirections=function(e,n){return g(Utils.worldToLatLon(this.nodes[e.from].coord),Utils.worldToLatLon(this.nodes[e.to].coord),n).then(function(e){var l=e.map(function(e){return new ye(Utils.latLonToWorld(e))});return{mean:n,geom:l,midpoint:m(l)}})},e}(),Pe=function(){function e(e,n,l){this.graph=n,this.renderer=e,this.tripLayer=l}return e.prototype.acceptTouchEvent=function(e,n,l){if("wheel"===l)return!1;this.startWorldPos=new ye(n);var t=this.findLabelAtWorldPos(this.startWorldPos);if(t){this.selectLabel(t);var i=t.properties;return this.applyDelta=function(e){i.labelCoord.x+=e.x,i.labelCoord.y+=e.y,i.labelBbox.min.x+=e.x,i.labelBbox.min.y+=e.y,i.labelBbox.max.x+=e.x,i.labelBbox.max.y+=e.y,i.userPlacement=new ye(i.labelCoord),we.placeLeaderLine(t),this.onLabelMoved&&this.onLabelMoved(t)},!0}this.selectedLabel&&this.deselectLabel();var o=this.closestBezier(n),r=this.renderer.pinchZoom.worldDistanceFromViewerDistance(10*this.renderer.pixelRatio);if(o&&o.d<r){var a=this,s=function(e){a.applyDelta=function(n){if(e){for(var l=Array.isArray(e)?e:[e],t=0,i=l;t<i.length;t++){var r=i[t];r.x+=n.x,r.y+=n.y}this.onBezierMoved&&this.onBezierMoved(o)}}},u=function(e,n,l){a.applyDelta=function(l){e.x+=l.x,e.y+=l.y,n.x+=l.x/2,n.y+=l.y/2}};return 2===o.edge.controlPoints.length?s(o.edge.controlPoints[o.t<.5?0:1]):5===o.edge.controlPoints.length?o.bezier.points[1].x===o.edge.controlPoints[0].x&&o.bezier.points[1].y===o.edge.controlPoints[0].y?o.t<.5?s(o.edge.controlPoints[0]):o.t<.9?u(o.edge.controlPoints[1],o.edge.controlPoints[2],o.edge.controlPoints[3]):s([o.edge.controlPoints[1],o.edge.controlPoints[2],o.edge.controlPoints[3]]):o.t<.1?s([o.edge.controlPoints[1],o.edge.controlPoints[2],o.edge.controlPoints[3]]):o.t<.5?u(o.edge.controlPoints[3],o.edge.controlPoints[2],o.edge.controlPoints[1]):s(o.edge.controlPoints[4]):s(ye.nearest(n,o.edge.controlPoints)),this.selectBezier(o),!0}return this.applyDelta=void 0,!1},e.prototype.selectLabel=function(e){this.selectedLabel&&delete this.selectedLabel.properties.frame,this.selectedLabel=void 0,this.selectBezier(),this.selectedLabel=e,this.onLabelSelect&&this.onLabelSelect(e),e&&(e.properties=e.properties||{},e.properties.frame="#000000"),this.renderer.refreshIfNotMoving()},e.prototype.deselectLabel=function(){return this.selectLabel()},e.prototype.handleMouseDown=function(e){e.preventDefault()},e.prototype.handleMouseMove=function(e){e.preventDefault();var n=Utils.eventPosInElementCoordinates(e,e.target||e.srcElement);this.handleMotion(n)},e.prototype.handleMotion=function(e){if(this.applyDelta){var n=this.renderer.pinchZoom.worldPosFromViewerPos(e.x,e.y),l={x:n.x-this.startWorldPos.x,y:n.y-this.startWorldPos.y};this.startWorldPos=n,this.applyDelta(l),this.renderer.refreshIfNotMoving()}},e.prototype.handleMouseUp=function(e){e.preventDefault(),this.applyDelta=void 0},e.prototype.handleMouseWheel=function(e){e.preventDefault()},e.prototype.handleStart=function(e){e.preventDefault()},e.prototype.handleEnd=function(e){e.preventDefault(),this.applyDelta=void 0},e.prototype.handleMove=function(e){if(e.preventDefault(),1!==e.touches.length)return void(this.applyDelta=void 0);var n=Utils.eventPosInElementCoordinates(e.touches[0],e.target||e.srcElement);this.handleMotion(n)},e.prototype.closestBezier=function(e){for(var n,l=0,t=this.graph.edges;l<t.length;l++)for(var i=t[l],o=this.graph.bezier(i),r=0,a=o;r<a.length;r++){var s=a[r],u=s.project(e);(!n||u.d<n.d)&&(n=u,n.edge=i,n.bezier=s)}return n},e.prototype.findLabelAtWorldPos=function(e){var n=this.graph.nodes;for(var l in n)if(n.hasOwnProperty(l)){var t=this.graph.nodes[l];if(t.properties&&t.properties.labelCoord&&!t.properties.labelBbox&&this.tripLayer.setLabelBbox(t),t.properties&&t.properties.labelBbox&&be.contains(t.properties.labelBbox,e))return t}},e.prototype.selectBezier=function(e){if(this.selectedBezier){var n=this.selectedBezier.edge;delete n.drawMiddlePoint,void 0!==n.properties._lineWidth?(n.properties.lineWidth=n.properties._lineWidth,delete n.properties._lineWidth):delete n.properties.lineWidth}if(this.selectedBezier=e,e){var n=e.edge;n.drawMiddlePoint=!0,void 0!==n.properties._lineWidth&&(n.properties._lineWidth=n.properties.lineWidth),n.properties.lineWidth=5}this.selectedLabel&&this.deselectLabel(),this.onBezierSelect&&this.onBezierSelect(this.selectedBezier),this.renderer.refreshIfNotMoving()},e}(),xe=function(){function e(){this.allPlaces=[]}return e.parse=function(n){var l=new e;l.coord=new ye(n.coord),n.place&&(n.place=e.parse(n.place)),n.viewerPos&&(l.viewerPos=new ye(n.viewerPos));for(var t=0,i=["dbid","name","label","labelIcon","properties"];t<i.length;t++){var o=i[t];n[o]&&(l[o]=n[o])}return l.name||(void 0!==l.dbid?l.name=""+l.dbid:l.label&&(l.name=l.label)),l.properties?(l.properties.labelBbox&&(l.properties.labelBbox=new be(l.properties.labelBbox)),l.properties.leaderLineAnchor&&(l.properties.leaderLineAnchor=new ye(l.properties.leaderLineAnchor)),l.properties.labelCoord&&(l.properties.labelCoord=new ye(l.properties.labelCoord))):l.properties={},l},e.prototype.isSkipped=function(){return!(this.label&&(!this.properties||void 0===this.properties.skip))&&this.properties.skip},e}(),Ce=function(){function e(n){if(this.properties={},n){if(n.controlPoints){this.controlPoints=[];for(var l=0;l<n.controlPoints.length;++l)this.controlPoints[l]=new ye(n.controlPoints[l])}n.originalEdge&&(this.originalEdge=new e(n.originalEdge));for(var t=0,i=["from","to","drawMiddlePoint","properties","fromDbId"];t<i.length;t++){var o=i[t];o in n&&(this[o]=n[o])}}}return e.prototype.propagateToOriginal=function(){if(this.originalEdge)for(var e=0,n=["controlPoints","drawMiddlePoint"];e<n.length;e++){var l=n[e];l in this&&(this.originalEdge[l]=this[l])}},e}(),ke=function(){function e(e){if(this.params=e,this.renderer=e.renderer,this.defaultRadius=e.defaultRadius||6,this.icons={},this.defaultTextProp={fontSize:e.defaultFontSize||20,stroke:"rgba(255,255,255,.8)",fill:"#000000"},this.defaultEdgeProp=e.defaultEdgeProp||{lineWidth:1,lineColor:"#000000"},this.hideLabels=!!e.hideLabels,!this.renderer)throw new Error("TripGraphLayer: no renderer !");this.graph=e.graph||new we(void 0,this.defaultEdgeProp)}return e.prototype.draw=function(e,n,l,t){for(var i=this.graph,o=e.getContext("2d"),r=this.renderer.pixelRatio,a=0,s=i.edges;a<s.length;a++){var u=s[a];this.drawEdge(o,n,u,r,"curve")}for(var d=0,p=i.edges;d<p.length;d++){var u=p[d];this.drawEdge(o,n,u,r,"mark")}o.setLineDash([]);for(var c in i.nodes){var h=i.nodes[c];h.viewerPos=n.viewerPosFromWorldPos(h.coord)}for(var c in i.nodes){var h=i.nodes[c];this.drawNodePoint(o,n,h)}for(var c in i.nodes)if(!this.hideLabels||c.match(/-(takeoff)|(landing)$/)){var h=i.nodes[c];this.drawLeaderLine(o,n,h)}for(var c in i.nodes)if(!this.hideLabels||c.match(/-(takeoff)|(landing)$/)){var h=i.nodes[c];this.drawNodeLabel(o,n,h)}},e.prototype.drawEdge=function(e,n,l,t,i){this.setEdgeStrokeStyle(e,l),l.properties&&"route"==l.properties.geom?this.drawRoad(e,n,l,t,i):this.drawEdgeBezier(e,n,l,t,i)},e.prototype.drawRoad=function(e,n,l,t,i){var o=this,r=this.edgeProperty(l,"travelMean");if("curve"==i)if(l.properties&&"object"==typeof l.properties.route&&l.properties.route.mean==r){var a=l.properties.route.geom;e.beginPath();var s=n.viewerPosFromWorldPos(a[0]);e.moveTo(s.x,s.y);for(var u=1;u<a.length;++u){var d=n.viewerPosFromWorldPos(a[u]);e.lineTo(d.x,d.y)}e.stroke()}else l.properties||(l.properties={}),this.graph.getEdgeDirections(l,this.edgeProperty(l,"travelMean")).then(function(e){l.properties.route=e,o.renderer.refresh()}).catch(function(e){console.log(e)});else if("mark"==i&&l.properties&&l.properties.route&&l.properties.route.midpoint){var p=l.properties.route,s=new ye(n.viewerPosFromWorldPos(p.geom[0])),c=new ye(n.viewerPosFromWorldPos(p.geom[p.geom.length-1]));if(ye.dist(c,s)>80*t){var h=p.midpoint,f=h+Math.min(p.geom.length-1,Math.floor(.2*p.geom.length)),g=new ye(n.viewerPosFromWorldPos(p.geom[h])),m=new ye(n.viewerPosFromWorldPos(p.geom[f])),v=ye.minus(m,g),y=new ye(v.y,-v.x);this.drawEdgeMark(g,y,v,e,t,l,i)}}},e.prototype.drawEdgeBezier=function(e,n,l,t,i){for(var o=this.graph.bezier(l),r=0,a=o;r<a.length;r++){var s=a[r];this.drawBezier(e,n,s,t,l,i)}if("mark"!=i&&o.length>1&&l.drawMiddlePoint)for(var u in o){var d=n.viewerPosFromWorldPos(o[u].points[3]),p=5*t;e.beginPath(),e.arc(d.x,d.y,p,0,2*Math.PI,!1),e.fillStyle="#000000",e.fill()}},e.prototype.drawBezier=function(e,n,l,t,i,o){e.save();for(var r=new Array(8),a=l.points,s=0;s<4;++s){var u=n.viewerPosFromWorldPos(a[s]);r[2*s]=u.x,r[2*s+1]=u.y}var d=new Bezier(r),p=d.length(),c=Math.min(2,Math.floor(p/(40*t))),h=d.points;"mark"!=o&&(e.beginPath(),e.moveTo(h[0].x,h[0].y),e.bezierCurveTo(h[1].x,h[1].y,h[2].x,h[2].y,h[3].x,h[3].y),e.stroke());for(var f=1;f<c;++f){var g=f/c,u=new ye(d.get(g)),m=new ye(d.normal(g)),v=new ye(d.derivative(g));this.drawEdgeMark(u,m,v,e,t,i,o)}e.restore()},e.prototype.drawEdgeMark=function(n,l,t,i,o,r,a){switch(this.edgeProperty(r,"travelMean")){case"Bike":case"Boat":case"Bus":case"Car":case"Helicopter":case"Plane":case"Train":case"Walk":"curve"!=a&&this.drawEdgeMarkIcon(n,l,t,i,o,r);break;case"Unspecified":default:"mark"!=a&&e.drawEdgeMarkTriangle(n,l,t,i,o)}},e.drawEdgeMarkTriangle=function(e,n,l,t,i){var o=10*i;l.mul(o/l.norm()),e=ye.plus(e,ye.times(.5,l));var r=ye.minus(e,l);t.beginPath(),t.moveTo(r.x+o/2*n.x,r.y+o/2*n.y),t.lineTo(e.x,e.y),t.lineTo(r.x-o/2*n.x,r.y-o/2*n.y),t.closePath(),t.fill()},e.prototype.drawEdgeMarkIcon=function(e,n,l,t,i,o){t.fillStyle="#fff",t.setLineDash([]),t.lineWidth=1*i;var r=10*i,a=6*i;l=l.mul(1/l.norm());var s=ye.plus(e,ye.times((r+a)/2,l)),u=ye.minus(e,ye.times((r+a)/2,l)),d=ye.plus(u,ye.times(r,l)),p=new ye(-l.y,l.x).mul(4*i),c=ye.plus(d,p),h=ye.minus(d,p),f=ye.minus(c,u),g=Math.atan2(f.y,f.x),m=ye.minus(h,u),v=Math.atan2(m.y,m.x);t.beginPath(),t.arc(u.x,u.y,r,g,v),t.lineTo(s.x,s.y),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#000",t.textAlign="center",t.textBaseline="middle",t.font=Math.round(10*i)+"px FontAwesome";var y={Bike:"\uf206",Boat:"\uf21a",Bus:"\uf207",Car:"\uf1b9",Helicopter:"H",Plane:"\uf072",Train:"\uf238",Walk:"\uf183"},b=this.edgeProperty(o,"travelMean");t.fillText(y[b],u.x,u.y)},e.prototype.edgeProperty=function(e,n){return e.properties[n]||this.defaultEdgeProp[n]},e.prototype.setEdgeStrokeStyle=function(e,n){var l=this.edgeProperty(n,"lineColor");e.strokeStyle=l,e.fillStyle=l,e.lineWidth=this.renderer.pixelRatio*this.edgeProperty(n,"lineWidth"),this.setDashStyle(e,this.edgeProperty(n,"dashed"))},e.prototype.nodeRadius=function(e){var n=this.defaultRadius;return e.properties&&e.properties.radius&&(n=e.properties.radius),n*this.renderer.pixelRatio},e.prototype.drawNodePoint=function(e,n,l){if(!l.properties||0!=l.properties.point){var t=l.viewerPos;this.drawPoint(e,t,this.renderer.pixelRatio,l.properties||{})}},e.prototype.drawNodeLabel=function(n,l,t){var i=this;if(t.label||t.labelIcon){var o=l.viewerPosFromWorldPos(t.properties&&t.properties.labelCoord?t.properties.labelCoord:t.coord);if(t.label&&e.drawText(n,t.label,o,this.renderer.pixelRatio,t.properties||{},this.defaultTextProp),t.labelIcon)if(t.labelIcon.url in this.icons){if(void 0!=t.labelIcon.autorotate&&t.properties.labelCoord){var r=new ye(t.coord);t.labelIcon.angle=t.labelIcon.autorotate+Math.atan2(r.y-t.properties.labelCoord.y,r.x-t.properties.labelCoord.x)}e.drawIcon(n,this.icons[t.labelIcon.url],t.labelIcon,o,this.renderer.pixelRatio)}else this.loadIcons(function(){return i.renderer.refresh()});if(t.properties&&t.properties.frame&&t.label){var a=e.measureText(n,t.label,this.renderer.pixelRatio,t.properties||{},this.defaultTextProp);n.strokeStyle=t.properties.frame,a.width+=3*this.renderer.pixelRatio,a.height+=3*this.renderer.pixelRatio,n.rect(o.x-a.width/2,o.y-a.height/2,a.width,a.height),n.stroke()}}},e.prototype.setDashStyle=function(e,n){var l=[];if(n)for(var t=0,i=n;t<i.length;t++){var o=i[t];l.push(this.renderer.pixelRatio*o)}e.setLineDash(l)},e.prototype.drawLeaderLine=function(e,n,l){if(l.properties&&l.properties.leaderLineAnchor){var t=this.renderer.pixelRatio,i=n.viewerPosFromWorldPos(l.properties.leaderLineAnchor);e.lineWidth=(l.properties.leaderLineWidth||1)*t,e.beginPath();var o=n.viewerPosFromWorldPos(l.coord),r=this.nodeRadius(l),a=n.viewerPosFromWorldPos(be.closestPoint(new ye(l.coord),l.properties.labelBbox)),s=l.properties&&void 0!==l.properties.maxLeaderLineLength?l.properties.maxLeaderLineLength*t:3*r;ye.dist(a,o)>s&&(l.properties.dashed&&this.setDashStyle(e,l.properties.dashed),e.moveTo(i.x,i.y),e.lineTo(o.x,o.y),e.strokeStyle=l.properties.leaderLineColor||"#000000",e.stroke(),l.properties.dashed&&e.setLineDash([]))}},e.prototype.drawPoint=function(e,n,l,t){e.strokeStyle="rgba(0,0,0,1)",e.fillStyle="rgba(255,255,255,1)",e.lineWidth=2*l,e.beginPath();var i=(t.radius||this.defaultRadius)*l;e.arc(n.x,n.y,i,0,2*Math.PI,!1),e.stroke(),e.fill();var o=t.markStyle;!o&&t.firstVisited&&(o="first"),"first"===o&&(e.fillStyle="rgba(0, 0, 0, 1)",e.beginPath(),e.arc(n.x,n.y,.6*i,0,2*Math.PI,!1),e.fill())},e.measureText=function(n,l,t,i,o){var r=l.split("\n"),a=e.setTextStyle(n,t,i,o),s={width:0,height:a*r.length};for(var u in r)s.width=Math.max(s.width,n.measureText(r[u]).width);return s},e.setTextStyle=function(e,n,l,t){l=l||{};var i=l.fontSize||t.fontSize;return i*=n,e.font=i+"px "+(l.font||"'PT Sans', sans-serif"),e.strokeStyle=l.stroke||t.stroke,e.lineWidth=(l.haloWidth||4)*n,e.fillStyle=l.fill||t.fill,parseInt(""+i)},e.drawText=function(n,l,t,i,o,r){var a,s,u=(void 0!=o.textOffset?o.textOffset:20)*i,d=((o.textPlacement||"S")+"").toUpperCase();switch(d){default:case"C":case"N":case"S":n.textAlign="center",a=0;break;case"E":case"NE":n.textAlign="start",a=u;break;case"O":case"W":n.textAlign="end",a=-u}switch(d){case"C":case"E":case"W":case"O":n.textBaseline="middle",s=0;break;case"N":case"NE":n.textBaseline="bottom",s=-u;break;default:case"S":n.textBaseline="top",s=u}var p=t.x+a,c=t.y+s,h=e.setTextStyle(n,i,o,r),f=l.split("\n");n.shadowBlur=3*i,n.shadowColor="#ffffff",n.lineWidth=2*i;for(var g=(f.length-1)/2,m=0;m<f.length;++m){var v=c+(m-g)*h;n.strokeText(f[m],p,v),n.fillText(f[m],p,v)}n.shadowColor="transparent"},e.drawIcon=function(e,n,l,t,i){if(n){var o=l.width?l.width*i:16*i,r=l.height?l.height*i:o,a="ratioX"in l?l.ratioX:.5,s="ratioY"in l?l.ratioY:.5,u=o*a,d=r*s;l.angle?(e.save(),e.translate(t.x,t.y),e.rotate(l.angle),e.drawImage(n,-u,-d,o,r),e.restore()):e.drawImage(n,t.x-u,t.y-d,o,r)}},e.prototype.getLabelIconSize=function(e,n){var l=this.renderer.pixelRatio,t=n.labelIcon;return{width:(t.width||16)*l,height:(t.height||t.width||16)*l}},e.prototype.computeNodeSizeWithMargin=function(n,l){var t;if(l.label){var i=this.renderer.pixelRatio;t=e.measureText(n,l.label,i,l.properties,this.defaultTextProp)}else l.labelIcon&&(t=this.getLabelIconSize(n,l),t.width*=1.4,t.height*=1.4);if(!t)throw"no label and no labIcon for node";var o=2*this.renderer.pixelRatio;return t.width+=2*o,t.height+=2*o,t},e.prototype.setLabelBbox=function(e,n,l){if(e&&(e.label||e.labelIcon)&&e.properties&&e.properties.labelCoord){var t=this.renderer.pinchZoom;if(!l){var i=this.computeNodeSizeWithMargin(n,e),o=t.viewerPosFromWorldPos(e.properties.labelCoord);l={x:o.x,y:o.y,width:i.width,height:i.height}}if(!n){this.renderer.canvas.getContext("2d")}var r=e.properties,a=ye.times(.5,new ye(l.width,l.height));r.labelBbox=new be({min:t.worldPosFromViewerPos(ye.minus(l,a)),max:t.worldPosFromViewerPos(ye.plus(l,a))})}},e.prototype.nodeName=function(e){if(e.label)return e.label;if(e.labelIcon)return"icon:"+e.labelIcon.url;throw"no label and no labIcon for node"},e.prototype.placeLabels=function(e){var n=this.renderer.pinchZoom,l=this.renderer.pixelRatio,t=[],i=[];for(var o in this.graph.nodes){var r=this.graph.nodes[o];if(r.label||r.labelIcon){var a=n.viewerPosFromWorldPos(r.coord),s=this.defaultRadius;r.properties&&r.properties.radius&&(s=r.properties.radius),i.push({x:a.x,y:a.y,r:s*l});var u=this.computeNodeSizeWithMargin(e,r),d=this.nodeName(r),p=a;r.properties&&r.properties.userPlacement&&(p=n.viewerPosFromWorldPos(r.properties.userPlacement));var c={x:p.x,y:p.y,name:d,width:u.width,height:u.height,node:r,userPlacement:r.properties&&r.properties.userPlacement?p:void 0};t.push(c)}}var h=d3.labeler().label(t).anchor(i).width(this.renderer.canvas.width).height(this.renderer.canvas.height),f=h.alt_energy(),g=[],m=[],v=[];for(var y in this.graph.edges){var b=this.graph.bezier(this.graph.edges[y]);for(var o in b){var _=b[o];g.push(_);var w=_.bbox();m.push({min:n.viewerPosFromWorldPos(w.x.min,w.y.min),max:n.viewerPosFromWorldPos(w.x.max,w.y.max)});var P=_.getLUT(30),x=[];for(var C in P)x.push(n.viewerPosFromWorldPos(P[C]));v.push(x)}}h.alt_energy(function(e,n,l){var i=0,o=h.boxOfLabel(e),r=new be;r.addPoint(new ye(o.left,o.top)),r.addPoint(new ye(o.right,o.bottom));for(var a in g)if(be.overlaps(m[a],r)){var s=v[a];for(var u in s)r.contains(s[u])&&i++}var d=10*i+f(e),p=t[e].userPlacement;if(p){d+=ye.dist(p,t[e])}return d});h.start(5e3,1);for(var o in t){var k=t[o];k.node.properties||(k.node.properties={});var L=k.node.properties;L.labelCoord=n.worldPosFromViewerPos(k),this.setLabelBbox(k.node,e,k),we.placeLeaderLine(k.node),L.textPlacement="C",L.textOffset=0}},e.shallowCopy=function(e){var n,l=Object.create(Object.getPrototypeOf(e)),t=Object.getOwnPropertyNames(e);for(n=0;n<t.length;n++)Object.defineProperty(l,t[n],Object.getOwnPropertyDescriptor(e,t[n]));return l},e.prototype.forEachNode=function(e){for(var n in this.graph.nodes)e(this.graph.nodes[n])},e.prototype.loadIcons=function(e){var n=this;this.iconsToLoad=1,this.failedIcons=0;var l=function(){n.iconsToLoad--,e&&0===n.iconsToLoad&&(n.failedIcons>0?e(new Error(n.failedIcons+" icons failed to load.")):e())};this.forEachNode(function(e){if(e.labelIcon){var t=e.labelIcon.url;n.iconsToLoad++;var i=window.imageUrlPrefix||"";n.renderer.loadImage(i+e.labelIcon.url,function(e){n.icons[t]=e,l()},function(e){console.log("Failed to load: "+t+" (prefix: "+i+")"),n.failedIcons++,l()})}}),l()},e}(),Le=function(){function e(){this.reset()}return e.makePlaneIcon=function(e,n){var l=new xe;return l.name=n.dbid+"-"+e,l.labelIcon={url:"/ng-map/assets/plane.png",width:20,autorotate:Math.PI/2*("landing"===e?1:-1),ratioX:.5,ratioY:"landing"===e?0:1},l.coord=n.coord,l.properties={point:!1,leaderLine:"center",dashed:[5,3],leaderLineWidth:2,maxLeaderLineLength:2},l},e.prototype.places=function(){return this._tripData.places},e.prototype.stages=function(){return this._tripData.stages},e.prototype.setLocation=function(e){this._tripData.location=e},e.prototype.location=function(){return this._tripData.location},e.prototype.width_mm=function(){return this._tripData.width},e.prototype.height_mm=function(){return this._tripData.height},e.prototype.pageSizeName=function(){return this._tripData.pageSizeName},e.prototype.world=function(){return this._tripData.world||(this._tripData.world={}),this._tripData.world},e.prototype.setSize=function(e,n,l){this._tripData.width=n,this._tripData.height=l,this._tripData.pageSizeName=e},e.prototype.defaultRadius=function(){return this._tripData.defaultRadius},e.prototype.defaultTextProp=function(){return this._tripData.defaultTextProp||(this._tripData.defaultTextProp={}),this._tripData.defaultTextProp},e.prototype.defaultEdgeProp=function(){return this._tripData.defaultEdgeProp||(this._tripData.defaultEdgeProp=e.defaultTrip().defaultEdgeProp),this._tripData.defaultEdgeProp},e.prototype.reset=function(){this._tripData=e.defaultTrip()},e.defaultTrip=function(){return{places:[],stages:[],additionalPlaces:[],location:{x:.5,y:.5,scale:1/8},defaultRadius:8,width:128,height:190,pageSizeName:"Full page",borderColor:"#fefefe",landColor:"#cecece",seaColor:"#c4e3ff",showRivers:!1,world:{},defaultTextProp:{fontSize:12,font:"'PT Sans', sans-serif",stroke:"rgba(255,255,255,.8)",fill:"#000000"},defaultEdgeProp:{lineWidth:2,lineColor:"#000000",geom:"straight"}}},e.prototype.setPlaces=function(e){this._tripData.places.splice.apply(this._tripData.places,[0,this._tripData.places.length].concat(e)),this.updateStages(),this.updateLandingsAndTakeoff()},e.prototype.stagesAsDict=function(){for(var e={},n=0,l=this._tripData.stages;n<l.length;n++){var t=l[n];t.from in e||(e[t.from]={}),e[t.from][t.to]=t}return e},e.prototype.updateStages=function(){for(var e=this._tripData.places,n=e.length-1,l=(this._tripData.stages,[]),t=this.stagesAsDict(),i=1;i<=n;++i){var o=e[i-1].dbid,r=e[i].dbid;if(t[o]&&t[o][r]){var a=t[o][r];a.to=e[i].name,l.push(a)}else l.push(new Ce({from:e[i-1].name,to:e[i].name,fromDbId:o,controlPoints:we.generateControlPoints(i>=2?e[i-2].coord:void 0,e[i-1].coord,e[i].coord,i+1<e.length?e[i+1].coord:void 0)}))}this._tripData.stages.splice.apply(this._tripData.stages,[0,this._tripData.stages.length].concat(l))},e.prototype.updateLandingsAndTakeoff=function(){for(var n={},l=this._tripData.additionalPlaces,t=0;t<l.length;++t)n[l[t].name]=t;for(var i=[],o={},r={},a=["landing","takeoff"],s=0,u=this._tripData.places;s<u.length;s++)for(var d=u[s],p=0,c=a;p<c.length;p++){var h=c[p],f=d.dbid+"-"+h;r[f]=!0,d.properties[h]?f in n||i.push(e.makePlaneIcon(h,d)):f in n&&(o[f]=!0)}var g=/-(landing|takeoff)$/,m=l.filter(function(e){return!(e.name in o)&&(e.name in r||null==e.name.match(g))}).concat(i);this._tripData.additionalPlaces.splice.apply(this._tripData.additionalPlaces,[0,this._tripData.additionalPlaces.length].concat(m))},e.prototype.nodeRadius=function(e,n){var l=this._tripData.defaultRadius;return e.properties&&e.properties.radius&&(l=e.properties.radius),l*n},e.prototype.makeGraph=function(e){for(var n={},l=(function(e){for(var l=e;l in n;)l=n[l];return l}),t=0,i=this._tripData.places;t<i.length;t++){var o=i[t];if(!o.name)throw new Error("nodes should have names and labels")}var r=[];if(e){for(var a=e.renderer.pinchZoom,s=e.renderer.pixelRatio,u=0,d=this._tripData.places;u<d.length;u++){var p=d[u];p.viewerPos=a.viewerPosFromWorldPos(p.coord)}for(var c=0,h=this._tripData.places;c<h.length;c++){var p=h[c];if(!(!p.label||p.properties&&p.properties.skip)){for(var f=this.nodeRadius(p,s),g=!0,m=0;m<r.length;++m){var o=r[m];if(ye.dist(o.viewerPos,p.viewerPos)<this.nodeRadius(o,s)+f){r[m]=function(e,l){var t=xe.parse(e);t.name=e.name+","+l.name,t.allPlaces=e.allPlaces.concat([l]);var i=e.label.split("\n");return i.indexOf(l.label)<0&&i.push(l.label),t.label=i.join("\n"),n[e.name]=n[l.name]=t.name,t}(o,p),g=!1;break}}if(g){p.properties||(p.properties={});var v=xe.parse(p);v.place=p,v.allPlaces=[p],r.push(v)}}}}else for(var y=0,b=this._tripData.places;y<b.length;y++){var p=b[y],v=xe.parse(p);v.place=p,v.allPlaces=[p],r.push(v)}for(var _=this._tripData.places,w={},m=0;m<_.length;++m){var o=_[m];w[o.name]=m}for(var P=new we(void 0,this._tripData.defaultEdgeProp),x=0,C=r;x<C.length;x++){var o=C[x];P.nodes[o.name]=o}this.updateLandingsAndTakeoff();for(var k=0,L=this._tripData.additionalPlaces;k<L.length;k++){var o=L[k];P.nodes[o.name]=o}for(var T=0,M=this._tripData.stages;T<M.length;T++){var S=M[T];if(!S.properties.hidden&&!_[w[S.from]].isSkipped()){for(var R=l(S.from),D=w[S.to];D<_.length&&_[D].isSkipped();)++D;if(!(D>=_.length||_[D].isSkipped())){var E=l(_[D].name);if(R!==E){var z=ke.shallowCopy(S);z.from=R,z.to=E,z.originalEdge=S,P.edges.push(z)}}}}return P},e.prototype.save=function(){return this._tripData},e.prototype.load=function(e){if(!e||!e.places||!e.stages)throw new Error("no data");var n=e,l=function(e){for(var n=0;n<e.length;++n)e[n]=xe.parse(e[n])};l(n.places);for(var t=n.stages,i=0;i<t.length;++i)t[i]=new Ce(t[i]);l(n.additionalPlaces),this._tripData=n,this.defaultEdgeProp(),this.setSize(e.pageSizeName,e.width,e.height)},e.prototype.seaColor=function(){return this._tripData.seaColor},e.prototype.setSeaColor=function(e){this._tripData.seaColor=e},e.prototype.landColor=function(){return this._tripData.landColor},e.prototype.setLandColor=function(e){this._tripData.landColor=e},e.prototype.borderColor=function(){return this._tripData.borderColor},e.prototype.setBorderColor=function(e){this._tripData.borderColor=e},e.prototype.showRivers=function(){return this._tripData.showRivers},e.prototype.toggleShowRiver=function(){this._tripData.showRivers=!this._tripData.showRivers},e.prototype.placeByName=function(e){for(var n=0,l=this._tripData.places;n<l.length;n++){var t=l[n];if(e===t.name)return t}},e.prototype.markFirstLocation=function(){for(var e=!0,n=0,l=this._tripData.places;n<l.length;n++){var t=l[n];!t.label||t.properties&&t.properties.skip||(e?t.properties.firstVisited=!0:"firstVisited"in t.properties&&delete t.properties.firstVisited,e=!1)}},e.prototype.clearUserPlacements=function(){for(var e=0,n=this._tripData.additionalPlaces.concat(this._tripData.places);e<n.length;e++){var l=n[e];l.properties&&l.properties.userPlacement&&delete l.properties.userPlacement}},e.prototype.saveUserPlacements=function(){for(var e=0,n=this._tripData.additionalPlaces.concat(this._tripData.places);e<n.length;e++){var l=n[e];l.properties||(l.properties={}),l.properties.labelCoord&&(l.properties.userPlacement=l.properties.labelCoord)}},e}(),Te=function(){function e(e,n,l){this.name=e,this.width_mm=n,this.height_mm=l}return e.fromPt=function(n,l,t){return new e(n,l/e.mmToPoint,t/e.mmToPoint)},e.prototype.widthPt=function(){return Math.round(this.width_mm*e.mmToPoint)},e.prototype.heightPt=function(){return Math.round(this.height_mm*e.mmToPoint)},e.prototype.key=function(){return Math.round(this.width_mm)+"x"+Math.round(this.height_mm)},e}();Te.mmToPoint=2.83465;var Me;!function(e){e[e.Location=1]="Location",e[e.Node=2]="Node",e[e.NodeStyle=3]="NodeStyle",e[e.Edge=4]="Edge",e[e.PageSize=5]="PageSize",e[e.MapColor=6]="MapColor",e[e.Frame=7]="Frame",e[e.LabelMoved=8]="LabelMoved",e[e.CurveMoved=9]="CurveMoved",e[e.Label=10]="Label",e[e.LabelProperties=11]="LabelProperties",e[e.EdgeProperties=12]="EdgeProperties",e[e.UpdatedLocations=13]="UpdatedLocations"}(Me||(Me={}));var Se=function(){function e(e){this.http=e,this._cssserviceUrl=window.cssserviceUrl||"https://destinationbook-cssservice.herokuapp.com/",this._canvasWidth=512,this._canvasHeight=512,this._selectedCountry="",this._loadingMap=!1,this._autoLockMap=!0;this._pageSizes=[new Te("Full page",128,190),new Te("Full page rotated",190,128),new Te("Square",128,128),new Te("Landscape",128,95)],this._pageSizeMap={};for(var n=0,l=this._pageSizes;n<l.length;n++){var t=l[n];this._pageSizeMap[t.key()]=t}this._numLocations=0,this._showSpinner=!1,this._seqTrip=new Le,this._graph=new we(void 0,this._seqTrip.defaultEdgeProp()),this._tripLayer&&(this._tripLayer.defaultTextProp=this._seqTrip.defaultTextProp(),this._tripLayer.defaultEdgeProp=this._seqTrip.defaultEdgeProp()),this._visitedPlaceList=this._seqTrip.places(),this._stages=this._seqTrip.stages(),this._interleaved=this.interleavedPlacesAndEvents(),this.setPageSize(this._pageSizes[0].key())}return e.prototype.fetchRawLocations=function(){var e=this;return this._numLocations=0,new Promise(function(n,l){e.http.get(thisTripApi.locationsUrl,{responseType:"json"}).subscribe(function(t){Array.isArray(t)?(e._numLocations=t.length,n(t)):l("bad map data")},function(e){l(e)})})},e.prototype.translateLocations=function(e){var n=this;return new Promise(function(l,t){for(var i in e)e[i].translations&&e[i].translations[thisTripApi.tripLanguage]?e[i].label=e[i].translations[thisTripApi.tripLanguage]:e[i].translations&&e[i].translations.en&&(e[i].label=e[i].translations.en);var o=e.filter(function(e){return e.geoname_id&&!e.translations}).map(function(e){return e.geoname_id});if(0==o.length)return void l(e);var r=n._cssserviceUrl+"location?q="+o.join(",")+"&l="+thisTripApi.tripLanguage;n.http.get(r,{responseType:"json"}).subscribe(function(n){if(!n||!Array.isArray(n))return void l(e);for(var t={},i=0,o=n;i<o.length;i++){var r=o[i];t[r.id]=r}for(var a=0,s=e;a<s.length;a++){var u=s[a];u.geoname_id&&u.geoname_id in t&&t[u.geoname_id].name&&(u.label=t[u.geoname_id].name)}return l(e)},function(e){t(e)})})},e.prototype.fetchLocations=function(){var e=this;return this.fetchRawLocations().then(function(n){return e.translateLocations(n)})},e.prototype.generateFromLocations=function(e){this._seqTrip.reset(),this.updateWithLocations(e,{resetLocation:!0}),this._tripLayer&&(this._tripLayer.defaultTextProp=this._seqTrip.defaultTextProp(),this._tripLayer.defaultEdgeProp=this._seqTrip.defaultEdgeProp()),this.saveMap()},e.prototype.updateWithLocations=function(e,n){n=n||{};for(var l={},t=0,i=this._seqTrip.places();t<i.length;t++){var o=i[t];"dbid"in o&&(l[o.dbid]=o)}for(var r=[],a=0,s=0,u=e;s<u.length;s++){var d=u[s],p=function(e,n){var l=Utils.latLonToWorld([n,e]);return new ye(l)}(d.latitude,d.longitude),c=""+d.id;if(c in l){var h=l[c];h.coord=p,h.label&&!n.resetLabels||(h.label=d.label),r.push(h)}else r.push(xe.parse({dbid:c,name:c,label:d.label,coord:p})),++a}this._seqTrip.setPlaces(r),n.resetLocation&&this._seqTrip.setLocation(this._seqTrip.makeGraph().location(this._seqTrip.width_mm()/this._seqTrip.height_mm(),1.2)),this._visitedPlaceList=this._seqTrip.places(),this._stages=this._seqTrip.stages(),this._interleaved=this.interleavedPlacesAndEvents(),this.pushSeqTripToCanvas(n.resetLocation),a>0&&this.placeLabels()},e.prototype.destination=function(e){return this._tripLayer&&e.to in this._tripLayer.graph.nodes?this._tripLayer.graph.nodes[e.to]:this._seqTrip.placeByName(e.to)},e.prototype.origin=function(e){return this._tripLayer&&e.from in this._tripLayer.graph.nodes?this._tripLayer.graph.nodes[e.from]:this._seqTrip.placeByName(e.from)},e.prototype.ngOnInit=function(){this.loadMap()},e.prototype.pushSeqTripToCanvas=function(e){for(var n=0,l=["seaColor","borderColor","landColor","showRivers"];n<l.length;n++);var t=new Te(this._seqTrip.pageSizeName(),this._seqTrip.width_mm(),this._seqTrip.height_mm());this._pageSizeMap[t.key()]||(this._pageSizeMap[t.key()]=t,this._pageSizes.push(t)),this.setPageSize(t.key(),!1),this._renderer&&(this._renderer.setLocation(this._seqTrip.location()),this._graph=this.mapview.setSeqTrip(this._seqTrip)),this.clearSelection(),!0===e?this.reset():this.makeGraph()},e.prototype.ngAfterViewInit=function(){},e.prototype.scale=function(){var e=this._seqTrip.location();return Math.log2(1/e.scale)},e.prototype.setScale=function(e){var n=this,l=this._renderer;if(l){var t=l.getLocation();t.scale=1/Math.pow(2,e),l.setLocation(t),this._seqTrip.setLocation(this._renderer.getLocation()),this.modified(Me.Location),this._scaleChangeTimeout&&clearTimeout(this._scaleChangeTimeout),this._scaleChangeTimeout=setTimeout(function(){n.placeLabels()},800)}},e.prototype.prepareCanvas=function(e){var n=this;this.mapview.prepareCanvas({graph:this._graph,onLocationChange:function(e){if(!n._loadingMap&&n._seqTrip&&n._tripLayer&&n._editor){var l=e.getLocation(),t=n._seqTrip.makeGraph(n._tripLayer);t.compareNodes(n._tripLayer.graph)?n._seqTrip.setLocation(l):(n._graph=t,n._tripLayer.graph=t,n._editor.graph=t,n.autoPlaceLabels()),n.modified(Me.Location)}},alreadyCreated:function(n){e&&e()},created:function(l,t){n._renderer=l,n._tripLayer=t,setTimeout(function(){n.clearSelection(),n._editor=new Pe(n._renderer,n._graph,t),n._renderer.pinchZoom.touchEventHandlers.push(n._editor),n._editor.onLabelMoved=function(e){n.modified(Me.LabelMoved)},n._editor.onBezierMoved=function(e){n.modified(Me.CurveMoved)},n._editor.onLabelSelect=function(e){n.selectNode(e)},n._editor.onBezierSelect=function(e){e?n.selectEdge(e.edge):n.clearSelection()},n.pushSeqTripToCanvas(),n.mapview.resize(),e&&e()},10)}})},e.prototype.mapIsLocked=function(){return this._renderer&&this._renderer.pinchZoom&&this._renderer.pinchZoom.locked},e.prototype.lockMap=function(e){this._renderer&&this._renderer.pinchZoom&&(this._renderer.pinchZoom.locked=e&&this._autoLockMap)},e.prototype.ngOnDestroy=function(){this._autoRefresh&&clearInterval(this._autoRefresh)},e.prototype.clearSelection=function(){this._selectedCountry=void 0,this._selectedNode=void 0,this._selectedEdge=void 0},e.prototype.clearAndSaveSelection=function(){var e={_selectedCountry:this._selectedCountry,_selectedNode:this._selectedNode,_selectedEdge:this._selectedEdge};return this.clearSelection(),e},e.prototype.restoreSelection=function(e){this._selectedCountry=e._selectedCountry,this._selectedNode=e._selectedNode,this._selectedEdge=e._selectedEdge},e.prototype.selectCountry=function(e){this.clearSelection(),this._selectedCountry=e,this.setCountryColor(e,this.countryColor(e))},e.prototype.setCountryColor=function(e,n){if(e){var l,t="default"==n,i=!1;l?t?(i=!!l.color,delete l.color,0==Object.keys(l).length&&delete this._worldLayer.params.countryStyle[e]):(i=l.color!==n,l.color=n):t||(i=!0,l=this._worldLayer.params.countryStyle[e]={color:n}),i&&this.modified(Me.MapColor)}},e.prototype.countryColor=function(e){return this._worldLayer&&this._worldLayer.params.countryStyle[e]&&this._worldLayer.params.countryStyle[e].color?this._worldLayer.params.countryStyle[e].color:this._seqTrip.landColor()},e.prototype.tunedCountries=function(){return this._worldLayer?Object.keys(this._worldLayer.params.countryStyle):[]},e.prototype.selectNode=function(e){if(this.clearSelection(),e&&(e.properties||(e.properties={}),e.name in this._graph.nodes&&(this._selectedNode=this._graph.nodes[e.name]),e!==this._editor.selectedLabel)){var n=this._editor.onLabelSelect,l=this._editor.onBezierSelect;this._editor.onLabelSelect=function(){},this._editor.onBezierSelect=function(){},e.name in this._editor.graph.nodes?this._editor.selectLabel(e):this._editor.deselectLabel(),this._editor.onLabelSelect=n,this._editor.onBezierSelect=l}},e.prototype.selectEdge=function(e){this.clearSelection(),this._selectedEdge=e},e.prototype.nodeNames=function(){return Object.keys(this._graph.nodes)},e.prototype.nodeArray=function(){for(var e=[],n=0,l=Object.keys(this._graph.nodes);n<l.length;n++){var t=l[n];e.push(this._graph.nodes[t])}return e},e.prototype.isSkipped=function(e){return!(!e.properties||void 0===e.properties.skip)&&e.properties.skip},e.prototype.toggleHideEdge=function(e){if(e.properties.hidden){delete e.properties.hidden;for(var n=0,l=this._visitedPlaceList;n<l.length;n++){var t=l[n];t.name!=e.from&&t.name!=e.to||!this.isSkipped(t)||this.toggleSkipNode(t)}}else e.properties.hidden=!0;this.modified(Me.Edge)},e.prototype.toggleSkipNode=function(e){if(this.isSkipped(e))delete e.properties.skip;else{e.properties?e.properties.skip=!0:e.properties={skip:!0};for(var n=0,l=this._stages;n<l.length;n++){var t=l[n];t.from!=e.name&&t.to!=e.name||(t.properties.hidden=!0)}}this._seqTrip.markFirstLocation(),this.modified(Me.Node)},e.prototype.toggleProperty=function(e,n){e.properties[n]=!e.properties[n],this.modified(Me.Node)},e.prototype.setProperty=function(e,n,l,t){void 0!==l?e.properties[n]=l:n in e.properties&&delete e.properties[n],this._seqTrip.markFirstLocation(),this.modified(Me.NodeStyle)},e.prototype.setNodeLabel=function(e,n){var l=e.label;if(l!==n){e.label=n;var t=this._graph;for(var i in t.nodes){var o=t.nodes[i];(o.place===e||o.allPlaces.indexOf(e)>=0)&&(o.label=o.label.replace(l,n))}this.modified(Me.Label)}},e.prototype.removeEdge=function(e){var n=function(n){return n.from!==e.from||n.to!==e.to};this._graph.edges=this._graph.edges.filter(n),this._editor.graph.edges=this._editor.graph.edges.filter(n)},e.prototype.uiSetFrame=function(e,n){this.setFrame(e,n),this.modified(Me.Frame),this.autoPlaceLabels()},e.prototype.setFrame=function(e,n){if(this._renderer){var l=this._canvasWidth,t=this._canvasHeight,i=this._seqTrip.makeGraph().location(l/t,1.2);this._seqTrip.setLocation(i),this._renderer.setLocation(i)}},e.prototype.setMapboxLocation=function(e){this.mapview.setMapboxLocation(e)},e.prototype.getLocation=function(){return this._renderer.getLocation()},e.prototype.autoPlaceLabels=function(){this._seqTrip.clearUserPlacements(),this.placeLabels()},e.prototype.placeLabels=function(){var e=this;this._tripLayer&&this._renderer&&this._seqTrip&&this.runBlockingTask(function(n){e._tripLayer.placeLabels(e._renderer.canvas.getContext("2d")),e._seqTrip.saveUserPlacements(),e.modified(Me.LabelMoved),e._renderer.refresh(),n()})},e.prototype.runBlockingTask=function(e){var n=this;this._showSpinner=!0,setTimeout(function(){try{e(function(){n._showSpinner=!1})}catch(e){n._showSpinner=!1,console.log(e)}},30)},e.prototype.update=function(){this.placeLabels()},e.prototype.resetCurves=function(){this._graph.createDefaultBezier();var e=this._seqTrip.makeGraph(this._tripLayer);this._graph=e,this._tripLayer.graph=e,this._editor.graph=e,this._tripLayer.placeLabels(this._renderer.canvas.getContext("2d")),this._renderer.refresh()},e.prototype.makeGraph=function(){this._graph=this._seqTrip.makeGraph(this._tripLayer),this._tripLayer&&(this._tripLayer.graph=this._graph),this._editor&&(this._editor.graph=this._graph)},e.prototype.recreate=function(){this._visitedPlaceList.length&&(this.makeGraph(),this.placeLabels())},e.prototype.reset=function(){this._visitedPlaceList.length&&(this.makeGraph(),this.setFrame(),this.placeLabels())},e.prototype.uiSetPageSize=function(e,n){this.setPageSize(e,n),this.modified(Me.PageSize)},e.prototype.setPageSize=function(e,n){var l=this,t=this._pageSizeMap[e];t&&(this._pageSizeName=e,this._canvasWidth=t.widthPt(),this._canvasHeight=t.heightPt(),this._seqTrip.setSize(t.name,t.width_mm,t.height_mm),!1!==n&&(this.setFrame(this._canvasWidth,this._canvasHeight),setTimeout(function(){l.placeLabels()},20))),this.mapview&&setTimeout(function(){l.mapview.resize()},0)},e.prototype.setLayerColors=function(){this.mapview.setLayerColors(this._seqTrip)},e.prototype.setSeaColor=function(e){e!=this._seqTrip.seaColor()&&(this._seqTrip.setSeaColor(e),this.setLayerColors(),this.modified(Me.MapColor))},e.prototype.setBorderColor=function(e){e!=this._seqTrip.borderColor()&&(this._seqTrip.setBorderColor(e),this.setLayerColors(),this.modified(Me.MapColor))},e.prototype.setLandColor=function(e){e!=this._seqTrip.landColor()&&(this._seqTrip.setLandColor(e),this.setLayerColors(),this.modified(Me.MapColor))},e.prototype.toggleShowRiver=function(){this._seqTrip.toggleShowRiver(),this._worldLayer.params.showRivers=this._seqTrip.showRivers(),this.modified(Me.MapColor)},e.prototype.fetchMap=function(){var e=this;return new Promise(function(n,l){e.http.get(thisTripApi.mapUrl,{responseType:"json"}).subscribe(function(e){n(e)},function(e){l(e)})})},e.prototype.loadMap=function(){var e=this;this._loadingMap=!0,this.fetchMap().then(function(n){try{return e._seqTrip.load(n),e._saved=!0,e._visitedPlaceList=e._seqTrip.places(),e._stages=e._seqTrip.stages(),e._interleaved=e.interleavedPlacesAndEvents(),e.prepareCanvas(),e.fetchLocations().then(function(n){e.updateWithLocations(n)}).catch(function(n){e._loadingMap=!1,e.handleError(n)})}catch(n){return e.fetchLocationsAndGenerateMap()}}).then(function(){setTimeout(function(){e._loadingMap=!1,e.modified(Me.UpdatedLocations)},100)}).catch(function(n){e._loadingMap=!1,e.handleError(n)})},e.prototype.fetchLocationsAndGenerateMap=function(){var e=this;return this.fetchLocations().then(function(n){n.length>0&&(e.generateFromLocations(n),e.prepareCanvas())})},e.prototype.saveMap=function(){var e=this,n=this.clearAndSaveSelection();if(this._editor&&this._editor.deselectLabel(),this._graph)for(var l=0,t=this._graph.edges;l<t.length;l++){var i=t[l];i.propagateToOriginal()}$.ajax({type:"PUT",url:thisTripApi.mapUrl,dataType:"text",contentType:"application/json",data:JSON.stringify({_method:"PUT",map_data:JSON.stringify(this._seqTrip.save())}),success:function(){e._saved=!0,e._errorMessage=void 0},error:function(n,l,t){e.handleError("Error: Can't save map. Please check your internet connection.")}}),this.restoreSelection(n)},e.prototype.handleError=function(e){var n=""+("message"in e?e.message:e);console.error(e),this._infoMessage=void 0,this._errorMessage=n},e.prototype.nodePropertiesChanged=function(){this.modified(Me.LabelProperties),this.modified(Me.NodeStyle)},e.prototype.edgePropertiesChanged=function(e){this.modified(Me.EdgeProperties)},e.prototype.modified=function(e){var n=this;if(!this._loadingMap){switch(this._saved=!1,e){case Me.UpdatedLocations:case Me.LabelMoved:case Me.CurveMoved:case Me.Location:break;case Me.NodeStyle:case Me.Label:case Me.LabelProperties:case Me.EdgeProperties:case Me.MapColor:this._renderer.refreshIfNotMoving();break;case Me.Node:case Me.Edge:case Me.Frame:this.recreate();break;case Me.PageSize:}this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(function(){n._loadingMap||n.saveMap()},500)}},e.prototype.interleavedPlacesAndEvents=function(){for(var e=[],n=this._seqTrip.stagesAsDict(),l={},t=this._visitedPlaceList,i=t.length-1,o=0;o<t.length;++o){var r=t[o],a=void 0;o<i&&(a=t[o+1].dbid,r.dbid===a)||(!function(n){n.dbid in l?e.push({node:l[n.dbid]}):(l[n.dbid]=n,e.push({node:n}))}(r),void 0!==a&&(r.dbid in n&&a in n[r.dbid]?e.push({edge:n[r.dbid][a]}):console.log("No edge from "+r.dbid+" to "+a)))}return e},e.prototype.download=function(e){var n=this,l=function(e){return Math.round(Math.pow(36,e+1)-Math.random()*Math.pow(36,e)).toString(36).slice(1)}(16),t=this._cssserviceUrl+"mapgen/"+l,i=t+"/"+e;this.http.post(t,JSON.stringify(this._seqTrip.save()),{headers:new ve.g({"content-type":"application/json"})}).subscribe(function(e){window.open(i)},function(e){console.log(e),n.handleError(e.message)})},e.prototype.resetNodeToDefault=function(e){for(var n=0,l=Object.keys(e.properties);n<l.length;n++){var t=l[n];"firstVisited"!=t&&delete e.properties[t]}this._seqTrip.markFirstLocation(),this.modified(Me.Node)},e.prototype.resetLabels=function(){var e=this;this.fetchLocations().then(function(n){e.updateWithLocations(n,{resetLabels:!0})}),this.modified(Me.Label)},e.prototype.doSomething=function(e){!this._loadingMap&&this._numLocations>0&&!this._saved&&(e.returnValue="Your data will be lost!")},e.ctorParameters=function(){return[{type:ve.c}]},e}(),Re=l("Fw80"),De=l("Djd0"),Ee=l("pYHX"),ze=l("DmCJ"),Oe={CanvasTilesRenderer:CanvasTilesRenderer,PinchZoom:PinchZoom,Utils:Utils},Ie="e7trAnc5053j8mX60MlQ",je={glyphs:"https://maps.tilehosting.com/fonts/{fontstack}/{range}.pbf?key="+Ie,id:"topo",layers:[{id:"background",layout:{visibility:"visible"},minzoom:0,paint:{"background-color":"rgba(232, 230, 223, 1)"},type:"background"},{filter:["any",["==","subclass","park"],["==","subclass","village_green"],["==","class","grass"],["==","class","farmland"]],id:"landcover_grass",layout:{visibility:"visible"},maxzoom:22,metadata:{},minzoom:9,paint:{"fill-antialias":!1,"fill-color":"rgba(222, 226, 191, 1)","fill-opacity":.6},source:"openmaptiles","source-layer":"landcover",type:"fill"},{filter:["all",["==","class","wood"]],id:"landcover_wood",layout:{visibility:"visible"},maxzoom:22,metadata:{},minzoom:9,paint:{"fill-antialias":!1,"fill-color":"rgba(191, 202, 155, 1)","fill-opacity":1},source:"openmaptiles","source-layer":"landcover",type:"fill"},{filter:["all",["==","class","ice"]],id:"landcover_ice",layout:{visibility:"visible"},maxzoom:22,metadata:{},minzoom:9,paint:{"fill-antialias":!1,"fill-color":"rgba(255, 255, 255, 1)","fill-opacity":1},source:"openmaptiles","source-layer":"landcover",type:"fill"},{filter:["all",["in","class","sand"]],id:"landcover_sand",metadata:{},paint:{"fill-antialias":!1,"fill-color":"rgba(232, 214, 38, 1)","fill-opacity":.3},source:"openmaptiles","source-layer":"landcover",type:"fill"},{filter:["all",["==","class","grass"]],id:"globallandcover_grass",layout:{visibility:"visible"},maxzoom:9,minzoom:0,paint:{"fill-color":"rgba(222, 226, 191, 1)","fill-opacity":{stops:[[8,.6],[9,.2]]}},source:"landcover","source-layer":"globallandcover",type:"fill"},{filter:["all",["==","class","scrub"]],id:"globallandcover_scrub",layout:{visibility:"visible"},maxzoom:9,minzoom:0,paint:{"fill-color":"rgba(202, 214, 166, 1)","fill-opacity":1},source:"landcover","source-layer":"globallandcover",type:"fill"},{filter:["all",["==","class","tree"]],id:"globallandcover_tree",layout:{visibility:"visible"},maxzoom:9,minzoom:0,paint:{"fill-color":"rgba(191, 202, 155, 1)","fill-opacity":1},source:"landcover","source-layer":"globallandcover",type:"fill"},{filter:["all",["==","class","forest"]],id:"globallandcover_forest",layout:{visibility:"visible"},maxzoom:9,minzoom:0,paint:{"fill-color":"rgba(191, 202, 155, 1)","fill-opacity":1},source:"landcover","source-layer":"globallandcover",type:"fill"},{filter:["all",["==","class","snow"]],id:"globallandcover_ice",layout:{visibility:"visible"},maxzoom:9,minzoom:0,paint:{"fill-color":"rgba(255, 255, 255, 1)","fill-opacity":1},source:"landcover","source-layer":"globallandcover",type:"fill"},{filter:["all",["==","$type","Polygon"],["==","class","residential"]],id:"landuse-residential",layout:{visibility:"visible"},maxzoom:16,paint:{"fill-color":"rgba(191, 186, 171, 1)","fill-opacity":{stops:[[8,.4],[9,.1],[9.1,.4]]}},source:"openmaptiles","source-layer":"landuse",type:"fill"},{filter:["any",["==","class","industrial"],["==","class","commercial"],["==","class","retail"],["==","class","stadium"],["==","class","college"],["==","class","university"],["==","class","school"]],id:"landuse_industrial_school",layout:{visibility:"visible"},maxzoom:22,metadata:{},minzoom:10,paint:{"fill-color":{stops:[[12,"rgba(179, 179, 179, 1)"],[16,"rgba(232, 230, 223, 1)"]]},"fill-opacity":.5},source:"openmaptiles","source-layer":"landuse",type:"fill"},{filter:["==","class","cemetery"],id:"landuse_cemetery",layout:{visibility:"visible"},maxzoom:22,metadata:{},minzoom:10,paint:{"fill-color":"rgba(175, 169, 157, 1)","fill-opacity":.5},source:"openmaptiles","source-layer":"landuse",type:"fill"},{filter:["==","class","hospital"],id:"landuse_hospital",layout:{visibility:"visible"},maxzoom:22,metadata:{},minzoom:10,paint:{"fill-color":"rgba(236, 224, 231, 1)","fill-opacity":.5},source:"openmaptiles","source-layer":"landuse",type:"fill"},{id:"hillshading",layout:{visibility:"visible"},paint:{"raster-contrast":0,"raster-fade-duration":300,"raster-opacity":{base:.5,stops:[[3,0],[5,.15],[12,.15]]}},source:"hillshading",type:"raster"},{filter:["all",[">","height",0],["in","nth_line",10,5]],id:"contour_index",layout:{visibility:"visible"},paint:{"line-color":"rgba(181, 129, 100, 1)","line-opacity":{stops:[[7,.2],[10,.6]]},"line-width":1.3},source:"contours","source-layer":"contour",type:"line"},{filter:["all",["!in","nth_line",10,5],[">","height",0]],id:"contour",layout:{visibility:"visible"},paint:{"line-color":"rgba(181, 129, 100, 1)","line-opacity":.5,"line-width":.8},source:"contours","source-layer":"contour",type:"line"},{filter:["all",["==","brunnel","tunnel"]],id:"waterway_tunnel",layout:{"line-cap":"round"},minzoom:14,paint:{"line-color":"rgba(103, 166, 196, 1)","line-dasharray":[2,4],"line-width":{base:1.3,stops:[[13,.5],[20,6]]}},source:"openmaptiles","source-layer":"waterway",type:"line"},{filter:["all",["==","class","river"],["!=","brunnel","tunnel"]],id:"waterway_river",layout:{"line-cap":"round",visibility:"visible"},metadata:{},paint:{"line-color":{stops:[[6,"rgba(103, 166, 196, 1)"],[8,"rgba(196, 229, 236, 1)"],[9,"rgba(103, 166, 196, 1)"]]},"line-width":{base:1.2,stops:[[11,1],[20,18]]}},source:"openmaptiles","source-layer":"waterway",type:"line"},{filter:["all",["!=","class","river"],["!=","brunnel","tunnel"]],id:"waterway_other",layout:{"line-cap":"butt",visibility:"visible"},metadata:{},paint:{"line-color":"rgba(103, 166, 196, 1)","line-width":{base:1.3,stops:[[13,.5],[20,12]]}},source:"openmaptiles","source-layer":"waterway",type:"line"},{filter:["all"],id:"water",layout:{visibility:"visible"},metadata:{},paint:{"fill-color":"rgba(103, 166, 196, 1)"},source:"openmaptiles","source-layer":"water",type:"fill"},{filter:["==","$type","Polygon"],id:"aeroway_fill",metadata:{},minzoom:11,paint:{"fill-color":"rgba(229, 228, 224, 1)","fill-opacity":.7},source:"openmaptiles","source-layer":"aeroway",type:"fill"},{filter:["all",["==","$type","LineString"],["==","class","runway"]],id:"aeroway_runway",metadata:{},minzoom:11,paint:{"line-color":"#f0ede9","line-width":{base:1.2,stops:[[11,3],[20,16]]}},source:"openmaptiles","source-layer":"aeroway",type:"line"},{filter:["all",["==","$type","LineString"],["==","class","taxiway"]],id:"aeroway_taxiway",metadata:{},minzoom:11,paint:{"line-color":"#f0ede9","line-width":{base:1.2,stops:[[11,.5],[20,6]]}},source:"openmaptiles","source-layer":"aeroway",type:"line"},{filter:["all",["in","class","ferry"]],id:"ferry",layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(47, 136, 183, 1)","line-dasharray":[2,2],"line-width":1.1},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","motorway"],["==","ramp",1],["==","brunnel","tunnel"]],id:"tunnel_motorway_link_casing",layout:{"line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#e9ac77","line-dasharray":[.5,.25],"line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","service","track"]],id:"tunnel_service_track_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#cfcdca","line-dasharray":[.5,.25],"line-width":{base:1.2,stops:[[15,1],[16,4],[20,11]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","ramp","1"],["==","brunnel","tunnel"]],id:"tunnel_link_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","street","street_limited"]],id:"tunnel_street_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#cfcdca","line-opacity":{stops:[[12,0],[12.5,1]]},"line-width":{base:1.2,stops:[[12,.5],[13,1],[14,4],[20,15]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","secondary","tertiary"]],id:"tunnel_secondary_tertiary_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[8,1.5],[20,21]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","primary","trunk"]],id:"tunnel_trunk_primary_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-width":{base:1.2,stops:[[5,.4],[6,.7],[7,1.75],[20,22]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","motorway"],["==","brunnel","tunnel"]],id:"tunnel_motorway_casing",layout:{"line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#e9ac77","line-dasharray":[.5,.25],"line-width":{base:1.2,stops:[[5,.4],[6,.7],[7,1.75],[20,22]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","$type","LineString"],["==","brunnel","tunnel"],["in","class","path","pedestrian"]],id:"tunnel_path_pedestrian",metadata:{},paint:{"line-color":"hsl(0, 0%, 100%)","line-dasharray":[1,.75],"line-width":{base:1.2,stops:[[14,.5],[20,10]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","motorway_link"],["==","ramp",1],["==","brunnel","tunnel"]],id:"tunnel_motorway_link",layout:{"line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#fc8","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","service","track"]],id:"tunnel_service_track",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fff","line-width":{base:1.2,stops:[[15.5,0],[16,2],[20,7.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","ramp","1"],["==","brunnel","tunnel"]],id:"tunnel_link",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fff4c6","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","minor"]],id:"tunnel_minor",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fff","line-opacity":1,"line-width":{base:1.2,stops:[[13.5,0],[14,2.5],[20,11.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","secondary","tertiary"]],id:"tunnel_secondary_tertiary",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fff4c6","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,12]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","primary","trunk"]],id:"tunnel_trunk_primary",layout:{"line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#fff4c6","line-width":{base:1.2,stops:[[5,0],[7,1],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","motorway"],["==","brunnel","tunnel"]],id:"tunnel_motorway",layout:{"line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#ffdaa6","line-width":{base:1.2,stops:[[5,0],[7,1],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["in","class","rail"]],id:"tunnel_major_rail",metadata:{},paint:{"line-color":"#bbb","line-width":{base:1.4,stops:[[14,.4],[15,.75],[20,2]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","tunnel"],["==","class","rail"]],id:"tunnel_major_rail_hatching",metadata:{},paint:{"line-color":"#bbb","line-dasharray":[.2,8],"line-width":{base:1.4,stops:[[14.5,0],[15,3],[20,8]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","$type","Polygon"],["==","brunnel","bridge"]],id:"road_area_bridge",layout:{visibility:"visible"},metadata:{},paint:{"fill-antialias":!0,"fill-color":"rgba(246, 241, 229, 0.6)"},source:"openmaptiles","source-layer":"transportation",type:"fill"},{filter:["all",["==","$type","Polygon"],["!=","brunnel","bridge"]],id:"road_area_pattern",layout:{visibility:"visible"},metadata:{},paint:{"fill-pattern":"pedestrian_polygon"},source:"openmaptiles","source-layer":"transportation",type:"fill"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway"],["==","ramp",1]],id:"road_motorway_link_casing",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},minzoom:12,paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","track"]],id:"road_service_track_casing-1",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},minzoom:13,paint:{"line-color":"rgba(165, 165, 165, 1)","line-width":{base:1.2,stops:[[15,1.3],[16,4],[20,11]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","service"]],id:"road_service_track_casing",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"rgba(181, 178, 175, 1)","line-width":{base:1.2,stops:[[15,1],[16,4],[20,11]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","ramp",1],["!in","class","pedestrian","path","track","service"]],id:"road_link_casing",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},minzoom:13,paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,6],[20,23]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","$type","LineString"],["!in","brunnel","bridge","tunnel"],["in","class","minor"],["!=","ramp","1"]],id:"road_minor_casing",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"rgba(181, 178, 175, 1)","line-opacity":{stops:[[12,0],[12.5,1]]},"line-width":{base:1.2,stops:[[12,.5],[13,1],[14,4],[20,20]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","secondary","tertiary"],["!=","ramp",1]],id:"road_secondary_tertiary_casing",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[8,1.5],[20,21]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","$type","LineString"],["!in","brunnel","bridge","tunnel"],["in","class","path","pedestrian"]],id:"road_path_pedestrian",layout:{"line-join":"round",visibility:"visible"},metadata:{},minzoom:13,paint:{"line-color":"rgba(169, 169, 169, 1)","line-dasharray":[3,2],"line-width":{base:1.2,stops:[[14,1],[20,6]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","primary","trunk"]],id:"road_trunk_primary_casing",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[5,.4],[6,.7],[7,1.75],[20,23]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway"],["!=","ramp","1"]],id:"road_motorway_casing",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},minzoom:5,paint:{"line-color":"rgba(230, 144, 81, 1)","line-width":{base:1.2,stops:[[5,.4],[6,.7],[7,1.75],[20,22]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","$type","LineString"],["all",["!in","brunnel","bridge","tunnel"],["in","class","minor"]]],id:"road_minor",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#fff","line-opacity":1,"line-width":{base:1.2,stops:[[13.5,0],[14,2.5],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","service","track"]],id:"road_service_track",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#fff","line-width":{base:1.2,stops:[[15.5,0],[16,2],[20,7.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","ramp",1],["!in","class","pedestrian","path","track","service"]],id:"road_link",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},minzoom:13,paint:{"line-color":"#fea","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway"],["==","ramp",1]],id:"road_motorway_link",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},minzoom:12,paint:{"line-color":"#fc8","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,19]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","secondary","tertiary"]],id:"road_secondary_tertiary",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"rgba(255, 238, 170, 1)","line-width":{base:1.2,stops:[[6.5,0],[8,.5],[20,17]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","primary","trunk"]],id:"road_trunk_primary",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#fea","line-width":{base:1.2,stops:[[5,0],[7,1],[20,19]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway"],["!=","ramp",1]],id:"road_motorway",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},minzoom:5,paint:{"line-color":{base:1,stops:[[5,"rgba(251, 183, 100, 1)"],[6,"rgba(255, 204, 136, 1)"]]},"line-width":{base:1.2,stops:[[5,0],[7,1],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","rail"]],id:"road_major_rail",metadata:{},paint:{"line-color":"#bbb","line-width":{base:1.4,stops:[[14,.4],[15,.75],[20,2]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","rail"]],id:"road_major_rail_hatching",metadata:{},paint:{"line-color":"#bbb","line-dasharray":[.2,8],"line-width":{base:1.4,stops:[[14.5,0],[15,3],[20,8]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{id:"building",layout:{visibility:"visible"},maxzoom:24,minzoom:12,paint:{"fill-antialias":!0,"fill-color":"rgba(202, 197, 189, 1)","fill-outline-color":"rgba(190, 185, 176, 1)"},source:"openmaptiles","source-layer":"building",type:"fill"},{id:"building-3d",layout:{visibility:"none"},metadata:{},minzoom:14,paint:{"fill-extrusion-base":{property:"render_min_height",type:"identity"},"fill-extrusion-color":"rgba(171, 165, 156, 1)","fill-extrusion-height":{property:"render_height",type:"identity"},"fill-extrusion-opacity":.5},source:"openmaptiles","source-layer":"building",type:"fill-extrusion"},{filter:["all",["==","class","motorway_link"],["==","ramp",1],["==","brunnel","bridge"]],id:"bridge_motorway_link_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","service","track"]],id:"bridge_service_track_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#cfcdca","line-width":{base:1.2,stops:[[15,1],[16,4],[20,11]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","link"],["==","brunnel","bridge"]],id:"bridge_link_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","street","street_limited"]],id:"bridge_street_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"hsl(36, 6%, 74%)","line-opacity":{stops:[[12,0],[12.5,1]]},"line-width":{base:1.2,stops:[[12,.5],[13,1],[14,4],[20,25]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","$type","LineString"],["==","brunnel","bridge"],["in","class","path","pedestrian"]],id:"bridge_path_pedestrian_casing",layout:{"line-join":"miter",visibility:"visible"},metadata:{},paint:{"line-color":"hsl(35, 6%, 80%)","line-dasharray":[1,0],"line-width":{base:1.2,stops:[[14,1.5],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","secondary","tertiary"]],id:"bridge_secondary_tertiary_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-opacity":1,"line-width":{base:1.2,stops:[[8,1.5],[20,21]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","primary","trunk"]],id:"bridge_trunk_primary_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-width":{base:1.2,stops:[[5,.4],[6,.7],[7,1.75],[20,22]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","motorway"],["==","brunnel","bridge"]],id:"bridge_motorway_casing",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#e9ac77","line-width":{base:1.2,stops:[[5,.4],[6,.7],[7,1.75],[20,22]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","$type","LineString"],["==","brunnel","bridge"],["in","class","path","pedestrian"]],id:"bridge_path_pedestrian",metadata:{},paint:{"line-color":"hsl(0, 0%, 100%)","line-dasharray":[1,.3],"line-width":{base:1.2,stops:[[14,.5],[20,10]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","motorway_link"],["==","ramp",1],["==","brunnel","bridge"]],id:"bridge_motorway_link",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fc8","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","service","track"]],id:"bridge_service_track",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fff","line-width":{base:1.2,stops:[[15.5,0],[16,2],[20,7.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","link"],["==","brunnel","bridge"]],id:"bridge_link",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fea","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","minor"]],id:"bridge_street",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fff","line-opacity":1,"line-width":{base:1.2,stops:[[13.5,0],[14,2.5],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","secondary","tertiary"]],id:"bridge_secondary_tertiary",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fea","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,12]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","brunnel","bridge"],["in","class","primary","trunk"]],id:"bridge_trunk_primary",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fea","line-width":{base:1.2,stops:[[5,0],[7,1],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","motorway"],["==","brunnel","bridge"]],id:"bridge_motorway",layout:{"line-join":"round"},metadata:{},paint:{"line-color":"#fc8","line-width":{base:1.2,stops:[[5,0],[7,1],[20,18]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","rail"],["==","brunnel","bridge"]],id:"bridge_major_rail",metadata:{},paint:{"line-color":"#bbb","line-width":{base:1.4,stops:[[14,.4],[15,.75],[20,2]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["==","class","rail"],["==","brunnel","bridge"]],id:"bridge_major_rail_hatching",metadata:{},paint:{"line-color":"#bbb","line-dasharray":[.2,8],"line-width":{base:1.4,stops:[[14.5,0],[15,3],[20,8]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["==","class","cable_car"],id:"cablecar",layout:{"line-cap":"round",visibility:"visible"},maxzoom:24,minzoom:13,paint:{"line-color":"rgba(153, 153, 153, 1)","line-width":{base:1,stops:[[11,1],[19,2.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["==","class","cable_car"],id:"cablecar-dash",layout:{"line-cap":"round",visibility:"visible"},maxzoom:24,minzoom:13,paint:{"line-color":"hsl(0, 0%, 60%)","line-dasharray":[2,3],"line-width":{base:1,stops:[[11,3],[19,5.5]]}},source:"openmaptiles","source-layer":"transportation",type:"line"},{filter:["all",["in","admin_level",3,4],["==","maritime",0]],id:"boundary_3",layout:{"line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"#9e9cab","line-dasharray":[5,1],"line-width":{base:1,stops:[[4,.4],[5,1],[12,1.8]]}},source:"openmaptiles","source-layer":"boundary",type:"line"},{filter:["all",["==","admin_level",2],["==","maritime",1]],id:"boundary_2_maritime",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"rgba(77, 144, 175, 1)","line-opacity":{base:1,stops:[[4,0],[6,1]]},"line-width":{base:1,stops:[[5,1.2],[12,3]]}},source:"openmaptiles","source-layer":"boundary",type:"line"},{filter:["all",["==","admin_level",2],["==","maritime",0]],id:"boundary_2",layout:{"line-cap":"round","line-join":"round",visibility:"visible"},metadata:{},paint:{"line-color":"rgba(136, 136, 136, 1)","line-opacity":{base:1,stops:[[0,.6],[4,.9],[12,.9],[18,.6]]},"line-width":{base:1,stops:[[3,1],[5,1.2],[12,3]]}},source:"openmaptiles","source-layer":"boundary",type:"line"}],metadata:{"mapbox:type":"template","openmaptiles:version":"3.x"},name:"Topo",sources:{contours:{type:"vector",url:"https://maps.tilehosting.com/data/contours.json?key="+Ie},hillshading:{tileSize:256,type:"raster",url:"https://maps.tilehosting.com/data/hillshades.json?key="+Ie},landcover:{type:"vector",url:"https://maps.tilehosting.com/data/landcover.json?key="+Ie},openmaptiles:{type:"vector",url:"https://maps.tilehosting.com/data/v3.json?key="+Ie}},sprite:"https://cloud.maptiler.com/tileserver-config/c/_/sprites/53061fbd-c3bf-4c0d-a1e2-84413aa16fec/sprite",version:8},Ne=mapboxgl.AttributionControl,We=mapboxgl.Map,Fe=function(){function e(){this._mapStyle=je,this.waitingList=[]}return e.prototype.pixelRatio=function(){return this._renderer&&this._renderer.pixelRatio?this._renderer.pixelRatio:1},e.prototype.prepareCanvas=function(e){var n=this;if(!this.canvas||!this.canvas.nativeElement||this._renderer||this._map)return void(e.alreadyCreated&&(this._map.loaded()?e.alreadyCreated(this._renderer,this._tripLayer):this.waitingList.push(e)));this._map=new We({container:this.mapDiv.nativeElement,style:this._mapStyle,center:[0,0],zoom:10,attributionControl:!1}),this._map.addControl(new Ne({compact:this.compactAttribution})),this._map.on("error",function(e){console.log("Map error:",e)}),this._map.on("load",function(){n._map.on("render",function(){n._renderer&&n._renderer.refresh()});var l=n.canvas.nativeElement;n._renderer=new Oe.CanvasTilesRenderer({canvas:l,url:"https://tiles.wmflabs.org/bw-mapnik/$scale/$x/$y.png",initialLocation:{x:0,y:0,scale:.01},onLocationChange:function(l){var t=l.getLocation();n.setMapboxLocation(t),e.onLocationChange&&e.onLocationChange(l)}}),n._renderer.layers=[{draw:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}}],n._tripLayer=new ke({renderer:n._renderer,graph:e.graph}),n._renderer.addLayer(n._tripLayer),e.created(n._renderer,n._tripLayer),n.waitingList=[];for(var t=0,i=n.waitingList;t<i.length;t++){i[t].alreadyCreated(n._renderer,n._tripLayer)}})},e.prototype.getLayer=function(e){for(var n=0,l=this._mapStyle.layers;n<l.length;n++){var t=l[n];if(t.id==e)return t}},e.prototype.setLayerColors=function(e){},e.prototype.resize=function(){this._map&&(this._map.resize(),this._renderer&&this.setMapboxLocation(this._renderer.getLocation()))},e.prototype.setMapboxLocation=function(e){if(!isFinite(e.x)||!isFinite(e.y))throw new Error("Invalid coordinates: "+e.x+", "+e.y);if(this._map){var n=Utils.worldToLatLon(e);this._map.setCenter([n.lon,n.lat]),isFinite(e.scale)&&this._map.setZoom(this.getZoomFromLocation(e))}},e.prototype.getZoomFromLocation=function(e){if(e){var n=this.canvasWidth;return Math.log2(1/(e.scale*(512/n)))}return 8},e.prototype.setSeqTrip=function(e){var n=this,l=e.makeGraph(this._tripLayer);return this._tripLayer.graph=l,this._tripLayer.defaultRadius=e.defaultRadius(),this._tripLayer.defaultTextProp=e.defaultTextProp(),this._tripLayer.defaultEdgeProp=e.defaultEdgeProp(),this._renderer.setLocation(e.location()),this.setMapboxLocation(e.location()),this.setLayerColors(e),this._renderer.refresh(),this.resize(),this._tripLayer.loadIcons(function(e){e&&console.log(e),n._renderer.refresh()}),l},e}(),qe=[],Ae=B["\u0275crt"]({encapsulation:2,styles:qe,data:{}}),Be=(B["\u0275ccf"]("mapview",Fe,y,{canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",compactAttribution:"compactAttribution"},{},[]),l("4zAq")),Ve=l("rxZd"),Ue=l("poDJ"),$e=l("pBJ6"),He=l("2VFp"),Ze=l("iDwB"),Ge=[K],Ke=B["\u0275crt"]({encapsulation:0,styles:Ge,data:{}}),Xe=(B["\u0275ccf"]("trip-map",Se,O,{},{},[]),function(){function e(){this.width=1024,this.height=1024,this.trip=I(),this.width=this.trip.width_mm()*Te.mmToPoint,this.height=this.trip.height_mm()*Te.mmToPoint}return e.prototype.ngAfterViewInit=function(){var e=this;this.mapview.prepareCanvas({created:function(n,l){e.mapview.setSeqTrip(e.trip),e.tripLayer=l},onLocationChange:function(n){e.tripLayer&&(e.tripLayer.graph=e.trip.makeGraph(e.tripLayer))}})},e.ctorParameters=function(){return[]},e}()),Je=[],Ye=B["\u0275crt"]({encapsulation:2,styles:Je,data:{}}),Qe=(B["\u0275ccf"]("view-seq",Xe,N,{},{},[]),[G]),en=B["\u0275crt"]({encapsulation:0,styles:Qe,data:{}}),nn=B["\u0275ccf"]("app-root",U,A,{},{},[]),ln=l("fc+i"),tn=l("BhHz"),on=l("4Vp2"),rn=l("x/Up"),an=l("G8gw"),sn=l("xHno"),un=l("yroR"),dn=l("bIam"),pn=B["\u0275cmf"](V,[U],function(e){return B["\u0275mod"]([B["\u0275mpd"](512,B.ComponentFactoryResolver,B["\u0275CodegenComponentFactoryResolver"],[[8,[H.a,Z.a,nn]],[3,B.ComponentFactoryResolver],B.NgModuleRef]),B["\u0275mpd"](5120,B.LOCALE_ID,B["\u0275m"],[[3,B.LOCALE_ID]]),B["\u0275mpd"](4608,Y.NgLocalization,Y.NgLocaleLocalization,[B.LOCALE_ID]),B["\u0275mpd"](4608,B.Compiler,B.Compiler,[]),B["\u0275mpd"](5120,B.APP_ID,B["\u0275f"],[]),B["\u0275mpd"](5120,B.IterableDiffers,B["\u0275k"],[]),B["\u0275mpd"](5120,B.KeyValueDiffers,B["\u0275l"],[]),B["\u0275mpd"](4608,ln.b,ln.s,[Y.DOCUMENT]),B["\u0275mpd"](6144,B.Sanitizer,null,[ln.b]),B["\u0275mpd"](4608,ln.e,ln.f,[]),B["\u0275mpd"](5120,ln.c,function(e,n,l,t){return[new ln.k(e),new ln.o(n),new ln.n(l,t)]},[Y.DOCUMENT,Y.DOCUMENT,Y.DOCUMENT,ln.e]),B["\u0275mpd"](4608,ln.d,ln.d,[ln.c,B.NgZone]),B["\u0275mpd"](135680,ln.m,ln.m,[Y.DOCUMENT]),B["\u0275mpd"](4608,ln.l,ln.l,[ln.d,ln.m]),B["\u0275mpd"](6144,B.RendererFactory2,null,[ln.l]),B["\u0275mpd"](6144,ln.p,null,[ln.m]),B["\u0275mpd"](4608,B.Testability,B.Testability,[B.NgZone]),B["\u0275mpd"](4608,ln.g,ln.g,[Y.DOCUMENT]),B["\u0275mpd"](4608,ln.i,ln.i,[Y.DOCUMENT]),B["\u0275mpd"](4608,X.n,X.n,[]),B["\u0275mpd"](4608,ve.i,ve.n,[Y.DOCUMENT,B.PLATFORM_ID,ve.l]),B["\u0275mpd"](4608,ve.o,ve.o,[ve.i,ve.m]),B["\u0275mpd"](5120,ve.a,function(e){return[e]},[ve.o]),B["\u0275mpd"](4608,ve.k,ve.k,[]),B["\u0275mpd"](6144,ve.j,null,[ve.k]),B["\u0275mpd"](4608,ve.h,ve.h,[ve.j]),B["\u0275mpd"](6144,ve.b,null,[ve.h]),B["\u0275mpd"](5120,ve.f,ve.p,[ve.b,[2,ve.a]]),B["\u0275mpd"](4608,ve.c,ve.c,[ve.f]),B["\u0275mpd"](4608,ee.ColorPickerService,ee.ColorPickerService,[]),B["\u0275mpd"](4608,ze.a,ze.a,[]),B["\u0275mpd"](4608,me.a,me.a,[]),B["\u0275mpd"](4608,tn.a,tn.a,[]),B["\u0275mpd"](4608,Ue.a,Ue.a,[B.ComponentFactoryResolver,B.NgZone,B.Injector,tn.a,B.ApplicationRef]),B["\u0275mpd"](4608,Be.a,Be.a,[]),B["\u0275mpd"](512,Y.CommonModule,Y.CommonModule,[]),B["\u0275mpd"](1024,B.ErrorHandler,ln.q,[]),B["\u0275mpd"](1024,B.APP_INITIALIZER,function(e,n){return[ln.r(e,n)]},[[2,ln.h],[2,B.NgProbeToken]]),B["\u0275mpd"](512,B.ApplicationInitStatus,B.ApplicationInitStatus,[[2,B.APP_INITIALIZER]]),B["\u0275mpd"](131584,B["\u0275e"],B["\u0275e"],[B.NgZone,B["\u0275Console"],B.Injector,B.ErrorHandler,B.ComponentFactoryResolver,B.ApplicationInitStatus]),B["\u0275mpd"](2048,B.ApplicationRef,null,[B["\u0275e"]]),B["\u0275mpd"](512,B.ApplicationModule,B.ApplicationModule,[B.ApplicationRef]),B["\u0275mpd"](512,ln.a,ln.a,[[3,ln.a]]),B["\u0275mpd"](512,X.k,X.k,[]),B["\u0275mpd"](512,X.d,X.d,[]),B["\u0275mpd"](512,ve.e,ve.e,[]),B["\u0275mpd"](512,ve.d,ve.d,[]),B["\u0275mpd"](512,on.ColorPickerModule,on.ColorPickerModule,[]),B["\u0275mpd"](512,rn.a,rn.a,[]),B["\u0275mpd"](512,an.a,an.a,[]),B["\u0275mpd"](512,sn.a,sn.a,[]),B["\u0275mpd"](512,un.a,un.a,[]),B["\u0275mpd"](512,dn.a,dn.a,[]),B["\u0275mpd"](512,V,V,[]),B["\u0275mpd"](256,ve.l,"XSRF-TOKEN",[]),B["\u0275mpd"](256,ve.m,"X-XSRF-TOKEN",[]),B["\u0275mpd"](256,$e.a,{autoClose:!0},[])])});Object(B.enableProdMode)(),Object(ln.j)().bootstrapModuleFactory(pn)},z1vh:function(e,n){function l(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}l.keys=function(){return[]},l.resolve=l,e.exports=l,l.id="z1vh"}},[0]);