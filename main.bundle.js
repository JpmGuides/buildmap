webpackJsonp([1],{0:function(e,t,n){e.exports=n("f2TY")},S42r:function(e,t){function n(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="S42r"},f2TY:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n("3j3K"),r=function(){return function(){}}(),i=function(){function e(){}return e.ctorParameters=function(){return[]},e}(),o=n("GWLp"),a=n("jOFM"),s=n("NVOs"),u=n("2Je8"),p=n("M96w"),d=n("RlMM"),c=function(){function e(e,t){if("number"==typeof e&&"number"==typeof t?(this.x=e,this.y=t):Array.isArray(e)?(this.x=e[0],this.y=e[1]):"object"==typeof e&&(this.x=e.x,this.y=e.y),void 0===this.x||void 0===this.y)throw new Error("invalid point")}return e.minus=function(t,n){return new e(t.x-n.x,t.y-n.y)},e.plus=function(t,n){return new e(t.x+n.x,t.y+n.y)},e.times=function(t,n){return new e(t*n.x,t*n.y)},e.min=function(t,n){return new e(Math.min(t.x,n.x),Math.min(t.y,n.y))},e.max=function(t,n){return new e(Math.max(t.x,n.x),Math.max(t.y,n.y))},e.dist=function(e,t){var n=e.x-t.x,l=e.y-t.y;return Math.sqrt(n*n+l*l)},e.norm=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.nearest=function(t,n){for(var l,r,i=0,o=n;i<o.length;i++){var a=o[i],s=e.dist(a,t);(void 0===l||s<r)&&(r=s,l=a)}return l},e.rotate=function(t,n){var l=Math.cos(n),r=Math.sin(n);return new e(t.x*l-t.y*r,t.x*r+t.y*l)},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.mul=function(e){return this.x*=e,this.y*=e,this},e.prototype.norm=function(){return e.norm(this)},e}(),h=function(){function e(t){if(this.properties={},t){if(t.controlPoints){this.controlPoints=[];for(var n=0;n<t.controlPoints.length;++n)this.controlPoints[n]=new c(t.controlPoints[n])}t.originalEdge&&(this.originalEdge=new e(t.originalEdge));for(var l=0,r=["from","to","drawMiddlePoint","properties","fromDbId","fromIndex"];l<r.length;l++){var i=r[l];i in t&&(this[i]=t[i])}if(t.properties&&(this.properties=t.properties,t.properties.lineWidth&&(this.properties.lineWidth=parseFloat(t.properties.lineWidth)),t.properties.dashed))for(n=0;n<t.properties.dashed.length;++n)this.properties.dashed[n]=parseInt(t.properties.dashed[n])}}return e.prototype.propagateToOriginal=function(){if(this.originalEdge)for(var e=0,t=["controlPoints","drawMiddlePoint"];e<t.length;e++){var n=t[e];n in this&&(this.originalEdge[n]=this[n])}},e.prototype.getProperty=function(t,n){var l=this.properties[t]||n[t];if("geom"==t&&"route"==l){var r=this.properties.travelMean||n.travelMean;if(!e.isRoutable(r))return"straight"}return l},e.routableMeans=function(){return["Car","Bus","Bike","Walk"]},e.isRoutable=function(t){return-1!=e.routableMeans().indexOf(t)},e}(),f=function(){function e(e,t){this.name=e.replace(/-/g,"\u2501").replace(/ /g," \xa0"),this.style=t}return e.prototype.key=function(){return name},e}(),g=function(){function e(e){this.differs=e,this.onChange=new l.EventEmitter,this.defaultsDiffer=e.find({}).create(null),this.propertiesDiffer=e.find({}).create(null),this.allLineStyles=[new f("------",[]),new f("- - - ",[4,4]),new f("--  --",[8,8])],this.allTravelMeans=["Unspecified","Bike","Boat","Bus","Car","Helicopter","Plane","Train","Walk"]}return e.prototype.changeEvent=function(){this.setProp("lineWidth"),this.onChange.emit(this.properties)},e.prototype.ngOnInit=function(){this.readProperties()},e.prototype.ngDoCheck=function(){var e=this.defaultsDiffer.diff(this.defaults)||this.propertiesDiffer.diff(this.properties);return e&&this.readProperties(),e},e.prototype.readProperties=function(){for(var e,t={lineColor:"#000000",lineWidth:2,travelMean:"Unspecified",geom:"straight"},n=0,l=Object.keys(t);n<l.length;n++){var r=l[n];this.properties&&r in this.properties?this[r]=this.properties[r]:this.defaults&&r in this.defaults?this[r]=this.defaults[r]:this[r]=t[r]}if("curved"===this.geom?this.geom="spline":"route"!=this.geom||this.canDrive()||(this.geom="straight"),this.properties&&this.properties.dashed?e=this.properties.dashed:this.defaults&&this.defaults.dashed&&(e=this.defaults.dashed),e)for(var i=0,o=this.allLineStyles;i<o.length;i++){var a=o[i];this.sameStyles(a.style,e)&&(this.lineStyle=a.name)}else this.lineStyle=this.allLineStyles[0].name},e.prototype.sameStyles=function(e,t){if(!e||!t)return!1;if(e===t)return!0;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!=t[n])return!1;return!0},e.prototype.setProp=function(e){this.properties&&(this.defaults&&this[e]===this.defaults[e]?this.properties[e]&&delete this.properties[e]:this.properties[e]=this[e])},e.prototype.colorChanged=function(){this.setProp("lineColor"),this.changeEvent()},e.prototype.resetToDefault=function(){for(var e=0,t=Object.keys(this.properties);e<t.length;e++){var n=t[e];delete this.properties[n]}this.readProperties(),this.changeEvent()},e.prototype.hasDefault=function(){for(var e=0,t=["lineColor","lineWidth","travelMean","dashed"];e<t.length;e++){if(t[e]in this.properties)return!1}return!0},e.prototype.setLineStyle=function(e){for(var t=0,n=this.allLineStyles;t<n.length;t++){var l=n[t];l.name===e&&(this.properties.dashed=l.style)}this.changeEvent()},e.prototype.canDrive=function(){return h.isRoutable(this.travelMean)},e.prototype.setTravelMean=function(e){this.travelMean=e,this.setProp("travelMean"),this.canDrive()?"route"!=this.geom&&(this.geom="route",this.setProp("geom")):"route"==this.geom&&(this.geom=this.defaults?this.defaults.geom:"straight",this.setProp("geom")),this.changeEvent()},e.prototype.setGeom=function(e){this.geom=e,this.setProp("geom"),this.changeEvent()},e.ctorParameters=function(){return[{type:l.KeyValueDiffers}]},e}(),m=[[".form-control[_ngcontent-%COMP%]{display:inline-block;font-size:12px;padding:2px}.form-group[_ngcontent-%COMP%]{margin-bottom:2px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:400;text-align:left}.small[_ngcontent-%COMP%]{width:25px;height:25px}.edge-prop-colors[_ngcontent-%COMP%]{text-align:right}.input-form-control-margin[_ngcontent-%COMP%]{margin:10px 0}"]],v=l["\u0275crt"]({encapsulation:0,styles:m,data:{}});function y(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,3,"option",[],null,null,null,null,null)),l["\u0275did"](147456,null,0,s.i,[l.ElementRef,l.Renderer2,[2,s.j]],{value:[0,"value"]},null),l["\u0275did"](147456,null,0,s.o,[l.ElementRef,l.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),l["\u0275ted"](null,["",""]))],function(e,t){e(t,1,0,t.context.$implicit),e(t,2,0,t.context.$implicit)},function(e,t){e(t,3,0,t.context.$implicit)})}function b(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,3,"option",[],null,null,null,null,null)),l["\u0275did"](147456,null,0,s.i,[l.ElementRef,l.Renderer2,[2,s.j]],{value:[0,"value"]},null),l["\u0275did"](147456,null,0,s.o,[l.ElementRef,l.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),l["\u0275ted"](null,["",""]))],function(e,t){e(t,1,0,t.context.$implicit.name),e(t,2,0,t.context.$implicit.name)},function(e,t){e(t,3,0,t.context.$implicit.name)})}function _(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),l["\u0275did"](147456,null,0,s.i,[l.ElementRef,l.Renderer2,[2,s.j]],{value:[0,"value"]},null),l["\u0275did"](147456,null,0,s.o,[l.ElementRef,l.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),l["\u0275ted"](null,["Route"]))],function(e,t){e(t,1,0,"route");e(t,2,0,"route")},null)}function P(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,100,"div",[["class","form-horizontal"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275eld"](0,null,null,18,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Transport:"])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,12,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,9,"select",[["class","form-control input-sm"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,t,n){var r=!0,i=e.component;"change"===t&&(r=!1!==l["\u0275nov"](e,10).onChange(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,10).onTouched()&&r);"change"===t&&(r=!1!==i.setTravelMean(n.target.value)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.j,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[s.j]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275and"](16777216,null,null,1,null,y)),l["\u0275did"](802816,null,0,u.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n\n  "])),(e()(),l["\u0275eld"](0,null,null,18,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Line style:"])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,12,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,9,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,t,n){var r=!0,i=e.component;"change"===t&&(r=!1!==l["\u0275nov"](e,30).onChange(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,30).onTouched()&&r);"change"===t&&(r=!1!==i.setLineStyle(n.target.value)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.j,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[s.j]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275and"](16777216,null,null,1,null,b)),l["\u0275did"](802816,null,0,u.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n\n  "])),(e()(),l["\u0275eld"](0,null,null,28,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Line shape:"])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,22,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,19,"select",[["class","form-control"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,t,n){var r=!0,i=e.component;"change"===t&&(r=!1!==l["\u0275nov"](e,50).onChange(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,50).onTouched()&&r);"change"===t&&(r=!1!==i.setGeom(n.target.value)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.j,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[s.j]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),l["\u0275did"](147456,null,0,s.i,[l.ElementRef,l.Renderer2,[2,s.j]],{value:[0,"value"]},null),l["\u0275did"](147456,null,0,s.o,[l.ElementRef,l.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),l["\u0275ted"](null,["Straight"])),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,3,"option",[["class","form-control"]],null,null,null,null,null)),l["\u0275did"](147456,null,0,s.i,[l.ElementRef,l.Renderer2,[2,s.j]],{value:[0,"value"]},null),l["\u0275did"](147456,null,0,s.o,[l.ElementRef,l.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),l["\u0275ted"](null,["Curved"])),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275and"](16777216,null,null,1,null,_)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n\n  "])),(e()(),l["\u0275eld"](0,null,null,15,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Line width:"])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,9,"div",[["class","col-md-8"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,6,"input",[["class","form-control input-sm"],["id","lineWidth"],["max","10"],["min","0"],["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,t,n){var r=!0,i=e.component;"input"===t&&(r=!1!==l["\u0275nov"](e,80)._handleInput(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,80).onTouched()&&r);"compositionstart"===t&&(r=!1!==l["\u0275nov"](e,80)._compositionStart()&&r);"compositionend"===t&&(r=!1!==l["\u0275nov"](e,80)._compositionEnd(n.target.value)&&r);"change"===t&&(r=!1!==l["\u0275nov"](e,81).onChange(n.target.value)&&r);"input"===t&&(r=!1!==l["\u0275nov"](e,81).onChange(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,81).onTouched()&&r);"change"===t&&(r=!1!==i.changeEvent()&&r);"ngModelChange"===t&&(r=!1!==(i.lineWidth=n)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.c,[l.Renderer2,l.ElementRef,[2,s.a]],null,null),l["\u0275did"](16384,null,0,s.l,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e,t){return[e,t]},[s.c,s.l]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},{update:"ngModelChange"}),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n\n  "])),(e()(),l["\u0275eld"](0,null,null,10,"div",[["class","form-group form-group-sm"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,1,"label",[["class","control-label col-sm-4"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Line color:"])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[["class","col-md-8 edge-prop-colors"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control "]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"click"],[null,"focus"],[null,"input"]],function(e,t,n){var r=!0,i=e.component;"click"===t&&(r=!1!==l["\u0275nov"](e,97).inputFocus()&&r);"focus"===t&&(r=!1!==l["\u0275nov"](e,97).inputFocus()&&r);"input"===t&&(r=!1!==l["\u0275nov"](e,97).inputChange(n.target.value)&&r);"colorPickerChange"===t&&(r=!1!==(i.lineColor=n)&&r);"colorPickerChange"===t&&(r=!1!==i.colorChanged()&&r);return r},null,null)),l["\u0275did"](737280,null,0,p.ColorPickerDirective,[l.Injector,l.ComponentFactoryResolver,l.ApplicationRef,l.ViewContainerRef,l.ElementRef,d.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){var n=t.component;e(t,12,0,n.travelMean),e(t,17,0,n.allTravelMeans),e(t,32,0,n.lineStyle),e(t,37,0,n.allLineStyles),e(t,52,0,n.geom);e(t,57,0,"straight");e(t,58,0,"straight");e(t,62,0,"spline");e(t,63,0,"spline"),e(t,67,0,n.canDrive()),e(t,83,0,n.lineWidth),e(t,97,0,n.lineColor)},function(e,t){var n=t.component;e(t,9,0,l["\u0275nov"](t,14).ngClassUntouched,l["\u0275nov"](t,14).ngClassTouched,l["\u0275nov"](t,14).ngClassPristine,l["\u0275nov"](t,14).ngClassDirty,l["\u0275nov"](t,14).ngClassValid,l["\u0275nov"](t,14).ngClassInvalid,l["\u0275nov"](t,14).ngClassPending),e(t,29,0,l["\u0275nov"](t,34).ngClassUntouched,l["\u0275nov"](t,34).ngClassTouched,l["\u0275nov"](t,34).ngClassPristine,l["\u0275nov"](t,34).ngClassDirty,l["\u0275nov"](t,34).ngClassValid,l["\u0275nov"](t,34).ngClassInvalid,l["\u0275nov"](t,34).ngClassPending),e(t,49,0,l["\u0275nov"](t,54).ngClassUntouched,l["\u0275nov"](t,54).ngClassTouched,l["\u0275nov"](t,54).ngClassPristine,l["\u0275nov"](t,54).ngClassDirty,l["\u0275nov"](t,54).ngClassValid,l["\u0275nov"](t,54).ngClassInvalid,l["\u0275nov"](t,54).ngClassPending),e(t,79,0,l["\u0275nov"](t,85).ngClassUntouched,l["\u0275nov"](t,85).ngClassTouched,l["\u0275nov"](t,85).ngClassPristine,l["\u0275nov"](t,85).ngClassDirty,l["\u0275nov"](t,85).ngClassValid,l["\u0275nov"](t,85).ngClassInvalid,l["\u0275nov"](t,85).ngClassPending),e(t,96,0,n.lineColor)})}function w(e){return l["\u0275vid"](0,[(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275and"](16777216,null,null,1,null,P)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){e(t,2,0,t.component.properties)},null)}l["\u0275ccf"]("edge-prop",g,function(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"edge-prop",[],null,null,null,w,v)),l["\u0275did"](376832,null,0,g,[l.KeyValueDiffers],null,null)],function(e,t){e(t,1,0)},null)},{properties:"properties",defaults:"defaults",noReset:"noReset"},{properties:"properties",onChange:"onChange"},[]);var x=n("kzxK"),C=n("1pX+"),k=function(){function e(e,t){this.cpService=e,this.differs=t,this.onChange=new l.EventEmitter,this.defaultsDiffer=t.find({}).create(null),this.propertiesDiffer=t.find({}).create(null)}return e.prototype.ngOnInit=function(){},e.prototype.changeEvent=function(){this.onChange.emit(this.properties)},e.prototype.ngDoCheck=function(){var e=this.defaultsDiffer.diff(this.defaults)||this.propertiesDiffer.diff(this.properties);return e&&this.readProperties(),e},e.prototype.readProperties=function(){for(var e=0,t=["fill","stroke","fontSize"];e<t.length;e++){var n=t[e];this.properties&&n in this.properties?this[n]=this.properties[n]:this.defaults&&n in this.defaults?this[n]=this.defaults[n]:this[n]="stroke"==n||"fill"==n?"#000000":void 0}},e.prototype.hasDefault=function(){for(var e=0,t=["fill","stroke","fontSize"];e<t.length;e++){if(t[e]in this.properties)return!1}return!0},e.prototype.setProperty=function(e){this.properties[e]=this[e],this.changeEvent()},e.ctorParameters=function(){return[{type:C.ColorPickerService},{type:l.KeyValueDiffers}]},e}(),L=[[".block[_ngcontent-%COMP%]{display:inline-block;margin-right:15px}.form-control[_ngcontent-%COMP%]{width:8em;height:2em;display:inline-block;font-size:12px}.leftpadding[_ngcontent-%COMP%]{padding-left:15px}.small[_ngcontent-%COMP%]{width:25px;height:25px}.root[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative}input[_ngcontent-%COMP%]{display:inline-block}input[type=number][_ngcontent-%COMP%]{width:4em;padding-left:3px;padding-right:3px}i.fa-recycle[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.text-prop-colors[_ngcontent-%COMP%]{position:relative;padding:5px 0}span[_ngcontent-%COMP%]{font-size:12px}.font-size-margin[_ngcontent-%COMP%]{margin:5px 0 8px}"]],M=l["\u0275crt"]({encapsulation:0,styles:L,data:{}});function T(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,25,"span",[["class","root"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275eld"](0,null,null,7,"span",[["class","text-prop-colors block"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](16777216,null,null,1,"input",[["class","small form-control"]],[[4,"background",null]],[[null,"colorPickerChange"],[null,"click"],[null,"focus"],[null,"input"]],function(e,t,n){var r=!0,i=e.component;"click"===t&&(r=!1!==l["\u0275nov"](e,5).inputFocus()&&r);"focus"===t&&(r=!1!==l["\u0275nov"](e,5).inputFocus()&&r);"input"===t&&(r=!1!==l["\u0275nov"](e,5).inputChange(n.target.value)&&r);"colorPickerChange"===t&&(r=!1!==(i.fill=n)&&r);"colorPickerChange"===t&&(r=!1!==i.setProperty("fill")&&r);return r},null,null)),l["\u0275did"](737280,null,0,p.ColorPickerDirective,[l.Injector,l.ComponentFactoryResolver,l.ApplicationRef,l.ViewContainerRef,l.ElementRef,d.ColorPickerService],{colorPicker:[0,"colorPicker"]},{colorPickerChange:"colorPickerChange"}),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Text"])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n\n  "])),(e()(),l["\u0275ted"](null,["\n\n  "])),(e()(),l["\u0275eld"](0,null,null,12,"span",[["class","font-size-margin block"],["style","float: right;"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,1,"span",[["for","fontSize"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["size:"])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,6,"input",[["class","form-control"],["id","fontSize"],["max","64"],["min","5"],["type","number"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,t,n){var r=!0,i=e.component;"input"===t&&(r=!1!==l["\u0275nov"](e,18)._handleInput(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,18).onTouched()&&r);"compositionstart"===t&&(r=!1!==l["\u0275nov"](e,18)._compositionStart()&&r);"compositionend"===t&&(r=!1!==l["\u0275nov"](e,18)._compositionEnd(n.target.value)&&r);"change"===t&&(r=!1!==l["\u0275nov"](e,19).onChange(n.target.value)&&r);"input"===t&&(r=!1!==l["\u0275nov"](e,19).onChange(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,19).onTouched()&&r);"change"===t&&(r=!1!==i.setProperty("fontSize")&&r);"ngModelChange"===t&&(r=!1!==(i.fontSize=n)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.c,[l.Renderer2,l.ElementRef,[2,s.a]],null,null),l["\u0275did"](16384,null,0,s.l,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e,t){return[e,t]},[s.c,s.l]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},{update:"ngModelChange"}),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){var n=t.component;e(t,5,0,n.fill),e(t,21,0,n.fontSize)},function(e,t){e(t,4,0,t.component.fill),e(t,17,0,l["\u0275nov"](t,23).ngClassUntouched,l["\u0275nov"](t,23).ngClassTouched,l["\u0275nov"](t,23).ngClassPristine,l["\u0275nov"](t,23).ngClassDirty,l["\u0275nov"](t,23).ngClassValid,l["\u0275nov"](t,23).ngClassInvalid,l["\u0275nov"](t,23).ngClassPending)})}function S(e){return l["\u0275vid"](0,[(e()(),l["\u0275and"](16777216,null,null,1,null,T)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){e(t,1,0,t.component.properties)},null)}l["\u0275ccf"]("text-prop",k,function(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"text-prop",[],null,null,null,S,M)),l["\u0275did"](376832,null,0,k,[d.ColorPickerService,l.KeyValueDiffers],null,null)],function(e,t){e(t,1,0)},null)},{properties:"properties",defaults:"defaults",noReset:"noReset"},{properties:"properties",onChange:"onChange"},[]);var O=n("hel6"),I=n("WMEN"),D=n("XlZi"),R=n("6hVA"),E=n("lOd9"),z=n("ElZy"),F=n("Ki8D"),N=n("Mx5P"),A=n("ZXgD"),W=n("junq"),j=(n("eErF"),n("Gvdl")),q=function(){function e(){this._alertMessage=new j.BehaviorSubject(null),this._removeAlertMessage=new j.BehaviorSubject(null)}return e.prototype.alert=function(e){this._alertMessage.next(e)},e.prototype.removeAlert=function(e){this._removeAlertMessage.next(e)},e.ctorParameters=function(){return[]},e}(),B=function(){function e(e){var t=this;this.alertMessageService=e,this.FADE_TIMEOUT=600,this.alertMessages=[],this.alertMessageService._alertMessage.subscribe(function(e){t.show(e)}),this.alertMessageService._removeAlertMessage.subscribe(function(e){e&&t.destroy(e.uuid)})}return e.prototype.show=function(e){var t=this;e&&(this.alertMessages.unshift(e),console.log(this.alertMessages),e.timeoutInMiliSeconds&&setTimeout(function(){t.destroy(e.uuid)},e.timeoutInMiliSeconds))},e.prototype.fade=function(e){e.state="destroyed"},e.prototype.destroy=function(e){var t=this,n=this.findIndex(this.alertMessages,"uuid",e);-1!==n&&(this.alertMessages[n].state="destroyed",setTimeout(function(){t.alertMessages.splice(n,1)},this.FADE_TIMEOUT))},e.prototype.findIndex=function(e,t,n){for(var l=0;l<e.length;l+=1)if(e[l][t]===n)return l;return-1},e.ctorParameters=function(){return[{type:q}]},e}(),V=[[".bootstrap-alert[_ngcontent-%COMP%]{z-index:2000;position:fixed}.top-left[_ngcontent-%COMP%]{left:1rem;top:1rem}.top-center[_ngcontent-%COMP%]{margin:auto;left:0;right:0;top:1rem}.top-right[_ngcontent-%COMP%]{right:1rem;top:1rem}.bottom-left[_ngcontent-%COMP%]{left:1rem;bottom:1rem}.bottom-center[_ngcontent-%COMP%]{margin:auto;left:0;right:0;bottom:1rem}.bottom-right[_ngcontent-%COMP%]{right:1rem;bottom:1rem}"]],U=l["\u0275crt"]({encapsulation:0,styles:V,data:{animation:[{type:7,name:"alertVisible",definitions:[{type:0,name:"visible",styles:{type:6,styles:{opacity:1},offset:null},options:void 0},{type:0,name:"destroyed",styles:{type:6,styles:{opacity:0},offset:null},options:void 0},{type:1,expr:"visible => destroyed",animation:{type:4,styles:null,timings:"600ms"},options:null},{type:1,expr:"destroyed => visible",animation:{type:4,styles:null,timings:"600ms"},options:null}],options:{}}]}});function Z(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,6,"div",[["class","alert alert-dismissible"]],[[8,"id",0],[24,"@alertVisible",0]],null,null,null,null)),l["\u0275did"](278528,null,0,u.NgClass,[l.IterableDiffers,l.KeyValueDiffers,l.ElementRef,l.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,2,"button",[["aria-label","Close"],["class","close"],["data-dismiss","alert"],["type","button"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\xd7"])),(e()(),l["\u0275ted"](null,["\n    ","\n  "]))],function(e,t){e(t,1,0,"alert alert-dismissible",t.context.$implicit.type)},function(e,t){e(t,0,0,l["\u0275inlineInterpolate"](1,"",t.context.$implicit.uuid,""),t.context.$implicit.state),e(t,6,0,t.context.$implicit.message)})}function G(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,4,"div",[["class","alert-message-container"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275and"](16777216,null,null,1,null,Z)),l["\u0275did"](802816,null,0,u.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275ted"](null,["\n\n"]))],function(e,t){e(t,3,0,t.component.alertMessages)},null)}l["\u0275ccf"]("alert-message",B,function(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"alert-message",[],null,null,null,G,U)),l["\u0275did"](49152,null,0,B,[q],null,null)],null,null)},{},{},[]);var H=n("KdFd"),J=function(){return function(){}}(),K=function(){function e(e,t){this._uuid=this.generateUUId(),this._type=t,this._message=e,this._state="visible"}return e.prototype.generateUUId=function(){return this.randomizer()+this.randomizer()+"-"+this.randomizer()+"-"+this.randomizer()+"-"+this.randomizer()+"-"+this.randomizer()+this.randomizer()+this.randomizer()},e.prototype.randomizer=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeoutInMiliSeconds",{get:function(){return this._timeoutInMiliSeconds},set:function(e){this._timeoutInMiliSeconds=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),e}(),X=function(){function e(e){e&&(e.min&&(this.min=new c(e.min)),e.max&&(this.max=new c(e.max)))}return e.closestPoint=function(e,t){var n=new c(0,0);for(var l in n)e[l]<t.min[l]?n[l]=t.min[l]:e[l]>t.max[l]?n[l]=t.max[l]:n[l]=e[l];return n},e.overlaps=function(e,t){return!(e.max.x<t.min.x||e.min.x>t.max.x||e.max.y<t.min.y||e.min.y>t.max.y)},e.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},e.prototype.addPoint=function(e){this.min=void 0===this.min?new c(e):c.min(this.min,e),this.max=void 0===this.max?new c(e):c.max(this.max,e)},e.prototype.addArray=function(e){for(var t=0,n=e;t<n.length;t++){var l=n[t];this.addPoint(l)}},e.prototype.overlaps=function(t){return e.overlaps(this,t)},e.prototype.contains=function(t){return e.contains(this,t)},e}(),Y=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))(function(r,i){function o(e){try{s(l.next(e))}catch(e){i(e)}}function a(e){try{s(l.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((l=l.apply(e,t||[])).next())})},Q=this&&this.__generator||function(e,t){var n,l,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,l&&(r=2&i[0]?l.return:i[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],l=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},ee={};var te={};function ne(e){var t=this,n=JSON.stringify(e);return te[n]?te[n]:te[n]=Y(t,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(e){return Y(this,void 0,Promise,function(){return Q(this,function(t){return[2,new Promise(function(t,n){$.getJSON("https://overpass-api.de/api/interpreter?data="+encodeURIComponent('[out:json];(way["highway"~"^(road|motorway|trunk|primary|secondary|tertiary|residential)$"]["access:conditional"!~"no"]["access"!~"no"]["name"](around:15000,'+e.lat+","+e.lon+");>;);out 32;\n")).done(function(l){if(l&&Array.isArray(l.elements)&&l.elements.length>=1&&l.elements[0].lat&&l.elements[0].lon){var r=function(e,t){for(var n,l,r,i,o,a,s=0,u=t;s<u.length;s++){var p=u[s],d=(i=p,o=(r=e).lat-i.lat,a=r.lon-i.lon,Math.sqrt(o*o+a*a));(void 0==n||d<n)&&(n=d,l=p)}return l}(e,l.elements);t(r)}else n("Bad or empty reply from overpass")}).fail(n)})]})})}(e)];case 1:return[2,t.sent()];case 2:return t.sent(),[3,3];case 3:return t.trys.push([3,5,,6]),[4,function(e){var t=["https://api.openrouteservice.org/geocode/reverse?api_key=5b3ce3597851110001cf6248e0fee72951d5494c8b4cf5d8b4ff2b76","point.lat="+e.lat,"point.lon="+e.lon,"sources=oa"].join("&");return new Promise(function(e,n){$.getJSON(t).done(function(t){t&&t.features&&t.features[0]&&t.features[0].geometry&&t.features[0].geometry.coordinates?e({lon:t.features[0].geometry.coordinates[0],lat:t.features[0].geometry.coordinates[1]}):n(new Error("Empty or bad data from openrouteservice"))}).fail(function(e){"object"==typeof e&&"number"==typeof e.status&&e.status>=400&&e.status<500&&n(e),n(e)})})}(e)];case 4:return[2,t.sent()];case 5:return t.sent(),[3,6];case 6:return[2,e]}})})}function le(e,t,n){var l=["https://api.openrouteservice.org/directions?api_key=5b3ce3597851110001cf6248e0fee72951d5494c8b4cf5d8b4ff2b76","coordinates="+e.lon+"%2C"+e.lat+"%7C"+t.lon+"%2C"+t.lat,"profile="+n,"geometry_format=geojson","geometry_simplify=true","radiuses=-1%7C-1"].join("&");return new Promise(function(e,t){$.getJSON(l).done(function(n){n&&n.routes&&n.routes[0]&&n.routes[0].geometry&&n.routes[0].geometry.coordinates?e(n.routes[0]):t(new Error("Empty or bad data from openrouteservice"))}).fail(t)})}var re=function(){function e(e,t,n){this.AlertMessageService=n;var l=e||{};this.nodes=l.node||{},this.edges=l.edges||[],this.defaultEdgeProp=t}return e.generateControlPoints=function(e,t,n,l){var r=c.minus(n,t).mul(1/3),i=new c(-r.y,r.x);return[c.plus(c.plus(t,r),i),c.plus(c.minus(n,r),i)]},e.bezierFromPoints=function(e){for(var t=[],n=0;n<4;++n)t.push(e[n].x),t.push(e[n].y);return new Bezier(t)},e.bezierThroughPoints=function(t){for(var n=[],l=1;l<t.length;++l){var r=1===l?t[l-1]:t[l-2],i=t[l-1],o=t[l],a=l===t.length-1?t[l]:t[l+1];n.push(e.bezierFromPoints([i,c.plus(i,c.times(.2,c.minus(o,r))),c.plus(o,c.times(.2,c.minus(i,a))),o]))}return n},e.placeLeaderLine=function(e,t,n){e.properties||(e.properties={});var l,r=e.properties.leaderLine||"bestAnchor",i=e.properties.labelBbox;if("center"===r){i.max.x,i.min.x;var o=new c((i.min.x+i.max.x)/2,(i.min.y+i.max.y)/2),a=c.minus(e.coord,o);a.mul(.02),l=c.plus(o,a)}else l="closestOnBbox"===r?X.closestPoint(e.coord,i):d3.labeler.closestLineAnchorPoint(e.coord,{left:i.min.x,right:i.max.x,top:i.min.y,bottom:i.max.y,cx:(i.min.x+i.max.x)/2,cy:(i.min.y+i.max.y)/2});e.properties.leaderLineAnchorPixelOffset=void 0,e.properties.leaderLineAnchor=l,e.convertToPixelOffset(t,n)},e.prototype.createDefaultBezier=function(){for(var t in this.edges)for(var n=this.edges[t],l=this.nodes[n.from],r=this.nodes[n.to],i=e.generateControlPoints(void 0,l.coord,r.coord,void 0),o=0;o<i.length;++o)n.controlPoints[o]=i[o]},e.prototype.edgeProperty=function(e,t){return e.getProperty(t,this.defaultEdgeProp)},e.prototype.getEdgeRoute=function(e){if("route"==this.edgeProperty(e,"geom")&&e.properties&&e.properties.route&&e.properties.route.geom&&this.edgeProperty(e,"travelMean")==e.properties.route.mean)return e.properties.route},e.prototype.bezier=function(t){if(!t.controlPoints||t.properties.hidden)return[];if("straight"==this.edgeProperty(t,"geom"))return e.bezierThroughPoints([this.nodes[t.from].coord,this.nodes[t.to].coord]);if(2===t.controlPoints.length){var n=[this.nodes[t.from].coord,t.controlPoints[0],t.controlPoints[1],this.nodes[t.to].coord];return[e.bezierFromPoints(n)]}if(5===t.controlPoints.length){var l=[this.nodes[t.from].coord,t.controlPoints[0],t.controlPoints[1],t.controlPoints[2]],r=[t.controlPoints[2],t.controlPoints[3],t.controlPoints[4],this.nodes[t.to].coord];return[e.bezierFromPoints(l),e.bezierFromPoints(r)]}var i=[this.nodes[t.from].coord].concat(t.controlPoints,[this.nodes[t.to].coord]);return e.bezierThroughPoints(i)},e.prototype.bounds=function(){var e=new X;for(var t in this.nodes)this.nodes[t].properties.skip||e.addPoint(this.nodes[t].coord);for(var t in this.edges){var n=this.edges[t],l=this.getEdgeRoute(n);if(l)for(var r=0,i=l.geom;r<i.length;r++){var o=i[r];e.addPoint(o)}else for(var a=0,s=this.bezier(n);a<s.length;a++)for(var u=0,p=s[a].getLUT(8);u<p.length;u++){o=p[u];e.addPoint(o)}}return e},e.prototype.frame=function(e,t){var n=this.bounds();if(t=t||1.1,n.max&&n.min){if(n.min.x===n.max.x){var l=new c(1/32,1/32);n.addPoint(c.plus(n.min,l)),n.addPoint(c.minus(n.min,l))}}else n.min=new c(0,0),n.max=new c(1,1),t=1;e=e||(n.max.x-n.min.x)/(n.max.y-n.min.y);var r="number"==typeof t?new c(t,t):t,i=c.minus(n.max,n.min);i.x*=r.x,i.y*=r.y;var o,a=i.y*e;(o=i.x>a?new c(i.x,i.x/e):new c(i.y*e,i.y)).mul(.5);var s=c.times(.5,c.plus(n.max,n.min)),u=new X;return u.addPoint(c.minus(s,o)),u.addPoint(c.plus(s,o)),u},e.prototype.location=function(e,t){var n=this.frame(e,t);n.max.x,n.min.x;return{x:(n.max.x+n.min.x)/2,y:(n.max.y+n.min.y)/2,scale:Math.max(1/32768,n.max.x-n.min.x)}},e.prototype.compareNodes=function(e){var t=function(e,t){for(var n in e)if(!(n in t))return!1;return!0};return t(this.nodes,e.nodes)&&t(e.nodes,this.nodes)},e.prototype.getEdgeDirections=function(e,t){var n=this,l=Utils.worldToLatLon(this.nodes[e.from].coord),r=Utils.worldToLatLon(this.nodes[e.to].coord),i=new K("Finding route from "+this.nodes[e.from].label+" to "+this.nodes[e.to].label+" is taking longer than usual, please check your internet connection or Openrouteservice status","alert-warning"),o=setTimeout(function(){n.AlertMessageService.alert(i),setTimeout(function(){n.AlertMessageService.removeAlert(i)},1e4)},2e3);return function(e,t,n,l){var r=this;void 0===l&&(l=!1);var i=function(e){switch(e){case"Car":return"driving-car";case"Bus":return"driving-hgv";case"Bike":return"cycling-regular";case"Walk":return"foot-walking";default:return}}(n);if(!i)return Promise.reject(new Error("Transportation mean unsupported: "+n));var o=JSON.stringify({from:e,to:t,mean:n});return o in ee?ee[o]:(ee[o]=Y(r,void 0,void 0,function(){var n,l,r,o,a,s,u,p,d;return Q(this,function(c){switch(c.label){case 0:n=!1,l=!1,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,le(e,t,i)];case 2:return[2,c.sent()];case 3:if("object"!=typeof(r=c.sent())||!r.responseJSON||2010!=r.responseJSON.error.code)throw r;for(o=/not find point ([0-9]+)/g,a=void 0;a=o.exec(r.responseJSON.error.message);)switch(a[1]){case"0":n=!0;break;case"1":l=!0}if(!n&&!l)throw r;return[3,4];case 4:return n?[4,ne(e)]:[3,6];case 5:return u=c.sent(),[3,7];case 6:u=e,c.label=7;case 7:return s=u,l?[4,ne(t)]:[3,9];case 8:return p=c.sent(),[3,10];case 9:p=t,c.label=10;case 10:return[4,le(s,p,i)];case 11:return(d=c.sent()).geometry.coordinates.unshift([e.lon,e.lat]),d.geometry.coordinates.push([t.lon,t.lat]),[2,d]}})}),ee[o])}(l,r,t).then(function(l){clearTimeout(o),n.AlertMessageService.removeAlert(i);var r=l.geometry.coordinates.map(function(e){return new c(Utils.latLonToWorld(e))}),a={mean:t,geom:r,from:e.from,to:e.to,midpoint:function(e){for(var t=0,n=[0],l=1;l<e.length;++l)t+=c.dist(e[l],e[l-1]),n.push(t);var r=t/2;for(l=0;l<n.length;++l)if(n[l]>r)return l-1;return 0}(r)};return l.summary&&(a.distance_m=l.summary.distance,a.duration_s=l.summary.duration),a}).catch(function(e){throw console.log(e),clearTimeout(o),e})},e}(),ie=function(){function e(e,t,n){this.graph=t,this.renderer=e,this.tripLayer=n}return e.prototype.acceptTouchEvent=function(e,t,n){if("wheel"===n)return!1;this.startWorldPos=new c(t),this.startViewerPos=new c(e);var l=this.tripLayer.findLabelAtWorldPos(this.startWorldPos);if(l){this.selectLabel(l);var r=l.properties;return this.applyDelta=function(e,t){r.labelCoord&&(r.labelCoord.x+=e.x,r.labelCoord.y+=e.y,r.userPlacement=new c(r.labelCoord)),r.labelPixelOffset&&(r.labelPixelOffset.add(c.times(1/this.renderer.pixelRatio,t)),r.userPlacementPixelOffset=new c(r.labelPixelOffset)),r.labelBbox.min.x+=e.x,r.labelBbox.min.y+=e.y,r.labelBbox.max.x+=e.x,r.labelBbox.max.y+=e.y,re.placeLeaderLine(l,this.renderer.pinchZoom,this.renderer.pixelRatio),this.onLabelMoved&&this.onLabelMoved(l)},!0}this.deselectLabel();var i=this.closestBezier(t),o=this.renderer.pinchZoom.worldDistanceFromViewerDistance(10*this.renderer.pixelRatio);if(i&&i.d<o){if(this.selectBezier(i),!i.bezier)return!0;var a=this,s=function(e){a.applyDelta=function(t,n){if(e){for(var l=0,r=Array.isArray(e)?e:[e];l<r.length;l++){var o=r[l];o.x+=t.x,o.y+=t.y}this.onBezierMoved&&this.onBezierMoved(i)}}},u=function(e,t,n){a.applyDelta=function(n,l){e.x+=n.x,e.y+=n.y,t.x+=n.x/2,t.y+=n.y/2}};return 2===i.edge.controlPoints.length?s(i.edge.controlPoints[i.t<.5?0:1]):5===i.edge.controlPoints.length?i.bezier.points[1].x===i.edge.controlPoints[0].x&&i.bezier.points[1].y===i.edge.controlPoints[0].y?i.t<.5?s(i.edge.controlPoints[0]):i.t<.9?u(i.edge.controlPoints[1],i.edge.controlPoints[2],i.edge.controlPoints[3]):s([i.edge.controlPoints[1],i.edge.controlPoints[2],i.edge.controlPoints[3]]):i.t<.1?s([i.edge.controlPoints[1],i.edge.controlPoints[2],i.edge.controlPoints[3]]):i.t<.5?u(i.edge.controlPoints[3],i.edge.controlPoints[2],i.edge.controlPoints[1]):s(i.edge.controlPoints[4]):s(c.nearest(t,i.edge.controlPoints)),!0}return this.selectBezier(),this.applyDelta=void 0,!1},e.prototype.selectLabel=function(e){this.selectedLabel&&delete this.selectedLabel.properties.frame,this.selectedLabel=void 0,this.selectBezier(),this.selectedLabel=e,this.onLabelSelect&&this.onLabelSelect(e),e&&(e.properties=e.properties||{},e.properties.frame="#000000"),this.renderer.refreshIfNotMoving()},e.prototype.deselectLabel=function(){return this.selectLabel()},e.prototype.handleMouseDown=function(e){e.preventDefault()},e.prototype.handleMouseMove=function(e){e.preventDefault();var t=Utils.eventPosInElementCoordinates(e,e.target||e.srcElement);this.handleMotion(t)},e.prototype.handleMotion=function(e){if(this.applyDelta){var t=this.renderer.pinchZoom.worldPosFromViewerPos(e.x,e.y),n=c.minus(t,this.startWorldPos);this.startWorldPos=t;var l=c.minus(e,this.startViewerPos);this.startViewerPos=new c(e),this.applyDelta(n,l),this.renderer.refreshIfNotMoving()}},e.prototype.handleMouseUp=function(e){e.preventDefault(),this.applyDelta=void 0},e.prototype.handleMouseWheel=function(e){e.preventDefault()},e.prototype.handleStart=function(e){e.preventDefault()},e.prototype.handleEnd=function(e){e.preventDefault(),this.applyDelta=void 0},e.prototype.handleMove=function(e){if(e.preventDefault(),1===e.touches.length){var t=Utils.eventPosInElementCoordinates(e.touches[0],e.target||e.srcElement);this.handleMotion(t)}else this.applyDelta=void 0},e.prototype.edgeProperty=function(e,t){return this.graph.edgeProperty(e,t)},e.prototype.closestBezier=function(e){for(var t,n=0,l=this.graph.edges;n<l.length;n++){var r=l[n],i=this.graph.getEdgeRoute(r);if(i)for(var o=0,a=i.geom;o<a.length;o++){var s=a[o],u=c.dist(e,s);(!t||u<t.d)&&(t={d:u,edge:r,bezier:void 0})}else for(var p=0,d=this.graph.bezier(r);p<d.length;p++){var h=d[p],f=h.project(e);(!t||f.d<t.d)&&((t=f).edge=r,t.bezier=h)}}return t},e.prototype.selectBezier=function(e){var t;this.selectedBezier&&(delete(t=this.selectedBezier.edge).drawMiddlePoint,void 0!==t.properties._lineWidth?(t.properties.lineWidth=t.properties._lineWidth,delete t.properties._lineWidth):delete t.properties.lineWidth);(this.selectedBezier=e,e)&&((t=e.edge).drawMiddlePoint=!0,void 0!==t.properties.lineWidth&&(t.properties._lineWidth=t.properties.lineWidth),t.properties.lineWidth=5);this.selectedLabel&&this.deselectLabel(),this.onBezierSelect&&this.onBezierSelect(this.selectedBezier),this.renderer.refreshIfNotMoving()},e}(),oe=function(){function e(){this.allPlaces=[]}return e.parse=function(t){var n=new e;n.coord=new c(t.coord),t.place&&(t.place=e.parse(t.place)),t.viewerPos&&(n.viewerPos=new c(t.viewerPos));for(var l=0,r=["dbid","name","label","indication","labelIcon","properties"];l<r.length;l++){var i=r[l];t[i]&&(n[i]=t[i])}return n.name||(void 0!==n.dbid?n.name=""+n.dbid:n.label&&(n.name=n.label)),n.properties=t.properties||{},n.properties.labelBbox&&(n.properties.labelBbox=new X(n.properties.labelBbox)),n.properties.leaderLineAnchor&&(n.properties.leaderLineAnchor=new c(n.properties.leaderLineAnchor)),n.properties.labelCoord&&(n.properties.labelCoord=new c(n.properties.labelCoord)),n.properties.labelPixelOffset&&(n.properties.labelPixelOffset=new c(n.properties.labelPixelOffset)),n},e.prototype.isSkipped=function(){return!(this.label&&(!this.properties||void 0===this.properties.skip))&&this.properties.skip},e.prototype.labelPixelPos=function(e,t){return this.properties&&this.properties.labelPixelOffset?c.plus(e.viewerPosFromWorldPos(this.coord),c.times(t,this.properties.labelPixelOffset)):e.viewerPosFromWorldPos(this.properties&&this.properties.labelCoord?this.properties.labelCoord:this.coord)},e.prototype.leaderLineAnchorPos=function(e,t){if(this.properties&&(this.properties.leaderLineAnchor||this.properties.leaderLineAnchorPixelOffset))return this.properties.leaderLineAnchorPixelOffset?c.plus(e.viewerPosFromWorldPos(this.coord),c.times(t,this.properties.leaderLineAnchorPixelOffset)):e.viewerPosFromWorldPos(this.properties.leaderLineAnchor)},e.prototype.convertToPixelOffset=function(e,t){this.properties.labelCoord&&(this.properties.labelPixelOffset||(this.properties.labelPixelOffset=c.minus(e.viewerPosFromWorldPos(this.properties.labelCoord),e.viewerPosFromWorldPos(this.coord)).mul(1/t)),delete this.properties.labelCoord),this.properties.leaderLineAnchor&&(this.properties.leaderLineAnchorPixelOffset||(this.properties.leaderLineAnchorPixelOffset=c.minus(e.viewerPosFromWorldPos(this.properties.leaderLineAnchor),e.viewerPosFromWorldPos(this.coord)).mul(1/t)),delete this.properties.leaderLineAnchor)},e}();function ae(){var e=window,t=e.global_map_params;if(!t&&thisTripApi){var n=window.cssserviceUrl||"https://destinationbook-cssservice.herokuapp.com/";e.global_map_params={locations_url:thisTripApi.locationsUrl,map_settings_url:thisTripApi.mapUrl,preferences:{line_shape:thisTripApi.lineShape},language:thisTripApi.tripLanguage,geoname_service_url:n,map_print_service_url:n},t=e.global_map_params}if(t||"undefined"==typeof mapJson||("object"==typeof mapJson&&mapJson.global_map_params?e.global_map_params=mapJson.global_map_params:e.global_map_params={map_settings:mapJson,language:mapJson.tripLanguage,geoname_service_url:"",map_print_service_url:"",hide_ui:!0},t=e.global_map_params),!t)throw new Error("Can't find map parameters");return t.preferences||(t.preferences={}),t}var se=function(){function e(e){if(this.params=e,this.markedPlaces=[],this.renderer=e.renderer,this.defaultRadius=e.defaultRadius||6,this.icons={},this.defaultTextProp={fontSize:e.defaultFontSize||20,stroke:"rgba(255,255,255,.8)",fill:"#000000"},this.defaultEdgeProp=e.defaultEdgeProp||{lineWidth:1,lineColor:"#000000"},this.hideLabels=!!e.hideLabels,this.hideNodePoints=!!e.hideNodePoints,!this.renderer)throw new Error("TripGraphLayer: no renderer !");this.graph=e.graph||new re(void 0,this.defaultEdgeProp,null),this.missingData=1}return e.prototype.isReady=function(){return 0==this.missingData},e.prototype.draw=function(e,t,n,l){var r=this.graph,i=e.getContext("2d"),o=this.renderer.pixelRatio;this.markedPlaces=[],this.missingData=0;for(var a=0,s=r.edges;a<s.length;a++){var u=s[a];this.drawEdge(i,t,u,o,"curve")}for(var p=0,d=r.edges;p<d.length;p++){u=d[p];this.drawEdge(i,t,u,o,"mark")}for(var c in i.setLineDash([]),r.nodes){(h=r.nodes[c]).convertToPixelOffset(t,o),h.viewerPos=t.viewerPosFromWorldPos(h.coord)}if(!this.hideNodePoints)for(var c in r.nodes){var h=r.nodes[c];this.drawNodePoint(i,t,h)}for(var c in r.nodes)if(this.forceLeaderLines||!this.hideLabels||c.match(/-(takeoff)|(landing)$/)){h=r.nodes[c];this.drawLeaderLine(i,t,h)}for(var c in r.nodes)if(!this.hideLabels||c.match(/-(takeoff)|(landing)$/)){h=r.nodes[c];this.drawNodeLabel(i,t,h)}this.markedPlaces=this.markedPlaces.map(function(e){return t.worldPosFromViewerPos(e)}),this.fillClicMap(e,t)},e.prototype.drawEdge=function(e,t,n,l,r){this.setEdgeStrokeStyle(e,n),"route"==this.edgeProperty(n,"geom")?this.drawRoad(e,t,n,l,r):this.drawEdgeBezier(e,t,n,l,r)},e.prototype.drawRoad=function(e,t,n,l,r){var i=this,o=(this.edgeProperty(n,"travelMean"),this.graph.getEdgeRoute(n));if("curve"==r)if(o){var a=n.properties.route.geom;e.beginPath();var s=t.viewerPosFromWorldPos(a[0]);e.moveTo(s.x,s.y);for(var u=1;u<a.length;++u){var p=t.viewerPosFromWorldPos(a[u]);e.lineTo(p.x,p.y)}e.stroke()}else this.missingData+=1,n.properties||(n.properties={}),this.graph.getEdgeDirections(n,this.edgeProperty(n,"travelMean")).then(function(e){n.properties.route=e,i.renderer.refresh()}).catch(function(e){console.log(e),n.properties.geom="straight",i.renderer.refresh()});else if("mark"==r&&o&&o.midpoint){s=new c(t.viewerPosFromWorldPos(o.geom[0]));var d=new c(t.viewerPosFromWorldPos(o.geom[o.geom.length-1]));if(c.dist(d,s)>80*l){var h=o.midpoint,f=16*l,g=new c(t.viewerPosFromWorldPos(o.geom[h])),m=void 0;for(u=h;u<o.geom.length;++u){var v=new c(t.viewerPosFromWorldPos(o.geom[u]));if(c.dist(g,v)>f){m=c.minus(v,g);break}}if(!m)return;var y=new c(m.y,-m.x);this.drawEdgeMark(c.plus(g,c.times(8*l/m.norm(),m)),y,m,e,l,n,r)}}},e.prototype.drawEdgeBezier=function(e,t,n,l,r){for(var i=this.graph.bezier(n),o=0,a=i;o<a.length;o++){var s=a[o];this.drawBezier(e,t,s,l,n,r)}if("mark"!=r&&i.length>1&&n.drawMiddlePoint)for(var u in i){var p=t.viewerPosFromWorldPos(i[u].points[3]),d=5*l;e.beginPath(),e.arc(p.x,p.y,d,0,2*Math.PI,!1),e.fillStyle="#000000",e.fill()}},e.prototype.drawBezier=function(e,t,n,l,r,i){e.save();for(var o=new Array(8),a=n.points,s=0;s<4;++s){var u=t.viewerPosFromWorldPos(a[s]);o[2*s]=u.x,o[2*s+1]=u.y}var p=new Bezier(o),d=p.length(),h=Math.min(2,Math.floor(d/(40*l))),f=p.points;"mark"!=i&&(e.beginPath(),e.moveTo(f[0].x,f[0].y),e.bezierCurveTo(f[1].x,f[1].y,f[2].x,f[2].y,f[3].x,f[3].y),e.stroke());for(var g=1;g<h;++g){var m=g/h,v=(u=new c(p.get(m)),new c(p.normal(m))),y=new c(p.derivative(m));this.drawEdgeMark(u,v,y,e,l,r,i)}e.restore()},e.prototype.drawEdgeMark=function(t,n,l,r,i,o,a){switch(this.edgeProperty(o,"travelMean")){case"Bike":case"Boat":case"Bus":case"Car":case"Helicopter":case"Plane":case"Train":case"Walk":"curve"!=a&&this.drawEdgeMarkIcon(t,n,l,r,i,o);break;case"Unspecified":default:"mark"!=a&&e.drawEdgeMarkTriangle(t,n,l,r,i)}},e.drawEdgeMarkTriangle=function(e,t,n,l,r){var i=10*r;n.mul(i/n.norm()),e=c.plus(e,c.times(.5,n));var o=c.minus(e,n);l.beginPath(),l.moveTo(o.x+i/2*t.x,o.y+i/2*t.y),l.lineTo(e.x,e.y),l.lineTo(o.x-i/2*t.x,o.y-i/2*t.y),l.closePath(),l.fill()},e.prototype.drawEdgeMarkIcon=function(e,t,n,l,r,i){l.fillStyle="#fff",l.setLineDash([]),l.lineWidth=1*r;var o=10*r,a=6*r;n=n.mul(1/n.norm());var s=c.plus(e,c.times((o+a)/2,n)),u=c.minus(e,c.times((o+a)/2,n)),p=c.plus(u,c.times(o,n)),d=new c(-n.y,n.x).mul(4*r),h=c.plus(p,d),f=c.minus(p,d),g=c.minus(h,u),m=Math.atan2(g.y,g.x),v=c.minus(f,u),y=Math.atan2(v.y,v.x);l.beginPath(),l.arc(u.x,u.y,o,m,y),l.lineTo(s.x,s.y),l.closePath(),l.fill(),l.stroke(),l.fillStyle="#000",l.textAlign="center",l.textBaseline="middle",l.font=Math.round(10*r)+"px 'Font Awesome 5 Free'";var b=this.edgeProperty(i,"travelMean");"Plane"==b&&(l.save(),l.translate(u.x,u.y),l.rotate(Math.PI/4+Math.atan2(n.y,n.x)),l.translate(-u.x,-u.y)),l.fillText({Bike:"\uf206",Boat:"\uf21a",Bus:"\uf207",Car:"\uf1b9",Helicopter:"H",Plane:"\uf072",Train:"\uf238",Walk:"\uf183"}[b],u.x,u.y),this.markedPlaces.push(u),"Plane"==b&&l.restore()},e.prototype.edgeProperty=function(e,t){return e.getProperty(t,this.defaultEdgeProp)},e.prototype.setEdgeStrokeStyle=function(e,t){var n=this.edgeProperty(t,"lineColor");e.strokeStyle=n,e.fillStyle=n,e.lineWidth=this.renderer.pixelRatio*this.edgeProperty(t,"lineWidth"),this.setDashStyle(e,this.edgeProperty(t,"dashed"))},e.prototype.nodeRadius=function(e){var t=this.defaultRadius;return e.properties&&e.properties.radius&&(t=e.properties.radius),t*this.renderer.pixelRatio},e.prototype.drawNodePoint=function(e,t,n){if(!n.properties||0!=n.properties.point){var l=n.viewerPos;this.drawPoint(e,l,this.renderer.pixelRatio,n.properties||{})}},e.prototype.drawNodeLabel=function(t,n,l){var r=this;if(l.label||l.labelIcon){var i=l.labelPixelPos(n,this.renderer.pixelRatio);if(l.label&&e.drawText(t,l.label,i,this.renderer.pixelRatio,l.properties||{},this.defaultTextProp),l.labelIcon){var o=this.getIcon(l.labelIcon.url);if(o){if(void 0!=l.labelIcon.autorotate){var a=n.viewerPosFromWorldPos(l.coord);l.labelIcon.angle=l.labelIcon.autorotate+Math.atan2(a.y-i.y,a.x-i.x)}this.drawIcon(t,o,l.labelIcon,i,this.renderer.pixelRatio)}else this.missingData++,this.loadIcons(function(){return r.renderer.refresh()})}if(l.properties&&l.properties.frame&&l.label){var s=e.measureText(t,l.label,this.renderer.pixelRatio,l.properties||{},this.defaultTextProp);t.strokeStyle=l.properties.frame,s.width+=3*this.renderer.pixelRatio,s.height+=3*this.renderer.pixelRatio,t.rect(i.x-s.width/2,i.y-s.height/2,s.width,s.height),t.stroke()}}},e.prototype.setDashStyle=function(e,t){var n=[];if(t)for(var l=0,r=t;l<r.length;l++){var i=r[l];n.push(this.renderer.pixelRatio*i)}e.setLineDash(n)},e.prototype.drawLeaderLine=function(e,t,n){if(n.properties){var l=n.properties;if(l.leaderLineAnchor||l.leaderLineAnchorPixelOffset){var r=this.renderer.pixelRatio,i=n.leaderLineAnchorPos(t,r);e.lineWidth=(n.properties.leaderLineWidth||1)*r,e.beginPath();var o=t.viewerPosFromWorldPos(n.coord),a=this.nodeRadius(n),s=n.properties&&void 0!==n.properties.maxLeaderLineLength?n.properties.maxLeaderLineLength*r:3*a;c.dist(i,o)>s&&(n.properties.dashed&&this.setDashStyle(e,n.properties.dashed),e.moveTo(i.x,i.y),e.lineTo(o.x,o.y),e.strokeStyle=n.properties.leaderLineColor||"#000000",e.stroke(),n.properties.dashed&&e.setLineDash([]))}}},e.prototype.drawPoint=function(e,t,n,l){e.strokeStyle="rgba(0,0,0,1)",e.fillStyle="rgba(255,255,255,1)",e.lineWidth=2*n,e.beginPath();var r=(l.radius||this.defaultRadius)*n;e.arc(t.x,t.y,r,0,2*Math.PI,!1),e.stroke(),e.fill();var i=l.markStyle;!i&&l.firstVisited&&(i="first"),"first"===i&&(e.fillStyle="rgba(0, 0, 0, 1)",e.beginPath(),e.arc(t.x,t.y,.6*r,0,2*Math.PI,!1),e.fill())},e.measureText=function(t,n,l,r,i){var o=n.split("\n"),a={width:0,height:e.setTextStyle(t,l,r,i)*o.length*1.1};for(var s in o)a.width=Math.max(a.width,1.1*t.measureText(o[s]).width);return a},e.setTextStyle=function(e,t,n,l){var r=(n=n||{}).fontSize||l.fontSize;return r*=t,e.font=r+"px "+(n.font||"'PT Sans', sans-serif"),e.strokeStyle=n.stroke||l.stroke,e.lineWidth=(n.haloWidth||4)*t,e.fillStyle=n.fill||l.fill,parseInt(""+r)},e.drawText=function(t,n,l,r,i,o){var a,s,u=(void 0!=i.textOffset?i.textOffset:20)*r,p=((i.textPlacement||"S")+"").toUpperCase();switch(p){default:case"C":case"N":case"S":t.textAlign="center",a=0;break;case"E":case"NE":t.textAlign="start",a=u;break;case"O":case"W":t.textAlign="end",a=-u}switch(p){case"C":case"E":case"W":case"O":t.textBaseline="middle",s=0;break;case"N":case"NE":t.textBaseline="bottom",s=-u;break;default:case"S":t.textBaseline="top",s=u}var d=l.x+a,c=l.y+s,h=e.setTextStyle(t,r,i,o),f=n.split("\n");t.shadowBlur=3*r,t.shadowColor="#ffffff",t.lineWidth=2*r;for(var g=(f.length-1)/2,m=0;m<f.length;++m){var v=c+(m-g)*h;t.strokeText(f[m],d,v),t.fillText(f[m],d,v)}t.shadowColor="transparent"},e.prototype.drawIcon=function(e,t,n,l,r){if(t){var i=n.width?n.width*r:16*r,o=n.height?n.height*r:i,a=i*("ratioX"in n?n.ratioX:.5),s=o*("ratioY"in n?n.ratioY:.5);n.angle?(e.save(),e.translate(l.x,l.y),e.rotate(n.angle),e.drawImage(t,-a,-s,i,o),e.restore(),this.markedPlaces.push(c.plus(l,c.rotate(new c(i/2-a,o/2-s),n.angle)))):(e.drawImage(t,l.x-a,l.y-s,i,o),this.markedPlaces.push({x:l.x-a+i/2,y:l.y-s+o/2}))}},e.prototype.getLabelIconSize=function(e,t){var n=this.renderer.pixelRatio,l=t.labelIcon;return{width:(l.width||16)*n,height:(l.height||l.width||16)*n}},e.prototype.computeNodeSizeWithMargin=function(t,n){var l;if(n.label){var r=this.renderer.pixelRatio;l=e.measureText(t,n.label,r,n.properties,this.defaultTextProp)}else n.labelIcon&&((l=this.getLabelIconSize(t,n)).width*=1.4,l.height*=1.4);if(!l)throw"no label and no labIcon for node";var i=2*this.renderer.pixelRatio;return l.width+=2*i,l.height+=2*i,l},e.prototype.setLabelBbox=function(e,t,n){if(e&&(e.label||e.labelIcon)&&e.properties&&(e.properties.labelCoord||e.properties.labelPixelOffset)){t||(t=this.renderer.canvas.getContext("2d"));var l=this.renderer.pinchZoom;if(!n){var r=this.computeNodeSizeWithMargin(t,e),i=e.labelPixelPos(l,this.renderer.pixelRatio);n={x:i.x,y:i.y,width:r.width,height:r.height}}var o=e.properties,a=c.times(.5,new c(n.width,n.height));o.labelBbox=new X({min:l.worldPosFromViewerPos(c.minus(n,a)),max:l.worldPosFromViewerPos(c.plus(n,a))})}},e.prototype.nodeName=function(e){if(e.label)return e.label;if(e.labelIcon)return"icon:"+e.labelIcon.url;throw"no label and no labIcon for node"},e.prototype.placeLabels=function(e,t){var n=this.renderer.pinchZoom,l=this.renderer.pixelRatio,r=[],i=[];for(var o in this.graph.nodes){var a=this.graph.nodes[o];if(a.label||a.labelIcon){var s=n.viewerPosFromWorldPos(a.coord),u=this.defaultRadius;a.properties&&a.properties.radius&&(u=a.properties.radius),i.push({x:s.x,y:s.y,r:!1!==a.properties.point?u*l:-1});var p=this.computeNodeSizeWithMargin(e,a),d=this.nodeName(a),h=s;!1===a.properties.point&&(h.x-=p.width/2,h.y-=p.height/2);var f=void 0;t&&(f=h),a.properties&&a.properties.userPlacement&&(f=h=n.viewerPosFromWorldPos(a.properties.userPlacement)),a.properties&&a.properties.userPlacementPixelOffset&&(f=h=c.plus(s,c.times(l,a.properties.userPlacementPixelOffset)));var g={x:h.x,y:h.y,name:d,width:p.width,height:p.height,node:a,userPlacement:f};r.push(g)}}var m=d3.labeler().label(r).anchor(i).width(this.renderer.canvas.width).height(this.renderer.canvas.height),v=m.alt_energy(),y=[],b=[];for(var _ in this.graph.edges){var P=this.graph.getEdgeRoute(this.graph.edges[_]);if(P){for(var w=[],x=0,C=P.geom;x<C.length;x++){var k=C[x],L=n.viewerPosFromWorldPos(k);(0==w.length||c.dist(w[w.length-1],L)>4*l)&&w.push(L)}(S=new X).addArray(w),y.push(S),b.push(w)}else{var M=this.graph.bezier(this.graph.edges[_]);for(var o in M){var T=M[o],S=T.bbox();y.push({min:n.viewerPosFromWorldPos(S.x.min,S.y.min),max:n.viewerPosFromWorldPos(S.x.max,S.y.max)});var O=T.getLUT(30),I=[];for(var D in O)I.push(n.viewerPosFromWorldPos(O[D]));b.push(I)}}}m.alt_energy(function(e,t,n){var l=0,i=m.boxOfLabel(e),o=new X;for(var a in o.addPoint(new c(i.left,i.top)),o.addPoint(new c(i.right,i.bottom)),y)if(X.overlaps(y[a],o)){var s=b[a];for(var u in s)o.contains(s[u])&&l++}var p=10*l+v(e),d=r[e].userPlacement;d&&(p+=c.dist(d,r[e]));return p});m.start(5e3,1);for(var o in r){var R=r[o];R.node.properties||(R.node.properties={});var E=R.node.properties,z=n.viewerPosFromWorldPos(R.node.coord);E.labelPixelOffset=c.minus(R,z).mul(1/l),"labelCoord"in E&&delete E.labelCoord,this.setLabelBbox(R.node,e,R),re.placeLeaderLine(R.node,n,l),E.textPlacement="C",E.textOffset=0}},e.shallowCopy=function(e){var t,n=Object.create(Object.getPrototypeOf(e)),l=Object.getOwnPropertyNames(e);for(t=0;t<l.length;t++)Object.defineProperty(n,l[t],Object.getOwnPropertyDescriptor(e,l[t]));return n},e.prototype.forEachNode=function(e){for(var t in this.graph.nodes)e(this.graph.nodes[t])},e.prototype.getIcon=function(e){if(this.icons[e]&&!this.icons[e].jpm_loading)return this.icons[e]},e.prototype.loadIcons=function(e){if(!(this.iconsToLoad>0)){var t=this;this.iconsToLoad=1,this.failedIcons=0;var n=function(){t.iconsToLoad--,e&&0===t.iconsToLoad&&(t.failedIcons>0?e(new Error(t.failedIcons+" icons failed to load.")):e())};this.forEachNode(function(e){if(e.labelIcon){var l=e.labelIcon.url;if(t.icons[l])return;t.icons[l]={jpm_loading:!0},t.iconsToLoad++;var r=window.imageUrlPrefix||"";t.renderer.loadImage(r+e.labelIcon.url,function(e){t.icons[l]=e,n()},function(e){console.log("Failed to load: "+l+" (prefix: "+r+")"),t.failedIcons++,n()})}}),n()}},e.prototype.findLabelAtWorldPos=function(e){var t=this.graph.nodes;for(var n in t)if(t.hasOwnProperty(n)){var l=this.graph.nodes[n];if(l.properties&&(l.properties.labelCoord||l.properties.labelPixelOffset)&&this.setLabelBbox(l),l.properties&&l.properties.labelBbox&&X.contains(l.properties.labelBbox,e))return l}},e.prototype.findNodePointAtViewerPos=function(e){var t=this.graph;for(var n in t.nodes){var l=t.nodes[n];if(!l.properties||0!=l.properties.point){var r=(l.properties.radius||this.defaultRadius)*this.renderer.pixelRatio;if(c.dist(l.viewerPos,e)<r)return l}}},e.prototype.fillClicMap=function(e,t){var n=document.getElementById("image-clic-map"),l=this.graph;if(n){var r="";for(var i in l.nodes){var o=l.nodes[i];if(o.label){var a=this.computeNodeSizeWithMargin(e.getContext("2d"),o),s=o.labelPixelPos(t,this.renderer.pixelRatio),u=[s.x-a.width/2,s.y-a.height/2,s.x+a.width/2,s.y+a.height/2].map(function(e){return Math.round(e)});u[0]>=e.width||u[1]>=e.height||u[2]<0||u[3]<0||(r+='<area href="'+(o.dbid||o.name)+'" shape="rect" alt="'+o.label+'" coords="'+u.join(",")+'">\n')}}n.innerHTML=r}},e}(),ue=function(){function e(e,t,n){this.name=e,this.width_mm=t,this.height_mm=n}return e.fromPt=function(t,n,l){return new e(t,n/e.mmToPoint,l/e.mmToPoint)},e.fromIPageSize=function(t){return new e(t.name,t.width_mm,t.height_mm)},e.prototype.widthPt=function(){return Math.round(this.width_mm*e.mmToPoint)},e.prototype.heightPt=function(){return Math.round(this.height_mm*e.mmToPoint)},e.prototype.key=function(){return Math.round(this.width_mm)+"x"+Math.round(this.height_mm)},e.mmToPoint=2.83465,e}(),pe=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))(function(r,i){function o(e){try{s(l.next(e))}catch(e){i(e)}}function a(e){try{s(l.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((l=l.apply(e,t||[])).next())})},de=this&&this.__generator||function(e,t){var n,l,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,l&&(r=2&i[0]?l.return:i[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],l=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function ce(e){if(!e)throw new Error("worldToLatLon: Point is not defined");var t=Utils.worldToLatLon(e);return[t.lon,t.lat]}function he(e,t,n){var l={sources:{},layers:[],filters:[],articleId:t},r="ic-"+t,i={};if(e.length>0){var o={"icon-image":["concat","jpm-",["get","icon"]],"icon-size":["*",2/64,["coalesce",["get","radius"],16]]};n.withText&&(o["text-optional"]=!0,o["text-size"]=12,o["text-field"]=["coalesce",["get","name:LANG"],["get","name"]],o["text-font"]=n.textFont||["match",["get","fontName"],"noto",["literal",["Noto Sans Bold"]],["literal",["Open Sans Regular"]]],o["text-anchor"]=n.textAnchor||"top",o["text-offset"]="left"==n.textAnchor?[1.75,0]:[0,1.2],"left"==n.textAnchor&&(o["text-justify"]="left",o["text-size"]=10),i["text-halo-color"]="rgba(255,255,255,0.8)",i["text-halo-width"]=1.5);for(var a="source-symbol-"+r,s=function(e,t){for(var n={},l=0,r=e;l<r.length;l++){var i=r[l];i.properties&&void 0!=i.properties.publishedIcon?n[i.properties.publishedIcon]=1:n[t||"generic"]=1}return Object.keys(n)}(e,n.defaultIcon),u=0,p=s;u<p.length;u++){var d=p[u],c={type:"symbol",id:"symbol-"+r+"-"+d,source:a,layout:o,filter:["==","icon",d],metadata:{filter:d}};i&&(c.paint=i),l.layers.push(c),l.filters.push({key:d,icon:d})}l.sources[a]={type:"geojson",data:function(e,t){var n=[];for(var l in e){var r=e[l];if(!r.properties.skip){for(var i=r.properties||{},o={name:r.label,icon:i.publishedIcon||t||"generic"},a=0,s=Object.keys(i);a<s.length;a++){var u=s[a];u.match(/name_/)&&(o[u.replace("_",":")]=i[u])}for(var p={type:"Feature",geometry:{type:"Point",coordinates:ce(r.coord)},properties:o},d={poiId:"poi-id",articleId:"articleID"},c=0,h=Object.keys(d);c<h.length;c++){var f=h[c];i[f]&&(p.properties[d[f]]=i[f])}n.push(p)}}return{type:"FeatureCollection",features:n}}(e,n.defaultIcon)}}return l}function fe(e,t,n){return pe(this,void 0,Promise,function(){var l=this;return de(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){return pe(l,void 0,void 0,function(){var l;return de(this,function(r){switch(r.label){case 0:return l={edge:e},[4,function(e,t,n){return pe(this,void 0,Promise,function(){var l,r,i,o,a,s,u,p,d;return de(this,function(c){switch(c.label){case 0:if(l=n.nodes,r=t.edgeProperty(e,"geom"),e.properties&&e.properties.hidden||l[e.from].properties.skip||l[e.to].properties.skip)return[2,[]];if("route"!=r)return[3,5];if(i=n.getEdgeRoute(e),o="route data from: "+l[e.from].label+" to "+l[e.to].label,i)return[3,4];console.log("Trying to fetch missing "+o+"."),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,n.getEdgeDirections(e,n.edgeProperty(e,"travelMean"))];case 2:return i=c.sent(),console.log("Done fetching "+o+"."),e.properties.route=i,[3,4];case 3:return c.sent(),console.log("Failed to fetch "+o+"."),[3,4];case 4:if(i&&i.geom)return[2,i.geom.map(ce)];r="straight",c.label=5;case 5:if("straight"==r)return[2,[l[e.from].coord,l[e.to].coord].map(ce)];if(2==e.controlPoints.length){for(a=[l[e.from].coord,e.controlPoints[0],e.controlPoints[1],l[e.to].coord],s=[],u=0,p=a;u<p.length;u++)d=p[u],s.push(d.x),s.push(d.y);return[2,new Bezier(s).getLUT(128).map(ce)]}return console.log("Unexpected edge structure, not drawing"),[2,[]]}})})}(e,t,n)];case 1:return[2,(l.coords=r.sent(),l)]}})})}))];case 1:return[2,{type:"FeatureCollection",features:r.sent().map(function(e){var n={mean:t.edgeProperty(e.edge,"travelMean"),color:t.edgeProperty(e.edge,"lineColor"),width:parseFloat(t.edgeProperty(e.edge,"lineWidth"))};return{type:"Feature",geometry:{type:"LineString",coordinates:e.coords},properties:n}})}]}})})}function ge(e,t){var n,l=t.nodes,r=t.edgeProperty(e,"geom");if(e.properties&&e.properties.hidden||l[e.from].properties.skip||l[e.to].properties.skip)return[];if("route"===r&&e.properties.route&&e.properties.route.midpoint)n=[e.properties.route.geom[e.properties.route.midpoint]];else if("spline"==r){var i=t.bezier(e);n=[];for(var o=0,a=i;o<a.length;o++){var s=a[o];n.push(new c(s.get(.5)))}}else if("straight"==r){var u=l[e.from].coord,p=l[e.to].coord;n=[c.plus(u,p).mul(.5)]}else n=[];var d={Bike:"bicycle-solid",Bus:"bus-solid",Car:"car-solid",Helicopter:"helicopter-solid",Plane:"plane-solid",Boat:"ship-solid",Train:"train-solid",Walk:"walking-solid"},h=t.edgeProperty(e,"travelMean");return n.map(function(t){var n=l[e.from].coord,r=l[e.to].coord,i=c.minus(r,n),o=180*Math.atan2(i.x,-i.y)/Math.PI;return{type:"Feature",geometry:{type:"Point",coordinates:ce(t)},properties:{orient:o,icon:d[h]}}})}function me(e,t,n){if(t){var l,r,i,o,a,s=e+"-poly";switch(n.sources[s]={type:"geojson",data:t},function(){var e=ae();if(e.preferences&&e.preferences.map_style)return e.preferences.map_style;return}()){case"topo":case"streets":r="#000000",i=l="#ffffff",o=a=.2;break;case"positron":case"https://api.maptiler.com/maps/dda79759-12f3-4996-b7c3-b3df0f9e4676/style.json?key=e7trAnc5053j8mX60MlQ":r="#000000",i="#664444",l="#000000",o=.15,a=.25}var u={type:"fill",id:e+"-poly-fill",source:s,paint:{"fill-color":["case",["coalesce",["get","selected"],!1],r,l],"fill-opacity":["case",["coalesce",["get","selected"],!1],a,o]},metadata:{beforeFirstLayerOfType:"symbol"}},p={type:"line",id:e+"-poly-line",source:s,layout:{"line-join":"round"},paint:{"line-color":["coalesce",["get","stroke"],i],"line-width":["coalesce",["get","stroke-width"],6]},metadata:{afterLayer:u.id}};n.layers||(n.layers=[]),n.layers.push(u),n.layers.push(p)}}function ve(e){return pe(this,void 0,Promise,function(){var t,n;return de(this,function(l){switch(l.label){case 0:return(t=function(e){var t=(e._tripData.additionalPlaces||[]).filter(function(e){return e.name.match(/^kml-/)}),n=function(e){for(var t=0,n=e;t<n.length;t++){var l=n[t];if(l.properties&&l.properties.articleId)return"a:"+l.properties.articleId}}(t);if(void 0!=n){var l=he(t,n,{defaultIcon:"generic",withText:!0,textAnchor:"left",textFont:["Noto Sans Bold"]});return me(n,e.getInteractiveData(),l),l}}(e))?[2,t]:(r=ae(),(n=r.day_id?"d:"+r.day_id:r.trip_id?"t:"+r.trip_id:void 0)?(t=function(e,t){return he(t._tripData.places||[],e,{defaultIcon:"tripstop",withText:!0,textFont:["Noto Sans Bold"]})}(n,e),[4,function(e,t,n){return pe(this,void 0,void 0,function(){var l,r,i,o,a,s,u,p,d,c,h,f,g,m,v;return de(this,function(y){switch(y.label){case 0:return l=e.makeGraph(),0==(r=l.edges||[]).length?[2]:(o={type:"line",id:"edge-"+t,source:i="s-edge-"+t,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["get","width"]},metadata:{beforeFirstLayerOfType:"symbol",filter:"tripstop",clickable:!1}},n.layers.push(o),a=n.sources,s=i,u={type:"geojson"},[4,fe(r,e,l)]);case 1:for(a[s]=(u.data=y.sent(),u),p={type:"FeatureCollection",features:[]},d=0,c=r;d<c.length;d++)h=c[d],(f=e.edgeProperty(h,"travelMean"))&&"Unspecified"!=f&&(p.features=p.features.concat(ge(h,l)));return p.features.length>0&&(g=i+"-mean",n.sources[g]={type:"geojson",data:p},m={type:"symbol",id:o.id+"-bubble",source:g,layout:{"icon-image":"jpm-circle_with_arrow","icon-size":.25,"icon-ignore-placement":!0,"icon-rotation-alignment":"map","icon-rotate":{type:"identity",property:"orient"},"icon-padding":0},metadata:{filter:"tripstop",beforeLayer:n.layers[0].id,clickable:!1}},n.layers.push(m),v={type:"symbol",id:o.id+"-mean",source:g,layout:{"icon-image":["concat","jpm-",["get","icon"]],"icon-size":10/64,"icon-ignore-placement":!0,"icon-rotate":["case",["==",["get","icon"],"plane-solid"],["-",["get","orient"],90],0],"icon-padding":18},metadata:{filter:"tripstop",afterLayer:m.id,clickable:!1}},n.layers.push(v)),[2]}})})}(e,n,t)]):[3,2]);case 1:l.sent(),l.label=2;case 2:return[2,t]}var r})})}function ye(e,t){var n=ce(e),l=ce(t),r=Math.PI*n[1]/180,i=Math.PI*l[1]/180,o=Math.PI*n[0]/180-Math.PI*l[0]/180,a=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(o);return 1609.344*(a=60*(a=180*(a=Math.acos(a))/Math.PI)*1.1515)}var be,_e=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))(function(r,i){function o(e){try{s(l.next(e))}catch(e){i(e)}}function a(e){try{s(l.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((l=l.apply(e,t||[])).next())})},Pe=this&&this.__generator||function(e,t){var n,l,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,l&&(r=2&i[0]?l.return:i[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],l=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},we=function(){function e(e){this.AlertMessageService=e,this.reset()}return e.makePlaneIcon=function(e,t){var n=new oe;return n.name=t.dbid+"-"+e,n.labelIcon={url:"/ng-map/assets/plane.png",width:20,autorotate:Math.PI/2*("landing"===e?1:-1),ratioX:.5,ratioY:"landing"===e?0:1},n.coord=t.coord,n.properties={point:!1,leaderLine:"center",dashed:[5,3],leaderLineWidth:2,maxLeaderLineLength:2},n},e.prototype.places=function(){return this._tripData.places},e.prototype.stages=function(){return this._tripData.stages},e.prototype.setLocation=function(e){this._tripData.location=e},e.prototype.location=function(){return this._tripData.location},e.prototype.width_mm=function(){return this._tripData.width},e.prototype.height_mm=function(){return this._tripData.height},e.prototype.pageSizeName=function(){return this._tripData.pageSizeName},e.prototype.world=function(){return this._tripData.world||(this._tripData.world={}),this._tripData.world},e.prototype.setSize=function(e,t,n){this._tripData.width=t,this._tripData.height=n,this._tripData.pageSizeName=e},e.prototype.defaultRadius=function(){return this._tripData.defaultRadius},e.prototype.defaultTextProp=function(){return this._tripData.defaultTextProp||(this._tripData.defaultTextProp={}),this._tripData.defaultTextProp},e.prototype.defaultEdgeProp=function(){return this._tripData.defaultEdgeProp||(this._tripData.defaultEdgeProp=e.defaultTrip().defaultEdgeProp),this._tripData.defaultEdgeProp},e.prototype.edgeProperty=function(e,t){var n=e.properties[t]||this._tripData.defaultEdgeProp[t];if("geom"==t&&"route"==n){var l=e.properties.travelMean||this._tripData.defaultEdgeProp.travelMean;if(!l||!h.isRoutable(l))return"straight"}return n},e.prototype.nodeProperty=function(e,t){return e.properties[t]||this._tripData.defaultTextProp[t]},e.prototype.reset=function(){this._tripData=e.defaultTrip()},e.defaultTrip=function(){window;var e=ae().preferences||{},t=new ue("Full page",128,190);if(e.default_page_size&&e.page_sizes)for(var n=0,l=e.page_sizes;n<l.length;n++){var r=l[n];if(r.name==e.default_page_size){t=r;break}}return{places:[],stages:[],additionalPlaces:[],location:{x:.5,y:.5,scale:1/8},defaultRadius:8,width:t.width_mm,height:t.height_mm,pageSizeName:t.name,borderColor:"#fefefe",landColor:"#cecece",seaColor:"#c4e3ff",showRivers:!1,world:{},defaultTextProp:Object.assign({fontSize:12,font:"'PT Sans', sans-serif",stroke:"rgba(255,255,255,.8)",fill:"#000000"},e.default_node_prop),defaultEdgeProp:Object.assign({lineWidth:2,lineColor:"#000000",geom:e.line_shape||"straight"},e.default_edge_prop)}},e.prototype.setPlaces=function(e){this._tripData.places.splice.apply(this._tripData.places,[0,this._tripData.places.length].concat(e)),this.updateStages(),this.updateLandingsAndTakeoff()},e.prototype.stagesAsDict=function(){for(var e={},t=0,n=this._tripData.stages;t<n.length;t++){var l=n[t];l.from in e||(e[l.from]={}),e[l.from][l.to]=l}return e},e.prototype.edgeFrom=function(e){for(var t=0,n=this._tripData.stages;t<n.length;t++){var l=n[t];if(l.from==e)return l}},e.prototype.updateStages=function(){for(var e=this._tripData.places,t=e.length-1,n=(this._tripData.stages,[]),l=this.stagesAsDict(),r=1;r<=t;++r){var i=e[r-1].dbid,o=e[r].dbid;if(l[i]&&l[i][o]){var a=l[i][o];a.to=e[r].name,a.fromIndex=r-1,n.push(a)}else n.push(new h({from:e[r-1].name,fromIndex:r-1,to:e[r].name,fromDbId:i,controlPoints:re.generateControlPoints(r>=2?e[r-2].coord:void 0,e[r-1].coord,e[r].coord,r+1<e.length?e[r+1].coord:void 0),properties:e[r-1].followingEdgeProp||{}}))}this._tripData.stages.splice.apply(this._tripData.stages,[0,this._tripData.stages.length].concat(n))},e.prototype.updateLandingsAndTakeoff=function(){for(var t={},n=this._tripData.additionalPlaces,l=0;l<n.length;++l)t[n[l].name]=l;for(var r=[],i={},o={},a=["landing","takeoff"],s=0,u=this._tripData.places;s<u.length;s++)for(var p=u[s],d=0,c=a;d<c.length;d++){var h=c[d],f=p.dbid+"-"+h;o[f]=!0,!p.properties.skip&&p.properties[h]?f in t||r.push(e.makePlaneIcon(h,p)):f in t&&(i[f]=!0)}var g=/-(landing|takeoff)$/,m=n.filter(function(e){return!(e.name in i)&&(e.name in o||null==e.name.match(g))}).concat(r);this._tripData.additionalPlaces.splice.apply(this._tripData.additionalPlaces,[0,this._tripData.additionalPlaces.length].concat(m))},e.prototype.nodeRadius=function(e,t){var n=this._tripData.defaultRadius;return e.properties&&e.properties.radius&&(n=e.properties.radius),n*t},e.prototype.makeGraph=function(e){for(var t={},n=function(e,n){var l=oe.parse(e);l.name=e.name+","+n.name,l.allPlaces=e.allPlaces.concat([n]);var r=e.label.split("\n");return r.indexOf(n.label)<0&&r.push(n.label),l.label=r.join("\n"),t[e.name]=t[n.name]=l.name,l},l=function(e){for(var n=e;n in t;)n=t[n];return n},r=0,i=this._tripData.places;r<i.length;r++){if(!(v=i[r]).name)throw new Error("nodes should have names and labels")}var o=[];if(e){for(var a=e.renderer.pinchZoom,s=e.renderer.pixelRatio,u=0,p=this._tripData.places;u<p.length;u++){(P=p[u]).viewerPos=a.viewerPosFromWorldPos(P.coord)}for(var d=0,h=this._tripData.places;d<h.length;d++){if(!(!(P=h[d]).label||P.properties&&P.properties.skip)){for(var f=this.nodeRadius(P,s),g=!0,m=0;m<o.length;++m){var v=o[m];if(c.dist(v.viewerPos,P.viewerPos)<this.nodeRadius(v,s)+f){o[m]=n(v,P),g=!1;break}}if(g)P.properties||(P.properties={}),(_=oe.parse(P)).place=P,_.allPlaces=[P],o.push(_)}}}else for(var y=0,b=this._tripData.places;y<b.length;y++){var _,P=b[y];(_=oe.parse(P)).place=P,_.allPlaces=[P],o.push(_)}var w=this._tripData.places,x={};for(m=0;m<w.length;++m){x[(v=w[m]).name]=m}for(var C=new re(void 0,this._tripData.defaultEdgeProp,this.AlertMessageService),k=0,L=o;k<L.length;k++){v=L[k];C.nodes[v.name]=v}this.updateLandingsAndTakeoff();for(var M=0,T=this._tripData.additionalPlaces;M<T.length;M++){v=T[M];C.nodes[v.name]=v}for(var S=0,O=this._tripData.stages;S<O.length;S++){var I=O[S];if(void 0==I.fromIndex&&(I.fromIndex=x[I.from]),!(I.properties.hidden||w[I.fromIndex]&&w[I.fromIndex].isSkipped())){var D=l(I.from),R=I.fromIndex+1;if(!Number.isNaN(R)){for(;R<w.length&&w[R].isSkipped();)++R;if(!(R>=w.length||w[R].isSkipped())){var E=l(w[R].name);if(D!==E){var z=se.shallowCopy(I);z.from=D,z.to=E,z.originalEdge=I;var F=z.properties.route;F&&F.from==D&&F.to==E&&F.mean==I.properties.travelMean||(I.properties.travelMean&&"Unspecified"!=I.properties.travelMean?z.properties.route={mean:I.properties.travelMean,from:D,to:E,distance_m:ye(w[R].coord,w[I.fromIndex].coord)}:delete z.properties.route),C.edges.push(z)}}}}}return C},e.prototype.save=function(){return _e(this,void 0,Promise,function(){var e;return Pe(this,function(t){switch(t.label){case 0:return e=this._tripData,[4,ve(this)];case 1:return e.interactiveContent=t.sent(),[2,this._tripData]}})})},e.prototype.load=function(e){if("string"==typeof e&&(e=JSON.parse(e)),!e||!e.places||!e.stages)throw new Error("no data");var t=e,n=function(e){for(var t=0;t<e.length;++t)e[t]=oe.parse(e[t])};n(t.places);for(var l=t.stages,r=0;r<l.length;++r)l[r]=new h(l[r]),void 0==l[r].fromIndex&&(l[r].fromIndex=r);n(t.additionalPlaces),this._tripData=t,this.defaultEdgeProp(),this.setSize(e.pageSizeName,e.width,e.height)},e.prototype.seaColor=function(){return this._tripData.seaColor},e.prototype.setSeaColor=function(e){this._tripData.seaColor=e},e.prototype.landColor=function(){return this._tripData.landColor},e.prototype.setLandColor=function(e){this._tripData.landColor=e},e.prototype.borderColor=function(){return this._tripData.borderColor},e.prototype.setBorderColor=function(e){this._tripData.borderColor=e},e.prototype.showRivers=function(){return this._tripData.showRivers},e.prototype.toggleShowRiver=function(){this._tripData.showRivers=!this._tripData.showRivers},e.prototype.language=function(){return this._tripData.language||"en"},e.prototype.setLanguage=function(e){this._tripData.language=e},e.prototype.placeByName=function(e){for(var t=0,n=this._tripData.places;t<n.length;t++){var l=n[t];if(e===l.name)return l}},e.prototype.markFirstLocation=function(){for(var e=0,t=this._tripData.places;e<t.length;e++){"firstVisited"in(r=t[e]).properties&&delete r.properties.firstVisited}for(var n=0,l=this._tripData.places;n<l.length;n++){var r;if(!(!(r=l[n]).label||r.properties&&r.properties.skip))return void(r.properties.firstVisited=!0)}},e.prototype.clearUserPlacements=function(){for(var e=0,t=this._tripData.additionalPlaces.concat(this._tripData.places);e<t.length;e++){var n=t[e];n.properties&&(n.properties.userPlacement&&delete n.properties.userPlacement,n.properties.userPlacementPixelOffset&&delete n.properties.userPlacementPixelOffset)}},e.prototype.getMapStyle=function(){return ae().preferences.map_style||"streets"},e.prototype.filterAdditionalPlace=function(e){var t=this._tripData.additionalPlaces.filter(e);this._tripData.additionalPlaces.splice.apply(this._tripData.additionalPlaces,[0,this._tripData.additionalPlaces.length].concat(t))},e.prototype.setAdditionalPlace=function(e){var t=this._tripData.additionalPlaces,n=t.find(function(t){return t.name==e.name});n?t[t.indexOf(n)]=e:t.push(e)},e.prototype.renameNodes=function(e,t,n){for(var l=0,r=this._tripData.places;l<r.length;l++){var i=r[l];-1!=i.name.search(e)&&(i.label=i.label.replace(t,n))}},e.prototype.getInteractiveData=function(){return this._tripData.interactiveData},e.prototype.clearInteractiveData=function(){this._tripData.interactiveData&&delete this._tripData.interactiveData},e.prototype.addInteractiveData=function(e){this._tripData.interactiveData||(this._tripData.interactiveData={type:"FeatureCollection",features:[]}),this._tripData.interactiveData.features.push(e)},e}(),xe=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))(function(r,i){function o(e){try{s(l.next(e))}catch(e){i(e)}}function a(e){try{s(l.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((l=l.apply(e,t||[])).next())})},Ce=this&&this.__generator||function(e,t){var n,l,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,l&&(r=2&i[0]?l.return:i[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],l=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};!function(e){e[e.Location=1]="Location",e[e.Node=2]="Node",e[e.NodeStyle=3]="NodeStyle",e[e.Edge=4]="Edge",e[e.PageSize=5]="PageSize",e[e.MapColor=6]="MapColor",e[e.Frame=7]="Frame",e[e.LabelMoved=8]="LabelMoved",e[e.CurveMoved=9]="CurveMoved",e[e.Label=10]="Label",e[e.LabelProperties=11]="LabelProperties",e[e.EdgeProperties=12]="EdgeProperties",e[e.UpdatedLocations=13]="UpdatedLocations"}(be||(be={}));var ke=function(){function e(e,t){this.http=e,this.AlertMessageService=t;var n=document.querySelectorAll("meta[name^=role]")[0];this.role=n?n.getAttribute("content"):"unknown",this.superadmin="super-admin"==this.role,this._canvasWidth=512,this._canvasHeight=512,this._selectedCountry="",this._loadingMap=!1,this._autoLockMap=!0;ae().preferences.page_sizes?this._pageSizes=ae().preferences.page_sizes.map(ue.fromIPageSize):this._pageSizes=[new ue("Full page",128,190),new ue("Full page rotated",190,128),new ue("Square",128,128),new ue("Landscape",128,95)],this._pageSizeMap={};for(var l=0,r=this._pageSizes;l<r.length;l++){var i=r[l];this._pageSizeMap[i.key()]=i}this._numLocations=0,this._showSpinner=!1,this._seqTrip=new we(this.AlertMessageService),this._graph=new re(void 0,this._seqTrip.defaultEdgeProp(),this.AlertMessageService),this._tripLayer&&(this._tripLayer.defaultTextProp=this._seqTrip.defaultTextProp(),this._tripLayer.defaultEdgeProp=this._seqTrip.defaultEdgeProp()),this._visitedPlaceList=this._seqTrip.places(),this._stages=this._seqTrip.stages(),this._interleaved=this.interleavedPlacesAndEvents(),this.setPageSize(this._pageSizes[0].key()),this.language=ae().language,this._seqTrip.setLanguage(ae().language),window.serializeMap=this.serializeMap.bind(this)}return e.prototype.fetchRawLocations=function(){var e=this;this._numLocations=0;var t=ae();return(t.locations?Promise.resolve(t.locations.map(function(e){return Object.assign({},e)})):t.locations_url?new Promise(function(n,l){e.http.get(t.locations_url,{responseType:"json"}).subscribe(function(e){Array.isArray(e)?n(e):l("bad map data")},function(e){l(e)})}):Promise.resolve(void 0)).then(function(t){return t&&(e._numLocations=t.length),t})},e.prototype.translateLocations=function(e){var t=this;return new Promise(function(n,l){for(var r in e)e[r].translations&&e[r].translations[ae().language]?e[r].label=e[r].translations[ae().language]:e[r].translations&&e[r].translations.en&&(e[r].label=e[r].translations.en);var i=e.filter(function(e){return e.geoname_id&&!e.translations}).map(function(e){return e.geoname_id});if(0!=i.length){var o=ae().geoname_service_url+"location?q="+i.join(",")+"&l="+ae().language;t.http.get(o,{responseType:"json"}).subscribe(function(t){if(t&&Array.isArray(t)){for(var l={},r=0,i=t;r<i.length;r++){var o=i[r];l[o.id]=o}for(var a=0,s=e;a<s.length;a++){var u=s[a];u.geoname_id&&u.geoname_id in l&&l[u.geoname_id].name&&(u.label=l[u.geoname_id].name)}return n(e)}n(e)},function(e){l(e)})}else n(e)})},e.prototype.fetchLocations=function(){var e=this;return this.fetchRawLocations().then(function(t){return t?e.translateLocations(t):void 0})},e.prototype.generateFromLocations=function(e){this._seqTrip.reset(),this.updateWithLocations(e,{resetLocation:!0,resetLabels:!0}),this._tripLayer&&(this._tripLayer.defaultTextProp=this._seqTrip.defaultTextProp(),this._tripLayer.defaultEdgeProp=this._seqTrip.defaultEdgeProp()),this.saveMap()},e.prototype.updateWithLocations=function(e,t){return xe(this,void 0,void 0,function(){var n,l,r,i,o,a,s,u,p,d,h,f,g,m,v,y,b=this;return Ce(this,function(_){switch(_.label){case 0:for(t=t||{},n=function(e,t){var n=Utils.latLonToWorld([t,e]);return new c(n)},l={},r=0,i=this._seqTrip.places();r<i.length;r++)"dbid"in(y=i[r])&&(l[y.dbid]=y);for(o=[],a=0,s=0,u=e;s<u.length;s++)if(p=u[s],d=n(p.latitude,p.longitude),(h=""+p.id)in l)(f=l[h]).coord=d,f.label&&!t.resetLabels||(f.label=p.label),f.indication&&!t.resetLabels||(f.indication=p.indication),o.push(f);else{for(g=oe.parse({dbid:h,name:h,label:p.label,indication:p.indication,coord:d,properties:p.node_prop}),p.following_edge_prop&&(g.followingEdgeProp=p.following_edge_prop),m=0,v=o;m<v.length;m++)if((y=v[m]).dbid==g.dbid){g.properties=y.properties;break}o.push(g),++a}return this._seqTrip.setPlaces(o),this._seqTrip.markFirstLocation(),t.resetLocation&&this._seqTrip.setLocation(this._seqTrip.makeGraph().location(this._seqTrip.width_mm()/this._seqTrip.height_mm(),1.2)),this._visitedPlaceList=this._seqTrip.places(),this._stages=this._seqTrip.stages(),this._interleaved=this.interleavedPlacesAndEvents(),[4,this.pushSeqTripToCanvas(t.resetLocation)];case 1:return _.sent(),a>0||t.resetLabels?this._runAfterInit=function(){b.placeLabels(!t.resetLabels)}:this._runAfterInit=function(){b.makeGraph()},[2]}})})},e.prototype.destination=function(e){return this._tripLayer&&e.to in this._tripLayer.graph.nodes?this._tripLayer.graph.nodes[e.to]:this._seqTrip.placeByName(e.to)},e.prototype.origin=function(e){return this._tripLayer&&e.from in this._tripLayer.graph.nodes?this._tripLayer.graph.nodes[e.from]:this._seqTrip.placeByName(e.from)},e.prototype.ngOnInit=function(){var e=this;this.mapview.onMapReady=function(){e.isReady()&&console.log("Map is ready.")},this.loadMap()},e.prototype.pushSeqTripToCanvas=function(e){for(var t=this,n=0,l=["seaColor","borderColor","landColor","showRivers"];n<l.length;n++);var r=new ue(this._seqTrip.pageSizeName(),this._seqTrip.width_mm(),this._seqTrip.height_mm());return this._pageSizeMap[r.key()]||(this._pageSizeMap[r.key()]=r,this._pageSizes.push(r)),this.setPageSize(r.key(),!1),new Promise(function(e,t){return setTimeout(e,20)}).then(function(){t._renderer&&(t._renderer.setLocation(t._seqTrip.location()),t._graph=t.mapview.setSeqTrip(t._seqTrip)),!0===e?t.reset():t._renderer&&t.makeGraph()})},e.prototype.ngAfterViewInit=function(){},e.prototype.scale=function(){var e=this._seqTrip.location();return e?Math.log2(1/e.scale):0},e.prototype.setScale=function(e){var t=this,n=this._renderer;if(n){var l=n.getLocation();l.scale=1/Math.pow(2,e),n.setLocation(l),this._seqTrip.setLocation(this._renderer.getLocation()),this.modified(be.Location),this._scaleChangeTimeout&&clearTimeout(this._scaleChangeTimeout),this._scaleChangeTimeout=setTimeout(function(){t.placeLabels(!0)},800)}},e.prototype.prepareCanvas=function(e){var t=this;this._seqTrip&&this.mapview.prepareCanvas({disableMouseWheel:!this.hideUi(),trip:this._seqTrip,graph:this._graph,onLocationChange:function(e){if(!t._loadingMap&&t._seqTrip&&t._tripLayer&&t._editor){var n=e.getLocation(),l=!1;if(t._needLabelPlacement)clearTimeout(t._needLabelPlacement),t._needLabelPlacement=void 0,l=!0;else l=!t._seqTrip.makeGraph(t._tripLayer).compareNodes(t._tripLayer.graph);l?t._needLabelPlacement=setTimeout(function(){console.log("Placing labels after motion."),t._seqTrip.setLocation(e.getLocation());var n=t._seqTrip.makeGraph(t._tripLayer);t._graph=n,t._tripLayer.graph=n,t._editor.graph=n,t.placeLabels(!0),t._needLabelPlacement=void 0},500):t._seqTrip.setLocation(n),t.modified(be.Location)}},alreadyCreated:function(t){e&&e()},created:function(n,l){t._renderer=n,t._tripLayer=l,setTimeout(function(){return xe(t,void 0,void 0,function(){var t=this;return Ce(this,function(n){switch(n.label){case 0:return this.clearSelection(),this._editor=new ie(this._renderer,this._graph,l),this._renderer.pinchZoom.touchEventHandlers.push(this._editor),this._editor.onLabelMoved=function(e){t.modified(be.LabelMoved)},this._editor.onBezierMoved=function(e){t.modified(be.CurveMoved)},this._editor.onLabelSelect=function(e){t.selectNode(e)},this._editor.onBezierSelect=function(e){e?t.selectEdge(e.edge):t.clearSelection()},[4,this.pushSeqTripToCanvas()];case 1:return n.sent(),this.mapview.resize(),e&&e(),[2]}})})},10)}})},e.prototype.mapIsLocked=function(){return this._renderer&&this._renderer.pinchZoom&&this._renderer.pinchZoom.locked},e.prototype.lockMap=function(e){this._renderer&&this._renderer.pinchZoom&&(this._renderer.pinchZoom.locked=e&&this._autoLockMap)},e.prototype.ngOnDestroy=function(){this._autoRefresh&&clearInterval(this._autoRefresh)},e.prototype.clearSelection=function(){this._selectedCountry=void 0,this._selectedNode=void 0,this._selectedEdge=void 0},e.prototype.clearAndSaveSelection=function(){var e={_selectedCountry:this._selectedCountry,_selectedNode:this._selectedNode,_selectedEdge:this._selectedEdge};return this.clearSelection(),e},e.prototype.restoreSelection=function(e){this._selectedCountry=e._selectedCountry,this._selectedNode=e._selectedNode,this._selectedEdge=e._selectedEdge},e.prototype.selectCountry=function(e){this.clearSelection(),this._selectedCountry=e,this.setCountryColor(e,this.countryColor(e))},e.prototype.setCountryColor=function(e,t){if(e){var n,l="default"==t,r=!1;n?l?(r=!!n.color,delete n.color,0==Object.keys(n).length&&delete this._worldLayer.params.countryStyle[e]):(r=n.color!==t,n.color=t):l||(r=!0,n=this._worldLayer.params.countryStyle[e]={color:t}),r&&this.modified(be.MapColor)}},e.prototype.countryColor=function(e){return this._worldLayer&&this._worldLayer.params.countryStyle[e]&&this._worldLayer.params.countryStyle[e].color?this._worldLayer.params.countryStyle[e].color:this._seqTrip.landColor()},e.prototype.tunedCountries=function(){return this._worldLayer?Object.keys(this._worldLayer.params.countryStyle):[]},e.prototype.selectNode=function(e){if(this.clearSelection(),e&&(e.properties||(e.properties={}),e.name in this._graph.nodes&&(this._selectedNode=this._graph.nodes[e.name]),e!==this._editor.selectedLabel)){var t=this._editor.onLabelSelect,n=this._editor.onBezierSelect;this._editor.onLabelSelect=function(){},this._editor.onBezierSelect=function(){},e.name in this._editor.graph.nodes?this._editor.selectLabel(e):this._editor.deselectLabel(),this._editor.onLabelSelect=t,this._editor.onBezierSelect=n}},e.prototype.isNodeSelected=function(e){return this._selectedNode&&e&&this._selectedNode.properties===e.properties},e.prototype.selectEdge=function(e){this.clearSelection(),this._selectedEdge=e},e.prototype.isEdgeSelected=function(e){return e&&this._selectedEdge&&this._selectedEdge.properties===e.properties},e.prototype.nodeNames=function(){return Object.keys(this._graph.nodes)},e.prototype.nodeArray=function(){for(var e=[],t=0,n=Object.keys(this._graph.nodes);t<n.length;t++){var l=n[t];e.push(this._graph.nodes[l])}return e},e.prototype.nodeLabelFromName=function(e){return this._graph&&e in this._graph.nodes?this._graph.nodes[e].label:""},e.prototype.isSkipped=function(e){return!(!e.properties||void 0===e.properties.skip)&&e.properties.skip},e.prototype.toggleHideEdge=function(e){this.clearSelection(),e.properties.hidden?delete e.properties.hidden:e.properties.hidden=!0,this.modified(be.Edge)},e.prototype.toggleSkipNode=function(e){this.clearSelection(),this.isSkipped(e)?delete e.properties.skip:e.properties?e.properties.skip=!0:e.properties={skip:!0},this.modified(be.Node)},e.prototype.toggleProperty=function(e,t){e.properties[t]=!e.properties[t],this.modified(be.Node)},e.prototype.setProperty=function(e,t,n,l){void 0!==n?e.properties[t]=n:t in e.properties&&delete e.properties[t],this.modified(be.NodeStyle)},e.prototype.setNodeLabel=function(e,t){var n=e.label;if(n!==t){this._seqTrip.renameNodes(e.name,n,t),console.log('Renaming: "'+n+'" into "'+t+'"');var l=this._graph;for(var r in l.nodes){var i=l.nodes[r];(i.place===e||i.allPlaces.indexOf(e)>=0)&&(i.label=i.label.replace(n,t))}e.label=t,this.modified(be.Label)}},e.prototype.removeEdge=function(e){var t=function(t){return t.from!==e.from||t.to!==e.to};this._graph.edges=this._graph.edges.filter(t),this._editor.graph.edges=this._editor.graph.edges.filter(t)},e.prototype.uiSetFrame=function(e,t){this.setFrame(e,t),this.modified(be.Frame),this.autoPlaceLabels()},e.prototype.setFrame=function(e,t){if(this._renderer){var n=this._canvasWidth,l=this._canvasHeight,r=this._seqTrip.makeGraph().location(n/l,1.2);this._seqTrip.setLocation(r),this._renderer.setLocation(r)}},e.prototype.setMapboxLocation=function(e){this.mapview.setMapboxLocation(e)},e.prototype.getLocation=function(){return this._renderer.getLocation()},e.prototype.autoPlaceLabels=function(){this._seqTrip.clearUserPlacements(),this.placeLabels(!1)},e.prototype.placeLabels=function(e){var t=this;this._tripLayer&&this._renderer&&this._seqTrip&&this.runBlockingTask(function(n){t._tripLayer.placeLabels(t._renderer.canvas.getContext("2d"),e),t.modified(be.LabelMoved),t.mapview.refresh(),n()})},e.prototype.runBlockingTask=function(e){var t=this;this._showSpinner=!0,setTimeout(function(){try{e(function(){t._showSpinner=!1})}catch(e){t._showSpinner=!1,console.log(e)}},30)},e.prototype.update=function(){this.placeLabels(!0)},e.prototype.resetCurves=function(){this._seqTrip.makeGraph().createDefaultBezier();var e=this._seqTrip.makeGraph(this._tripLayer);e.createDefaultBezier(),this._graph=e,this._tripLayer.graph=e,this._editor.graph=e,this._tripLayer.placeLabels(this._renderer.canvas.getContext("2d"),!0),this.mapview.refresh(),this.modified(be.CurveMoved)},e.prototype.makeGraph=function(){this._graph=this._seqTrip.makeGraph(this._tripLayer),this._tripLayer?this._tripLayer.graph=this._graph:console.log("Warning: makeGraph called before this._tripLayer is ready."),this._editor&&(this._editor.graph=this._graph),this._interleaved=this.interleavedPlacesAndEvents()},e.prototype.recreate=function(){this._visitedPlaceList.length&&(this.makeGraph(),this._seqTrip.markFirstLocation(),this.placeLabels(!0))},e.prototype.reset=function(){this._visitedPlaceList.length&&(this.makeGraph(),this.setFrame(),this.placeLabels(!1))},e.prototype.uiSetPageSize=function(e,t){this.setPageSize(e,t),this.modified(be.PageSize)},e.prototype.setPageSize=function(e,t){var n=this,l=this._pageSizeMap[e];if(l){this._pageSizeName=e;var r=l.widthPt(),i=l.heightPt();this._canvasWidth=1.1*r,this._canvasHeight=1.1*i,this._seqTrip.setSize(l.name,l.width_mm,l.height_mm),!1!==t&&(this.setFrame(this._canvasWidth,this._canvasHeight),setTimeout(function(){n.placeLabels(!0)},20))}this.mapview&&setTimeout(function(){n.mapview.resize()},0)},e.prototype.setLayerColors=function(){this.mapview.setLayerColors(this._seqTrip)},e.prototype.setSeaColor=function(e){e!=this._seqTrip.seaColor()&&(this._seqTrip.setSeaColor(e),this.setLayerColors(),this.modified(be.MapColor))},e.prototype.setBorderColor=function(e){e!=this._seqTrip.borderColor()&&(this._seqTrip.setBorderColor(e),this.setLayerColors(),this.modified(be.MapColor))},e.prototype.setLandColor=function(e){e!=this._seqTrip.landColor()&&(this._seqTrip.setLandColor(e),this.setLayerColors(),this.modified(be.MapColor))},e.prototype.toggleShowRiver=function(){this._seqTrip.toggleShowRiver(),this._worldLayer.params.showRivers=this._seqTrip.showRivers(),this.modified(be.MapColor)},e.prototype.fetchMap=function(){var e=this,t=ae();return t.map_settings?Promise.resolve(t.map_settings):new Promise(function(n,l){e.http.get(t.map_settings_url,{responseType:"json"}).subscribe(function(e){n(e)},function(e){l(e)})})},e.prototype.loadMap=function(){var e=this;this._loadingMap=!0,this.fetchMap().then(function(t){try{e._seqTrip.load(t);var n=!!e._seqTrip.location();return e._seqTrip.setLanguage(ae().language),e.markMapAsSaved(),e._visitedPlaceList=e._seqTrip.places(),e._stages=e._seqTrip.stages(),e._interleaved=e.interleavedPlacesAndEvents(),e.fetchLocations().then(function(t){t&&e.updateWithLocations(t,{resetLocation:!n,resetLabels:!n})}).catch(function(t){e.handleError(t)})}catch(t){return e.fetchLocationsAndGenerateMap()}}).then(function(){return e.pushSeqTripToCanvas(!1)}).then(function(){e.prepareCanvas(function(){e._runAfterInit&&e._runAfterInit(),e._loadingMap=!1})}).catch(function(t){e.pushSeqTripToCanvas(!1),e.prepareCanvas(function(){e._loadingMap=!1}),e.handleError(t)})},e.prototype.isReady=function(){return!this._loadingMap&&this.mapview.isReady()},e.prototype.fetchLocationsAndGenerateMap=function(){var e=this;return this.fetchLocations().then(function(t){t.length>0&&e.generateFromLocations(t)})},e.prototype.serializeMap=function(){return xe(this,void 0,void 0,function(){var e,t,n,l;return Ce(this,function(r){switch(r.label){case 0:if(e=this.clearAndSaveSelection(),this._editor&&this._editor.deselectLabel(),this._graph)for(t=0,n=this._graph.edges;t<n.length;t++)n[t].propagateToOriginal();return[4,this._seqTrip.save()];case 1:return l=r.sent(),this.restoreSelection(e),[2,l]}})})},e.prototype.markMapAsSaved=function(){this._saved=!0,window.mapIsSaved=!0},e.prototype.markMapAsDirty=function(){window.mapIsSaved=this._saved=!1},e.prototype.saveMap=function(){return xe(this,void 0,void 0,function(){var e,t,n=this;return Ce(this,function(l){switch(l.label){case 0:return(e=ae().map_settings_url)?[3,1]:(this.markMapAsSaved(),[3,3]);case 1:return[4,this.serializeMap()];case 2:t=l.sent(),$.ajax({type:"POST",url:e,dataType:"text",contentType:"text/plain; charset=UTF-8",data:JSON.stringify(t),success:function(){n.markMapAsSaved()},error:function(e,t,l){console.log(l),n.handleError("Error: Can't save map. Please check your internet connection.")}}),l.label=3;case 3:return[2]}})})},e.prototype.handleError=function(e){var t;t="object"==typeof e?""+("message"in e?e.message:e):"string"==typeof e?e:"Undefined error",console.log(e);var n=new K(t,"alert-danger");this.AlertMessageService.alert(n)},e.prototype.nodePropertiesChanged=function(){this.modified(be.LabelProperties),this.modified(be.NodeStyle)},e.prototype.edgePropertiesChanged=function(e){this.modified(be.EdgeProperties)},e.prototype.modified=function(e){var t=this;if(!this._loadingMap){switch(this.markMapAsDirty(),e==be.Location?this.mapview.updateCanvas():this.mapview.refresh(),e){case be.UpdatedLocations:case be.LabelMoved:case be.CurveMoved:case be.Location:break;case be.NodeStyle:case be.LabelProperties:case be.MapColor:this._seqTrip.markFirstLocation(),this.mapview.updateInteractive(),this.mapview.refresh();break;case be.EdgeProperties:case be.Label:case be.Node:case be.Edge:case be.Frame:this.recreate(),this.mapview.updateInteractive();break;case be.PageSize:}this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(function(){t._loadingMap||t.saveMap()},500)}},e.prototype.attribution=function(){return this.mapview?this.mapview.attribution().join("|"):""},e.prototype.interleavedPlacesAndEvents=function(){for(var e=[],t=(this._seqTrip.stagesAsDict(),{}),n=this._visitedPlaceList,l=function(e){return e.dbid in t?t[e.dbid]:(t[e.dbid]=e,e)},r=this._seqTrip.stages(),i=n.length-1,o=0;o<n.length;++o){var a=n[o],s=void 0;if(!(o<i&&(s=n[o+1].dbid,a.dbid===s))){var u={node:l(a),placeIndex:o};o<i&&(u.edge=r[o]),e.push(u)}}return e},e.prototype.download=function(e,t){return xe(this,void 0,void 0,function(){var n,l,r,i,o,a=this;return Ce(this,function(s){switch(s.label){case 0:return n=function(e){return Math.round(Math.pow(36,e+1)-Math.random()*Math.pow(36,e)).toString(36).slice(1)}(16),l=ae().map_print_service_url+"mapgen/"+n,r=l+"/"+e,t&&(r+="?"+Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")),i=Object.assign({},ae()),o=i,[4,this._seqTrip.save()];case 1:return o.map_settings=s.sent(),i.map_settings_url&&delete i.map_settings_url,i.locations_url&&delete i.locations_url,i.hide_ui=!0,this.http.post(l,JSON.stringify({global_map_params:i}),{headers:new H.g({"content-type":"application/json"})}).subscribe(function(e){window.open(r)},function(e){console.log(e),a.handleError(e.message)}),[2]}})})},e.prototype.resetNodeToDefault=function(e){for(var t=0,n=Object.keys(e.properties);t<n.length;t++){var l=n[t];"firstVisited"!=l&&delete e.properties[l]}this.modified(be.Node)},e.prototype.resetLabels=function(){var e=this;this.fetchLocations().then(function(t){e.updateWithLocations(t,{resetLabels:!0}),e.modified(be.Label)})},e.prototype.doSomething=function(e){!this._loadingMap&&this._numLocations>0&&!this._saved&&(e.returnValue="Your data will be lost!")},e.prototype.hideUi=function(){return ae().hide_ui||!1},e.prototype.allowDrop=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},e.prototype.drag=function(e){e.preventDefault()},e.prototype.readKmlFile=function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Placemark"),n=0;n<t.length;++n){var l=t[n],r=l.getElementsByTagName("name")[0].textContent,i=l.getElementsByTagName("coordinates")[0].textContent.split(",").map(parseFloat),o=parseInt(r);isNaN(o)&&(o=n+1),this._seqTrip.setAdditionalPlace(oe.parse({coord:new c(Utils.latLonToWorld(i)),name:"kml-"+o,label:""+o,properties:{point:!1,blackdot:!0,numberedName:r.replace(/^[0-9]*\. */,"")}}))}},e.prototype.addJsonPoint=function(e){for(var t=e.properties.index,n={point:!1,blackdot:!0,numberedName:e.properties.name,articleId:e.properties.articleID||e.properties.article,publishedIcon:(e.properties.publishedIcon||"generic").toLowerCase(),poiId:e.properties["poi-id"]},l=0,r=Object.keys(e.properties);l<r.length;l++){var i=r[l];i.match(/name_/)&&(n[i]=e.properties[i])}this._seqTrip.setAdditionalPlace(oe.parse({coord:new c(Utils.latLonToWorld(e.geometry.coordinates)),name:"kml-"+t,label:""+t,properties:n}))},e.prototype.addJsonPolygon=function(e){this._seqTrip.addInteractiveData(e)},e.prototype.readJsonFile=function(e){try{for(var t=JSON.parse(e),n=0,l=t;n<l.length;n++){var r=l[n];"Feature"==r.type&&r.properties&&("Point"==r.geometry.type?this.addJsonPoint(r):"Polygon"==r.geometry.type?this.addJsonPolygon(r):console.log("Ignoring geojson feature with geometry type: "+r.geometry.type))}}catch(e){console.log(e)}},e.prototype.drop=function(e){var t=this;e.stopPropagation(),e.preventDefault(),this._kmlReader||(this._kmlReader=new FileReader,this._kmlReader.onload=function(e){t._seqTrip.clearInteractiveData(),t._seqTrip.filterAdditionalPlace(function(e){return!e.name.match(/^kml-/)});var n=t._kmlReader.result+"";"["==n[0]?t.readJsonFile(n):t.readKmlFile(n),t.makeGraph(),t.placeLabels(!1),t.modified(be.Label)}),e.dataTransfer&&e.dataTransfer.files.length>0&&this._kmlReader.readAsText(e.dataTransfer.files[0])},e.prototype.hasMark=function(e){return!!e.properties&&(e.properties.markStyle?"first"==e.properties.markStyle:!!e.properties.firstVisited)},e.prototype.toggleInteractive=function(){this.mapview.toggleInteractive()},e.prototype.applyDefaultsEverywhere=function(){var e=function(e,t){for(var n=0,l=e;n<l.length;n++)for(var r=l[n],i=0,o=t;i<o.length;i++){var a=o[i];a in r.properties&&delete r.properties[a]}};e(this._seqTrip.places(),["fill","stroke","fontSize"]),e(this._seqTrip.stages(),["lineColor","lineWidth","travelMean","dashed","geom"]),this.edgePropertiesChanged(),this.nodePropertiesChanged()},e.prototype.faIcon=function(e){return{Bike:"fa-bicycle",Boat:"fa-ship",Bus:"fa-bus",Car:"fa-car",Helicopter:"fa-header",Plane:"fa-plane",Train:"fa-train",Walk:"fa-male"}[e]||""},e.prototype.formatRoute=function(e){var t="";if(e.distance_m&&(e.geom||(t+="~"),t+=Math.round(e.distance_m/1e3)+" km"),e.duration_s){var n=function(e){return("00"+e).slice(-2)},l=Math.floor(e.duration_s/60/60),r=Math.floor(e.duration_s/60-60*l);t+=" ~"+n(l)+":"+n(r)}return t},e.ctorParameters=function(){return[{type:H.c},{type:q}]},e}(),Le=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))(function(r,i){function o(e){try{s(l.next(e))}catch(e){i(e)}}function a(e){try{s(l.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((l=l.apply(e,t||[])).next())})},Me=this&&this.__generator||function(e,t){var n,l,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,l&&(r=2&i[0]?l.return:i[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],l=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function Te(e,t){return!(e&&e.filter&&t)||t.indexOf(e.filter)>=0}function Se(e,t){for(var n=0,l=e.getStyle().layers;n<l.length;n++){var r=l[n];if(r.type===t&&"contour_label"!==r.id&&!r.id.match(/^(water_name)|(highway)/))return r.id}}function Oe(e,t){if(t){if(t.beforeLayer&&e.getLayer(t.beforeLayer))return t.beforeLayer;if(t.afterLayer)for(var n=e.getStyle().layers,l=0;l<n.length;++l)if(n[l].id===t.afterLayer)return l+1<n.length?n[l+1].id:void 0;return t.beforeFirstLayerOfType?Se(e,t.beforeFirstLayerOfType):e.getLayer("triangle-selection")?"triangle-selection":void 0}}function Ie(e,t,n){return Le(this,void 0,Promise,function(){return Me(this,function(l){return[2,new Promise(function(l,r){var i="jpm-"+e;if(n.hasImage(i))return l(i);var o="string"==typeof t?t+e+".png":t[e];o||r(new Error("Can't build URL for icon: "+e)),n.loadImage(o,function(e,t){return e?r(e):n.hasImage(i)?l(i):(n.addImage(i,t),l(i))})})]})})}function De(e,t,n,l){for(var r=0,i=n.layers||[];r<i.length;r++){var o=i[r];void 0!=t.getLayer(o.id)&&(o.metadata&&!1===o.metadata.clickable||("on"==e?t.on("click",o.id,l):t.off("click",o.id,l)))}}function Re(e,t){if(!t||!e.layout||!e.layout["text-field"])return e;var n=e.layout["text-field"];if("string"==typeof n&&!n.match(/LANG/))return e;var l=JSON.parse(JSON.stringify(e));return l.layout["text-field"]=function e(t,n){return Array.isArray(t)?t.map(function(t){return e(t,n)}):"string"==typeof t?n(t):t}(e.layout["text-field"],function(e){return e.replace(/LANG/,t)}),l}function Ee(e,t,n,l){for(var r=t.sources||{},i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=e.getSource(a);void 0==s?e.addSource(a,t.sources[a]):t.sources[a].data&&"setData"in s&&s.setData(t.sources[a].data)}for(var u=0,p=t.layers||[];u<p.length;u++){var d=p[u];void 0==e.getLayer(d.id)&&e.addLayer(Re(d,n),Oe(e,d.metadata))}!function(e,t,n){for(var l=0,r=t.layers||[];l<r.length;l++){var i=r[l];e.setLayoutProperty(i.id,"visibility",Te(i.metadata,n)?"visible":"none")}}(e,t,l)}function ze(e,t){for(var n="function"==typeof t?t:function(e){return function(e,t){if(!e||!e.properties||!t)return!1;for(var n=Object.keys(e.properties),l=0,r=t;l<r.length;l++){var i=r[l];if(e.geometry.type==i.geometry.type&&e.geometry.coordinates.length==i.geometry.coordinates.length){for(var o=!0,a=0,s=n;a<s.length;a++){var u=s[a];if(i.properties[u]!=e.properties[u]){o=!1;break}}if(o)return!0}}return!1}(e,t)},l=[],r=e.getStyle(),i=0,o=Object.keys(r.sources);i<o.length;i++){var a=o[i];if("geojson"==r.sources[a].type){var s=r.sources[a].data;if(s&&"object"==typeof s&&"FeatureCollection"==s.type&&Array.isArray(s.features)){for(var u=0,p=0,d=s.features;p<d.length;p++){var c=d[p];if(c.properties)n(c)?(c.properties.selected||u++,c.properties.selected=!0,l.push(c)):c.properties.selected&&(u++,c.properties.selected=!1)}u>0&&e.getSource(a).setData(s)}}}return l}var Fe=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))(function(r,i){function o(e){try{s(l.next(e))}catch(e){i(e)}}function a(e){try{s(l.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((l=l.apply(e,t||[])).next())})},Ne=this&&this.__generator||function(e,t){var n,l,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,l&&(r=2&i[0]?l.return:i[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],l=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ae="e7trAnc5053j8mX60MlQ",We=(mapboxgl.AttributionControl,mapboxgl.Map,mapboxgl.ScaleControl);var je=function(){function e(){var e=this;this.waitingList=[],this._lastInteractiveClick=new Date,this._interactiveClickHandler=function(t){var n=new Date;if(!(n.getTime()-e._lastInteractiveClick.getTime()<300)){e._lastInteractiveClick=n;var l=t.features[0].properties,r=l["poi-id"],i=l.articleID||l.article;!function(e,t){for(var n=ze(e,t),l=0,r=["symbol","circle"];l<r.length;l++){var i=r[l],o=e.getLayer("highlight-"+i);o&&e.removeLayer(o.id)}if(n&&0!=n.length){var a="highlight-source",s=e.getSource(a),u={type:"FeatureCollection",features:n};if(s){if("geojson"!=s.type)throw new Error(a+" source should have type geojson, but it has "+s.type);s.setData(u)}else e.addSource(a,{type:"geojson",data:u});var p={id:"highlight-circle",type:"circle",source:a,paint:{"circle-radius":16,"circle-stroke-color":"rgba(255,255,255,.8)","circle-stroke-width":5,"circle-stroke-opacity":1,"circle-stroke-opacity-transition":{duration:0},"circle-color":"rgba(255,255,255,.8)","circle-opacity":0,"circle-opacity-transition":{duration:0}},filter:["==",["geometry-type"],"Point"]};e.addLayer(p);var d={id:"highlight-symbol",type:"symbol",source:a,layout:{"icon-image":["concat","jpm-",["get","icon"]],"icon-size":["*",2/64,["coalesce",["get","radius"],16]]},paint:{"icon-opacity":1,"icon-opacity-transition":{duration:0}},filter:["==",["geometry-type"],"Point"]};e.addLayer(d)}}(e._map,function(e){return e.properties&&e.properties["poi-id"]==r&&(e.properties.article||e.properties.articleID)==i})}}}return e.prototype.pixelRatio=function(){return window.devicePixelRatio||1},e.prototype.createMap=function(e){var t=this;if(!this._map){var n,l={container:this.mapDiv.nativeElement,style:(n=e.getMapStyle(),n.match(/^http/)?n:"https://api.maptiler.com/maps/"+n+"/style.json?key="+Ae),center:ce(e.location()),zoom:this.getZoomFromLocation(e.location()),attributionControl:!1,minZoom:0,renderWorldCopies:!0};this._map=new mapboxgl.Map(l),this._map.on("error",function(e){console.log("Map error:",e)}),this._map.on("load",function(){var e=Object.keys(t._map.getStyle().sources);t.lang&&t._map.setLanguage(t.lang);for(var n=0,l=e;n<l.length;n++){var r=l[n],i=t._map.getSource(r);i&&(i.tileSize=400,i.roundZoom=!0)}});var r=new We;return this._map.addControl(r),this._map}},e.prototype.addTripLayers=function(e,t,n,l,r){var i=this._map;this._graph=t;var o=this.buildPathGeoJson(e,t),a=i.getSource("dayEdges"),s=Se(i,"symbol");if(n)this.updateCanvasLayer(n,l,r);else if(a?a.setData(o):i.addSource("dayEdges",{type:"geojson",data:o}),void 0==i.getLayer("dayEdgesLayer"))i.addLayer({id:"dayEdgesLayer",type:"line",source:"dayEdges",minZoom:0,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["get","width"]}},s);var u=this.buildPlacesGeoJson(e,t),p=i.getSource("dayPlaces");if(p)p.setData(u),i.setLayoutProperty("dayLabels","icon-size",this._iconFactor);else{i.addSource("dayPlaces",{type:"geojson",data:u}),this.genBlackDot(),i.addLayer({id:"dayLabels",type:"symbol",source:"dayPlaces",minZoom:0,layout:{"text-field":"{label}","text-font":["match",["get","fontName"],"noto",["literal",["Noto Sans Bold"]],["literal",["Open Sans Semibold"]]],"text-anchor":"center","text-offset":{type:"identity",property:"labelOffset"},"text-size":{property:"fontSize",type:"identity"},"text-allow-overlap":!0,"text-max-width":100,visibility:this._disabledLayers?"none":"visible","icon-image":["get","icon"],"icon-anchor":"center","icon-allow-overlap":!0,"icon-size":this._iconFactor,"icon-offset":{type:"identity",property:"iconOffset"}},paint:{"text-color":{property:"fill",type:"identity"},"text-halo-color":{property:"stroke",type:"identity"},"text-halo-width":1.2}});var d=e.places().filter(function(e){return!e.properties.skip}).map(function(e){return e.label+""});this.hidePlaces(d)}},e.prototype.updateCanvasLayer=function(e,t,n){var l=this;if(e&&t){var r=this._map,i=r.getSource("canvasSource");if(i){var o=i.coordinates,a=t.map(ce);JSON.stringify(o)!=JSON.stringify(a)&&i.setCoordinates(a),i.play()}else{var s=Se(r,"symbol");r.addSource("canvasSource",{type:"canvas",canvas:e,animate:!0,coordinates:t.map(ce)}),r.addLayer({id:"canvasLayer",type:"raster",source:"canvasSource",paint:{"raster-fade-duration":0},layout:{visibility:this._disabledLayers?"none":"visible"},minZoom:0},s)}this.pauseCanvasSourceTimeout&&clearTimeout(this.pauseCanvasSourceTimeout),this.pauseCanvasSourceTimeout=setTimeout(function(){l.pauseCanvasSourceTimeout=void 0,r.getSource("canvasSource").pause()},200),this.killMapLabels(n)}},e.prototype.resize=function(){this._map&&(this._map.resize(),this._trip&&this.setMapboxLocation(this._trip.location()))},e.prototype.setMapboxLocation=function(e){if(!isFinite(e.x)||!isFinite(e.y))throw new Error("Invalid coordinates: "+e.x+", "+e.y);this._map&&(this._map.setCenter(ce(e)),isFinite(e.scale)&&this._map.setZoom(this.getZoomFromLocation(e)))},e.prototype.getZoomFromLocation=function(e){if(e){var t=this.canvasWidth;return Math.log2(1/(e.scale*(512/t)))}return 8},e.prototype.buildPathGeoJson=function(e,t){return{type:"FeatureCollection",features:t.edges.map(function(n){return{type:"Feature",geometry:{type:"LineString",coordinates:function(e,t,n){var l=n.nodes,r=t.edgeProperty(e,"geom");if(e.properties&&e.properties.hidden||l[e.from].properties.skip||l[e.to].properties.skip)return[];if("route"==r){if(e.properties&&e.properties.route&&e.properties.route.geom)return e.properties.route.geom.map(ce);r="straight"}if("straight"==r)return[l[e.from].coord,l[e.to].coord].map(ce);if(2==e.controlPoints.length){for(var i=[],o=0,a=[l[e.from].coord,e.controlPoints[0],e.controlPoints[1],l[e.to].coord];o<a.length;o++){var s=a[o];i.push(s.x),i.push(s.y)}return new Bezier(i).getLUT(128).map(ce)}return console.log("Unexpected edge structure, not drawing"),[]}(n,e,t)},properties:{mean:n.properties.travelMean,color:e.edgeProperty(n,"lineColor"),width:parseFloat(e.edgeProperty(n,"lineWidth")),dashed:(e.edgeProperty(n,"dashed")||[]).concat([1])[0]}}})}},e.prototype.buildPlacesGeoJson=function(e,t){var n=[];for(var l in this._iconFactor=(e.defaultTextProp().fontSize/12*16+4)/64,t.nodes){var r=t.nodes[l];if(!r.properties.skip){var i=e.nodeProperty(r,"fontSize")||12,o=[0,0],a=[0,0];if(r.properties.labelPixelOffset){var s=1/i;o=[r.properties.labelPixelOffset.x*s,r.properties.labelPixelOffset.y*s],a=[r.properties.labelPixelOffset.x/this._iconFactor,r.properties.labelPixelOffset.y/this._iconFactor]}n.push({type:"Feature",geometry:{type:"Point",coordinates:ce(r.coord)},properties:{label:r.label,labelOffset:o,iconOffset:a,fontSize:i,fontName:e.nodeProperty(r,"blackdot")?"noto":"default",icon:e.nodeProperty(r,"blackdot")?"blackdot":"",fill:e.nodeProperty(r,"fill"),stroke:e.nodeProperty(r,"stroke")}})}}return{type:"FeatureCollection",features:n}},e.prototype.hidePlaces=function(e){var t=[["!in","name:"+this.lang].concat(e),["!in","name"].concat(e)],n=["","-"+this.lang],l=this._map;["place_city_capital","place_city","place_town","place_village","place_other"].forEach(function(e){n.forEach(function(n){var r=e+n;if(l.getLayer(r)){var i=l.getFilter(r);i=i.concat(t),l.setFilter(r,i)}})})},e.prototype.killMapLabels=function(e){var t=this,n=this._map;if(!n.hasImage("blank4")){for(var l=new Uint8Array(64),r=0;r<4;r++)for(var i=0;i<4;i++){var o=4*(4*i+r);l[o+0]=255,l[o+1]=0,l[o+2]=0,l[o+3]=0}n.addImage("blank4",{width:4,height:4,data:l})}e||console.log("No marked places!");var a=e.map(ce);this._graph&&(a=a.concat(Object.keys(this._graph.nodes).map(function(e){return ce(t._graph.nodes[e].coord)})));for(var s=n.getCanvas(),u=s.clientWidth,p=s.clientHeight,d=[],c=18;c<u;c+=18)d.push(n.unproject([c,0])),d.push(n.unproject([c,p]));for(var h=18;h<p;h+=18)d.push(n.unproject([0,h])),d.push(n.unproject([u,h]));var f={type:"FeatureCollection",features:(a=a.concat(d.map(function(e){return[e.lng,e.lat]}))).map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e}}})},g=n.getSource("blankSource");g?g.setData(f):(n.addSource("blankSource",{type:"geojson",data:f}),n.addLayer({id:"blank",type:"symbol",source:"blankSource",minZoom:0,layout:{"icon-image":"blank4","icon-anchor":"center","icon-size":4,"icon-allow-overlap":!0,visibility:this._disabledLayers?"none":"visible"}}))},e.prototype.switchCustomLayers=function(e){if(this._map){var t=this._map;if(!e||this._disabledLayers){if(!e){if(this._disabledLayers)return;this._disabledLayers=["blank","dayLabels","canvasLayer"];for(var n=this._map.getStyle().layers,l=0;l<n.length;l++){var r=n[l];"symbol"==r.type&&"visible"==t.getLayoutProperty(r.id,"visibility")&&this._disabledLayers.push(r.id)}}var i=e?"visible":"none";this._disabledLayers.forEach(function(e){t.setLayoutProperty(e,"visibility",i)}),e&&(this._disabledLayers=void 0)}}},e.prototype.genBlackDot=function(){var e=this._map;if(!e.hasImage("blackdot")){for(var t=new Uint8Array(16384),n=new c(31.5,31.5),l=0;l<64;l++)for(var r=0;r<64;r++){var i=new c(l,r),o=c.dist(i,n),a=Math.min(1,Math.max(0,31.5-o)),s=4*(64*r+l);t[s+0]=0,t[s+1]=0,t[s+2]=0,t[s+3]=255*a}e.addImage("blackdot",{width:64,height:64,data:t})}},e.prototype.setLayersVisibility=function(e){for(var t=0,n=["dayLabels","canvasLayer","blank"];t<n.length;t++){var l=n[t];this._map.setLayoutProperty(l,"visibility",e)}},e.prototype.showInteractive=function(e){return Fe(this,void 0,void 0,function(){var t;return Ne(this,function(n){switch(n.label){case 0:this.setLayersVisibility("none"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,function(e,t,n){return Le(this,void 0,Promise,function(){var l,r,i,o,a,s,u,p,d,c,h,f,g;return Me(this,function(m){if(!t||!t.sources)return[2];for(l=Object.keys(t.sources),r={circle_with_arrow:!0},i=0,o=l;i<o.length;i++)if(a=o[i],(s=t.sources[a]).data&&"string"!=typeof s.data&&"FeatureCollection"==s.data.type)for(u=0,p=s.data.features;u<p.length;u++)(d=p[u]).properties&&d.properties.icon&&(r[d.properties.icon]=!0);for(c=[],h=0,f=Object.keys(r);h<f.length;h++)g=f[h],c.push(Ie(g,n,e));return[2,Promise.all(c)]})})}(this._map,e,ae().interactive_icons_url)];case 2:return n.sent(),Ee(this._map,e,this.lang,null),this._interactiveContent=e,De("on",this._map,e,this._interactiveClickHandler),[2,!0];case 3:return t=n.sent(),console.log("Failed to load icons for interactive content."),console.log(t),this.setLayersVisibility("visible"),[2,!1];case 4:return[2]}})})},e.prototype.hideInteractive=function(){De("off",this._map,this._interactiveContent,this._interactiveClickHandler),function(e,t){for(var n=0,l=t.layers||[];n<l.length;n++){var r=l[n];void 0!=e.getLayer(r.id)&&e.removeLayer(r.id)}for(var i=t.sources||{},o=0,a=Object.keys(i);o<a.length;o++){var s=a[o];void 0!=e.getSource(s)&&e.removeSource(s)}}(this._map,this._interactiveContent),this.setLayersVisibility("visible")},e.ctorParameters=function(){return[]},e}(),qe=l["\u0275crt"]({encapsulation:2,styles:[],data:{}});function Be(e){return l["\u0275vid"](0,[l["\u0275qud"](402653184,1,{mapDiv:0}),(e()(),l["\u0275eld"](0,[[1,0],["mapDiv",1]],null,0,"div",[["style","position: absolute;"]],[[4,"width","px"],[4,"height","px"]],null,null,null,null)),(e()(),l["\u0275ted"](null,["\n"]))],null,function(e,t){var n=t.component;e(t,1,0,n.canvasWidth,n.canvasHeight)})}l["\u0275ccf"]("mapview2",je,function(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"mapview2",[],null,null,null,Be,qe)),l["\u0275did"](49152,null,0,je,[],null,null)],null,null)},{canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",compactAttribution:"compactAttribution",lang:"lang"},{},[]);var Ve={CanvasTilesRenderer:CanvasTilesRenderer,PinchZoom:PinchZoom,Utils:Utils},Ue=this&&this.__awaiter||function(e,t,n,l){return new(n||(n=Promise))(function(r,i){function o(e){try{s(l.next(e))}catch(e){i(e)}}function a(e){try{s(l.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((l=l.apply(e,t||[])).next())})},$e=this&&this.__generator||function(e,t){var n,l,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,l&&(r=2&i[0]?l.return:i[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,i[1])).done)return r;switch(l=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,l=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],l=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};var Ze=function(){function e(e){this.el=e,this.waitingList=[],this._showOld=!0,this._removeMapLabels=!1,this.interactive=!1}return e.prototype.pixelRatio=function(){return this._renderer&&this._renderer.pixelRatio?this._renderer.pixelRatio:1},e.prototype.getCanvasWidth=function(){return this.canvasWidth?this.canvasWidth:this.el&&this.el.nativeElement?this.el.nativeElement.offsetWidth:0},e.prototype.getCanvasHeight=function(){return this.canvasHeight?this.canvasHeight:this.el&&this.el.nativeElement?this.el.nativeElement.offsetHeight:0},e.prototype.isReady=function(){var e=this._map;return e&&this._renderer&&this._tripLayer&&this._tripLayer.isReady()&&e.loaded()&&!(e._sourcesDirty||e._repaint||e._styleDirty||e._placementDirty)},e.prototype.prepareCanvas=function(e){var t=this;this._options=e,this.canvas&&this.canvas.nativeElement&&!this._renderer&&!this._map?(this._map=this.mapview.createMap(e.trip),this._map.on("load",function(){var n=t.canvas.nativeElement,l=e.trip.location();t._renderer=new Ve.CanvasTilesRenderer({canvas:n,width:1,clearBorder:!1,downsampleDuringMotion:!1,fillScreen:!1,downgradeIfSlowerFPS:1e-8,url:"https://tiles.wmflabs.org/bw-mapnik/$scale/$x/$y.png",initialLocation:l,onLocationChange:function(n){var l=n.getLocation();t.setMapboxLocation(l),e.onLocationChange&&e.onLocationChange(n)}}),t._renderer.pinchZoom.maxScale=t.getScaleFromZoom(0),e.disableMouseWheel&&(t._renderer.pinchZoom.handleMouseWheel=function(e){}),t._renderer.layers=[{draw:function(){var e=t.renderCanvas.nativeElement,n=t.canvas.nativeElement;e.width=n.width,e.height=n.height,e.getContext("2d").clearRect(0,0,e.width,e.height)}}],t._tripLayer=new se({renderer:t._renderer,graph:e.graph}),t._renderer.addLayer(t._tripLayer);var r=t._tripLayer.draw,i=t;t._tripLayer.draw=function(){if(this.hideLabels=!i._removeMapLabels,this.forceLeaderLines=!0,i._showOld){var e=i.renderCanvas.nativeElement;arguments[0]=e,r.apply(this,arguments);var t=e.width,n=e.height;i._canvasWorldCoord=[[0,0],[t,0],[t,n],[0,n]].map(function(e){return i._renderer.pinchZoom.worldPosFromViewerPos({x:e[0],y:e[1]})}),i.updateCanvas()}},e.created&&e.created(t._renderer,t._tripLayer);for(var o=0,a=t.waitingList;o<a.length;o++){var s=a[o];s.alreadyCreated&&s.alreadyCreated(t._renderer,t._tripLayer)}setTimeout(function(){t.setSeqTrip(e.trip),l&&(t._removeMapLabels=l.scale>1,t.switchCanvasVisibility(t._removeMapLabels),t.mapview.switchCustomLayers(!t._removeMapLabels))},10),t.resize()}),this._map.on("idle",function(){t._map;t.isReady()?t.onMapReady&&t.onMapReady():console.log("mapbox map is ready, but not mapview!!")})):e.alreadyCreated&&(this._map.loaded()?e.alreadyCreated(this._renderer,this._tripLayer):this.waitingList.push(e))},e.prototype.getLayer=function(e){},e.prototype.setLayerColors=function(e){},e.prototype.resize=function(){this.mapview.resize(),this._renderer&&(this._renderer.pinchZoom.maxScale=this.getScaleFromZoom(0),this.setMapboxLocation(this._renderer.getLocation()))},e.prototype.setMapboxLocation=function(e){this.mapview.setMapboxLocation(e),this._removeMapLabels=e.scale>1,this.switchCanvasVisibility(this._removeMapLabels),this.mapview.switchCustomLayers(!this._removeMapLabels)},e.prototype.getZoomFromLocation=function(e){if(e){var t=this.getCanvasWidth();return Math.log2(1/(e.scale*(512/t)))}return 8},e.prototype.getScaleFromZoom=function(e){return this.getCanvasWidth()/512*1/Math.pow(2,e)},e.prototype.setSeqTrip=function(e){var t,n=this;this._seqTrip=e,this._tripLayer.graph&&Object.keys(this._tripLayer.graph.nodes).length>0?t=this._tripLayer.graph:(t=e.makeGraph(this._tripLayer),this._tripLayer.graph=t),this._tripLayer.defaultRadius=e.defaultRadius(),this._tripLayer.defaultTextProp=e.defaultTextProp(),this._tripLayer.defaultEdgeProp=e.defaultEdgeProp();var l,r,i,o,a,s=e.location();l=s,r=this._renderer.location,i=l.x-r.x,o=l.y-r.y,a=l.scale-r.scale,Math.abs(i)<1e-7&&Math.abs(o)<1e-7&&Math.abs(a)<1e-7||this._renderer.setLocation(s),this.setMapboxLocation(s),this.setLayerColors(e),this._renderer.refresh(),this.resize(),this._tripLayer.loadIcons(function(e){e&&console.log(e),n._renderer.refresh()});var u=this.renderCanvas.nativeElement,p=u.width,d=u.height;return this.mapview.addTripLayers(e,t,u,[[0,0],[p,0],[p,d],[0,d]].map(function(e){return n._renderer.pinchZoom.worldPosFromViewerPos({x:e[0],y:e[1]})}),this._tripLayer.markedPlaces),t},e.prototype.updateCanvas=function(){if(this._canvasWorldCoord){var e=this.renderCanvas.nativeElement;e.width,e.height;this.mapview.updateCanvasLayer(e,this._canvasWorldCoord,this._tripLayer.markedPlaces)}},e.prototype.refresh=function(){this._renderer&&this._renderer.refresh(),this._seqTrip&&this.setSeqTrip(this._seqTrip)},e.prototype.attribution=function(){var e=this._map;if(!e||!e.style)return[];var t=[],n=e.style.sourceCaches;for(var l in n){var r=n[l];if(r.used){var i=r.getSource();i.attribution&&t.indexOf(i.attribution)<0&&t.push(i.attribution)}}return t.sort(function(e,t){return e.length-t.length}),t=t.filter(function(e,n){for(var l=n+1;l<t.length;l++)if(t[l].indexOf(e)>=0)return!1;return!0})},e.prototype.switchCanvasVisibility=function(e){var t=this.renderCanvas.nativeElement,n=t.parentElement;e?n.insertBefore(t,this.canvas.nativeElement):n.insertBefore(t,n.firstChild)},e.prototype.addMarker=function(e,t){if(this._map)return new mapboxgl.Marker(t).setLngLat([e.longitude,e.latitude]).addTo(this._map)},e.prototype.addAttributionControl=function(e){this._map&&this._map.addControl(new mapboxgl.AttributionControl({compact:e}))},e.prototype.toggleInteractive=function(){return Ue(this,void 0,void 0,function(){var e,t;return $e(this,function(n){switch(n.label){case 0:return this.interactive=!this.interactive,this.interactive?(t=(e=this.mapview).showInteractive,[4,ve(this._seqTrip)]):[3,3];case 1:return[4,t.apply(e,[n.sent()])];case 2:return n.sent()||(this.interactive=!1),this.refresh(),[3,4];case 3:this.mapview.hideInteractive(),this.setMapboxLocation(this._renderer.getLocation()),this.refresh(),n.label=4;case 4:return[2]}})})},e.prototype.updateInteractive=function(){return Ue(this,void 0,void 0,function(){var e,t;return $e(this,function(n){switch(n.label){case 0:return this.interactive?(this.mapview.hideInteractive(),t=(e=this.mapview).showInteractive,[4,ve(this._seqTrip)]):[2];case 1:return[4,t.apply(e,[n.sent()])];case 2:return n.sent()||(this.interactive=!1),[2]}})})},e.ctorParameters=function(){return[{type:l.ElementRef}]},e}(),Ge=l["\u0275crt"]({encapsulation:2,styles:[],data:{}});function He(e){return l["\u0275vid"](0,[l["\u0275qud"](402653184,1,{renderCanvas:0}),l["\u0275qud"](402653184,2,{canvas:0}),l["\u0275qud"](402653184,3,{mapview:0}),(e()(),l["\u0275eld"](0,[[1,0],["renderCanvas",1]],null,0,"canvas",[["style","position: absolute;"]],[[4,"width","px"],[4,"height","px"],[1,"width",0],[1,"height",0]],null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"mapview2",[["style","display:block; position:absolute;"]],[[4,"width","px"],[4,"height","px"]],null,null,Be,qe)),l["\u0275did"](49152,[[3,4],["mapview",4]],0,je,[],{canvasWidth:[0,"canvasWidth"],canvasHeight:[1,"canvasHeight"],compactAttribution:[2,"compactAttribution"],lang:[3,"lang"]},null),(e()(),l["\u0275eld"](0,[[2,0],["eventCanvas",1]],null,0,"canvas",[["style","position: absolute;"]],[[8,"hidden",0],[4,"width","px"],[4,"height","px"],[1,"width",0],[1,"height",0]],null,null,null,null)),(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){var n=t.component;e(t,5,0,n.getCanvasWidth(),n.getCanvasHeight(),!0,n.lang)},function(e,t){var n=t.component;e(t,3,0,n.getCanvasWidth(),n.getCanvasHeight(),n.getCanvasWidth()*n.pixelRatio(),n.getCanvasHeight()*n.pixelRatio()),e(t,4,0,n.getCanvasWidth(),n.getCanvasHeight()),e(t,6,0,n.interactive,n.getCanvasWidth(),n.getCanvasHeight(),n.getCanvasWidth()*n.pixelRatio(),n.getCanvasHeight()*n.pixelRatio())})}l["\u0275ccf"]("mapview",Ze,function(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"mapview",[],null,null,null,He,Ge)),l["\u0275did"](49152,null,0,Ze,[l.ElementRef],null,null)],null,null)},{canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",compactAttribution:"compactAttribution",lang:"lang"},{},[]);var Je=n("oZUJ"),Ke=n("+dHm"),Xe=n("F6a+"),Ye=n("RaSy"),Qe=n("Zek7"),et=n("4ejn"),tt=[[".node-legend[_ngcontent-%COMP%]{font-size:7pt;color:gray;padding-top:2pt;margin-left:5px}.properties[_ngcontent-%COMP%]{font-size:12px}.maptabset[_ngcontent-%COMP%]    .panel-heading{padding:10px 15px}.maptabset[_ngcontent-%COMP%]    .panel{margin-bottom:1px}tabset[_ngcontent-%COMP%]    .nav-stacked{float:left}tabset[_ngcontent-%COMP%]    .tab-content{float:left;width:305px;margin-right:6px}.inline[_ngcontent-%COMP%]{display:inline-block}.floatleft[_ngcontent-%COMP%]{float:left}.floatright[_ngcontent-%COMP%]{float:right}.nodeSelected[_ngcontent-%COMP%]{font-weight:700}.nodeSkipped[_ngcontent-%COMP%]{color:gray}.small[_ngcontent-%COMP%]{width:25px;height:25px}button.delete[_ngcontent-%COMP%]{margin-top:2px;margin-right:.8em;background-color:#d3d3d3;color:red}div.maptabset[_ngcontent-%COMP%]{float:left}.label-input[_ngcontent-%COMP%]{width:95%}tab[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{width:100%} .square{width:10px;height:10px;display:inline-block;margin:3px}.hidden[_ngcontent-%COMP%]{display:none}.global-buttons[_ngcontent-%COMP%]{margin-bottom:20px}.maptabset[_ngcontent-%COMP%]    .nav-pills{margin-right:6px}.maptabset[_ngcontent-%COMP%]    .nav-item{border-right:1px solid #ddd;margin:0}.maptabset[_ngcontent-%COMP%]    .nav-item.active{border-top:1px solid #ddd;border-bottom:1px solid #ddd;border-left:1px solid #ddd;border-right:0}.maptabset[_ngcontent-%COMP%]    .nav-item.active  a{color:#428bca;background-color:#fff}.maptabset[_ngcontent-%COMP%]    .tab-content  button{width:100%}.spin-loader[_ngcontent-%COMP%]{position:absolute;bottom:-20px;left:0;right:0;top:-20px;z-index:10000;background:url(/ng-map/assets/loader.gif) center center no-repeat rgba(0,0,0,.6);background-size:80px 80px;display:block}.maptabset[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{height:2em}.maptabset[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]{font-size:12px;text-align:right;margin-top:5px;display:table}.maptabset[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:table-cell;vertical-align:middle;height:25px}.maptabset[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#428bca}.maptabset[_ngcontent-%COMP%]   .panel-default[_ngcontent-%COMP%]{margin-bottom:7px}.maptabset[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{-webkit-box-shadow:none;box-shadow:none}.route-action[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{float:right;margin:0;height:12px}.route-action[_ngcontent-%COMP%]{min-width:30px}.route-action[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{float:right;font-size:10px;margin-right:4px;color:#428bca}.button-separtor[_ngcontent-%COMP%]{margin:10px 0}.map-colors[_ngcontent-%COMP%]{position:relative;padding:5px 0}.map-colors[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:40px;top:11px}.heading[_ngcontent-%COMP%]   .map-btn[_ngcontent-%COMP%]{margin-top:10px}.in-margin-top[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.fa-right-margin[_ngcontent-%COMP%]{margin-right:7px}.form-control-input[_ngcontent-%COMP%]{display:inline-block;margin-right:10px;height:34px;padding:6px 12px;font-size:12px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out}.italic[_ngcontent-%COMP%]{font-style:italic;padding-left:12px;font-size:12px}.btn-group[_ngcontent-%COMP%]{width:100%}.form-control[_ngcontent-%COMP%]{margin-top:5px}.blue[_ngcontent-%COMP%]{margin-right:10px;color:#428bca}#accordion-menu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#333;background-color:#f5f5f5;cursor:pointer;padding:10px 20px;margin:0;border-top-left-radius:4px;border-top-right-radius:4px;border:1px solid #ddd;-webkit-box-shadow:0 1px 1px rgba(0,0,0,.05);box-shadow:0 1px 1px rgba(0,0,0,.05)}#accordion-menu[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{border:1px solid #ddd;padding:20px 15px 10px;color:#333;background-color:#fff;display:none;margin:0}#accordion-menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style-type:none}#accordion-menu[_ngcontent-%COMP%]   .collapsable-menu[_ngcontent-%COMP%]{display:none}#accordion-menu[_ngcontent-%COMP%]   .uncollapsable-menu[_ngcontent-%COMP%]{display:block}#long-accord[_ngcontent-%COMP%]{max-height:600px;padding-right:5px}#long-accord[_ngcontent-%COMP%]::-webkit-scrollbar{background-color:#eee;width:6px}#long-accord[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#999;border-radius:6px}.thinbutton[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}#scaleSlider[_ngcontent-%COMP%]{padding:15px}.hflex-container[_ngcontent-%COMP%]{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-ms-flex-pack:start;-webkit-box-pack:start;justify-content:flex-start;-ms-flex-line-pack:stretch;align-content:stretch;-ms-flex-align:start;-webkit-box-align:start;align-items:flex-start}.flex-item-narrow[_ngcontent-%COMP%], .flex-item-wide[_ngcontent-%COMP%]{-ms-flex-order:0;-webkit-box-ordinal-group:1;order:0;-webkit-align-self:auto;-ms-flex-item-align:auto;-ms-grid-row-align:auto;align-self:auto}.flex-item-narrow[_ngcontent-%COMP%]{-ms-flex:0 1 auto;-webkit-box-flex:0;flex:0 1 auto}.flex-item-wide[_ngcontent-%COMP%]{-ms-flex:1 1 auto;-webkit-box-flex:1;flex:1 1 auto}.smallspacing[_ngcontent-%COMP%]{margin-top:5px;margin-bottom:5px}"]],nt=l["\u0275crt"]({encapsulation:0,styles:tt,data:{}});function lt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Please add at least one location in a day or event settings"]))],null,null)}function rt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Loading..."]))],null,null)}function it(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,7,"div",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275eld"](0,null,null,1,"p",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["No map created yet."])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275eld"](0,null,null,1,"button",[["class","btn btn-primary"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.fetchLocationsAndGenerateMap()&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Create map"])),(e()(),l["\u0275ted"](null,["\n"]))],null,null)}function ot(e){return l["\u0275vid"](0,[(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["class","glyphicon glyphicon-map-marker"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "]))],null,null)}function at(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,3,"option",[["class","form-control"],["required",""]],null,null,null,null,null)),l["\u0275did"](147456,null,0,s.i,[l.ElementRef,l.Renderer2,[2,s.j]],{value:[0,"value"]},null),l["\u0275did"](147456,null,0,s.o,[l.ElementRef,l.Renderer2,[8,null]],{value:[0,"value"]},null),(e()(),l["\u0275ted"](null,["",""]))],function(e,t){e(t,1,0,t.context.$implicit.key()),e(t,2,0,t.context.$implicit.key())},function(e,t){e(t,3,0,t.context.$implicit.name)})}function st(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,0,"input",[["type","checkbox"]],[[8,"checked",0],[8,"disabled",0]],[[null,"change"],[null,"click"]],function(e,t,n){var l=!0,r=e.component;"change"===t&&(l=!1!==r.toggleHideEdge(e.parent.parent.context.$implicit.edge)&&l);"click"===t&&(l=!1!==n.stopPropagation()&&l);return l},null,null))],null,function(e,t){var n=t.component;e(t,0,0,!t.parent.parent.context.$implicit.edge.properties.hidden&&!n.isSkipped(t.parent.parent.context.$implicit.node),n.isSkipped(t.parent.parent.context.$implicit.node))})}function ut(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,0,"i",[["class","fa fa-road"]],null,null,null,null,null))],null,null)}function pt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"edge-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,t,n){var l=!0,r=e.component;"propertiesChange"===t&&(l=!1!==(e.parent.parent.parent.context.$implicit.edge.properties=n)&&l);"onChange"===t&&(l=!1!==r.edgePropertiesChanged(e.parent.parent.parent.context.$implicit.edge)&&l);return l},w,v)),l["\u0275did"](376832,null,0,g,[l.KeyValueDiffers],{properties:[0,"properties"],defaults:[1,"defaults"]},{onChange:"onChange"})],function(e,t){var n=t.component;e(t,1,0,t.parent.parent.parent.context.$implicit.edge.properties,n._seqTrip._tripData.defaultEdgeProp)},null)}function dt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,50,"div",[["class","btn-group properties"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,34,"div",[["style","margin-bottom: 10px;"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,31,"span",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n              "])),(e()(),l["\u0275eld"](0,null,null,8,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,t,n){var r=!0,i=e.component;"click"===t&&(r=!1!==l["\u0275nov"](e,7).onClick()&&r);"click"===t&&(r=!1!==i.toggleProperty(e.parent.parent.context.$implicit.node,"landing")&&r);return r},null,null)),l["\u0275did"](81920,null,0,x.a,[],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[x.a]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n                "])),(e()(),l["\u0275eld"](0,null,null,0,"img",[["alt","Landing"],["height","16px"],["src","/ng-map/assets/landing.svg"],["width","16px"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n              "])),(e()(),l["\u0275ted"](null,["\n              "])),(e()(),l["\u0275eld"](0,null,null,8,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,t,n){var r=!0,i=e.component;"click"===t&&(r=!1!==l["\u0275nov"](e,17).onClick()&&r);"click"===t&&(r=!1!==i.toggleProperty(e.parent.parent.context.$implicit.node,"takeoff")&&r);return r},null,null)),l["\u0275did"](81920,null,0,x.a,[],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[x.a]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n                "])),(e()(),l["\u0275eld"](0,null,null,0,"img",[["alt","Take-off"],["height","16px"],["src","/ng-map/assets/takeoff.svg"],["width","16px"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n              "])),(e()(),l["\u0275ted"](null,["\n              "])),(e()(),l["\u0275eld"](0,null,null,8,"label",[["btnCheckbox",""],["class","btn btn-default map-btn"]],[[2,"active",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"]],function(e,t,n){var r=!0,i=e.component;"click"===t&&(r=!1!==l["\u0275nov"](e,27).onClick()&&r);"click"===t&&(r=!1!==i.setProperty(e.parent.parent.context.$implicit.node,"markStyle",i.hasMark(e.parent.parent.context.$implicit.node)?"normal":"first")&&r);return r},null,null)),l["\u0275did"](81920,null,0,x.a,[],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[x.a]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n                "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-circle"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n              "])),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,0,"hr",[["class","smallspacing"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,1,"text-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,t,n){var l=!0,r=e.component;"propertiesChange"===t&&(l=!1!==(e.parent.parent.context.$implicit.node.properties=n)&&l);"onChange"===t&&(l=!1!==r.nodePropertiesChanged()&&l);return l},S,M)),l["\u0275did"](376832,null,0,k,[d.ColorPickerService,l.KeyValueDiffers],{properties:[0,"properties"],defaults:[1,"defaults"]},{onChange:"onChange"}),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n\n          "])),(e()(),l["\u0275eld"](0,null,null,0,"hr",[["class","smallspacing"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n\n          "])),(e()(),l["\u0275and"](16777216,null,null,1,null,pt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n        "]))],function(e,t){var n=t.component;e(t,7,0),e(t,9,0,t.parent.parent.context.$implicit.node.properties.landing),e(t,17,0),e(t,19,0,t.parent.parent.context.$implicit.node.properties.takeoff),e(t,27,0),e(t,29,0,n.hasMark(t.parent.parent.context.$implicit.node)),e(t,43,0,t.parent.parent.context.$implicit.node.properties,n._seqTrip._tripData.defaultTextProp),e(t,49,0,t.parent.parent.context.$implicit.edge&&!t.parent.parent.context.$implicit.edge.properties.hidden)},function(e,t){e(t,6,0,l["\u0275nov"](t,7).state,l["\u0275nov"](t,11).ngClassUntouched,l["\u0275nov"](t,11).ngClassTouched,l["\u0275nov"](t,11).ngClassPristine,l["\u0275nov"](t,11).ngClassDirty,l["\u0275nov"](t,11).ngClassValid,l["\u0275nov"](t,11).ngClassInvalid,l["\u0275nov"](t,11).ngClassPending),e(t,16,0,l["\u0275nov"](t,17).state,l["\u0275nov"](t,21).ngClassUntouched,l["\u0275nov"](t,21).ngClassTouched,l["\u0275nov"](t,21).ngClassPristine,l["\u0275nov"](t,21).ngClassDirty,l["\u0275nov"](t,21).ngClassValid,l["\u0275nov"](t,21).ngClassInvalid,l["\u0275nov"](t,21).ngClassPending),e(t,26,0,l["\u0275nov"](t,27).state,l["\u0275nov"](t,31).ngClassUntouched,l["\u0275nov"](t,31).ngClassTouched,l["\u0275nov"](t,31).ngClassPristine,l["\u0275nov"](t,31).ngClassDirty,l["\u0275nov"](t,31).ngClassValid,l["\u0275nov"](t,31).ngClassInvalid,l["\u0275nov"](t,31).ngClassPending)})}function ct(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,46,"accordion-group",[["class","panel"],["style","display: block"]],[[2,"nodeSkipped",null],[2,"panel-open",null]],null,null,O.b,O.a)),l["\u0275did"](245760,[["group",4]],0,I.a,[D.a],{isOpen:[0,"isOpen"]},null),(e()(),l["\u0275ted"](1,["\n        "])),(e()(),l["\u0275eld"](0,null,0,39,"div",[["accordion-heading",""],["class","hflex-container"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,2,"i",[["class","fa fa-right-margin flex-item-narrow in-margin-top"],["style","font-size: 14pt"]],null,null,null,null,null)),l["\u0275did"](278528,null,0,u.NgClass,[l.IterableDiffers,l.KeyValueDiffers,l.ElementRef,l.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),l["\u0275pod"]({"fa-caret-down":0,"fa-caret-right":1}),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,12,"div",[["class","flex-item-wide"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,5,"input",[["class","form-control-input label-input"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"],[null,"change"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,t,n){var r=!0,i=e.component;"input"===t&&(r=!1!==l["\u0275nov"](e,12)._handleInput(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,12).onTouched()&&r);"compositionstart"===t&&(r=!1!==l["\u0275nov"](e,12)._compositionStart()&&r);"compositionend"===t&&(r=!1!==l["\u0275nov"](e,12)._compositionEnd(n.target.value)&&r);"click"===t&&(r=!1!==n.stopPropagation()&&r);"change"===t&&(r=!1!==i.setNodeLabel(e.parent.context.$implicit.node,n.target.value)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.c,[l.Renderer2,l.ElementRef,[2,s.a]],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[s.c]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n\n            "])),(e()(),l["\u0275eld"](0,null,null,1,"div",[["class","node-legend"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["",""])),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,18,"div",[["class","route-action"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,5,"input",[["type","checkbox"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"click"],[null,"change"],[null,"blur"]],function(e,t,n){var r=!0,i=e.component;"change"===t&&(r=!1!==l["\u0275nov"](e,26).onChange(n.target.checked)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,26).onTouched()&&r);"click"===t&&(i.toggleSkipNode(e.parent.context.$implicit.node),r=!1!==n.stopPropagation()&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.b,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[s.b]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["class","glyphicon glyphicon-map-marker"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,0,"br",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275and"](16777216,null,null,1,null,st)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275and"](16777216,null,null,1,null,ut)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](1,["\n        "])),(e()(),l["\u0275and"](16777216,null,1,1,null,dt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](1,["\n      "]))],function(e,t){var n=t.component;e(t,1,0,n.isNodeSelected(t.parent.context.$implicit.node)||n.isEdgeSelected(t.parent.context.$implicit.edge));e(t,6,0,"fa fa-right-margin flex-item-narrow in-margin-top",e(t,7,0,null==l["\u0275nov"](t,1)?null:l["\u0275nov"](t,1).isOpen,!(null!=l["\u0275nov"](t,1)&&l["\u0275nov"](t,1).isOpen))),e(t,14,0,n.isSkipped(t.parent.context.$implicit.node),t.parent.context.$implicit.node.label),e(t,28,0,!n.isSkipped(t.parent.context.$implicit.node)),e(t,37,0,t.parent.context.$implicit.edge),e(t,40,0,t.parent.context.$implicit.edge),e(t,45,0,!n.isSkipped(t.parent.context.$implicit.node))},function(e,t){var n=t.component;e(t,0,0,t.parent.context.$implicit.node&&n.isSkipped(t.parent.context.$implicit.node),l["\u0275nov"](t,1).isOpen),e(t,11,0,l["\u0275nov"](t,16).ngClassUntouched,l["\u0275nov"](t,16).ngClassTouched,l["\u0275nov"](t,16).ngClassPristine,l["\u0275nov"](t,16).ngClassDirty,l["\u0275nov"](t,16).ngClassValid,l["\u0275nov"](t,16).ngClassInvalid,l["\u0275nov"](t,16).ngClassPending),e(t,19,0,t.parent.context.$implicit.node.indication),e(t,25,0,l["\u0275nov"](t,30).ngClassUntouched,l["\u0275nov"](t,30).ngClassTouched,l["\u0275nov"](t,30).ngClassPristine,l["\u0275nov"](t,30).ngClassDirty,l["\u0275nov"](t,30).ngClassValid,l["\u0275nov"](t,30).ngClassInvalid,l["\u0275nov"](t,30).ngClassPending)})}function ht(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,4,null,null,null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275and"](16777216,null,null,1,null,ct)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n      "]))],function(e,t){e(t,3,0,t.context.$implicit.node)},null)}function ft(e){return l["\u0275vid"](0,[(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["class","fa fa-file"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "]))],null,null)}function gt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,153,"div",[["class","maptabset"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275eld"](0,null,null,150,"tabset",[["type","pills"]],[[2,"tab-container",null]],null,null,R.b,R.a)),l["\u0275did"](180224,null,0,E.a,[z.a],{vertical:[0,"vertical"],type:[1,"type"]},null),(e()(),l["\u0275ted"](0,["\n  "])),(e()(),l["\u0275eld"](0,null,0,63,"tab",[],[[2,"active",null],[2,"tab-pane",null]],[[null,"select"]],function(e,t,n){var l=!0,r=e.component;"select"===t&&(l=!1!==r.lockMap(!0)&&l);return l},null,null)),l["\u0275did"](212992,null,0,F.a,[E.a,l.ElementRef,l.Renderer],null,{select:"select"}),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275and"](0,null,null,1,null,ot)),l["\u0275did"](16384,null,0,N.a,[l.TemplateRef,F.a],null,null),(e()(),l["\u0275ted"](null,["\n\n    "])),(e()(),l["\u0275eld"](0,null,null,26,"div",[["class","row heading"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,12,"div",[["class","col-md-5"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,9,"select",[["class","form-control btn-xs"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"blur"]],function(e,t,n){var r=!0,i=e.component;"change"===t&&(r=!1!==l["\u0275nov"](e,16).onChange(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,16).onTouched()&&r);"change"===t&&(r=!1!==i.uiSetPageSize(n.target.value)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.j,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e){return[e]},[s.j]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275and"](16777216,null,null,1,null,at)),l["\u0275did"](802816,null,0,u.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,9,"div",[["class","col-md-7 legend"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,6,"p",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,1,"i",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Display location"])),(e()(),l["\u0275ted"](null,[" "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["class","glyphicon glyphicon-map-marker"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,18,"div",[["class","row heading"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[["class","col-md-5"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,1,"button",[["class","btn btn-default btn-xs map-btn"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.uiSetFrame()&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Auto scroll/zoom"])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n\n      "])),(e()(),l["\u0275eld"](0,null,null,9,"div",[["class","col-md-7 legend"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,6,"p",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,1,"i",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Line to next active location"])),(e()(),l["\u0275ted"](null,[" "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["class","fa fa-road"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,0,"hr",[["class","button-separtor"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,6,"accordion",[["class","panel-group"],["id","long-accord"],["role","tablist"],["style","display: block"]],[[1,"aria-multiselectable",0]],null,null,A.b,A.a)),l["\u0275did"](49152,null,0,D.a,[W.a],{closeOthers:[0,"closeOthers"]},null),(e()(),l["\u0275ted"](0,["\n      "])),(e()(),l["\u0275and"](16777216,null,0,1,null,ht)),l["\u0275did"](802816,null,0,u.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(e()(),l["\u0275ted"](0,["  "])),(e()(),l["\u0275ted"](0,["\n    "])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](0,["\n\n  "])),(e()(),l["\u0275eld"](0,null,0,81,"tab",[],[[2,"active",null],[2,"tab-pane",null]],[[null,"select"]],function(e,t,n){var l=!0,r=e.component;"select"===t&&(l=!1!==r.lockMap(!1)&&l);return l},null,null)),l["\u0275did"](212992,null,0,F.a,[E.a,l.ElementRef,l.Renderer],null,{select:"select"}),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275and"](0,null,null,1,null,ft)),l["\u0275did"](16384,null,0,N.a,[l.TemplateRef,F.a],null,null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,29,"div",[["class","panel panel-default"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,26,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,1,"label",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Zoom / center"])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,9,"div",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,6,"input",[["id","scaleSlider"],["max","18"],["min","0"],["step","0.000001"],["type","range"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"change"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(e,t,n){var r=!0,i=e.component;"input"===t&&(r=!1!==l["\u0275nov"](e,89)._handleInput(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,89).onTouched()&&r);"compositionstart"===t&&(r=!1!==l["\u0275nov"](e,89)._compositionStart()&&r);"compositionend"===t&&(r=!1!==l["\u0275nov"](e,89)._compositionEnd(n.target.value)&&r);"change"===t&&(r=!1!==l["\u0275nov"](e,90).onChange(n.target.value)&&r);"input"===t&&(r=!1!==l["\u0275nov"](e,90).onChange(n.target.value)&&r);"blur"===t&&(r=!1!==l["\u0275nov"](e,90).onTouched()&&r);"change"===t&&(r=!1!==i.setScale(n.target.value)&&r);"input"===t&&(r=!1!==i.setScale(n.target.value)&&r);return r},null,null)),l["\u0275did"](16384,null,0,s.c,[l.Renderer2,l.ElementRef,[2,s.a]],null,null),l["\u0275did"](16384,null,0,s.m,[l.Renderer2,l.ElementRef],null,null),l["\u0275prd"](1024,null,s.e,function(e,t){return[e,t]},[s.c,s.m]),l["\u0275did"](671744,null,0,s.h,[[8,null],[8,null],[8,null],[2,s.e]],{model:[0,"model"]},null),l["\u0275prd"](2048,null,s.f,null,[s.h]),l["\u0275did"](16384,null,0,s.g,[s.f],null,null),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,6,"div",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,0,"input",[["type","checkbox"]],[[8,"checked",0]],[[null,"change"]],function(e,t,n){var l=!0,r=e.component;"change"===t&&(l=!1!=(r._autoLockMap=!r._autoLockMap)&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,1,"span",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["Auto lock map"])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,16,"div",[["class","panel panel-default"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,13,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,3,"label",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-map-marker blue"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,[" Default text properties\n          "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,1,"text-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,t,n){var l=!0,r=e.component;"propertiesChange"===t&&(l=!1!==(r._seqTrip._tripData.defaultTextProp=n)&&l);"onChange"===t&&(l=!1!==r.nodePropertiesChanged()&&l);return l},S,M)),l["\u0275did"](376832,null,0,k,[d.ColorPickerService,l.KeyValueDiffers],{properties:[0,"properties"],noReset:[1,"noReset"]},{onChange:"onChange"}),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,16,"div",[["class","panel panel-default"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,13,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,3,"label",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-road blue"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,[" Default line properties\n          "])),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n            "])),(e()(),l["\u0275eld"](0,null,null,1,"edge-prop",[],null,[[null,"propertiesChange"],[null,"onChange"]],function(e,t,n){var l=!0,r=e.component;"propertiesChange"===t&&(l=!1!==(r._seqTrip._tripData.defaultEdgeProp=n)&&l);"onChange"===t&&(l=!1!==r.edgePropertiesChanged()&&l);return l},w,v)),l["\u0275did"](376832,null,0,g,[l.KeyValueDiffers],{properties:[0,"properties"],noReset:[1,"noReset"]},{onChange:"onChange"}),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,7,"div",[["class","panel panel-default"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275eld"](0,null,null,4,"div",[["class","panel-body"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n          "])),(e()(),l["\u0275eld"](0,null,null,1,"button",[["class","btn btn-default btn-xs map-btn"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.applyDefaultsEverywhere()&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Apply defaults everywhere"])),(e()(),l["\u0275ted"](null,["\n        "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](0,["\n"])),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){var n=t.component;e(t,3,0,!0,"pills"),e(t,6,0),e(t,18,0,n._pageSizeName),e(t,23,0,n._pageSizes);e(t,62,0,!0),e(t,65,0,n._interleaved),e(t,71,0),e(t,92,0,n.scale());e(t,120,0,n._seqTrip._tripData.defaultTextProp,!0);e(t,138,0,n._seqTrip._tripData.defaultEdgeProp,!0)},function(e,t){var n=t.component;e(t,2,0,l["\u0275nov"](t,3).clazz),e(t,5,0,l["\u0275nov"](t,6).active,l["\u0275nov"](t,6).addClass),e(t,15,0,l["\u0275nov"](t,20).ngClassUntouched,l["\u0275nov"](t,20).ngClassTouched,l["\u0275nov"](t,20).ngClassPristine,l["\u0275nov"](t,20).ngClassDirty,l["\u0275nov"](t,20).ngClassValid,l["\u0275nov"](t,20).ngClassInvalid,l["\u0275nov"](t,20).ngClassPending),e(t,61,0,l["\u0275nov"](t,62).closeOthers),e(t,70,0,l["\u0275nov"](t,71).active,l["\u0275nov"](t,71).addClass),e(t,88,0,l["\u0275nov"](t,94).ngClassUntouched,l["\u0275nov"](t,94).ngClassTouched,l["\u0275nov"](t,94).ngClassPristine,l["\u0275nov"](t,94).ngClassDirty,l["\u0275nov"](t,94).ngClassValid,l["\u0275nov"](t,94).ngClassInvalid,l["\u0275nov"](t,94).ngClassPending),e(t,99,0,n._autoLockMap)})}function mt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.download("mbtiles",{zip:1})&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Export Map zip"]))],null,null)}function vt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.download("mbtiles",{zip:1,maxzoom:14})&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Export Map zip (max details)"]))],null,null)}function yt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,0,"li",[["class","divider dropdown-divider"]],null,null,null,null,null))],null,null)}function bt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.toggleInteractive()&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Switch print/interactive view"]))],null,null)}function _t(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,35,"ul",[["class","dropdown-menu dropdown-menu-right"],["role","menu"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.autoPlaceLabels()&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Auto place labels"])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.resetCurves()&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Reset curves"])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.resetLabels()&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Reset labels"])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,0,"li",[["class","divider dropdown-divider"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.download("jpg")&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Export JPG"])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,2,"li",[["role","menuitem"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,1,"a",[["class","dropdown-item"],["href","#"]],null,[[null,"click"]],function(e,t,n){var l=!0,r=e.component;"click"===t&&(l=!1!==r.download("png")&&l);return l},null,null)),(e()(),l["\u0275ted"](null,["Export PNG"])),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275and"](16777216,null,null,1,null,mt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275and"](16777216,null,null,1,null,vt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275and"](16777216,null,null,1,null,yt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275and"](16777216,null,null,1,null,bt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n    "]))],function(e,t){var n=t.component;e(t,25,0,n.superadmin),e(t,28,0,n.superadmin),e(t,31,0,n.superadmin),e(t,34,0,n.superadmin)},null)}function Pt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,0,"div",[["class","spin-loader"]],null,null,null,null,null))],null,null)}function wt(e){return l["\u0275vid"](0,[l["\u0275qud"](402653184,1,{mapview:0}),(e()(),l["\u0275eld"](0,null,null,0,"link",[["href","https://fonts.googleapis.com/css?family=PT+Sans"],["rel","stylesheet"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n\n"])),(e()(),l["\u0275eld"](0,null,null,1,"alert-message",[],null,null,null,G,U)),l["\u0275did"](49152,null,0,B,[q],null,null),(e()(),l["\u0275ted"](null,["\n\n"])),(e()(),l["\u0275and"](16777216,null,null,1,null,lt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275and"](16777216,null,null,1,null,rt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n\n"])),(e()(),l["\u0275and"](16777216,null,null,1,null,it)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275eld"](0,null,null,28,"div",[],[[2,"hidden",null]],null,null,null,null)),(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275and"](16777216,null,null,1,null,gt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n\n"])),(e()(),l["\u0275eld"](0,null,null,6,"div",[["class","floatleft"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275eld"](0,null,null,1,"mapview",[["style","display:block;"]],[[4,"width","px"],[4,"height","px"]],[[null,"drop"],[null,"dragover"]],function(e,t,n){var l=!0,r=e.component;"drop"===t&&(l=!1!==r.drop(n)&&l);"dragover"===t&&(l=!1!==r.allowDrop(n)&&l);return l},He,Ge)),l["\u0275did"](49152,[[1,4],["mapview",4]],0,Ze,[l.ElementRef],{canvasWidth:[0,"canvasWidth"],canvasHeight:[1,"canvasHeight"],compactAttribution:[2,"compactAttribution"],lang:[3,"lang"]},null),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275eld"](0,null,null,0,"div",[["id","map_attribution"],["style","font-size: 8pt;"]],[[8,"innerHTML",1]],null,null,null,null)),(e()(),l["\u0275ted"](null,["\n"])),(e()(),l["\u0275ted"](null,["\n\n  "])),(e()(),l["\u0275eld"](16777216,null,null,14,"span",[["class","floatright btn-group"],["dropdown",""],["style","width:auto;"]],[[2,"dropup",null],[2,"open",null],[2,"show",null]],null,null,null,null)),l["\u0275prd"](512,null,Je.a,Je.a,[]),l["\u0275did"](212992,null,0,Ke.a,[l.ElementRef,l.Renderer,l.ViewContainerRef,Xe.a,Ye.a,Je.a],null,null),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275eld"](0,null,null,6,"button",[["class","btn btn-default dropdown-toggle thinbutton"],["dropdownToggle",""],["type","button"]],[[1,"aria-haspopup",0],[1,"disabled",0],[1,"aria-expanded",0]],[[null,"click"],["document","click"],[null,"keyup.esc"]],function(e,t,n){var r=!0;"click"===t&&(r=!1!==l["\u0275nov"](e,33).onClick()&&r);"document:click"===t&&(r=!1!==l["\u0275nov"](e,33).onDocumentClick(n)&&r);"keyup.esc"===t&&(r=!1!==l["\u0275nov"](e,33).onEsc()&&r);return r},null,null)),l["\u0275did"](147456,null,0,Qe.a,[Je.a,l.ElementRef],null,null),(e()(),l["\u0275ted"](null,["\n      "])),(e()(),l["\u0275eld"](0,null,null,0,"i",[["aria-hidden","true"],["class","fa fa-cogs"]],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,0,"br",[],null,null,null,null,null)),(e()(),l["\u0275eld"](0,null,null,0,"span",[["class","caret"]],null,null,null,null,null)),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275ted"](null,["\n    "])),(e()(),l["\u0275and"](16777216,null,null,1,null,_t)),l["\u0275did"](16384,null,0,et.a,[Je.a,l.ViewContainerRef,l.TemplateRef],null,null),(e()(),l["\u0275ted"](null,["\n  "])),(e()(),l["\u0275ted"](null,["\n\n\n"])),(e()(),l["\u0275ted"](null,["\n\n"])),(e()(),l["\u0275and"](16777216,null,null,1,null,Pt)),l["\u0275did"](16384,null,0,u.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){var n=t.component;e(t,7,0,!n._loadingMap&&0==n._numLocations),e(t,10,0,n._loadingMap),e(t,13,0,n._numLocations>0&&!n._visitedPlaceList.length),e(t,18,0,!n.hideUi());e(t,23,0,n._canvasWidth,n._canvasHeight,!0,n.language),e(t,30,0),e(t,46,0,n._showSpinner)},function(e,t){var n=t.component;e(t,15,0,!n._visitedPlaceList.length),e(t,22,0,n._canvasWidth,n._canvasHeight),e(t,25,0,n.attribution()),e(t,28,0,l["\u0275nov"](t,30).dropup,l["\u0275nov"](t,30).isOpen,l["\u0275nov"](t,30).isOpen&&l["\u0275nov"](t,30).isBs4);e(t,32,0,!0,l["\u0275nov"](t,33).isDisabled,l["\u0275nov"](t,33).isOpen)})}l["\u0275ccf"]("trip-map",ke,function(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"trip-map",[],null,[["window","beforeunload"]],function(e,t,n){var r=!0;return"window:beforeunload"===t&&(r=!1!==l["\u0275nov"](e,1).doSomething(n)&&r),r},wt,nt)),l["\u0275did"](4440064,null,0,ke,[H.c,q],null,null)],function(e,t){e(t,1,0)},null)},{},{},[]);var xt=[[""]],Ct=l["\u0275crt"]({encapsulation:0,styles:xt,data:{}});function kt(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"trip-map",[],null,[["window","beforeunload"]],function(e,t,n){var r=!0;"window:beforeunload"===t&&(r=!1!==l["\u0275nov"](e,1).doSomething(n)&&r);return r},wt,nt)),l["\u0275did"](4440064,null,0,ke,[H.c,q],null,null),(e()(),l["\u0275ted"](null,["\n"]))],function(e,t){e(t,1,0)},null)}var Lt=l["\u0275ccf"]("app-root",i,function(e){return l["\u0275vid"](0,[(e()(),l["\u0275eld"](0,null,null,1,"app-root",[],null,null,null,kt,Ct)),l["\u0275did"](49152,null,0,i,[],null,null)],null,null)},{},{},[]),Mt=n("Qbdm"),Tt=n("1GJ2"),St=n("KN8t"),Ot=n("Um43"),It=n("/CuN"),Dt=n("6OI+"),Rt=n("7QEy"),Et=n("xg3z"),zt=n("yGAZ"),Ft=n("CCBf"),Nt=n("xvT5"),At=l["\u0275cmf"](r,[i],function(e){return l["\u0275mod"]([l["\u0275mpd"](512,l.ComponentFactoryResolver,l["\u0275CodegenComponentFactoryResolver"],[[8,[o.a,a.a,Lt]],[3,l.ComponentFactoryResolver],l.NgModuleRef]),l["\u0275mpd"](5120,l.LOCALE_ID,l["\u0275m"],[[3,l.LOCALE_ID]]),l["\u0275mpd"](4608,u.NgLocalization,u.NgLocaleLocalization,[l.LOCALE_ID]),l["\u0275mpd"](4608,l.Compiler,l.Compiler,[]),l["\u0275mpd"](5120,l.APP_ID,l["\u0275f"],[]),l["\u0275mpd"](5120,l.IterableDiffers,l["\u0275k"],[]),l["\u0275mpd"](5120,l.KeyValueDiffers,l["\u0275l"],[]),l["\u0275mpd"](4608,Mt.c,Mt.t,[u.DOCUMENT]),l["\u0275mpd"](6144,l.Sanitizer,null,[Mt.c]),l["\u0275mpd"](4608,Mt.f,Mt.g,[]),l["\u0275mpd"](5120,Mt.d,function(e,t,n,l){return[new Mt.l(e),new Mt.p(t),new Mt.o(n,l)]},[u.DOCUMENT,u.DOCUMENT,u.DOCUMENT,Mt.f]),l["\u0275mpd"](4608,Mt.e,Mt.e,[Mt.d,l.NgZone]),l["\u0275mpd"](135680,Mt.n,Mt.n,[u.DOCUMENT]),l["\u0275mpd"](4608,Mt.m,Mt.m,[Mt.e,Mt.n]),l["\u0275mpd"](5120,Tt.a,St.d,[]),l["\u0275mpd"](5120,Tt.c,St.e,[]),l["\u0275mpd"](4608,Tt.b,St.c,[Tt.a,Tt.c]),l["\u0275mpd"](5120,l.RendererFactory2,St.f,[Mt.m,Tt.b,l.NgZone]),l["\u0275mpd"](6144,Mt.q,null,[Mt.n]),l["\u0275mpd"](4608,l.Testability,l.Testability,[l.NgZone]),l["\u0275mpd"](4608,Mt.h,Mt.h,[u.DOCUMENT]),l["\u0275mpd"](4608,Mt.j,Mt.j,[u.DOCUMENT]),l["\u0275mpd"](4608,s.n,s.n,[]),l["\u0275mpd"](4608,H.i,H.n,[u.DOCUMENT,l.PLATFORM_ID,H.l]),l["\u0275mpd"](4608,H.o,H.o,[H.i,H.m]),l["\u0275mpd"](5120,H.a,function(e){return[e]},[H.o]),l["\u0275mpd"](4608,H.k,H.k,[]),l["\u0275mpd"](6144,H.j,null,[H.k]),l["\u0275mpd"](4608,H.h,H.h,[H.j]),l["\u0275mpd"](6144,H.b,null,[H.h]),l["\u0275mpd"](5120,H.f,H.p,[H.b,[2,H.a]]),l["\u0275mpd"](4608,H.c,H.c,[H.f]),l["\u0275mpd"](4608,d.ColorPickerService,d.ColorPickerService,[]),l["\u0275mpd"](4608,Ot.b,St.b,[l.RendererFactory2,Mt.b]),l["\u0275mpd"](4608,q,q,[]),l["\u0275mpd"](4608,W.a,W.a,[]),l["\u0275mpd"](4608,z.a,z.a,[]),l["\u0275mpd"](4608,It.a,It.a,[]),l["\u0275mpd"](4608,Xe.a,Xe.a,[l.ComponentFactoryResolver,l.NgZone,l.Injector,It.a,l.ApplicationRef]),l["\u0275mpd"](4608,Je.a,Je.a,[]),l["\u0275mpd"](512,u.CommonModule,u.CommonModule,[]),l["\u0275mpd"](1024,l.ErrorHandler,Mt.r,[]),l["\u0275mpd"](1024,l.APP_INITIALIZER,function(e,t){return[Mt.s(e,t)]},[[2,Mt.i],[2,l.NgProbeToken]]),l["\u0275mpd"](512,l.ApplicationInitStatus,l.ApplicationInitStatus,[[2,l.APP_INITIALIZER]]),l["\u0275mpd"](131584,l["\u0275e"],l["\u0275e"],[l.NgZone,l["\u0275Console"],l.Injector,l.ErrorHandler,l.ComponentFactoryResolver,l.ApplicationInitStatus]),l["\u0275mpd"](2048,l.ApplicationRef,null,[l["\u0275e"]]),l["\u0275mpd"](512,l.ApplicationModule,l.ApplicationModule,[l.ApplicationRef]),l["\u0275mpd"](512,Mt.a,Mt.a,[[3,Mt.a]]),l["\u0275mpd"](512,s.k,s.k,[]),l["\u0275mpd"](512,s.d,s.d,[]),l["\u0275mpd"](512,H.e,H.e,[]),l["\u0275mpd"](512,H.d,H.d,[]),l["\u0275mpd"](512,Dt.ColorPickerModule,Dt.ColorPickerModule,[]),l["\u0275mpd"](512,Rt.a,Rt.a,[]),l["\u0275mpd"](512,Et.a,Et.a,[]),l["\u0275mpd"](512,zt.a,zt.a,[]),l["\u0275mpd"](512,Ft.a,Ft.a,[]),l["\u0275mpd"](512,Nt.a,Nt.a,[]),l["\u0275mpd"](512,St.a,St.a,[]),l["\u0275mpd"](512,J,J,[]),l["\u0275mpd"](512,r,r,[]),l["\u0275mpd"](256,H.l,"XSRF-TOKEN",[]),l["\u0275mpd"](256,H.m,"X-XSRF-TOKEN",[]),l["\u0275mpd"](256,Ye.a,{autoClose:!0},[])])});Object(l.enableProdMode)(),Object(Mt.k)().bootstrapModuleFactory(At)}},[0]);